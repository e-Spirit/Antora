<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{mainTitle}: {subtitle} :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/cloud/1.0/Spryker/fsconnect-spryker-documentation_EN.html">
    <meta name="description" content="Dieses Dokument enthält die Dokumentation für das {modulname}-Modul von {fs}.">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/shortcut-icon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/index.html">Spartacus</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Crownpeak</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cloud" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">FirstSpirit Cloud</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../First_Steps_with_FS_Cloud_EN.html">First Steps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Getting_Started_EN.html">Getting Started</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">FirstSpirit Cloud</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dxm/1.0/index.html">DXM</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dxm/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ecom/1.0/index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ecom/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">FirstSpirit Cloud</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../headless/1.0/index.html">Headless</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../headless/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">FirstSpirit Cloud</a></li>
    <li><a href="fsconnect-spryker-documentation_EN.html">{mainTitle}: {subtitle}</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/cloud/edit/main/modules/Spryker/pages/fsconnect-spryker-documentation_EN.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">{mainTitle}: {subtitle}</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FirstSpirit is used to create versatile and project-specific content.
Thanks to the <em>FirstSpirit Connect for Spryker Commerce OS</em> module, it is possible to transfer these contents to the e-commerce shop system Spryker Commerce OS and use it there.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the remainder of the document the abbreviated form "Spryker" is used instead of "Spryker Commerce OS".</p>
</div>
<div class="paragraph">
<p>Furthermore, the entire documentation is geared towards connecting to the Spryker B2C Demo Shop in version 202009.0.
Mention of the shop therefore refers exclusively to the B2C Demo Shop.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The module combines the functional strengths of both systems, delivering the key advantages and create a successful overall system made up of two areas that work in parallel and are largely decoupled from one another:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Components on the FirstSpirit side</dt>
<dd>
<p>These components are used for creating and maintaining editorial data.
The data is transferred in JSON format to the relevant <em>CaaS</em> instance, and queried from there by Spryker.</p>
</dd>
<dt class="hdlist1">Components on the Spryker side</dt>
<dd>
<p>These components are used for the integration of the editorial content created in FirstSpirit.
Spryker imports this data and integrates it into the shop.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Included in the delivery of the <em>FirstSpirit Connect for Spryker Commerce OS</em> module is the reference project <em>FirstSpirit Connect Reference Project</em>, which is available as a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">GitHub repository</a>.
This documentation is consistently based on the reference project and provides an explanation of the functions made available by the module using common use cases.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This document is aimed at both Spryker and FirstSpirit developers, who should be able to perform the integration using this document as a guide.<br>
It is <strong>not</strong> intended as a manual for FirstSpirit editors.</p>
</div>
<div class="paragraph">
<p>It is assumed that the reader is confident in the use of FirstSpirit and Spryker as well as <em>CaaS</em> and <em>Omnichannel Manager</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spryker_installation_and_configuration"><a class="anchor" href="#_spryker_installation_and_configuration"></a>2. Spryker - Installation and configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FirstSpirit is used to create and maintain editorial data that is transferred to and persisted by the <em>CaaS</em>.
To integrate the data, Spryker needs access to the <em>CaaS</em>.
This is provided by the Spryker modules <code>firstspirit-preview</code> and <code>firstspirit-caas</code>, which require an installation and configuration in Spryker.
The <code>firstspirit-preview</code> module enables the storefront to be displayed in ContentCreator.
The contents are retrieved from the <em>CaaS</em> using the <code>firstspirit-caas</code> module.</p>
</div>
<div class="paragraph">
<p>The following chapters describe all steps required for installation and configuration as well as additional extensions in Spryker.</p>
</div>
<div class="sect2">
<h3 id="sp_modules"><a class="anchor" href="#sp_modules"></a>2.1. Spryker-Modules</h3>
<div class="paragraph">
<p>Both the retrieval of the <em>CaaS</em> contents by Spryker and their display and editing in ContentCreator is done using various Spryker modules.
These modules require an installation in Spryker and an extension of the configuration.
They also require various JavaScript and CSS files to be included in Spryker.</p>
</div>
<div class="paragraph">
<p>The following chapters describe how to perform the necessary steps.</p>
</div>
<div class="sect3">
<h4 id="sp_install_module"><a class="anchor" href="#sp_install_module"></a>2.1.1. Installation of the Spryker modules</h4>
<div class="paragraph">
<p>The maintenance of shop contents in ContentCreator requires the installation of several Spryker modules, which are included in the delivery in the form of zip files.
They have to be stored in any directory below the Spryker project directory, which must be announced to Composer as another repository.
This is done via the following command to be executed in the project directory, which extends the <code>composer.json</code> file of the Spryker server accordingly.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the composer.json file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">composer config repo.espirit artifact ./PATH-TO-DIRECTORY</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spryker modules to be installed use the namespace <code>ESpirit</code>, which must be announced to Spryker.
This requires an extension of the <code>KernelConstants</code> in the environment-independent file <code>config_default.php</code> in the directory <code><strong>config/Shared</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the KernelConstants</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">$config[KernelConstants::CORE_NAMESPACES] = [
   'SprykerShop',
   'SprykerEco',
   'Spryker',
   'Generated',
   'ESpirit'
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spryker modules are then installed using the following commands, which must also be executed in the Spryker project directory in the specified order.</p>
</div>
<div class="listingblock">
<div class="title">Installation commands</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">composer require e-spirit/firstspirit-caas
composer require e-spirit/firstspirit-preview
composer require e-spirit/firstspirit-preview-navigation
composer require e-spirit/firstspirit-data-state-writer
composer require e-spirit/firstspirit-data-cleanup
composer require e-spirit/firstspirit-data-import
composer require e-spirit/firstspirit-data-inconsistency-check
composer require e-spirit/firstspirit-data-rest-api
composer require e-spirit/firstspirit-cms-data-connector
composer require e-spirit/firstspirit-cms-data-storage</code></pre>
</div>
</div>
<div class="paragraph">
<p>The commands load the modules from the created repository and install them automatically.</p>
</div>
<div class="paragraph">
<p>The last step of the installation corresponds to the generation of the transfer objects of the Data Import module and the creation of the database schema contained in the CMS Block Data Connector module:</p>
</div>
<div class="listingblock">
<div class="title">Generation of the transfer objects and creation of the database schema</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">vendor/bin/console transfer:generate
vendor/bin/console propel:install</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sp_twigtemplates"><a class="anchor" href="#sp_twigtemplates"></a>2.1.2. Twig Templates</h4>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module provides different ways to access shop content from Spryker and use it in FirstSpirit.
These possibilities are described in the following of this documentation on the basis of the supplied reference project in the form of <a href="#usecases">use cases</a>.</p>
</div>
<div class="paragraph">
<p>If the <a href="#ref-project">sections and page templates</a> contained in the reference project should be used, this requires different Twig templates in Spryker.</p>
</div>
<div class="paragraph">
<p>The sections correspond to different Spryker molecules, atoms and organisms, which are summarized in the folder <code><strong>FirstSpiritReferenceComponents</strong></code>.
This is part of the delivery and is provided in the form of another Spryker module, which is to be installed using the following command:</p>
</div>
<div class="listingblock">
<div class="title">Installation command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">composer require e-spirit/firstspirit-reference-components</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to make the components provided with the module usable in Spryker, the corresponding path must be specified in Spryker.
This is done by adapting the files <code>settings.js</code> and <code>tsconfig.json</code>.</p>
</div>
<div class="paragraph">
<p>Within the <code>settings.js</code> file in the directory <code><strong>Spryker-directory/frontend</strong></code> an extension of the context is necessary:</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the settings.js file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">[...]

dirs: [
   join(globalSettings.context, paths.core),
   join(globalSettings.context, './vendor/e-spirit'),
   join(globalSettings.context, paths.eco),
   join(globalSettings.context, paths.project)
],</code></pre>
</div>
</div>
<div class="paragraph">
<p>An additional include must be added to the <code>tsconfig.json</code> file in the <code><strong>Spryker directory</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the tsconfig.json file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">[...]

"include": [
   "./vendor/spryker-shop/**/*",
   "./vendor/spryker-eco/**/*",
   "./src/Pyz/Yves/**/*",
   "./vendor/e-spirit/**/*"
],</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic Twig template <code>fs_molecule_block.twig</code> controls the output of the supplied molecules.
It is a part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery and must be stored under the path <code><strong>src/Pyz/Shared/CmsBlock/Theme/default/template</strong></code> in Spryker.</p>
</div>
<div class="paragraph">
<p>The integration of the Twig templates in Spryker takes place via the following command, which finally is to be executed in the Spryker project directory.</p>
</div>
<div class="listingblock">
<div class="title">Integration of the Twig templates</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">npm run yves</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FirstSpirit templates allow the extension of existing <a href="#rp_staticsite">static pages</a>, <a href="#rp_productpages">product</a>, and <a href="#rp_categorypages">category pages</a> and the creation of <a href="#rp_contentpage">dynamic content pages</a> or a <a href="#rp_magazine">magazine</a>.
Therefore, the reference project contains the page templates <code>homepage</code>, <code>productpage</code>, <code>categorypage</code>, <code>contentpage</code>, and <code>magazine_detail_page</code>.
In addition, the following Twig templates are required in Spryker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#rp_twigtemplates"><code>home.twig</code></a></p>
</li>
<li>
<p><a href="#rp_pdp_twigtemp"><code>pdp.twig</code></a></p>
</li>
<li>
<p><a href="#rp_pdp_twigtemp"><code>product-cms-block.twig</code></a></p>
</li>
<li>
<p><a href="#rp_cp_twigtemp"><code>page-layout-catalog.twig</code></a></p>
</li>
<li>
<p><a href="#rp_cp_twigtemp"><code>catalog-with-cms-slot.twig</code></a></p>
</li>
<li>
<p><a href="#rp_dcp_twigtemp"><code>fs-content-page.twig</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code>, which can be found under the path <code><strong>src/Pyz/Yves/HomePage/Theme/default/views/home</strong></code>, needs some changes.
These are explained in the description of the <a href="#rp_twigtemplates">static pages</a>.
The same applies to the Twig templates <code>pdp.twig</code>, <code>page-layout-catalog.twig</code> and <code>catalog-with-cms-slot.twig</code> which are necessary to edit <a href="#rp_pdp_twigtemp">product</a> and <a href="#rp_cp_twigtemp">category pages</a>.</p>
</div>
<div class="paragraph">
<p>They are available in Spryker under the following paths:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>src/Pyz/Yves/ProductDetailPage/Theme/default/views/pdp</strong></code></p>
</li>
<li>
<p><code><strong>src/Pyz/Yves/CatalogPage/Theme/default/templates/page-layout-catalog</strong></code></p>
</li>
<li>
<p><code><strong>src/Pyz/Yves/CatalogPage/Theme/default/views/catalog-with-cms-slot</strong></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remaining Twig templates are part of the zip file included in the delivery and have to be stored under the following paths:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Product pages: <code><strong>src/Pyz/Yves/CmsBlockWidget/Theme/default/components/molecules/product-cms-block</strong></code></p>
</li>
<li>
<p>Dynamic Content Pages: <code><strong>src/Pyz/Shared/Cms/Theme/default/templates/fs-content-page</strong></code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sp_slotimport"><a class="anchor" href="#sp_slotimport"></a>2.1.3. Slots import</h4>
<div class="paragraph">
<p>In both Spryker and FirstSpirit, pages are based on a structure of different components.
In Spryker, these include the CMS slots, which are represented in FirstSpirit by the content areas of a page template.
The slots bind CMS blocks, each of which corresponds to a FirstSpirit section.</p>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code> represents a <a href="#rp_staticsite">static page</a> on the Spryker side and is mapped by the page template <code>homepage</code> in the provided <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.
It contains the content areas <code>fs_slt_2</code> and <code>fs_slt_3</code>, for which the corresponding slots must exist in Spryker.</p>
</div>
<div class="paragraph">
<p>The slots are imported using the file <code>cms_slot.csv</code>, which is stored in Spryker in the directory <code><strong>/data/import/common/common</strong></code>.
It must be replaced by the file of the same name from the delivery, which additionally contains the following two lines:</p>
</div>
<div class="listingblock">
<div class="title">Import file cms_slot.csv</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">template_path,slot_key,content_provider,name,description,is_active
[...]
@HomePage/views/home/home.twig,fs-slt-2,FirstSpiritCmsSlotBlock,Banner,Banner content section for the homepage.,1
@HomePage/views/home/home.twig,fs-slt-3,FirstSpiritCmsSlotBlock,Homepage Content,Homepage main content section.,1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, the new slots are taken over via the following command, which has to be executed in the Spryker project directory.</p>
</div>
<div class="listingblock">
<div class="title">Import command</div>
<div class="content">
<pre>vendor/bin/console data:import cms-slot</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sp_configuration"><a class="anchor" href="#sp_configuration"></a>2.1.4. Extension of the configuration</h4>
<div class="paragraph">
<p>In FirstSpirit, the creation and editing of editorial content takes place in ContentCreator.
The storefront is embedded in it using the <em>Omnichannel Manager</em>.</p>
</div>
<div class="paragraph">
<p>To enable the display of the shop contents from Spryker in ContentCreator, an extension of the environment-specific configuration is necessary.
To do this, a token must be defined in the <a href="https://documentation.spryker.com/docs/configuration-management">file <code>config_default-[environment].php</code></a> in the directory <code><strong>config/Shared</strong></code> as well as the host and port of the FirstSpirit start page.
Furthermore, the operation of <em>CaaS</em> requires the specification of some parameters.
These parameters are necessary both for production operation and for the use of the <em>CaaS</em> in the preview.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">// ----------- FirstSpirit Preview Configurations
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_AUTHENTICATION_INIT_TOKEN] = '&lt;ADD TOKEN&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_WEB_HOST] = '&lt;ADD FS PREVIEW HOST&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_CAAS_CONTENT_PAGE_COLLECTION] = '&lt;CAAS COLLECTION&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_CAAS_CATEGORY_PAGE_COLLECTION] = '&lt;CAAS COLLECTION&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_CAAS_PRODUCT_PAGE_COLLECTION] = '&lt;CAAS COLLECTION&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_DISPLAY_BLOCK_RENDER_ERRORS] = true;

// ----------- FirstSpirit Data Import Configurations
$config[FirstSpiritDataImportConstants::FIRSTSPIRIT_DATA_IMPORT_BLOCK_DATA_CAAS_PATH] = '/_aggrs/blocks';
$config[FirstSpiritDataImportConstants::FIRSTSPIRIT_CAAS_REQUEST_PAGESIZE] = &lt;VALUE&gt;;

// ----------- FirstSpirit CaaS Configurations
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_HOSTNAME_PREVIEW] = '&lt;ADD CAAS HOST&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_PORT_PREVIEW] = '&lt;ADD CAAS PORT&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_SCHEME_PREVIEW] = '&lt;ADD CAAS SCHEME&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_APIKEY_PREVIEW] = '&lt;ADD APIKEY&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_DATABASE_PREVIEW] = '&lt;ADD CAAS DATABASE&gt;';

$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_HOSTNAME_ONLINE] = '&lt;ADD CAAS HOST&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_PORT_ONLINE] = '&lt;ADD CAAS PORT&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_SCHEME_ONLINE] = '&lt;ADD CAAS SCHEME&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_APIKEY_ONLINE] = '&lt;ADD APIKEY&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_DATABASE_ONLINE] = '&lt;ADD CAAS DATABASE&gt;';</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">FirstSpirit Preview Configurations</dt>
<dd>
<p>The token is used for authentication and must be specified in the ContentCreator settings as a query parameter of the <a href="#fs_previewurl">external preview URL</a> during the configuration in FirstSpirit.
It can be defined arbitrarily.</p>
<div class="paragraph">
<p>Specifying the fully qualified host of the FirstSpirit home page (e.g. <code>http://localhost:8000</code>) is a requirement of the <a href="#sp_plugin">HeadersSecurityExtensionPlugins</a> to be installed.
It uses the information to enable previewing in ContentCreator.</p>
</div>
<div class="paragraph">
<p>The mentions of the <em>CaaS</em> collections for content, category and product pages enable access to the editorial content stored in the <em>Preview CaaS</em> and its display in the ContentCreator.</p>
</div>
<div class="paragraph">
<p>The error parameter enables the display of error outputs in the page.
Using the value <code>true</code> therefore only makes sense for Dev and QA instances.</p>
</div>
</dd>
<dt class="hdlist1">FirstSpirit Data Import Configurations</dt>
<dd>
<p>The path is used to query and persist the block data stored in the <em>Online CaaS</em>.
It is required by the <a href="#sp-importcommand"><code>FsDataImportConsole</code> command</a>, which triggers the importer in the context of a <a href="#fs-deployment">FirstSpirit deployment</a>.</p>
<div class="paragraph">
<p>With the help of the pagesize the number of documents that the <em>CaaS</em> returns on a request can be defined.
The parameter is optional and may have a value from <code>1</code> to <code>100</code>.
By default, the maximum value of <code>100</code> is defined for it.</p>
</div>
</dd>
<dt class="hdlist1">FirstSpirit CaaS Configurations</dt>
<dd>
<p>The <em>CaaS</em> host, port, and scheme to use (<code>http</code> or <code>https</code>) allow Spryker to connect to the <em>CaaS</em>.
Access to the data stored in it requires a valid API Key that needs read access to the corresponding project.
The name of the project stored in <em>CaaS</em> must be specified in the configuration file as the value of the database parameter.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on using the <em>CaaS</em>, see the <em><a href="https://docs.e-spirit.com/module/caas/CaaS_FSM_Documentation_EN.html">Content as a Service Documentation</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To ensure that the used classes <code>FirstSpiritPreviewConstants</code>, <code>FirstSpiritDataImportConstants</code> and <code>FirstSpiritCaaSConstants</code> can be found, they have to be included in the configuration file via use statements:</p>
</div>
<div class="listingblock">
<div class="title">Integration of the classes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Shared\FirstSpiritPreview\FirstSpiritPreviewConstants;
use ESpirit\Shared\FirstSpiritDataImport\FirstSpiritDataImportConstants;
use ESpirit\Shared\FirstSpiritCaaS\FirstSpiritCaaSConstants;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sp_basetemp"><a class="anchor" href="#sp_basetemp"></a>2.1.5. Extension of the basic template</h4>
<div class="paragraph">
<p>The <em>Omnichannel Manager</em> enables the display and editing of external content in ContentCreator, for which it requires some preview-specific data attributes.
In Spryker, it also requires a preview-specific JavaScript file, which is included by the FirstSpiritPreview module.</p>
</div>
<div class="paragraph">
<p>The JavaScript file must be added to the Twig template, which is responsible for the basic layout of all shop pages.
By default this is the <code>page-blank.twig</code> template, which is stored under the path <code><strong>src/Pyz/Yves/ShopUi/Theme/default/templates/page-blank</strong></code>.
In the same template, the data attributes must also be determined by the Twig function <code>fsIncludeDataAttributes</code>.</p>
</div>
<div class="paragraph">
<p>The Twig template is adapted by calling the Twig functions <code>fsIncludeDataAttributes</code> and <code>fsIncludeOcmScript</code> and by extending the template data.
The Twig function <code>fsIncludeOcmScript</code> can be passed the URL to a local copy of the JavaScript file as an optional parameter.
By default, it retrieves the file from the <a href="https://unpkg.com/fs-spryker-content-editing">CDN</a>.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the Twig template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% block template %}
   {% set isNewFrontendBuildSupported = true %}
   &lt;body [...] {{ fsIncludeDataAttributes() }}&gt;
   {{ parent() }}
{% endblock %}

{% block footerScripts %}
   {% include molecule('check-touch') only %}
   {{ fsIncludeOcmScript() }}
   {{ parent() }}
{% endblock %}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sp_plugin"><a class="anchor" href="#sp_plugin"></a>2.2. Plugins</h3>
<div class="paragraph">
<p>In addition to the installation of the <a href="#sp_modules">Spryker modules</a>, the following plugins must be included:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HeadersSecurityExtensionPlugin</code></p>
</li>
<li>
<p><code>FsTwigExtensionPlugin</code></p>
</li>
<li>
<p><code>FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</code></p>
</li>
<li>
<p><code>FirstSpiritDataImportsResourceRoutePlugin</code></p>
</li>
<li>
<p><code>FirstSpiritDataCleanupsResourceRoutePlugin</code></p>
</li>
<li>
<p><code>FirstSpiritCmsPagesResourceRoutePlugin</code></p>
</li>
</ul>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">HeadersSecurityExtensionPlugin and FsTwigExtensionPlugin</dt>
<dd>
<p>The <code>HeadersSecurityExtensionPlugin</code> uses the <a href="#sp_configuration">hosts of the FirstSpirit home page</a> defined in the <a href="https://documentation.spryker.com/docs/configuration-management">configuration file <code>config_default-[environment].php</code></a> to enable the storefront to be displayed in ContentCreator.
Therefore, it checks if storefront queries contain the <a href="#sp_configuration">Token</a> also defined in the configuration file or if a logged in user exists.
If one of the two options applies, the plugin sets the Content Security Policy Header and extends the Cookie header.</p>
<div class="paragraph">
<p>The <code>FsTwigExtensionPlugin</code> enables the maintenance of CMS placeholders and CMS blocks in FirstSpirit.
Therefore, it accesses information provided by the <a href="#sp_controller">CmsController</a> to be installed.
The information is needed for mapping between the data stored in FirstSpirit and in Spryker.</p>
</div>
<div class="paragraph">
<p>The integration of both plugins is done with the following code, which has to be added to the <code>ShopApplicationDependencyProvider</code> in the directory
<code><strong>src/Pyz/Yves/ShopApplication</strong></code>.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the ShopApplicationDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Yves\FirstSpiritPreview\Plugin\HeadersSecurityExtensionPlugin;
use ESpirit\Yves\FirstSpiritPreview\Plugin\FsTwigExtensionPlugin;

[...]

protected function getApplicationPlugins(): array
{
   return [
      new HeadersSecurityExtensionPlugin(),
      new FsTwigExtensionPlugin()
   ];
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</dt>
<dd>
<p>The <code>FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</code> enables the output of all blocks contained in a slot.
In contrast to the <code>CmsSlotBlockWidget</code> included in Spryker, which is limited to the output of the Spryker data, the plugin only considers the information from the <em>CaaS</em>.
The inclusion of the plugin requires an extension of the <code>ShopCmsSlotDependencyProvider</code> in the <code><strong>src/Pyz/Yves/ShopCmsSlot</strong></code> directory.</p>
<div class="listingblock">
<div class="title">Extension of the ShopCmsSlotDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php

namespace Pyz\Yves\ShopCmsSlot;

use ESpirit\Yves\FirstSpiritPreviewSlotBlockWidget\FirstSpiritPreviewSlotBlockWidgetConfig;
use ESpirit\Yves\FirstSpiritPreviewSlotBlockWidget\Plugin\FirstSpiritPreviewSlotBlockWidget\
   FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin;
[...]

class ShopCmsSlotDependencyProvider extends SprykerShopShopCmsSlotDependencyProvider
{
   protected function getCmsSlotContentPlugins(): array
   {
      return [
         CmsSlotBlockConfig::CMS_SLOT_CONTENT_PROVIDER_TYPE
            =&gt; new CmsSlotBlockWidgetCmsSlotContentPlugin(),
         FirstSpiritPreviewSlotBlockWidgetConfig::FS_CMS_SLOT_CONTENT_PROVIDER_TYPE
            =&gt; new FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin(),
      ];
   }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">FirstSpiritDataImportsResourceRoutePlugin and FirstSpiritDataCleanupsResourceRoutePlugin</dt>
<dd>
<p>The <code>FirstSpiritDataImportsResourceRoutePlugin</code> and <code>FirstSpiritDataCleanupsResourceRoutePlugin</code> each provide an API endpoint.
This endpoint allows the <a href="#fs-deployment">FirstSpirit deployment</a> to address the importer.</p>
<div class="paragraph">
<p>The <code>FirstSpiritDataImportsResourceRoutePlugin</code> controls the transfer of editorial content from the <em>Online CaaS</em> to Spryker and its persistence there.
In contrast, the <code>FirstSpiritDataCleanupsResourceRoutePlugin</code> is used to find and delete obsolete data in Spryker.</p>
</div>
<div class="paragraph">
<p>Both plugins and the following <code>FirstSpiritCmsPagesResourceRoutePlugin</code> must be added to the <code>GlueApplicationDependencyProvider</code>.</p>
</div>
</dd>
<dt class="hdlist1">FirstSpiritCmsPagesResourceRoutePlugin</dt>
<dd>
<p>If a new page is created within the ContentCreator, the creation of a CMS page in Spryker is required in parallel.
Because the ContentCreator displays the storefront, the newly created page would otherwise not be visible in the preview.
Instead, it would already be available in the live state if it were created in Spryker with a deployment.</p>
<div class="paragraph">
<p>The <code>FirstSpiritCmsPagesResourceRoutePlugin</code> is used to create the new page.
This plugin and the other two ResourceRoutePlugins described above must be added to the <code>GlueApplicationDependencyProvider</code> in the <code><strong>src/Pyz/Glue/GlueApplication</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the GlueApplicationDependencyProviders</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Glue\FirstSpiritDataRestApi\Plugin\FirstSpiritDataImportsResourceRoutePlugin;
use ESpirit\Glue\FirstSpiritDataRestApi\Plugin\FirstSpiritDataCleanupsResourceRoutePlugin;
use ESpirit\Glue\FirstSpiritDataRestApi\Plugin\FirstSpiritCmsPagesResourceRoutePlugin;

[...]

protected function getResourceRoutePlugins(): array
{
   return [
      new FirstSpiritDataImportsResourceRoutePlugin(),
      new FirstSpiritDataCleanupsResourceRoutePlugin(),
      new FirstSpiritCmsPagesResourceRoutePlugin()
      [...]
   ];
}</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="sp_widgets"><a class="anchor" href="#sp_widgets"></a>2.3. Widgets</h3>
<div class="paragraph">
<p>In addition to the <a href="#sp_modules">Spryker modules</a> and the <a href="#sp_plugin">plugins</a> the delivery contains the following widgets.
They enable the expandability of the <a href="#rp_navigation">navigations</a> contained in the shop, as well as the usage of the <a href="#rp_links">DOM references</a> and the <a href="#sp_twigtemplates">Shoppable Image</a> contained in the reference project.
Only if these elements are used a registration of the widgets is required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FirstSpiritPreviewContentNavigationWidget</code></p>
</li>
<li>
<p><code>FirstSpiritCategoryLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritProductLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritContentLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritExternalLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritProductFlyoutWidget</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritPreviewContentNavigationWidget</strong></span><br>
The <code>FirstSpiritPreviewContentNavigationWidget</code> creates the possibility to maintain the navigations contained in the store with FirstSpirit and to add further menu items.
It replaces the existing <code>ContentNavigationWidget</code> in Spryker and provides various attributes required for displaying the corresponding navigation in the preview.
Therefore the existing <code><strong>ContentNavigationWidget</strong></code>, which is stored under the path <code><strong>/src/Pyz/Yves</strong></code> in Spryker, has to be replaced by the <code><strong>FirstSpiritPreviewContentNavigationWidget</strong></code> included in the delivery.
Finally, the use of the <code>FirstSpiritPreviewContentNavigationWidget</code> requires a registration.
This is done by modifying the <code>TwigDependencyProvider</code> in the directory <code><strong>/src/Pyz/Yves/Twig/</strong></code>,
in which the <code>ContentNavigationTwigPlugin</code> has to be replaced by the <code>FirstSpiritPreviewNavigationWidgetTwigPlugin</code>.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the TwigDependencyProviders</div>
<div class="content">
<pre>&lt;?php

namespace Pyz\Yves\Twig;

use ESpirit\Yves\FirstSpiritPreviewNavigationWidget\Plugin\Twig\FirstSpiritPreviewNavigationWidgetTwigPlugin;
[...]

class TwigDependencyProvider extends SprykerTwigDependencyProvider
{
   [...]

   protected function getTwigPlugins(): array
   {
      return [
         [...]
         new FirstSpiritPreviewNavigationWidgetTwigPlugin(),
      ];
   }

   [...]
}</pre>
</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritCategoryLinkWidget und FirstSpiritProductLinkWidget</strong></span><br>
The <code>FirstSpiritCategoryLinkWidget</code> and the <code>FirstSpiritProductLinkWidget</code> are used to display editorial DOM links to category or product detail pages.
In both cases, the widget determines the corresponding category or product using a unique identifier and passes the result to the Twig template that controls the display of the respective link in Spryker.
Each of the two widgets references its corresponding Twig template.
The Twig templates are provided by the previously installed FirstSpiritPreview module.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritContentLinkWidget und FirstSpiritExternalLinkWidget</strong></span><br>
The <code>FirstSpiritContentLinkWidget</code> and the <code>FirstSpiritExternalLinkWidget</code> enable DOM links to editorial content, whereby the type of content differs in each case.
The <code>FirstSpiritExternalLinkWidget</code> only allows the referencing of external content.
In contrast, the <code>FirstSpiritContentLinkWidget</code> is used to display internal DOM links to <a href="#rp_contentpage">dynamic content pages</a> or <a href="#rp_magazine">magazine articles</a> maintained within the FirstSpirit project.
An important aspect is that the target URL of the internal links to dynamic content pages depends on the output:
While the link in the live state refers to the published CMS page, the corresponding preview URL must be used in the preview.
In both cases, the widget controls the determination of the required URL.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritProductFlyoutWidgets</strong></span><br>
The registration of the <code>FirstSpiritProductFlyoutWidget</code> is only required if the Shoppable Image provided with the delivery is used in the project.
The widget controls the display of flyouts for the products linked to the Shoppable Image.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Registration</strong></span><br>
The four link widgets and the flyout widget are registered using the following code, which must be added to the <code>ShopApplicationDependencyProvider</code> in the folder <code><strong>src/Pyz/Yves/ShopApplication</strong></code>.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the ShopApplicationDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritCategoryLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritProductLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritContentLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritExternalLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritProductFlyoutWidget;

[...]

protected function getGlobalWidgets(): array
{
   return [
      [...]
      FirstSpiritCategoryLinkWidget::class,
      FirstSpiritProductLinkWidget::class,
      FirstSpiritContentLinkWidget::class,
      FirstSpiritExternalLinkWidget::class,
      FirstSpiritProductFlyoutWidget::class
   ];
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sp_controller"><a class="anchor" href="#sp_controller"></a>2.4. Controllers</h3>
<div class="paragraph">
<p>The previously installed <a href="#sp_plugin"><code>CmsBlockTwigFunctionPlugin</code></a> allows mapping between the content stored in FirstSpirit and in Spryker.
For this, it assumes that the view data of a page contains its ID and type.
The controllers of Spryker do not provide this information by default.
For this reason, the following controllers must be overwritten both for <a href="#rp_contentpage">content</a> and <a href="#rp_categorypages">category pages</a> and in the case of the homepage, which corresponds to a <a href="#rp_staticsite">static page</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IndexController</p>
</li>
<li>
<p>CatalogController</p>
</li>
<li>
<p>CmsController</p>
</li>
<li>
<p>PreviewController</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The overwriting is done by creating the corresponding classes, which are all part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery.
They must be copied into the directory <code><strong>Controller</strong></code> to be created below <code><strong>src/Pyz/Yves/HomePage|CatalogPage|CmsPage</strong></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the classes already exist under the path specified for them, the controllers are already overwritten project-specifically.
In this case, it need to be ensured that the view parameters are extended accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In contrast to the other pages, the <a href="#rp_productpages">product pages</a> require the adaptation of the ProductController which already exists in Spryker.
It is contained in the directory <code><strong>src/Pyz/Yves/ProductDetailPage/Controller/ProductController</strong></code> and must be extended by the definition of the page type and the Product SKU.
The following code snippet shows the changes to be made:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the ProductController</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php
namespace Pyz\Yves\ProductDetailPage\Controller;

[...]
use ESpirit\Shared\FirstSpiritPreview\FirstSpiritPreviewConstants;

class ProductController extends SprykerShopProductController
{
   protected function executeDetailAction(array $productData, Request $request): array
   {
      [...]

       $viewData['cart'] = $quoteTransfer;
       $viewData[FirstSpiritPreviewConstants::VIEW_DATA_PAGE_TYPE_KEY] = FirstSpiritPreviewConstants::PRODUCT_PAGE_TYPE;
       $viewData[FirstSpiritPreviewConstants::VIEW_DATA_PAGE_ID_KEY] = $productData['sku'];

       return $viewData;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the controllers mentioned above, the delivery includes further render controllers which enable individual CMS elements to be updated in the preview.
They are addressed by the <code>FirstSpiritPreviewRoutePlugin</code> which initially does not exist in Spryker and therefore requires registration in the <code>RouterDependencyProvider</code> file in the <code><strong>Pyz/Yves/Router</strong></code> directory.
Within the file, the method <code>getRouteProvider</code> has to be extended as follows.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the method getRouteProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Yves\FirstSpiritPreview\Plugin\Route\FirstSpiritPreviewRoutePlugin;

[...]
protected function getRouteProvider(): array
{
   return [
      [...]
      new FirstSpiritPreviewRoutePlugin()
   ];
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sp_navigation"><a class="anchor" href="#sp_navigation"></a>2.5. Main navigation</h3>
<div class="paragraph">
<p>By default, the Spryker B2C Demo Shop contains different navigations, which can be created and edited in Spryker.
The integration realised with the <em>FirstSpirit Connect</em> module offers the possibility to maintain these navigations with FirstSpirit and to add further menu items.</p>
</div>
<div class="paragraph">
<p>Within the reference project the functionality is implemented exemplarily for the main navigation.
Its usage requires the already described <a href="#sp_widgets">referencing of the <code>FirstSpiritPreviewContentNavigationWidgets</code></a>, the creation of a placeholder, and the addition of a preview ID.</p>
</div>
<div class="paragraph">
<p>The placeholder to be created corresponds to another menu item.
This is required to display the navigation in the preview and must be added to the <code>navigation-header.twig</code> file
in the <code><strong>src/Pyz/Yves/ShopUi/Theme/default/components/molecules/navigation-header</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Adjustment of the navigation-header.twig file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">[..]
&lt;ul class="menu {{ menuClass }} grid grid--center grid--no-wrap"&gt;
   {% for node in data.nodes %}
      [..]
   {% endfor %}

   {% if isFsPreview() %}
      &lt;li class="fs-navigation-extension"
         style="padding-left: 1rem; transform: translate(0,15% );"&gt;
      &lt;/li&gt;
   {% endif %}
&lt;/ul&gt;
[..]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, a preview ID is required to display the main navigation in the preview.
This preview ID is to be defined in the <code>navigation-multilevel-node.twig</code> file in the directory <code><strong>src/Pyz/Yves/ShopUi/Theme/default/components/molecules/navigation-multilevel-node</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">Adjustment of the navigation-multilevel-node.twig file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% block attributes %}
   {% if isFsPreview() and data.node.previewId is defined and data.node.previewId is not empty %}
      data-preview-id="{{ data.node.previewId }}" style="min-height: unset;"
   {% endif %}
{% endblock %}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After the changes have been made, it may be necessary to empty the cache for the twig templates and to rebuild the frontend.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_query_container"><a class="anchor" href="#_query_container"></a>2.6. Query Container</h3>
<div class="paragraph">
<p>The previously installed &lt;sp_install_module,Cms Block Data Connector module&gt;&gt; creates a Zed table.
During the import, the editorial contents determined from the <em>Online CaaS</em> are stored in this table.
The CMS blocks are persisted in another table.</p>
</div>
<div class="paragraph">
<p>Since the CMS blocks do not contain placeholders, they are not published by Spryker by default.
For this reason, it is necessary to overwrite the <code>CmsBlockStorageQueryContainer</code> and thus adapt the standard behavior of Spryker for publishing CMS blocks.
The query container is overwritten by creating the class <code>CmsBlockStorageQueryContainer.php</code>.
It is part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery and must be copied into the directory <code><strong>src/Pyz/Zed/CmsBlockStorage/Persistence</strong></code> to be created.</p>
</div>
</div>
<div class="sect2">
<h3 id="sp_customer"><a class="anchor" href="#sp_customer"></a>2.7. Technical user</h3>
<div class="paragraph">
<p>The integration realized with the <em>FirstSpirit Connect</em> module only allows FirstSpirit to create and maintain editorial content and to publish it in the form of JSON objects.
The integration of these contents and the creation of the preview, however, still takes place in Spryker.</p>
</div>
<div class="paragraph">
<p>In the preview case, FirstSpirit determines the current view of a page in the storefront and displays it in ContentCreator using the <em>Omnichannel Manager</em>.
To integrate the editorial content into the shop, Spryker imports it from the <em>Online CaaS</em> and persists it in its internal data system.</p>
</div>
<div class="paragraph">
<p>As both the preview and the import process are protected by authentication, a technical user must be specified in the <a href="#fs_pcomp">project component of the <em>FirstSpirit Connect</em> module</a>.
This corresponds to a customer, who in turn is assigned to a Zed user.
The assignment can be done in the menu <code><strong><span class="menuseq"><b class="menu">Users Control</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">User</b></span></strong></code> via the button <b class="button">Assign Customers</b>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a more detailed description of the steps required for the assignment, see the chapters
<a href="https://documentation.spryker.com/docs/managing-users#assigning-customers-to-users">Assigning Customers</a> and
<a href="https://documentation.spryker.com/v2/docs/managing-cms-pages#previewing-cms-pages">Previewing a Page</a> of the <em>Spryker documentation</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sp-importcommand"><a class="anchor" href="#sp-importcommand"></a>2.8. Import command</h3>
<div class="paragraph">
<p>The integration of the contents created or maintained in FirstSpirit into the Shop takes place through Spryker.
Therefore, Spryker imports the data from the <em>Online CaaS</em> and persists them in its data system.
The transfer of the information must take place with each <a href="#fs-deployment">FirstSpirit deployment</a>, which for this reason each time triggers a Spryker sided import command.</p>
</div>
<div class="paragraph">
<p>The command instructs the importer to import the block data stored in the <em>Online CaaS</em>.
To do this, it uses the <a href="#sp_configuration"><code>FirstSpirit Data Import Block CaaS Path</code></a> stored in the <a href="https://documentation.spryker.com/docs/configuration-management">configuration file <code>config_default-[environment].php</code></a>.
Using this path, the importer accesses the <em>CaaS</em> aggregation that is created by the <a href="#fs-deployment">FirstSpirit deployment</a>.</p>
</div>
<div class="paragraph">
<p>The import command must be registered in Spryker in the <code>getConsoleCommands</code>.
This requires the following extension to the <code>ConsoleDependencyProvider.php</code> file in the <code><strong>src/Pyz/Zed/Console</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the getConsoleCommands</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">use ESpirit\Zed\FirstSpiritDataImport\Communication\Console\FsDataImportConsole;

[...]

$commands = [
   // Default commands
   [...]

   // FirstSpirit Data importers
   new FsDataImportConsole(FsDataImportConsole::DEFAULT_NAME)
];</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization"><a class="anchor" href="#_synchronization"></a>2.9. Synchronization</h3>
<div class="paragraph">
<p>During deployment, the content maintained in FirstSpirit is retrieved from the <em>Online CaaS</em> using the importer.
It transfers the data to Spryker and persists them in the backend in its data system.
The display of the data in the live state additionally requires its transmission to Yves.
The transmission of the data requires the registration of an event subscriber, several queues and a message processor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See the <a href="https://documentation.spryker.com/docs/publish-and-synchronization">Publish and Synchronization</a> chapter of the <em>Spryker documentation</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The registration of the EventSubscriber is done with the following code to be added to the <code>EventDependencyProvider</code> in the directory <code><strong>Pyz/Zed/Event</strong></code>.</p>
</div>
<div class="listingblock">
<div class="title">EventDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Zed\FirstSpiritCmsDataStorage\Communication\Plugin\Event\Subscriber\FirstSpiritCmsDataStorageEventSubscriber;

[...]

class EventDependencyProvider extends SprykerEventDependencyProvider
{
   [...]

   public function getEventSubscriberCollection()
   {
      $eventSubscriberCollection = parent::getEventSubscriberCollection();

      /**
      * Storage Events
      */
      [...]
      $eventSubscriberCollection-&gt;add(new FirstSpiritCmsDataStorageEventSubscriber());

      /**
      * Search Events
      */
      [...]

      return $eventSubscriberCollection;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Registration of the queues requires the following adaption of the <code>RabbitMqConfig</code> file in the <code><strong>Pyz/Client/RabbitMq</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">RabbitMqConfig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php
namespace Pyz\Client\RabbitMq;

use ESpirit\Shared\FirstSpiritCmsDataStorage\FirstSpiritCmsDataStorageConfig;
[...]

class RabbitMqConfig extends SprykerRabbitMqConfig
{
   [...]

   protected function getPublishQueueConfiguration(): array
   {
      return [
         PublisherConfig::PUBLISH_QUEUE =&gt; [
            [...]
         ],
         GlossaryStorageConfig::PUBLISH_TRANSLATION,
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_BLOCK_DATA_CONNECTOR,
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_PAGE_DATA_CONNECTOR,
      ];
   }

   protected function getSynchronizationQueueConfiguration(): array
   {
      return [
         [...]
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_BLOCK_DATA,
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_PAGE_DATA
      ];
   }

   [...]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The registration of the event subscriber necessary for the queues requires an adjustment of the <code>QueueDependencyProvider</code> in the directory <code><strong>Pyz/Zed/Queue</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">QueueDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php
namespace Pyz\Zed\Queue;

use ESpirit\Shared\FirstSpiritCmsDataStorage\FirstSpiritCmsDataStorageConfig;
[...]

class QueueDependencyProvider extends SprykerDependencyProvider
{
   protected function getProcessorMessagePlugins(Container $container)
   {
      return [
         [...]
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_BLOCK_DATA_CONNECTOR =&gt; new EventQueueMessageProcessorPlugin(),
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_PAGE_DATA_CONNECTOR =&gt; new EventQueueMessageProcessorPlugin(),
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_BLOCK_DATA =&gt; new SynchronizationStorageQueueMessageProcessorPlugin(),
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_PAGE_DATA =&gt; new SynchronizationStorageQueueMessageProcessorPlugin(),
      ];
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fs-installation"><a class="anchor" href="#fs-installation"></a>3. FirstSpirit - Installation and Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Various components must be installed and configured in order to use the functions of the <em>FirstSpirit Connect</em> module.
The following subchapters explain the steps required.</p>
</div>
<div class="sect2">
<h3 id="fs_pcomp"><a class="anchor" href="#fs_pcomp"></a>3.1. Configuration of the project component</h3>
<div class="paragraph">
<p>A project-specific configuration is necessary for the use of the <em>FirstSpirit Connect</em> module.
This is done via the project component, which is already added to the supplied <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the <em>FirstSpirit Connect</em> module, the <em>Content as a Service</em> module must also be configured.
The necessary steps are described in the <em><a href="https://docs.e-spirit.com/module/caas/CaaS_FSM_Documentation_EN.html">Content as a Service Documentation</a></em>.</p>
</div>
<div class="paragraph">
<p>For the media usage, the generation of media into the <em>CaaS</em> has been defined in the <em>CaaS</em> project component.
This configuration is explicitly <strong>not</strong> to be used in productive operation.
For productive operation, the media usage must be converted to the use of a CDN.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the project component, open the <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Project components</b></span></strong></code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/projectcomponents.png" alt="projectcomponents">
</div>
<div class="title">Figure 1. Server properties - Project components</div>
</div>
<div class="paragraph">
<p>The main panel displays a list of all existing project components.
Select <code>FirstSpirit Connect for FirstSpirit Commerce OS Project Configuration</code> and open the corresponding configuration dialog via <b class="button">Configure</b>.</p>
</div>
<div class="paragraph">
<p>The dialog is divided into the tabs <code><strong>General</strong></code>, <code><strong>Preview</strong></code>, <code><strong>Publication</strong></code>, and <code><strong>YouTube</strong></code>:</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>General</strong></span></p>
</div>
<div class="paragraph">
<p>Within the tab <code><strong>General</strong></code>, the <code>Storefront Base URL</code> and the <code>Glue-API Base URL</code> have to be specified.
They have to be assigned to the FirstSpirit server to connect to Spryker and retrieve data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pcomp_general.png" alt="pcomp general">
</div>
<div class="title">Figure 2. Project component - General</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Preview</strong></span></p>
</div>
<div class="paragraph">
<p>Within the <code><strong>Preview</strong></code> tab, the login path is required first.
The corresponding field contains the default value <code>/firstspirit_login_check</code>, which can be adjusted if necessary.</p>
</div>
<div class="paragraph">
<p>Furthermore, the login data of a technical user must be entered in this tab.
This must correspond to the <a href="#sp_customer">Customer</a> defined during the steps to be performed on the Spryker side.
In Spryker, it is used to query the storefront, which is included in the ContentCreator using the <em>Omnichannel Manager</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pcomp_preview.png" alt="pcomp preview">
</div>
<div class="title">Figure 3. Project component - Preview</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Publication</strong></span></p>
</div>
<div class="paragraph">
<p>The <code><strong>Publication</strong></code> tab contains a list of all groups and full deployment schedules available in the project.
It allows the selected deployment schedule to be provided in the <code><strong>Actions</strong></code> menu in the ContentCreators for the groups selected in the tab.
The <code><strong>Actions</strong></code> menu contains the <code><strong>Publication</strong></code> menu item for executing the schedule.
For groups that are not allowed to execute the schedule, the entry is visible but disabled.</p>
</div>
<div class="paragraph">
<p>Within the supplied reference project, the ChiefEditors can be enabled to execute the <a href="#fs-deployment">full deployment</a> in this way, for example.</p>
</div>
<div class="paragraph">
<p>Furthermore, the <a href="#fs-wf-adaptions">release</a> and the <a href="#fs-wf-adaptions">delete workflow</a> use the selected schedule
if the publication of the entire project should be triggered additionally to the release or deletion of a page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server and project administrators are allowed to execute the full deployment by default, regardless of the configuration within the tab.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pcomp_deployment.png" alt="pcomp deployment">
</div>
<div class="title">Figure 4. Project component - Publication</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>YouTube</strong></span></p>
</div>
<div class="paragraph">
<p>The reference project provided contains a <a href="#rp_section">Shoppable video paragraph</a>.
It allows to display and reference products at defined times in a YouTube video.
The usage of the paragraph requires a <a href="https://developers.google.com/youtube/v3/getting-started#before-you-start"><code>Google API Key</code></a>, which has to be entered here.</p>
</div>
<div class="paragraph">
<p>In addition, one or more <code>Channel Ids</code> can be specified, separated by commas.
As soon as the field contains an Id, the video selection will show a dropdown.
This allows to reference a YouTube video from a specific channel.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pcomp_youtube.png" alt="pcomp youtube">
</div>
<div class="title">Figure 5. Projekt-Komponente - YouTube</div>
</div>
</div>
<div class="sect2">
<h3 id="fs-webcomponents"><a class="anchor" href="#fs-webcomponents"></a>3.2. Adding the web component</h3>
<div class="paragraph">
<p>To prepare the ContentCreator, a web component is needed, which is already added to the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.
By default it is installed globally in the <code><strong>ServerManager</strong></code> in the area <code><strong><span class="menuseq"><b class="menu">Server Properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Web applications</b></span></strong></code>.
In this case, all installation or configuration steps required for the web component have already been performed by the e-Spirit AG.</p>
</div>
<div class="paragraph">
<p>Alternatively, you may install the web component in the <code><strong>Project properties</strong></code>.
<strong>Only in this case</strong> it still needs to be installed on an active web server.
Therefore, open the <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Web components</b></span></strong></code>.</p>
</div>
<div class="paragraph">
<p>Within the main panel there are several tabs, each with a list of existing web components.
This list contains the <code>FirstSpirit Connect for Spryker Commerce OS Web App</code> for the <code><strong>Preview</strong></code> and <code><strong>ContentCreator</strong></code>.
The <code><strong>ContentCreator</strong></code> tab also contains the <code>FirstSpirit ThirdPartyPreview WebApp</code> and optionally the <a href="#fs-bwfs"><code>BasicWorkflows_ContentCreator_Library</code></a> (see figure <a href="#webcomp">Web components in the project properties</a>).
The web component of the <em>BasicWorkflows</em> is only required when using the workflows.</p>
</div>
<div class="paragraph">
<p>In both tabs, select a web server via the selection box and start the installation with the <b class="button">Install</b> button.
After the successful installation, a dialog opens, in which the activation of the web server is to be confirmed.</p>
</div>
<div class="paragraph">
<p>For detailed information about adding web components, see the <em><a href="https://docs.e-spirit.com/odfs/edocs/admi/index.en.html">FirstSpirit Documentation for Administrators</a></em>.</p>
</div>
<div id="webcomp" class="imageblock">
<div class="content">
<img src="_images/webcomponents.png" alt="webcomponents">
</div>
<div class="title">Figure 6. Web components in the project properties</div>
</div>
</div>
<div class="sect2">
<h3 id="fs_previewurl"><a class="anchor" href="#fs_previewurl"></a>3.3. Definition of the external preview URL</h3>
<div class="paragraph">
<p>By using the <em>Omnichannel Manager</em>, the ContentCreator displays external content from Spryker to which the <em>Omnichannel Manager</em> needs access.
The preview URL of the Spryker storefront must therefore be specified in the ContentCreator properties.
Since the specification is always project-specific, there is no default configuration for it within the reference project.</p>
</div>
<div class="paragraph">
<p>Open the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">ContentCreator</b></span></strong></code> area within the <code><strong>ServerManager</strong></code> and enter the URL of the storefront with the following syntax in the <code>External preview URL</code> field:</p>
</div>
<div class="paragraph">
<p><code>https://[STOREFRONT_HOST_DOMAIN]/en/?firstSpiritPreview=[PREVIEW_INIT_TOKEN]</code></p>
</div>
<div class="paragraph">
<p>The token to be specified for the <code>firstSpiritPreview</code> query parameter must match the <a href="#sp_configuration">authentication token</a> defined during the configuration on Spryker side.
It is stored in the <a href="https://documentation.spryker.com/docs/configuration-management">file <code>config_default-[environment].php</code></a> in the directory <code><strong>config/Shared</strong></code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/previewurl.png" alt="previewurl">
</div>
<div class="title">Figure 7. External Preview URL</div>
</div>
</div>
<div class="sect2">
<h3 id="fs-conversionrule"><a class="anchor" href="#fs-conversionrule"></a>3.4. Conversion rule</h3>
<div class="paragraph">
<p>The data to be transferred to <em>CaaS</em> is defined in the <a href="#fs-templateset">template set</a> still to be created.
The use of certain special characters could lead to invalid JSON objects.
A conversion rule must therefore be created in order to prevent potential errors.</p>
</div>
<div class="paragraph">
<p>It is advisable to create a new conversion rule instead of editing an existing rule.
To do this, create a text file in your file system and add the following content to this file:</p>
</div>
<div class="listingblock">
<div class="title">Conversion rule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Script hljs" data-lang="Script">0x22="\""
[convert]
0x3c="&amp;lt;"
0x3e="&amp;gt;"
0x22="&amp;#34;"
0x26="&amp;amp;"
0x27="&amp;#39;"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then open <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Server properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Conversion rules</b></span></strong></code>.
A list of the existing conversion rules is displayed in the main panel.
After clicking <b class="button">Add</b>, select the text file created earlier from your file system and click <b class="button">Open</b> to confirm your selection.
The new rule is then added to the list in the main panel and is to be assigned to the <a href="#fs-templateset">template set</a> to be created.</p>
</div>
<div class="paragraph">
<p>More information is available in the <em><a href="https://docs.e-spirit.com/odfs/edocs/admi/index.en.html">FirstSpirit Documentation for Administrators</a></em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="fs-templateset"><a class="anchor" href="#fs-templateset"></a>3.5. Template set</h3>
<div class="paragraph">
<p>In addition to the existing template sets of a project, another XML channel is required.
This must be created manually for empty projects, but is already contained within the supplied <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project <em>FirstSpirit Connect Reference Project</em></a>.</p>
</div>
<div class="paragraph">
<p>The template set was created in the <code><strong>ServerManager</strong></code> under <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Template sets</b></span></strong></code> and has the following configuration:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/templateset.png" alt="templateset">
</div>
<div class="title">Figure 8. Template set</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the selection box of the same name, the <a href="#fs-conversionrule">conversion rule</a> created previously must be selected.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The template set is activated and therefore available in the project.
It is used to define the contents to be transmitted, which are summarized in messages during generation and transmitted to the <em>CaaS</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolutions"><a class="anchor" href="#_resolutions"></a>3.6. Resolutions</h3>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project <em>FirstSpirit Connect Reference Project</em></a> has different sections, which can be used to include images on the various pages.
The editor should be able to cut the images to a certain detail.
This functionality is activated by specifying a resolution.</p>
</div>
<div class="paragraph">
<p>For the reference project the resolutions <code>CONTENT_IMAGE</code>, <code>BANNER_IMAGE</code> and <code>MAGAZINE_ARTICLE_BANNER</code> are required.
They are already created within the <code><strong>ServerManagers</strong></code> in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Resolutions</b></span></strong></code> area and specified at the corresponding places.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/resolutions.png" alt="resolutions">
</div>
<div class="title">Figure 9. Resolutions</div>
</div>
</div>
<div class="sect2">
<h3 id="fs-deployment"><a class="anchor" href="#fs-deployment"></a>3.7. Generation schedule - full generation</h3>
<div class="paragraph">
<p>By default, releasing content does not update the <em>Online CaaS</em> and does not transfer data to Spryker.
Instead, it only includes the FirstSpirit release process, which can be mapped using the <em>BasicWorkflows</em> release workflow, for example.
An update of the <em>Online CaaS</em> as well as a data transfer to Spryker takes place only in the context of a deployment.</p>
</div>
<div class="paragraph">
<p>The deployment of released editorial content is executed via a <em>CaaS</em> schedule.
Therefore the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> has the schedule <em>Spryker Deployment</em>, which is created within the <code><strong>ServerManager</strong></code> in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Schedule management</b></span></strong></code> area.
It can be started using the <code><strong>Publication</strong></code> action available in ContentCreator and contains the following actions:</p>
</div>
<div id="img_deploy_actions" class="imageblock">
<div class="content">
<img src="_images/deploy_actions.png" alt="deploy actions">
</div>
<div class="title">Figure 10. Actions of the full generation</div>
</div>
<div class="paragraph">
<p>The schedule executes a full generation and transfers the data to the <em>Online CaaS</em>, which provides it to Spryker for import.
The actions <em>Initialize CaaS Generation</em>, <em>CaaS Generate</em>, <em>CaaS Cleanup</em> and <em>Finalize CaaS Generation</em> are used to fill the <em>Online CaaS</em>.
They are described in the <em><a href="https://docs.e-spirit.com/module/caas/CaaS_FSM_Documentation_DE.html">Content as a Service-Dokumentation</a></em>.</p>
</div>
<div class="paragraph">
<p>The actions <a href="#fs-deployment-media"><em>Execute Publish Media to CDN</em></a>, <a href="#fs-deployment-aggregations"><em>Setup CaaS Blocks Aggregations</em></a>, <a href="#fs-deployment-spryker-import"><em>Trigger Spryker Import</em></a>, <a href="#fs-deployment-fetch-spryker-logs"><em>Trigger Fetch Spryker Logs</em></a>,
<a href="#fs-deployment-spryker-cleanup"><em>Trigger Spryker Cleanup</em></a>, and <a href="#fs-deployment-spryker-sendmail"><em>Send Result Mail</em></a> extend the schedule and are described in the following chapters.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case of an error, the action <em>Send Result Mail</em> sends an e-mail with all relevant information to a recipient to be defined.
The recipient&#8217;s e-mail address must be specified in the field <code>e-mail distribution list</code> in the properties of the schedule.</p>
</div>
<div class="paragraph">
<p>In addition, the <code>ChiefEditors</code> group within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> must be enabled to execute a full generation.
To do so, the group must be allowed to execute the <code>Interactive execution</code> in the properties of the schedule.
This setting has already been made in the schedule supplied.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/deploy_groups.png" alt="deploy groups">
</div>
<div class="title">Figure 11. Properties of the schedule</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="fs-deployment-media"><a class="anchor" href="#fs-deployment-media"></a>3.7.1. Execute Publish Media to CDN</h4>
<div class="paragraph">
<p>Unlike the content created with FirstSpirit, the released media is not transferred to the <em>CaaS</em>, but to the CDN provided by the e-Spirit AG.
Therefore the schedule contains the script action <em>Execute Publish Media to CDN</em>.</p>
</div>
<div class="listingblock">
<div class="title">Execute Publish Media to CDN</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">import de.espirit.firstspirit.access.AdminService;

String SCHEDULER_NAME = "Media Deployment";

connection = context.getConnection();
adminService = connection.getService(AdminService.class);

scheduleStorage = adminService.getScheduleStorage();
scheduleEntry = scheduleStorage.getScheduleEntry(context.getProject(), SCHEDULER_NAME);

if(scheduleEntry != null) {
   control = scheduleEntry.execute();
   control.awaitTermination();
   isSuccessful =
      control.state.state.equals(de.espirit.firstspirit.access.schedule.RunState.SUCCESS);
   if(!isSuccessful){
      context.logWarning(SCHEDULER_NAME + " Completed with errors!");
   }
   context.logInfo("Schedule Entry executed...");
} else {
   context.logError("Could not find schedule entry with name" + SCHEDULER_NAME);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script triggers the <a href="#fs-mediadeployment">media generation</a> schedule, which is also included in the supplied <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.
The script contains the variable <code>SCHEDULER_NAME</code>, which has the name of the schedule as its value.
If the name changes, it must also be adjusted accordingly here.</p>
</div>
</div>
<div class="sect3">
<h4 id="fs-deployment-aggregations"><a class="anchor" href="#fs-deployment-aggregations"></a>3.7.2. Setup CaaS Blocks Aggregations</h4>
<div class="paragraph">
<p>By default, <em>CaaS</em> stores and delivers the content transferred from FirstSpirit page-based.
However, the processing and persistence of editorial content in Spryker is done on the basis of CMS blocks, each corresponding to a FirstSpirit section.
In order to resolve this discrepancy, the data stored in the <em>Online CaaS</em> must be prepared accordingly, before importing.
For this reason, an aggregation must only be added to all collections of the <em>Online CaaS</em>.
This adjustment is not necessary for the <em>Preview CaaS</em>, since the information in the preview is obtained directly from it and no processing takes place in Spryker.</p>
</div>
<div class="paragraph">
<p>The schedule contains the script action <em>Setup CaaS Blocks Aggregations</em> to create the aggregations.</p>
</div>
<div class="listingblock">
<div class="title">Setup CaaS Blocks Aggregations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">#!executable-class
com.espirit.ecom.contentconnect.spryker.module.caas.BlocksAggregationSetupExecutable</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script executes a PUT request for the configured collections of the <em>Online CaaS</em>.
This generates the aggregations that are used to make all CMS blocks contained in the extended collections available for Spryker to import.
For this, the script requires the list of the relevant collections, which can be passed to it using the optional parameter <code>caas_collections</code>.</p>
</div>
<div class="paragraph">
<p>By default, the parameter has the value <code>contentpages;categorypages;productpages;technical</code> and therefore does not need to be configured in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.
To overwrite the default value, the parameter <code>caas_collections</code> needs to be added in the script&#8217;s properties dialog.
Its value must correspond to a list of all collections, separated by semicolons, for which an aggregation is to be created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/deployparams.png" alt="deployparams">
</div>
<div class="title">Figure 12. Configuration parameter</div>
</div>
</div>
<div class="sect3">
<h4 id="fs-deployment-spryker-import"><a class="anchor" href="#fs-deployment-spryker-import"></a>3.7.3. Trigger Spryker Import</h4>
<div class="paragraph">
<p>In FirstSpirit, the creation and editing of editorial content takes place in the ContentCreator.
After release, they are transferred by deployment to the <em>Online CaaS</em> and imported from there by Spryker to be integrated into the shop.
In order to keep the contents always up-to-date in Spryker, the import process must be triggered by the deployment.
Therefore, the schedule contains the script action <em>Trigger Spryker Import</em>.
The script activates a import job on Spryker side, which in turn triggers the import and persistence of the contents stored in the <em>Online CaaS</em>.</p>
</div>
<div class="listingblock">
<div class="title">Trigger Spryker Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">#!executable-class
com.espirit.ecom.contentconnect.spryker.module.trigger.triggerimport.TriggerImportExecutable</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using the Spryker B2C Demo Shop, the import may fail when accessing the <code>access-tokens</code> endpoint with a <code>Response Code 500</code>.
In this case, the key files <code>dev_only_private.key</code> and <code>dev_only_public.key</code> within the directory <code><strong>data/shop/development/current/config/Zed</strong></code> must receive the authorization <code>600</code> or <code>660</code> respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>References to categories or products that have been deleted or are inactive in Spryker will result in errors and warnings during import.
Errors occurring in this context and recorded in the Spryker log are transferred to the FirstSpirit log by the following action.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="fs-deployment-fetch-spryker-logs"><a class="anchor" href="#fs-deployment-fetch-spryker-logs"></a>3.7.4. Trigger Fetch Spryker Logs</h4>
<div class="paragraph">
<p>Deleting or deactivating categories or products in Spryker that are referenced in the FirstSpirit project leads to errors and warnings during the import.
However, by default these are only recorded in the Spryker log.
To provide all information about a release in one place, the errors and warnings must also be recorded in the FirstSpirit log.
Therefore, the schedule contains the script action <em>Trigger Fetch Spryker Logs</em>.
It determines all errors and warnings for missing categories and products from the Spryker log and transfers them as warnings to the FirstSpirit log.
Operational managers are thus given the opportunity to react quickly to the outdated references in the FirstSpirit project.</p>
</div>
<div class="listingblock">
<div class="title">Trigger Fetch Spryker Logs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">#!executable-class
com.espirit.ecom.contentconnect.spryker.module.trigger.triggerfetchlogs.TriggerFetchLogsExecutable</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fs-deployment-spryker-cleanup"><a class="anchor" href="#fs-deployment-spryker-cleanup"></a>3.7.5. Trigger Spryker Cleanup</h4>
<div class="paragraph">
<p>The creation and editing of editorial content takes place in FirstSpirit before it is transferred to the <em>Online CaaS</em> via deployment and imported from there by Spryker.
In order to keep the data in both systems up-to-date, deleted content from the FirstSpirit project must also be removed on the Spryker side.
Therefore, the schedule contains the script action <em>Trigger Spryker Cleanup</em>.
The script triggers a comparison between the contents stored in the <em>Online CaaS</em> and persisted in the Spryker data system.
In this way, the obsolete data can be determined on the Spryker side and then removed.</p>
</div>
<div class="listingblock">
<div class="title">Trigger Spryker Cleanup</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">#!executable-class
com.espirit.ecom.contentconnect.spryker.module.trigger.triggercleanup.TriggerCleanupExecutable</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fs-deployment-spryker-sendmail"><a class="anchor" href="#fs-deployment-spryker-sendmail"></a>3.7.6. Send Result Mail</h4>
<div class="paragraph">
<p>In most cases, the deployment of the content created or edited in FirstSpirit is performed via the ContentCreator.
However, the ContentCreator does not inform the editor whether a publication was successful or failed.
Therefore, the schedule contains the script action <em>Send Result Mail</em>.
In case of an error, this action sends an e-mail with all relevant information to the recipient defined in the <code>e-mail distribution list</code> field in the schedule&#8217;s properties.
Additionally the e-mail contains the possibility to forward these information to the Technical Support of the e-Spirit AG.</p>
</div>
<div class="listingblock">
<div class="title">Trigger Spryker Cleanup</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">#! executable-class
com.espirit.ecom.contentconnect.spryker.module.schedule.ReviewScheduleResultExecutable</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fs-mediadeployment"><a class="anchor" href="#fs-mediadeployment"></a>3.8. Generation schedule - Media generation</h3>
<div class="paragraph">
<p>Unlike the content created with FirstSpirit, the released media is not transferred to the <em>CaaS</em>, but to the CDN provided by the e-Spirit AG.
Therefore, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> has the schedule <em>Media Deployment</em>, which is created within the <code><strong>ServerManager</strong></code> in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Schedule management</b></span></strong></code> area.
It is triggered by the <a href="#fs-deployment-media"><em>Execute Publish Media to CDN</em></a> action contained in the full generation
and has the actions <a href="#fs-mediadeployment-generation"><em>Media Generation</em></a> and <a href="#fs-mediadeployment-publish"><em>Publish to CDN</em></a>.
These are described in the following subchapters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/mediadeploy_actions.png" alt="mediadeploy actions">
</div>
<div class="title">Figure 13. Actions of the Media generation</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If it is desired to use a local CDN or a MAM instead of the CDN provided by the e-Spirit AG, the <a href="https://help.e-spirit.com/">Technical Support</a> will assist with the configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="fs-mediadeployment-generation"><a class="anchor" href="#fs-mediadeployment-generation"></a>3.8.1. Media Generation</h4>
<div class="paragraph">
<p>To transfer the media to the CDN provided by the e-Spirit AG, they must first be generated.
Therefore the schedule contains the generation action <em>Media Generation</em>.
It represents a partial generation, which refers to the root node of the Media Store.</p>
</div>
<div class="paragraph">
<p>To avoid inconsistencies in the live state, the options <code>Clear generation directory beforehand</code> and <code>Generate release version</code> must be activated in the <code>Properties</code> of the action.
Furthermore, it is necessary that the URL Factory selected at this point for <code>PathGeneration</code> and the
<a href="https://docs.e-spirit.com/module/caas/CaaS_FSM_Documentation_DE.html#schedule_conf"><code>URL-Factory for media use</code></a> configured in the project component of the <em>CaaS</em> are identical.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/mediageneration_settings.png" alt="mediageneration settings">
</div>
<div class="title">Figure 14. Properties of the Media Generation action</div>
</div>
</div>
<div class="sect3">
<h4 id="fs-mediadeployment-publish"><a class="anchor" href="#fs-mediadeployment-publish"></a>3.8.2. Publish to CDN</h4>
<div class="paragraph">
<p>Once the media have been generated, they are transferred to the CDN.
Therefore, the schedule contains the action <em>Publish to CDN</em>.
In the Cloud environment, this action is added by the Cloud department of the e-Spirit AG and is thus already preconfigured.
No further configuration is required.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the On Premises environment, a manual creation and configuration of this action is required.
The necessary information is provided by the e-Spirit AG.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/mediageneration_publication.png" alt="mediageneration publication">
</div>
<div class="title">Figure 15. Publish to CDN</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fs-previewdeployment"><a class="anchor" href="#fs-previewdeployment"></a>3.9. Generation schedule - preview generation</h3>
<div class="paragraph">
<p>Under certain <a href="#uc-datasync">circumstances</a> it might happen that the datasets in the FirstSpirit project, the CaaS and in Spryker differ.
In this case the contents from the <em>Online CaaS</em> and in Spryker can be updated by a <a href="#fs-deployment">full generation</a>.
In contrast, updating the <em>Preview CaaS</em> would require all pages within the FirstSpirit project to be saved again separately.</p>
</div>
<div class="paragraph">
<p>For this reason, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> has the schedule <em>Spryker Preview Deployment</em>, which is created within the <code><strong>ServerManager</strong></code> in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Schedule management</b></span></strong></code> area and can only be executed by project administrators.
This schedule has the same actions as the <a href="#fs-deployment">full generation</a> with exception of the <a href="#fs-deployment-media"><em>Execute Publish Media to CDN</em></a>, <a href="#fs-deployment-aggregations"><em>Setup CaaS Blocks Aggregations</em></a>,
<a href="#fs-deployment-fetch-spryker-logs"><em>Trigger Fetch Spryker Logs</em></a>, and <a href="#fs-deployment-spryker-sendmail"><em>Send Result Mail</em></a> actions.
Since the information in the preview is obtained directly from the FirstSpirit project or the <em>Preview CaaS</em> and no processing takes place in Spryker,
it is not necessary to create aggregations, publish media or determine Spryker logs for the preview generation.
Furthermore, the preview generation is started from the <code><strong>ServerManager</strong></code>, so sending an e-mail to an administrator is also not required.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After a project import a <a href="#uc-datasync">content exchange</a> is mandatory.
For this, however, all configuration steps on both the FirstSpirit and the Spryker side must be completed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/previewdeploy_actions.png" alt="previewdeploy actions">
</div>
<div class="title">Figure 16. Actions of the preview generation</div>
</div>
<div class="paragraph">
<p>Within the actions <em>Initialize CaaS Generation</em>, <em>CaaS Generate</em>, <a href="#fs-deployment-spryker-import"><em>Trigger Spryker Import</em></a>, and <a href="#fs-deployment-spryker-cleanup"><em>Trigger Spryker Cleanup</em></a> different settings are necessary.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Initialize CaaS Generation</dt>
<dd>
<p>Among other things, the action <em>Initialize CaaS Generation</em> requires the definition of a API Key and a CaaS URL.
In the case of the preview generation, the <em>Preview CaaS</em> data must be specified for both parameters.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The API Key requires both read and write permissions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A description of the action and the parameters needed for it is contained in the <em><a href="https://docs.e-spirit.com/module/caas/CaaS_FSM_Documentation_EN.html">Content as a Service Documentation</a></em>.</p>
</div>
</dd>
<dt class="hdlist1">CaaS Generate</dt>
<dd>
<p>During preview generation, this action may only deal with the current state of the content.
For this reason, the checkbox <code>Generate release status</code> in the <code><strong>Properties</strong></code> of the action must be deactivated.</p>
<div class="paragraph">
<p>A description of the action is contained in the <em><a href="https://docs.e-spirit.com/module/caas/CaaS_FSM_Documentation_EN.html">Content as a Service Documentation</a></em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/deploy_caas_generate.png" alt="deploy caas generate">
</div>
<div class="title">Figure 17. Properties of the action CaaS Generate</div>
</div>
</dd>
<dt class="hdlist1">Trigger Spryker Import</dt>
<dd>
<p>In the preview, the import may only consider the contents of the <em>Preview CaaS</em>.
For this purpose, the parameter <code>triggerStagedContentImport</code> must be added to the action&#8217;s <code><strong>Properties</strong></code> and the value <code>true</code> must be specified for it.
By default, the parameter has the value <code>false</code> and is therefore not required in the action of the same name in the <a href="#fs-deployment">full generation</a>.</p>
<div class="paragraph">
<p>This setting is already included in the schedule of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.</p>
</div>
</dd>
<dt class="hdlist1">Trigger Spryker Cleanup</dt>
<dd>
<p>As the import action, the cleanup action may only consider the contents of the <em>Preview CaaS</em>.
For this purpose, the parameter <code>triggerStagedContentCleanup</code> must be added to the action&#8217;s <code><strong>Properties</strong></code> and the value <code>true</code> must be specified for it.
By default, this parameter also has the value <code>false</code> and is therefore optional in the full generation.</p>
<div class="paragraph">
<p>This setting is also already included in the schedule of the reference project.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CMS Pages deleted within the FirstSpirit project are only deleted in Spryker if they have not been published before.
Otherwise, due to technical restrictions, they are kept in Spryker and are only removed when a <a href="#fs-deployment">full generation</a> is executed.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="fs-wf"><a class="anchor" href="#fs-wf"></a>3.10. Workflows</h3>
<div class="paragraph">
<p>Content is released, deleted and published within the provided <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> via workflows.
These are already added to the project and are described in the following subchapters.</p>
</div>
<div class="sect3">
<h4 id="fs-delete-wf-report"><a class="anchor" href="#fs-delete-wf-report"></a>3.10.1. Delete workflow for automated deletion</h4>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> contains the <a href="#uc_orphanedpages">report <code><strong>Lost and Found</strong></code></a>, which shows an overview of all orphaned <a href="#rp_productpages">product</a> and <a href="#rp_categorypages">category pages</a>.
These are pages that contain references to deleted or inactive products or categories in Spryker.</p>
</div>
<div class="paragraph">
<p>Each entry of this report has a delete button, which enables the removal of the corresponding page.
The reference project therefore contains the workflow <em>Direct delete</em>, which is triggered by this button.
With the exception of the dual control principle, its functionality corresponds to that of the <a href="#fs-bwfs">delete BasicWorkflow</a> described in the following chapter.
In addition to the deletion of the page, the workflow releases the parent structure and finally performs a <a href="#fs-deployment">full deployment</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="fs-bwfs"><a class="anchor" href="#fs-bwfs"></a>3.10.2. BasicWorkflows</h4>
<div class="paragraph">
<p>Content is released, deleted, and published by editors within the supplied <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project <em>FirstSpirit Connect Reference Project</em></a> via the <em>BasicWorkflows</em>.
These were adapted project-specifically and extended by the possibility to execute a <a href="#fs-deployment">full generation</a>.
Just like the direct release or delete option, this option is only available to roles that have the release or delete right.
In the reference project, this is the group <code>ChiefEditors</code>.</p>
</div>
<div class="paragraph">
<p>In addition, both workflows send an e-mail to the user who has performed (and not just requested) the release or deletion.
In case of success, this e-mail only informs that the workflow has been successfully executed.
In case of an error, it indicates that the recipient specified in the <a href="#fs-deployment">deployment schedule</a> has received all necessary information and should be contacted.</p>
</div>
<div class="paragraph">
<p>The following <a href="#fs-wf-adaptions">subchapter</a> explains the adjustments made.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Installation of the BasicWorkflows module</strong></span></p>
</div>
<div class="paragraph">
<p>Before using the workflows, the <em>BasicWorkflows</em> module must first be installed on the FirstSpirit server and the web component activated.
The necessary steps are the same as the installation of the other modules and activation of the corresponding <a href="#fs-webcomponents">web components</a>.
By default, these steps are already performed.</p>
</div>
<div class="paragraph">
<p>The use of <em>BasicWorkflows</em> in ContentCreator also requires the selection of the provided <code>BasicWorkflows Status Provider</code> in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">ContentCreator</b></span></strong></code> area within the <code><strong>ServerManager</strong></code>.
This setting has as well already been made in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project <em>FirstSpirit Connect Reference Project</em></a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/basicwfs.png" alt="basicwfs">
</div>
<div class="title">Figure 18. Element Status Provider</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Templates</strong></span></p>
</div>
<div class="paragraph">
<p>The <em>BasicWorkflows</em> need different templates.
These usually have to be imported into the FirstSpirit project via the context menu.
However, they are already included in the reference project and an import of the templates is therefore not necessary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The templates contained in the reference project were adapted to the specific project and supplemented with additional templates.
If the workflows contained in the reference project should be used in another project, these templates and not those of the <em>BasicWorkflows</em> module must be transferred to the other project.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Permission assignment</strong></span></p>
</div>
<div class="paragraph">
<p>In the final step, the workflows must be allowed in each store to run on FirstSpirit elements.
To do this, you can open the permission assignment on the root nodes of the stores via the context menu entry <code><strong><span class="menuseq"><b class="menu">Extras</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Change Permissions</b></span></strong></code>.
This step has already been performed in the reference project and is therefore omitted.</p>
</div>
<div class="paragraph">
<p>The rights set on the stores' root nodes to execute the workflows refer to the <code>Everyone</code> group.
If this is not desired, the rights must be adjusted manually.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>More information about the installation, configuration and functionality of the workflows can be found in the <em><a href="https://docs.e-spirit.com/module/basicworkflows/BasicWorkflows_Documentation_EN.html">BasicWorkflows Documentation</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="fs-wf-adaptions"><a class="anchor" href="#fs-wf-adaptions"></a>3.10.3. Project-specific adjustments</h4>
<div class="paragraph">
<p>By default, the <em>BasicWorkflows</em> workflows has two ways to release or to delete an item:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct release | Direct delete</p>
</li>
<li>
<p>Request</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, the direct option is only available to roles that have the release or delete right.
In the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>, this is the group <code>ChiefEditors</code>.
Otherwise, a release or deletion can only be requested and assigned to the next person.
This person either rejects the request by manually triggering a conflict, or executes the release or deletion of the element by continuing the workflow.</p>
</div>
<div class="paragraph">
<p>Both workflows provided in the reference project were adapted project-specific and extended by the possibility,
to execute a <a href="#fs-deployment">full generation</a> in addition to the release or deletion of a page.
Therefore, an additional button has been added to the start dialog and the check dialog.</p>
</div>
<div class="paragraph">
<p>In the release workflow this is the button <b class="button">Page Publication</b>.
It corresponds to the transition <code>trigger_release_and_deploy</code>, which, like direct release, can only be executed with the release right.<br>
The delete workflow has been extended by the button <b class="button">Delete with publication</b>, which represents the transition <code>trigger_delete_and_deploy</code> and requires both release and delete rights.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/wf_dialogs.png" alt="wf dialogs">
</div>
<div class="title">Figure 19. Extension of the release workflow</div>
</div>
<div class="paragraph">
<p>Both buttons execute the <code>set_value_for_deployment</code> script, which sets the <code>deploymentTriggered</code> variable.
This variable is evaluated in the last step of the respective workflow in the script <code>trigger_full_deployment</code> and defines whether the workflow executes a full generation in addition to the release or deletion.</p>
</div>
<div class="paragraph">
<p>In order to execute the publication, the Executable triggered by the <code>trigger_full_deployment</code> script must know the name of the corresponding <a href="#fs-deployment">full deployment schedule</a>.
Therefore the Executable accesses the combo box <code>Schedule Entry for publication</code>, which is included in the <code><strong>Publication</strong></code> tab of the <a href="#fs_pcomp">project component</a>, and queries the schedule selected in it.
Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>, the full generation <em>Spryker Deployment</em> is defined here.</p>
</div>
<div class="paragraph">
<p>After execution, both workflows also send an e-mail to the user who has performed (and not just requested) the release or deletion.
This e-mail either just informs about the successful execution of the workflow or points out that an error occurred during the publication.
In this case, the e-mail also indicates that the recipient specified in the <a href="#fs-deployment">Deployment schedule</a> has received all needed information and should be contacted.
This is necessary because only project administrators can resolve errors in the deployment schedule.</p>
</div>
<div class="paragraph">
<p>Both in the case of success and in the case of error, the executable called in the last step of the respective workflow accesses the technical page template <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/technical/html_mail_template/ChannelSource_HTML_html.html"><code>html_mail_template</code></a> to send the corresponding e-mail.
This template includes the texts of all e-mails sent by the workflows or deployment schedules.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The notification of the recipient defined in the <a href="#fs-deployment">deployment schedule</a> is done via the action <a href="#fs-deployment-spryker-sendmail"><em>Send Result Mail</em></a>.
This e-mail is sent for all errors that occur during a generation and is not linked to the execution of a workflow.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the delete workflow can only be used for deleting <a href="#rp_contentpage">dynamic content pages</a> as well as <a href="#rp_productpages">product</a> and <a href="#rp_categorypages">category pages</a>, its display logic has also been extended.
The new statement hides the workflow for all pages that do not match a content, product, or category page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on the functionality of the workflows, see the <em><a href="https://docs.e-spirit.com/module/basicworkflows/BasicWorkflows_Documentation_EN.html">BasicWorkflows Documentation</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fs-projectsettings"><a class="anchor" href="#fs-projectsettings"></a>3.11. Project settings</h3>
<div class="paragraph">
<p>There is some essential project-specific information that needs to be entered for the connection between FirstSpirit and Spryker.
It is entered using the project settings form and must be specified within the project being used.</p>
</div>
<div class="paragraph">
<p>Within the supplied reference project, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/project_settings">project settings page</a> with the required configuration already exists.
In this case, there is no need to create the template or the required components.
Even defining the <code>settings page</code> in the <code><strong>Options</strong></code> of the project in the <code><strong>ServerManager</strong></code> is no longer required.</p>
</div>
<div class="paragraph">
<p>The form of the project settings in the reference project is divided into the tabs <code><strong>General</strong></code> and <code><strong>Static Pages</strong></code>, in which different information must be entered:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Aktive Store</dt>
<dd>
<p>This input component provides the option to select the store in which the created content is to be published.
The selection is read out at different points within the <a href="#ref-project">FirstSpirit templates</a>.</p>
</dd>
<dt class="hdlist1">Page Reference</dt>
<dd>
<p>The feature associated with this field is not yet available in the current version.
It therefore has no function at this time.</p>
<div class="imageblock">
<div class="content">
<img src="_images/psettings_general.png" alt="psettings general">
</div>
<div class="title">Figure 20. Projekteinstellungen - General</div>
</div>
</dd>
<dt class="hdlist1">Static Page URLs</dt>
<dd>
<p>This input component provides the option of assigning a relative URL to <a href="#rp_staticsite">static pages</a>.
This is needed because static pages do not have a URL by default and <a href="#rp_links">content page links</a> to them would therefore not be possible.</p>
<div class="paragraph">
<p>The definition of the URLs first requires a determination of all static pages.
For this purpose, the <b class="button">Static Page Templates Import</b> button within the reference project reads the contents of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/static_pages"><em>static_pages</em> template folder</a>,
which contains all page templates for static pages.
For each template, an entry is automatically created that contains a reference to the template and a language-dependent field for the relative URL to be defined.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/psettings_staticpages.png" alt="psettings staticpages">
</div>
<div class="title">Figure 21. Projekteinstellungen - Static Pages</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A future modification of the defined URLs requires the execution of both the <a href="#fs-deployment">full generation</a> and the <a href="#fs-previewdeployment">preview generation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ref-project"><a class="anchor" href="#ref-project"></a>4. Reference project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module provides different ways to access shop content from Spryker and use it in FirstSpirit.
This requires different templates both within the FirstSpirit project and on the Spryker side.
These templates and the dependencies between them are described in the following subchapters using the
<a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The section and page templates contained in the reference project require different <a href="#sp_twigtemplates">Twig templates</a> for their use in Spryker.
The descriptions in the following subchapters assume the existence of these templates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="rp_staticsite"><a class="anchor" href="#rp_staticsite"></a>4.1. Extension of existing static pages</h3>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module allows editors to enrich static pages that already exist on Spryker side with FirstSpirit content.
The pages are displayed within the ContentCreator using the <em>Omnichannel Manager</em> and thus integrate seamlessly into the editorial process familiar from FirstSpirit.</p>
</div>
<div class="paragraph">
<p>Besides the integration of the <em>Omnichannel Manager</em>, which is a step of the installation, the extension of static pages in FirstSpirit requires the filling of the output channel of the page and section templates.
In addition, an adaptation of the corresponding Twig templates is necessary on Spryker side.</p>
</div>
<div class="sect3">
<h4 id="rp_pagetemp"><a class="anchor" href="#rp_pagetemp"></a>4.1.1. Page template</h4>
<div class="paragraph">
<p>Editorial content in the FirstSpirit project is always edited on the basis of a page reference.
It and the page on which it is based must first be created in the FirstSpirit project.
Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project <em>FirstSpirit Connect Reference Project</em></a>, the creation of the page reference and its page runs automatically in the background and invisible to the editor.
The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/Scripts/omnichannel_manager/infer_page_storage_information"><code>infer_page_storage_information</code> script</a> uses the page ID defined in the <a href="#sp_controller">IndexController</a> to determine the corresponding FirstSpirit page template.</p>
</div>
<div class="paragraph">
<p>The page template <code>homepage</code> contained in the reference project is an example of a static page.
The following code fragment shows the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage/ChannelSource_CaaS_CaaS.json">output channel</a> of this page template:</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template homepage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_TRIM(level:1)$
   $CMS_SET(json, {:})$
   $CMS_SET(previewId, previewId(element:#global.node))$
   $CMS_SET(void, json.put("previewId", "" + previewId))$
   $CMS_SET(void, json.put("pagetype", "static"))$
   $CMS_SET(void, json.put("identifier", #global.node.uid))$

   $CMS_SET(blocks, [])$
   $CMS_FOR(bodyName, #global.page.template.bodies.map(body -&gt; body.name))$
      $CMS_VALUE(#global.page.body(bodyName))$
   $CMS_END_FOR$

   $CMS_SET(void, json.put("blocks", blocks))$

   $CMS_VALUE(json.toJSON)$
$CMS_END_TRIM$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page template maps the Twig template <code>home.twig</code> and contains the content areas <code>fs_slt_2</code>, and <code>fs_slt_3</code>.
The content areas enable the addition of editorial content, for which various section templates are available in the reference project.
Their content is added to the <code>json</code> object created in the template.</p>
</div>
<div class="paragraph">
<p>In addition to the editorial content, the <code>previewId</code>, the <code>identifier</code> and the <code>pagetype</code> are passed to the JSON object:
The <code>previewId</code> serves to identify the page reference and allows its decoration in the ContentCreator as well as its mapping to the Spryker Twig template.
The page reference for the preview is identified by the <a href="#sp_basetemp">JavaScript of the <em>Omnichannel Manager</em></a>.
The generation of the page in Spryker is done using the <code>identifier</code>.
It ensures the unique identification in Spryker.
It must also be known whether the underlying page is static or dynamic.
This information is indicated by the <code>pagetype</code>.</p>
</div>
<div class="paragraph">
<p>The generated JSON object is part of the <em>CaaS</em> item to be generated, which is persisted on the Spryker side by the importer.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_section"><a class="anchor" href="#rp_section"></a>4.1.2. Section template</h4>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage">page template <code>homepage</code></a> contained in the reference project is an example of a static page.
It contains the content areas <code>fs_slt_2</code>, and <code>fs_slt_3</code>.
The content areas allow the addition of editorial content.
Different section templates are available for this, all based on the same principle.
One of them is the <code>shoppable_video</code> section template, which is described here as an example.</p>
</div>
<div class="paragraph">
<p>Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json">output channel</a> of the Shoppable Video section, various general information is first defined and stored in the <code>block</code> array:
The <code>previewId</code> serves the identification of the section and enables it to be edited in the ContentCreator.
The fields <code>active</code> and <code>store_names</code> indicate that the CMS block represented by the section is active on the Spryker side and visible in the store selected in the <a href="#fs-projectsettings">project settings</a>.</p>
</div>
<div class="paragraph">
<p>The output of the section on Spryker side is handled by the <a href="#fs_molecule">Twig template <code>fs_molecule_block</code></a>.
This corresponds to a generic template that controls the output of all molecules.
In order to ensure the output of the section both in the preview and in the live state, the name and path of this Twig template must be stored within the <em>CaaS</em> item.
Both details are therefore included in the general information of the section.</p>
</div>
<div class="listingblock">
<div class="title">Definition of general information in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(block,{:})$

$-- Defining general block data --$
$CMS_SET(void, block.put("previewId", "" + previewId()))$
$CMS_SET(void, block.put("active", "1"))$
$CMS_SET(void, block.put("store_names",[ps_activeStore]))$
$CMS_SET(void, block.put("template_name", "fs_molecule_block"))$
$CMS_SET(void, block.put("template_path", "@CmsBlock/template/fs_molecule_block.twig"))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/block_name_render/ChannelSource_CaaS_CaaS.json"><code>block_name_render</code> render template</a> then determines the block name.
This is composed of the name of the parent content area and the ID of the section.</p>
</div>
<div class="paragraph">
<p>The <code>block_key_render</code> render template behaves in the same way as the <code>block_name_render</code> render template.
In contrast to this, however, it does not determine the block name, but the unique key of the corresponding block.</p>
</div>
<div class="paragraph">
<p>Using the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/additional_block_attributes_render/ChannelSource_CaaS_CaaS.json">render template <code>additional_block_attributes_render</code></a>, additional attributes are added to the block.
These attributes are the slot key and the position of the block within the slot, as well as the page type and a unique ID.</p>
</div>
<div class="paragraph">
<p>The importer requires the <code>placeholders</code> field to be in the generated <em>CaaS</em> item.
Therefore, it has to be created here, even though it does not have any data.</p>
</div>
<div class="listingblock">
<div class="title">Determination of specific information in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(set_pageType, json.get("pagetype"))$

$-- Add block name attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_name_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add block key attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_key_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add additional block attributes to block object (page type dependent) --$
$CMS_RENDER(template: "additional_block_attributes_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Defining placeholder data of the block --$
$CMS_SET(placeholders,{:})$
$CMS_SET(void, block.put("placeholder",placeholders))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The array <code>data</code> contains the editorial contents maintained in the form of the section.
These correspond to the video ID of the selected YouTube video and a list of video items based on the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/list_elements/shoppable_video_item"><code>shoppable_video_item</code> section template</a> described below.
They are displayed at defined times of the video.
To display the video, the player needs the <code>previewId</code> specified here.
On Spryker side, the section is represented by the molecule <code>fs-shoppable-video</code>, whose name is also contained in the <code>data</code> array.</p>
</div>
<div class="paragraph">
<p>The importer expects the information in the context of the current language.
For this reason, the corresponding language abbreviation to which the array <code>data</code> is assigned is determined.</p>
</div>
<div class="paragraph">
<p>In the preview, the contents of the section are output directly.
Otherwise, the last step adds the section to the <code>blocks</code> array defined in the page template, which contains all sections of a page and integrates them into the <em>CaaS</em> item to be generated.</p>
</div>
<div class="listingblock">
<div class="title">Processing of editorial content in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(data,{:})$
$CMS_SET(void, data.put("moleculename", "fs-shoppable-video"))$
$CMS_SET(void, data.put("videoId", if(!st_video.empty,st_video.values.first.id)))$
$CMS_SET(void, data.put("previewId", previewId()))$

$CMS_SET(items,[])$
$CMS_VALUE(st_items)$
$CMS_SET(void, data.put("items", items))$

$CMS_SET(locale, #global.language.getLocale())$
$CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$
$CMS_SET(localizedData,{:})$
$CMS_SET(void, localizedData.put(localeAbbr, data))$
$CMS_SET(void, block.put("data", localizedData))$

$CMS_IF(#global.is("WEBEDIT") &amp;&amp; !isSet(caas_preview_generation))$
   $CMS_VALUE(block.toJSON)$
$CMS_ELSE$
   $CMS_SET(void, blocks.add(block))$
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned before, the various video items are based on the <code>shoppable_video_item</code> section template.
Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/list_elements/shoppable_video_item/ChannelSource_CaaS_CaaS.json">output channel</a> of this template, the editorial content for a single video item is determined and stored in the <code>item</code> array.
The editorial content corresponds to the time at which the video item is displayed, an image, a text and a reference to the detail page of a product to be selected.
The last step adds the single video item to the <code>items</code> array defined in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json"><code>shoppable_video</code> section template</a>, which contains all video items and integrates them into the <em>CaaS</em> item to be generated.</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the video item</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(item, {"time": st_time})$

$CMS_IF(!st_picture.empty)$
	$CMS_SET(void, item.put("picture", {
		"imageUrl": ref(st_picture, res:"CONTENT_IMAGE", abs:1).url,
		"ambilight": !st_ambilight.empty &amp;&amp; st_ambilight
	}))$
	$CMS_IF(!#global.release)$
		$CMS_SET(void, item.picture.put("previewId", previewId(element: st_picture)))$
	$CMS_END_IF$
$CMS_END_IF$

$CMS_IF(!st_text.empty)$
	$CMS_SET(void, item.put("text", st_text.normalize.toText(true)))$
$CMS_END_IF$

$CMS_IF(!st_product.empty)$
	$CMS_SET(void, item.put("productId", st_product.identifiers.get(0)))$
$CMS_END_IF$

$CMS_SET(void, items.add(item))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The edit dialog in the ContentCreator has the <b class="button">Open Video</b> button for entering the display time, the image, the text and the reference of a video item.
This button opens another dialog in which the selected video is visible and playable.
With the help of a timeline, the video items can be intuitively created, edited or deleted within this dialog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/videoitem.png" alt="videoitem">
</div>
<div class="title">Figure 22. Editing dialog for video items</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_twigtemplates"><a class="anchor" href="#rp_twigtemplates"></a>4.1.3. Twig templates</h4>
<div class="paragraph">
<p>In FirstSpirit, the creation and editing of editorial content takes place in ContentCreator.
The storefront is embedded in it using the <em>Omnichannel Manager</em>.
This in turn accesses the <em>Preview CaaS</em> and determines the current FirstSpirit contents from there.
These contents are transferred to the <em>Online CaaS</em> via a <a href="#fs-deployment">FirstSpirit deployment</a>.
The latter makes them available to the importer, who transfers them to Spryker and persists them there.</p>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code> represents a static page on the Spryker side and can be found under the path <code><strong>src/Pyz/Yves/HomePage/Theme/default/views/home</strong></code>.
To make this page editable in ContentCreator, it is necessary to replace the CMS slots contained in it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The slots represent the content areas of the respective <a href="#rp_pagetemp">FirstSpirit page template</a>.
For this reason, the key of the CMS slot and the name of the content area must match and start with the prefix <code>fs-slt</code> and <code>fs_slt</code> respectively.
It is important to note that hyphens in the key of the slot are replaced by underscores within FirstSpirit.
The slot <code>fs-slt-2</code> thus corresponds to the content area <code>fs_slt_2</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The inclusion of a slot is done via the Spryker standard command <code>cms_slot</code>, which in turn calls the <a href="#sp_plugin"><code>FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</code></a>.
This is part of the delivery and requires an extension of the <code>ShopCmsSlotDependencyProvider</code>.
Unlike the <code>CmsSlotBlockWidget</code> included in Spryker, it only takes into account the data stored in <em>CaaS</em>.</p>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code> is represented by the  <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage">page template <code>homepage</code></a> contained in the reference project.
It is an example for a static page and has the content areas <code>fs_slt_2</code> and <code>fs_slt_3</code>.
The following code example shows the integration of the slots of the same name within the Twig template to make the static page editable in ContentCreator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Within the Twig template the ID <code>idCmsPage</code> has to be defined and passed to each block.
It is composed of the page type and the name of the FirstSpirit page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Extension of the Twig template home.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends template('page-layout-main') %}

{% define data = {
   idCmsPage: 'static_homepage',
} %}

{% block pageInfo %}{% endblock %}

{% block container %}
   {% cms_slot 'fs-slt-2' with{
      idCmsPage: data.idCmsPage,
   }%}

   &lt;div class="container container--home-page"&gt;
      &lt;main&gt;
         {% block content %}
            {% cms_slot 'fs-slt-3' with{
               idCmsPage: data.idCmsPage,
            }%}
         {% endblock %}
      &lt;/main&gt;
   &lt;/div&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The content areas <code>fs_slt_2</code> and <code>fs_slt_3</code> contained in the <a href="#rp_pagetemp">page template <code>homepage</code></a> allow the addition of editorial content.
For this purpose, various section templates are available within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>, for which a corresponding block Twig template must exist on the Spryker side.
One of these templates is the <a href="#rp_section">section template <code>shoppable_video</code></a>, which is represented by the molecule <code>fs-shoppable-video</code> on the Spryker side.
This molecule is part of the <a href="#sp_twigtemplates">Spryker module <code>firstspirit-reference-components</code></a> included in the delivery and is stored in the directory <code><strong>FirstSpiritReferenceComponents</strong></code> in Spryker.</p>
</div>
<div class="paragraph">
<p>The following code extract shows the content of the molecule <code>fs-shoppable-video</code> in a highly abbreviated form:</p>
</div>
<div class="listingblock">
<div class="title">Molecule fs-shoppable-video</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
   name: 'fs-shoppable-video',
   tag: 'fs-shoppable-video'
} %}

{% define data = {
   fsBlockData: [],
} %}

{% block body %}
   [...]
   &lt;fs-youtube-player video-id="{{ data.fsBlockData.videoId }}" nocookie muted&gt;
      {% for item in data.fsBlockData.items %}
         &lt;div data-time="{{ item.time }}"&gt;
            {% set url = item.productId is defined ? getProductPageUrl(item.productId):null %}
            &lt;a href="{{url}}"&gt;
               {% set ambilight = item.picture.ambilight is defined and item.picture.ambilight %}
               &lt;span class="picture{{ambilight ? 'with-ambilight':''}}"
                  style="background-image: url('{{ item.picture.imageUrl }}');"&gt;
               &lt;/span&gt;
               [...]
               {{ item.text | raw }}
               [...]
            &lt;/a&gt;
            [...]
         &lt;/div&gt;
      {% endfor %}
   &lt;/fs-youtube-player&gt;
   &lt;script type="module" src="https://www.unpkg.com/fs-youtube-player"&gt;&lt;/script&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the template, the name and tag of the molecule are defined first.
The fsBlockData object is then created.
It provides access to the structured data defined in the output channel of the <a href="#rp_section">FirstSpirit section template</a>.
In the preview case, this data is obtained directly from the <em>Preview CaaS</em>.
In contrast, the data for the live state comes from Spryker.
Therefore, they are imported during a <a href="#fs-deployment">FirstSpirit generation</a> from the <em>Online CaaS</em> and persisted in Spryker.
The fsBlockData object and the JSON object created in FirstSpirit thus have the same structure in both cases.</p>
</div>
<div class="paragraph">
<p>The block <code>body</code> describes the output of the editorial content.
These correspond to the time at which the video item is displayed, an image, a text and a reference to the detail page of a product to be selected.</p>
</div>
<div class="paragraph">
<p>The following figure shows the representation of the CMS block.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/section.png" alt="section">
</div>
<div class="title">Figure 23. Representation of the section</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_categorypages"><a class="anchor" href="#rp_categorypages"></a>4.2. Extension of existing category pages</h3>
<div class="paragraph">
<p>Just like the <a href="#rp_staticsite">static pages</a> described above, category pages that already exist on the Spryker side can also be displayed in ContentCreator using the <em>Omnichannel Manager</em> and enriched with editorial content.
This also requires the filling of the output channel of the page and section template within the FirstSpirit project as well as a adaptation of the corresponding Twig templates in Spryker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If there are references to categories or products within the FirstSpirit project which have been deleted or are inactive in Spryker, so-called orphaned pages occur.
These can be removed from the project via the <a href="#uc_orphanedpages">report <code><strong>Lost and Found</strong></code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="rp_cp_pagetemp"><a class="anchor" href="#rp_cp_pagetemp"></a>4.2.1. Page template</h4>
<div class="paragraph">
<p>Just like <a href="#rp_pagetemp">static pages</a>, the extension of a category page in the FirstSpirit project is based on a page reference.
It and its associated page are also automatically created in the background and invisible to the editor.</p>
</div>
<div class="paragraph">
<p>The reference project contains the page template <code>categorypage</code>, which is an example of a category page and maps the Twig template <code>catalog-with-cms-slot.twig</code>.
The following code fragment shows the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">output channel</a> of this page template:</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template categorypage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_TRIM(level:1)$
   $CMS_SET(json, {:})$
   $CMS_SET(previewId, previewId(element:#global.node))$
   $CMS_SET(void, json.put("previewId", "" + previewId))$
   $CMS_SET(void, json.put("pageRevisionId", #global.page.revision.id))$
   $CMS_SET(void, json.put("pagetype", "category"))$
   $CMS_SET(blocks, [])$

   $CMS_VALUE(#global.page.body("banner"))$
   $CMS_VALUE(#global.page.body("top"))$
   $CMS_VALUE(#global.page.body("bottom"))$
   $CMS_SET(void, json.put("blocks", blocks))$

   $CMS_VALUE(json.toJSON)$
$CMS_END_TRIM$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">output channel</a> of the category page is almost identical to that of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage/ChannelSource_CaaS_CaaS.json">homepage</a>, which corresponds to a <a href="#rp_pagetemp">static page</a>.
It differs only in the page type, the revision id and in the number of content areas.
The page type is used to determine the block name and must have the value <code>category</code> at this point.
The block name is determined depending on the page type using the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/block_name_render/ChannelSource_CaaS_CaaS.json">render template <code>block_name_render</code></a>, which is referenced in the output channel of the respective <a href="#rp_section">section</a>.
The content areas of the page template correspond to the CMS block positions defined on the Spryker side.
They must therefore be named identically.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_cp_sectiontemp"><a class="anchor" href="#rp_cp_sectiontemp"></a>4.2.2. Section template</h4>
<div class="paragraph">
<p>In addition to the already described <a href="#rp_section">Shoppable Video section</a> and the Text-Image section, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/carousel_section">section template <code>carousel_section</code></a> is available for adding editorial content to category pages.
The carousel section in turn embeds one or more <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/banner_section">banners</a>.</p>
</div>
<div class="paragraph">
<p>The banner allows the selection of an image that can be cut to size as well as the definition of a link, a title and a subtitle.
For both the heading and the subtitle, a text color can be selected.
Unlike the other sections, which can be used only on subcategory pages, the banner can be embedded on all category pages.</p>
</div>
<div class="paragraph">
<p>The banner corresponds to the Spryker molecule <code>fs-banner.twig</code>, whose output is also controlled by the generic Twig template <code>fs_molecule_block.twig</code>.
This corresponds to a generic template that regulates the output of all molecules.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/banner_section/ChannelSource_CaaS_CaaS.json">output channel</a> of the banner is almost identical to that of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json">Shoppable Video section</a> and only differs in the evaluation of the available input components.
For this reason, no additional extensions are required that go beyond the requirements already described for the Shoppable Video section.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_cp_twigtemp"><a class="anchor" href="#rp_cp_twigtemp"></a>4.2.3. Twig Templates</h4>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">FirstSpirit page template <code>categorypage</code></a> contained in the reference project is an example of a category page.
It has the content areas <code>banner</code>, <code>top</code> and <code>bottom</code> and maps the Twig template <code>catalog-with-cms-slot.twig</code>.
This is stored in Spryker under the path <code><strong>src/Pyz/Yves/CatalogPage/Theme/default/views/catalog-with-cms-slot</strong></code>
and extends the parent template <code>page-layout-catalog.twig</code>, which defines the base layout of all category pages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To make category pages editable in ContentCreator, the CMS blocks within both templates must be integrated using the Twig function <code>fsSpyCmsBlock</code>.</p>
</div>
<div class="paragraph">
<p>Unlike the CMS block <code>banner</code>, which is available on all category pages, the CMS blocks <code>top</code> and <code>bottom</code> can only be used on subcategory pages.
If they should also be available on all category pages, the template <code>Catalog + CMS Slot</code> must be selected for them in Spryker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code example shows the Twig template <code>catalog-with-cms-slot.twig</code> including the adjustments necessary for editing in FirstSpirit.
Since only for the positions <code>top</code> and <code>bottom</code> content areas exist in the FirstSpirit page template, the integration of the CMS blocks takes place exclusively in these two cases via the Twig function <code>fsSpyCmsBlock</code>.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the Twig template catalog-with-cms-slot.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends template('page-layout-catalog', 'CatalogPage') %}

[...]

{% block catalogContent %}
   {% if data.categoryId %}
      &lt;div class="catalog-cms-block catalog-cms-block--top"&gt;
         {{ fsSpyCmsBlock({category: data.categoryId, position: 'top'}) }}
         {% cms_slot 'slt-4' required ['idCategory'] with {
            idCategory: data.categoryId,
         } %}
      &lt;/div&gt;
   {% endif %}

   {{ parent() }}

   {% if data.categoryId %}
      &lt;div class="catalog-cms-block catalog-cms-block--bottom"&gt;
         {{ fsSpyCmsBlock({category: data.categoryId, position: 'bottom'}) }}
         {% cms_slot 'slt-6' required ['idCategory'] with {
            idCategory: data.categoryId,
         } %}
      &lt;/div&gt;
   {% endif %}
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each CMS block corresponds to a FirstSpirit section placed at a specific position on the category page.
The use of positions in category pages is enabled Spryker sided by the <code>CMS Block Category Connector</code> feature, which is already configured within the demo shop.
The feature provides by default the positions <code>top</code>, <code>middle</code> and <code>bottom</code>.
In FirstSpirit, the positions are represented by the content areas of the corresponding page template.
For this reason, the names of the content areas and the names of the positions defined for category pages must be identical.</p>
</div>
<div class="paragraph">
<p>For the integration of the <a href="#rp_cp_sectiontemp">banner</a> the feature must be additionally extended by the position <code>banner</code>.
For this the file <code>cms_block_category_position.csv</code> within the directory <code><strong>data/import</strong></code> has to be adapted accordingly.
The transfer of the new position is then done via the following command, which has to be executed in the Spryker project directory.</p>
</div>
<div class="listingblock">
<div class="title">Update command</div>
<div class="content">
<pre>console data:import:cms-block-category-position</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A more detailed description of the configuration of positions for category pages can be found in the chapter
<a href="https://documentation.spryker.com/docs/enabling-category-cms-block#usage-for-demoshop">Usage for Demoshop</a> of the <em>Spryker documentation</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Furthermore, the CMS block <code>banner</code> has to be added to the superior Twig template <code>page-layout-catalog.twig</code>, which is stored in the directory <code><strong>src/Pyz/Yves/CatalogPage/Theme/default/templates/page-layout-catalog</strong></code>.
Therefore, the existing <code>block title</code> section within the template must be replaced by the following code.</p>
</div>
<div class="listingblock">
<div class="title">Integration of the banner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% block title %}
   {{ fsSpyCmsBlock({category:data.category.id_category, position: 'banner'}) }}
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Spryker, the banner corresponds to the molecule <code>fs-banner</code>.
The following code fragment shows the content of the molecule in a highly abbreviated form:</p>
</div>
<div class="listingblock">
<div class="title">Molecule fs-banner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
   name: 'fs-banner',
   tag: 'fs-banner'
} %}

{% define data = {
   fsBlockData: []
} %}

{% block body %}
   {% set url -%}
      {%- if data.fsBlockData.link is defined and data.fsBlockData.link is not empty -%}
         {%- include template('link', 'FirstSpiritPreview') with { link: data.fsBlockData.link } -%}
      {%- endif -%}
   {%- endset %}
   &lt;figure class="fs-banner"
      {% if data.fsBlockData.variantEditorName is defined %}
         data-variant-editor-name="{{ data.fsBlockData.variantEditorName }}"
      {% endif %}
      {% if data.fsBlockData.variant is defined and data.fsBlockData.variant is not empty %}
         data-variant="{{data.fsBlockData.variant}}"
      {% endif %}
      {% if data.fsBlockData.previewId is defined and data.fsBlockData.previewId is not empty %}
         data-preview-id="{{data.fsBlockData.previewId}}"
      {% endif %}&gt;

      [...]

      &lt;img src="{{ data.fsBlockData.picture.imageUrl }}"
         {% if data.fsBlockData.picture.previewId is defined %}
            data-preview-id="{{ data.fsBlockData.picture.previewId }}"
            data-tpp-context-image-resolution="BANNER_IMAGE"
         {% endif %}&gt;

      [...]

   &lt;/figure&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the template, the name and the tag of the molecule are defined first and then the fsBlockData object is created.
It provides access to the structured data defined in the output channel of the <a href="#rp_cp_sectiontemp">FirstSpirit section template</a>.
In the preview case, this data is obtained directly from the <em>Preview CaaS</em>.
In contrast, the data for the live state comes from Spryker.
For this they are imported during the <a href="#fs-deployment">FirstSpirit generation</a> from the <em>Online CaaS</em> and persisted in Spryker.
The fsBlockData object and the JSON object created in FirstSpirit thus have the same structure.</p>
</div>
<div class="paragraph">
<p>The block <code>body</code> describes the output of the editorial content.
These correspond to a cropable image and a link as well as a title and a subtitle, for each of which a text color is defined.</p>
</div>
<div class="paragraph">
<p>The following figure shows the representation of a carousel with an embedded banner in the ContentCreator.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/banner.png" alt="banner">
</div>
<div class="title">Figure 24. Carousel with a single element</div>
</div>
<div id="fs_molecule" class="paragraph">
<p>The output of all molecules is controlled by the generic Twig template <code>fs_molecule_block.twig</code>.
The following code fragment shows the content of this template:</p>
</div>
<div class="listingblock">
<div class="title">Generic Twig template for the output of all molecules</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% define data = {
   fsBlockData: fsBlockData()
} %}

{% block content %}
   {% include molecule( data.fsBlockData.moleculename, 'FirstSpiritReferenceComponents') with{
      data: {
         fsBlockData: data.fsBlockData
      }
      attributes: {
         'data-attributes': data.fsBlockData.attributes | default('') | json_encode
      }
   }only %}
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the Twig template of the molecule, the fsBlockData object is first created in the generic template.
The block <code>content</code> then includes the molecule specified in the <a href="#rp_section">FirstSpirit section template</a> for the parameter <code>moleculename</code>.
In Spryker, the molecule is stored in the <a href="#sp_twigtemplates">directory <code><strong>FirstSpiritReferenceComponents</strong></code></a>.
In this way, the Twig template generically controls the output of all molecules and creates the mapping between the FirstSpirit section template and the respective Spryker block Twig template.</p>
</div>
<div class="paragraph">
<p>The <code>attributes</code> attribute provides additional configuration attributes that can be defined in the output channel of a section template.
They are provided in this way directly in the tag of the corresponding molecule, so that they can be easily accessed via TypeScript.
If no configuration attributes are defined within the output channel of a section, the <code>attributes</code> attribute remains empty.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_productpages"><a class="anchor" href="#rp_productpages"></a>4.3. Extension of existing product pages</h3>
<div class="paragraph">
<p>Product pages that already exist in Spryker are equivalent to the <a href="#rp_categorypages">category pages</a> described in the previous chapter.
They can also be displayed and edited in the ContentCreator using the Omnichannel Manager.
This also requires the filling of the output channel of the FirstSpirit page template and an adaptation of the corresponding Twig templates in Spryker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If there are references to categories or products within the FirstSpirit project which have been deleted or are inactive in Spryker, so-called orphaned pages occur.
These can be removed from the project via the <a href="#uc_orphanedpages">report <code><strong>Lost and Found</strong></code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="rp_pdp_pagetemp"><a class="anchor" href="#rp_pdp_pagetemp"></a>4.3.1. Page template</h4>
<div class="paragraph">
<p>Editing a product page is equivalent to extending a <a href="#rp_categorypages">category page</a> and is, in the FirstSpirit project, also based on a page reference.
This and its associated page are automatically created in the background and invisible to the editor.</p>
</div>
<div class="paragraph">
<p>The page template <code>productpage</code> provided with the reference project represents a product page.
It maps the Twig template <code>pdp.twig</code> and comes with the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/productpage/ChannelSource_CaaS_CaaS.json">output channel</a> displayed in the following code snippet.</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template productpage</div>
<div class="content">
<pre>$CMS_TRIM(level:1)$
   $CMS_SET(json, {:})$
   $CMS_SET(previewId, previewId(element:#global.node))$
	$CMS_SET(void, json.put("previewId", "" + previewId))$
	$CMS_SET(void, json.put("pageRevisionId", #global.page.revision.id))$
	$CMS_SET(void, json.put("pagetype", "product"))$
	$-- Page uid is needed for later identification when setting the SKU of the page --$
	$CMS_SET(void, json.put("page_uid", #global.page.uid))$
	$CMS_SET(void, json.put("product_sku", pt_productSku))$
	$CMS_SET(blocks, [])$

	$CMS_VALUE(#global.page.body("content"))$
	$CMS_SET(void, json.put("blocks", blocks))$

	$CMS_VALUE(json.toJSON)$
$CMS_END_TRIM$</pre>
</div>
</div>
<div class="paragraph">
<p>The output channel of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/productpage/ChannelSource_CaaS_CaaS.json">product page</a> and the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">category page</a> are almost identical.
They only differ in the specification of the Page UID, the Product SKU and in the number of content areas.
The Product SKU is a unique product ID which, together with the Page UID, is used to uniquely identify the product page in Spryker.
By using the script <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Scripts/omnichannel_manager/set_product_sku/ChannelSource_HTML_html.html"><code>set_product_sku</code></a>, the Product SKU is automatically saved in the form of the page when a product page is created in the FirstSpirit project.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_pdp_twigtemp"><a class="anchor" href="#rp_pdp_twigtemp"></a>4.3.2. Twig template</h4>
<div class="paragraph">
<p>The Twig template <code>product-cms-block.twig</code> represents a product section on the Spryker side and extends the parent template <code>pdp.twig</code>, in which the basic layout of all product pages is defined.
It is a part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery and must be stored under the path`<strong>src/Pyz/Yves/CmsBlockWidget/Theme/default/components/molecules/product-cms-block</strong>` in Spryker.</p>
</div>
<div class="paragraph">
<p>The template <code>pdp.twig</code> requires the following adaptation to enable the integration of product sections.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the Twig template pdp.twig</div>
<div class="content">
<pre>[...]
&lt;div class="container__inner"&gt;
   {% include molecule('product-detail', 'ProductDetailPage') with {
      [...]
   } only %}

   {% include molecule('product-cms-block', 'CmsBlockWidget') ignore missing with {
      data: {
         idProductAbstract: data.product.idProductAbstract,
      }
   } only %}
&lt;/div&gt;
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>The following code example shows the content of the Twig template <code>product-cms-block.twig</code>.
It first contains the name of the molecule and specifies that the specification of a Product SKU is required.
This is passed to the Twig template via the parent Twig template <code>pdp.twig</code>.
The block <code>body</code> is used to output the contents that are maintained for the corresponding product page.</p>
</div>
<div class="listingblock">
<div class="title">Twig template product-cms-block.twig</div>
<div class="content">
<pre>{% extends model('component') %}

{% define config = {
   name: 'product-cms-block'
} %}

{% define data = {
   idProductAbstract: required
} %}

{% block body %}
   {{ fsSpyCmsBlock({ product: data.idProductAbstract }) }}
{% endblock %}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_contentpage"><a class="anchor" href="#rp_contentpage"></a>4.4. Creation of dynamic content pages</h3>
<div class="paragraph">
<p>In addition to the extension of existing <a href="#rp_staticsite">static pages</a> or <a href="#rp_categorypages">category pages</a>, the <em>FirstSpirit Connect</em> module allows the creation of dynamic content pages.
These correspond, for example, to the imprint, the data security explanation or the general terms and conditions.
Just like the other pages, the dynamic content pages can also be displayed in ContentCreator using the <em>Omnichannel Manager</em> and enriched with editorial content.
However, since the dynamic pages are newly created and not only extended, they are initially empty, unlike the other pages.</p>
</div>
<div class="paragraph">
<p>To create the dynamic content pages, it is also necessary to fill the output channel of the <a href="#rp_dcp_pagetemp">page template</a> within the FirstSpirit project.
In addition, the existence of the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a> is assumed in Spryker.
The template is part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery.</p>
</div>
<div class="paragraph">
<p>The section templates contained in the reference project are allowed for all pages.
For this reason, no additional extensions are required that go beyond the requirements already described for the <a href="#rp_section">Shoppable Video section</a>.</p>
</div>
<div class="sect3">
<h4 id="rp_dcp_pagetemp"><a class="anchor" href="#rp_dcp_pagetemp"></a>4.4.1. Page template</h4>
<div class="paragraph">
<p>Just like <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, the maintenance of dynamic content pages in the FirstSpirit project is based on a page reference.
However, in contrast to the other pages that already exist in the project, dynamic content pages are created using the familiar editing process.
For this reason, they are initially empty.</p>
</div>
<div class="paragraph">
<p>The creation of the page reference in the ContentCreator triggers an event of the <em>Omnichannel Manager</em>, which triggers the creation of the corresponding CMS page in Spryker.
This is necessary for displaying the CMS page in the preview.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New dynamic content pages must be created in the <em>Content Pages</em> structure folder.
This ensures their storage in the corresponding <em>CaaS</em> collection and thereby their automatic creation in Spryker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Under certain circumstances it is possible that the FirstSpirit project contains a dynamic content page for which there is no CMS page on the Spryker side.
In this case, the first time the content page is called in the ContentCreator, the <em>Omnichannel Manager</em> event is also triggered, which triggers the creation of the corresponding CMS page in Spryker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reference project contains the page template <code>contentpage</code>.
It is an example for dynamic content pages and maps the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a>, which has to be created on the Spryker side.</p>
</div>
<div class="paragraph">
<p>Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">output channel</a> of the page template, various general information is first defined and stored in the JSON object of the <em>CaaS</em> item to be generated:
The <code>previewId</code> serves to identify the page reference and allows its decoration in the ContentCreator as well as its mapping to the Spryker Twig template.
The automatically determined name and path of this template are specified using the fields <code>template_name</code> and <code>template_path</code>.
The page reference is identified using the <a href="#sp_basetemp">JavaScript of the <em>Omnichannel Manager</em></a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to the name of the Twig template, the ID of the corresponding CMS page is also determined automatically.
It is stored in a hidden input component of the FirstSpirit page template.
Since the ID is only required for the preview and is read directly from the page form, it is not required within the <em>CaaS</em> item.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, the <code>pagetype</code> parameter is used to define the page type.
In the case of dynamic content pages, the field must have the value <code>cmspage</code>.</p>
</div>
<div class="paragraph">
<p>The <code>is_active</code> and <code>store_names</code> fields indicate that the Twig template represented by the page is active on the Spryker side and visible in the store selected in the <a href="#fs-projectsettings">Project settings</a>.
The <code>is_searchable</code> field can also be used to configure whether the page can be searched by its name in Spryker.
In contrast to the <code>previewId</code>, which only serves for the preview, the unique <code>identifier</code> also allows the referencing of the <em>CaaS</em> item on Spryker side.</p>
</div>
<div class="listingblock">
<div class="title">Definition of general information in the output channel of the page template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(json, {:})$
$CMS_SET(previewId, previewId(element:#global.node))$
$CMS_SET(void, json.put("previewId", "" + previewId))$
$CMS_SET(void, json.put("template_name", pt_cmsPageTemplateName))$
$CMS_SET(void, json.put("template_path", "@Cms/templates/fs-content-page/fs-content-page.twig"))$
$CMS_SET(void, json.put("pagetype", "cmspage"))$
$CMS_SET(void, json.put("is_active", "1"))$
$CMS_SET(void, json.put("store_names", [ps_activeStore]))$
$CMS_SET(void, json.put("is_searchable", "1"))$
$CMS_SET(void, json.put("identifier", #global.node.uid))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the general information, the <code>localizedAttributes</code> array is used to pass specific information to the JSON object, which Spryker requires for each content page.
They are used to define various metadata, a page name, and the URL at which the page will be accessible in Spryker.
While the various metadata can optionally be entered by the editor in the form of the page, the URL is a language-dependent mandatory field.
It must have the structure <code>/language abbreviation/subpath</code>, with the language abbreviation automatically prefixed to the URL during generation.
The importer expects this information in the context of the current language.
For this reason, the corresponding language abbreviation, which is passed to each attribute, is determined.</p>
</div>
<div class="listingblock">
<div class="title">Definition of specific information</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(locale, #global.language.getLocale())$
$CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$

$CMS_SET(attributes, {:})$
$CMS_IF(pt_url != null &amp;&amp; !pt_url.isEmpty())$
   $CMS_SET(url, "/" + locale.getLanguage() + if(!pt_url.startsWith("/"), "/") + pt_url.convert2)$
   $CMS_SET(void, attributes.put("url", {localeAbbr: url}))$
$CMS_ELSE$
   $CMS_SET(void,#global.logError(
      "Missing url for contentpage " + #global.node.uid + ". Contentpages without url can't create and generate."))$
   $CMS_SET(#global.stopGenerate,true)$
$CMS_END_IF$
$CMS_SET(pageName, #global.page.getDisplayName(#global.language))$
$CMS_SET(void, attributes.put("name", {localeAbbr: if(pageName.toString() != null, pageName, "")}))$
$CMS_SET(void, attributes.put("meta_title", {localeAbbr: if(!pt_metaTitle.isEmpty, pt_metaTitle.convert2, "")}))$
$CMS_SET(void, attributes.put("meta_description", {localeAbbr: if(!pt_metaDescription.isEmpty, pt_metaDescription.convert2, "")}))$
$CMS_SET(void, attributes.put("meta_keywords", {localeAbbr: if(!pt_metaKeywords.isEmpty, pt_metaKeywords.convert2, "")}))$
$CMS_SET(void, json.put("localizedAttributes", attributes))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page template for dynamic content pages contains the two content areas <code>content_top</code> and <code>content_body</code>.
They enable the creation of editorial content, for which different section templates are available in the reference project.
Their contents are added one after the other to the JSON object <code>json</code> created in the template.</p>
</div>
<div class="listingblock">
<div class="title">Determination of editorial content</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(blocks, [])$
$CMS_VALUE(#global.page.body("content_top"))$
$CMS_SET(contentTopBlocks, [])$
$CMS_SET(void, contentTopBlocks.addAll(blocks))$

$CMS_SET(blocks, [])$
$CMS_VALUE(#global.page.body("content_body"))$
$CMS_SET(contentBodyBlocks, [])$
$CMS_SET(void, contentBodyBlocks.addAll(blocks))$

$CMS_SET(resultingBlocks, [])$
$CMS_SET(void, resultingBlocks.addAll(contentTopBlocks))$
$CMS_SET(void, resultingBlocks.addAll(contentBodyBlocks))$
$CMS_SET(void, json.put("blocks", resultingBlocks))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, dynamic content pages have so-called placeholders.
These correspond to the content areas of the FirstSpirit page template and contain only references to the CMS blocks assigned to them.
After the editorial content has been entered, these references are created for each content area.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The placeholders must also be created in the case of empty content pages.
This is especially necessary for the initial creation of the pages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Creation of the block references</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(placeholder, {:})$
$CMS_SET(contentTopPlaceholder, "")$

$CMS_IF(!contentTopBlocks.isEmpty())$
   $CMS_FOR(contentTopBlock, contentTopBlocks)$
      $CMS_SET(contentTopPlaceholder, contentTopPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentTopBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$CMS_SET(contentBodyPlaceholder, "")$
$CMS_IF(!contentBodyBlocks.isEmpty())$
   $CMS_FOR(contentBodyBlock, contentBodyBlocks)$
      $CMS_SET(contentBodyPlaceholder, contentBodyPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentBodyBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$-- Placeholders values have to exist in Spryker for synchronization purposes, therefore allowing even empty placeholder values for online CaaS --$
$CMS_IF(!contentTopPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_top", {localeAbbr: contentTopPlaceholder}))$
$CMS_END_IF$
$CMS_IF(!contentBodyPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_body", {localeAbbr: contentBodyPlaceholder}))$
$CMS_END_IF$

$CMS_SET(void, json.put("placeholder", placeholder))$
$CMS_VALUE(json.toJSON)$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_dcp_twigtemp"><a class="anchor" href="#rp_dcp_twigtemp"></a>4.4.2. Twig template</h4>
<div class="paragraph">
<p>In Spryker, the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a> represents a dynamic content page.
Unlike <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, dynamic content pages have placeholders.
To make the placeholders editable in ContentCreator, it is necessary to use the Twig function <code>fsSpyCms</code> to include them.</p>
</div>
<div class="paragraph">
<p>Each placeholder represents a content area of the corresponding <a href="#rp_dcp_pagetemp">FirstSpirit page template</a>.
For this reason, the name of the placeholder and the name of the content area must be identical.
Each of the content areas can contain any number of <a href="#rp_section">sections</a>, for which a Twig template must also exist in Spryker.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">FirstSpirit page template <code>contentpage</code></a> contained in the reference project is an example for dynamic content pages.
It has the content areas <code>content_top</code> and <code>content_body</code> and maps the Twig template <code>fs-content-page.twig</code>.</p>
</div>
<div class="paragraph">
<p>Within the Twig template, specific metadata and the page title are first defined.
Then the output of the two placeholders <code>content_top</code> and <code>content_body</code> is handled within the blocks <code>title</code> and <code>content</code>.
They reference the CMS blocks assigned to them, which in turn control the output of the editorial content.</p>
</div>
<div class="paragraph">
<p>The following code example shows the content of the template.</p>
</div>
<div class="listingblock">
<div class="title">Twig template fs-content-page.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends template('page-layout-main') %}

{% define data = {
   title: _view.pageTitle | default('global.spryker.shop' | trans),
   metaTitle: _view.pageTitle | default('global.spryker.shop' | trans),
   metaDescription: _view.pageDescription | default(''),
   metaKeywords: _view.pageKeywords | default('')
} %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
   &lt;!-- CMS_PLACEHOLDER : "content-top" --&gt;
   &lt;div class="cms-page__title"&gt;
      {{ fsSpyCms('content_top') | raw }}
   &lt;/div&gt;
{% endblock %}

{% block content %}
   &lt;!-- CMS_PLACEHOLDER : "content-body" --&gt;
   &lt;div class="cms-page__content"&gt;
      {{ fsSpyCms('content_body') | raw }}
   &lt;/div&gt;
{% endblock %}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_magazine"><a class="anchor" href="#rp_magazine"></a>4.5. Creation of a magazine</h3>
<div class="paragraph">
<p>Based on the previously described <a href="#rp_contentpage">dynamic content pages</a>, the <em>FirstSpirit Connect</em> module allows the creation of a magazine.
This consists of any number of magazine articles and an overview page.
Both the magazine articles and the overview page can be maintained in the ContentCreator just like the other pages.
In contrast to them, the magazine articles do not represent different pages, but individual data sets.
Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/ContentStore/magazine_articles">data source <em>Magazine Articles</em></a> exists for their editorial creation and maintenance.
For the output of the magazine articles, the corresponding <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Schemes/magazine/magazine.magazine_articles/ChannelSource_CaaS_CaaS.json">table template</a> is referenced in a dynamic content page.
The data for the overview page is referenced via ContentSelects in a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/magazine_overview">section template</a>, which is also integrated in a dynamic content page.</p>
</div>
<div class="paragraph">
<p>The creation of a new magazine article in ContentCreator triggers an event of the <em>Omnichannel Manager</em>, which triggers the creation of the corresponding CMS page in Spryker.
This is necessary for displaying the CMS page in the preview.</p>
</div>
<div class="paragraph">
<p>For the creation of the magazine articles, it is necessary to fill the output channel of the corresponding page and table template.
The overview page requires the filling of the output channel of the corresponding section template.
Furthermore, the Twig templates <a href="#rp_m_twigtemplates"><code>fs-magazine-intro.twig</code>, <code>fs-magazine-overview.twig</code>, <code>fs-magazine-teaser.twig</code></a> and <a href="#rp_dcp_twigtemp"><code>fs-content-page.twig</code></a> are required in Spryker.
The templates are part of the <a href="#sp_twigtemplates">Spryker module <code>firstspirit-reference-components</code></a> included in the delivery.</p>
</div>
<div class="paragraph">
<p>The other section templates contained in the reference project for maintaining editorial content are permitted for all pages.
For this reason, they do not require any additional extensions that go beyond the requirements already described for the <a href="#rp_section">Shoppable Video section</a>.</p>
</div>
<div class="sect3">
<h4 id="rp_m_pagetemplate"><a class="anchor" href="#rp_m_pagetemplate"></a>4.5.1. Page template</h4>
<div class="paragraph">
<p>Both the magazine articles and the overview page are based on <a href="#rp_contentpage">dynamic content pages</a>.
Since they differ in their structure, the magazine articles need their own page template in contrast to the overview page.
In the reference project this corresponds to the page template <code>magazine_detail_page</code> and is a copy of a <a href="#rp_dcp_pagetemp"><code>contentpage</code></a>.
However, in comparison to the <code>contentpage</code>, the <code>magazine_detail_page</code> has only one content area, which only allows the integration of the <a href="#rp_m_tabletemplate">table template</a> of the magazine articles.</p>
</div>
<div class="paragraph">
<p>The following code fragment shows the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/magazine_detail_page/ChannelSource_CaaS_CaaS.json">output channel</a> of the page template <code>magazine_detail_page</code>:</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template magazine_detail_page</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(json, {:})$
$CMS_IF(#global.pageParams.data.size &gt; 0)$
   $CMS_SET(previewId, previewId(element:#global.node))$
   $CMS_SET(void, json.put("previewId", "" + previewId))$
   $CMS_SET(void, json.put("template_name", pt_cmsPageTemplateName))$
   $CMS_SET(void, json.put("template_path", "@Cms/templates/fs-content-page/fs-content-page.twig"))$
   $CMS_SET(void, json.put("pagetype", "cmspage"))$
   $CMS_SET(void, json.put("is_active", "1"))$
   $CMS_SET(void, json.put("store_names", [ps_activeStore]))$
   $CMS_SET(void, json.put("is_searchable", "1"))$

   $CMS_IF(#global.dataset.formData.tt_page_identifier != null &amp;&amp; !#global.dataset.formData.tt_page_identifier.isEmpty())$
      $CMS_SET(void, json.put("identifier", #global.dataset.formData.tt_page_identifier))$
   $CMS_ELSE$
      $CMS_SET(void, #global.logError(
         "Missing page identifier for magazine detail page with entity id '" + #row.id + "'. Magazine detail pages without a page identifier can't be generated."))$
      $CMS_SET(#global.stopGenerate, true)$
   $CMS_END_IF$

   $CMS_SET(locale, #global.language.getLocale())$
   $CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$

   $CMS_SET(attributes, {:})$
   $CMS_SET(set_entityUrl, #global.dataset.formData.tt_url.convert2)$
   $CMS_IF(set_entityUrl != null &amp;&amp; !set_entityUrl.isEmpty())$
      $CMS_SET(url, "/" + locale.getLanguage() + if(!set_entityUrl.startsWith("/"), "/") + set_entityUrl)$
      $CMS_SET(void, attributes.put("url", {localeAbbr: url}))$
   $CMS_ELSE$
      $CMS_SET(void,#global.logError(
         "Missing url for contentpage " + #global.node.uid + "_" + global.dataset.entity.fs_id + ". Contentpages without url can't create and generate."))$
      $CMS_SET(#global.stopGenerate,true)$
   $CMS_END_IF$

   $CMS_SET(pageName, #global.dataset.formData.tt_title.convert2)$
   $CMS_SET(void, attributes.put("name", {localeAbbr: if(pageName.toString() != null, pageName, "")}))$
   $CMS_SET(void, attributes.put("meta_title", {localeAbbr: ""}))$
   $CMS_SET(void, attributes.put("meta_description", {localeAbbr: ""}))$
   $CMS_SET(void, attributes.put("meta_keywords", {localeAbbr: ""}))$
   $CMS_SET(void, json.put("localizedAttributes", attributes))$

   $CMS_VALUE(#global.page.body("container"))$
$CMS_END_IF$

$CMS_VALUE(json.toJSON)$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/magazine_detail_page/ChannelSource_CaaS_CaaS.json">output channel</a> of the magazine articles is almost identical to the output channel of <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">dynamic content pages</a>.
It differs only in the definitions of the identifier, some attributes and the number of content areas.</p>
</div>
<div class="paragraph">
<p>The identifier allows the referencing of the <em>CaaS</em> item on Spryker side and must therefore be unique.
However, if it were specified within the output channel, all magazine articles would have the same identifier.
Due to this it is stored in the form of the corresponding data set.</p>
</div>
<div class="paragraph">
<p>In contrast to <a href="#rp_dcp_pagetemp">dynamic content pages</a>, the URL is not specified in the page form, but, like the identifier, within the data set.
For this reason, it is determined at this point from the input component of the data set.
For the page name, the title defined for the magazine article is used.
This ensures that each magazine article has a unique page name.</p>
</div>
<div class="paragraph">
<p>The enclosing If query prevents generation errors in case of an empty data source.</p>
</div>
<div class="paragraph">
<p>In contrast to dynamic content pages, the editorial content and the block references for the magazine articles are not determined within the page template,
but in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Schemes/magazine/magazine.magazine_articles/ChannelSource_CaaS_CaaS.json">output channel</a> of the associated <a href="#rp_m_tabletemplate">table template</a>.
This represents the only permissible content for the <code>container</code> content area.</p>
</div>
<div class="paragraph">
<p>The overview page corresponds to a dynamic content page.
It includes the data required for it using a <a href="#rp_m_section">section template</a> and also allows the addition of further sections.
For this reason, it does not need its own page template.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_m_tabletemplate"><a class="anchor" href="#rp_m_tabletemplate"></a>4.5.2. Table template</h4>
<div class="paragraph">
<p>In contrast to the other pages, the magazine articles represent individual data sets, which are integrated into a <a href="#rp_m_pagetemplate">content page</a> via content projection.
Their maintenance and processing is therefore based on a table template that provides the corresponding form and forms the basis for the corresponding data source.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Schemes/magazine/magazine.magazine_articles/ChannelSource_CaaS_CaaS.json">table template <code>magazine_articles</code></a> contained in the reference project consists of two thematic content blocks:<br>
The first block maps the Twig template <code>fs-magazine-intro.twig</code> in Spryker and consists of superordinate intro data, such as a title and various teaser information.
For their determination, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/magazine_intro_block_render_template">render template <code>magazine_intro_block_render_template</code></a> is referenced within the output channel of the table template, the result of which is stored in the array <code>contentTopBlocks</code>.
The output channel of this render template is almost identical to the output channel of the <a href="#rp_section">Shoppable Video section</a> and differs only in the evaluation of the available input components.<br>
The second block corresponds to the various sections of the magazine page, which respectively represent the Twig templates belonging to them in Spryker.
The sections are combined in a FS_CATALOG, which is stored in the output channel of the table template in the <code>contentBodyBlocks</code> array.</p>
</div>
<div class="paragraph">
<p>Both arrays are successively added to the JSON object <code>json</code> created in the <a href="#rp_m_pagetemplate">page template</a>.</p>
</div>
<div class="listingblock">
<div class="title">Determination of editorial content</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(blocks, [])$

$CMS_RENDER(template: "magazine_intro_block_render_template")$
$CMS_SET(contentTopBlocks, [])$
$CMS_SET(void, contentTopBlocks.addAll(blocks))$

$CMS_SET(blocks, [])$
$CMS_VALUE(tt_sections)$
$CMS_SET(contentBodyBlocks, [])$
$CMS_SET(void, contentBodyBlocks.addAll(blocks))$

$CMS_SET(resultingBlocks, [])$
$CMS_SET(void, resultingBlocks.addAll(contentTopBlocks))$
$CMS_SET(void, resultingBlocks.addAll(contentBodyBlocks))$
$CMS_SET(void, json.put("blocks", resultingBlocks))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the magazine articles are based on <a href="#rp_dcp_pagetemp">dynamic content pages</a>, they also have so-called placeholders.
The output channels of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/magazine_detail_page/ChannelSource_CaaS_CaaS.json">magazine articles</a> and the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">content pages</a> are therefore almost identical from this point on.
They differ only in the output of the placeholder for the body area and in the specification of the <code>previewId</code>.
In contrast to the content pages, the body area must also exist in the preview for the magazine articles in order to avoid the prohibited addition of further sections.
The <code>previewId</code> specified in this step overwrites the ID of the parent page, which references all magazine articles.
This is necessary because the <code>previewId</code> of the page is identical for all magazine articles, while the article IDs are unique.</p>
</div>
<div class="listingblock">
<div class="title">Creation of the block references</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(placeholder, {:})$
$CMS_SET(contentTopPlaceholder, "")$

$CMS_IF(!contentTopBlocks.isEmpty())$
   $CMS_FOR(contentTopBlock, contentTopBlocks)$
      $CMS_SET(contentTopPlaceholder, contentTopPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentTopBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$CMS_SET(contentBodyPlaceholder, "")$
$CMS_IF(!contentBodyBlocks.isEmpty())$
   $CMS_FOR(contentBodyBlock, contentBodyBlocks)$
      CMS_SET(contentBodyPlaceholder, contentBodyPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentBodyBlock.get("block_name") + "'}, isContentEditable = false) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$-- Placeholders values have to exist in Spryker for synchronization purposes, therefore allowing even empty placeholder values for online CaaS --$
$CMS_IF(!contentTopPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_top", {localeAbbr: contentTopPlaceholder}))$
$CMS_END_IF$
$CMS_SET(void, placeholder.put("content_body", {localeAbbr: contentBodyPlaceholder}))$

$CMS_SET(void, json.put("placeholder", placeholder))$
$CMS_SET(void, json.put("previewId", "" + previewId()))$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_m_section"><a class="anchor" href="#rp_m_section"></a>4.5.3. Section template</h4>
<div class="paragraph">
<p>In addition to the magazine articles, there is an overview page on which the articles are listed in the form of teasers sorted by date in ascending or descending order.
In contrast to magazine articles, the editorial content is not rendered via a content projection, but via two ContentSelects.
The reference project therefore contains the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/magazine_overview">section template <code>magazine_overview</code></a>, which can only be used in <a href="#rp_contentpage">dynamic content pages</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Editing, deleting or creating a magazine article does not update the overview page <strong>in the preview</strong> by default.
Within the reference project, the section template <code>magazine_overview</code> therefore contains the hidden FS_REFERENCE input component <code>st_dataSource</code>.
The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/ContentStore/magazine_articles">data source <code>magazine_articles</code></a>, which contains all magazine articles, is entered as the default value in this component.
With the help of this specification, a service running in the background recognizes the dependency between the corresponding magazine article and the overview page and triggers its update in the preview.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Publishing a magazine article always includes the publication of the overview page.
This ensures that the overview page is always up-to-date and contains all published magazine articles in the live status at any time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/magazine_overview/ChannelSource_CaaS_CaaS.json">output channel</a> of the section template contains the ContentSelects in the first place.
These query all data sets of the data source <code>magazine</code> and stores them in different order in the variables <code>fr_st_teasers_descending</code> or <code>fr_st_teasers_ascending</code>.</p>
</div>
<div class="listingblock">
<div class="title">ContentSelects in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">&lt;CMS_HEADER&gt;
   &lt;CMS_FUNCTION name="contentSelect" resultname="fr_st_teasers_descending"&gt;
      &lt;CMS_PARAM name="schema" value="magazine" /&gt;
      &lt;QUERY entityType="magazine_articles"&gt;
         &lt;ORDERCRITERIA attribute="date" descending="1" /&gt;
      &lt;/QUERY&gt;
   &lt;/CMS_FUNCTION&gt;

   &lt;CMS_FUNCTION name="contentSelect" resultname="fr_st_teasers_ascending"&gt;
      &lt;CMS_PARAM name="schema" value="magazine" /&gt;
      &lt;QUERY entityType="magazine_articles"&gt;
         &lt;ORDERCRITERIA attribute="date" descending="0" /&gt;
      &lt;/QUERY&gt;
   &lt;/CMS_FUNCTION&gt;
&lt;/CMS_HEADER&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to define various information, which is also contained in all other sections of the reference project.
At this point, the output channel is therefore identical to that of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json">Shoppable Video section</a>.</p>
</div>
<div class="listingblock">
<div class="title">Definition of various information in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(block,{:})$

$-- Defining general block data --$
$CMS_SET(void, block.put("previewId", "" + previewId()))$
$CMS_SET(void, block.put("active", "1"))$
$CMS_SET(void, block.put("store_names",[ps_activeStore]))$
$CMS_SET(void, block.put("template_name", "fs_molecule_block"))$
$CMS_SET(void, block.put("template_path", "@CmsBlock/template/fs_molecule_block.twig"))$

$CMS_SET(set_pageType, json.get("pagetype"))$

$-- Add block name attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_name_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add additional block attributes to block object (page type dependent) --$
$CMS_RENDER(template: "additional_block_attributes_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add block key attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_key_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Defining placeholder data of the block --$
$CMS_SET(placeholders,{:})$
$CMS_SET(void, block.put("placeholder",placeholders))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Subsequently, the teaser information is determined in two steps.
They consist of a title, an image, a text and a reference and are stored in the <code>teaser</code> array for each data set.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If for a teaser no title is specified or no image is selected, the title and image of the corresponding magazine article will be used for the display on the magazine overview page.
If the fields are maintained in both places, the overview page always shows the contents of the teaser.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first step only considers the information of the Featured Articles, which can be defined in the form of the overview page.
The second step is based on the result set of the corresponding ContentSelect and thus includes all magazine articles.
In both cases, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/magazine_teaser_render">render template <code>magazine_teaser_render</code></a> is referenced, whose output channel only contains the evaluation of the input components available for the teasers.
The information determined in the two steps is stored in the arrays <code>featuredTeasers</code> and <code>teasers</code>.</p>
</div>
<div class="listingblock">
<div class="title">Determination of the teaser data in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(featuredTeasers, [])$
$CMS_FOR(for_featuredArticle, st_featuredArticles.values)$
   $CMS_SET(teaser,{:})$
   $CMS_RENDER(template: "magazine_teaser_render", rt_entity: for_featuredArticle.entity, rt_teaser: teaser)$
   $CMS_SET(void, featuredTeasers.add(teaser))$
$CMS_END_FOR$

$CMS_SET(teasers, [])$
$CMS_FOR(for_teaser, #global.context.getVariableValue("fr_st_teasers_"+st_sortingOrder.key))$
   $CMS_SET(teaser,{:})$
   $CMS_RENDER(template: "magazine_teaser_render", rt_entity: for_teaser, rt_teaser: teaser)$
   $CMS_SET(void, teasers.add(teaser))$
$CMS_END_FOR$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>data</code> array contains the editorial content.
The previously determined teaser data is added to it.
In Spryker, the section is represented by the molecule <code>fs-magazine-overview</code>, whose name is also contained in the <code>data</code> array.</p>
</div>
<div class="paragraph">
<p>The importer expects the information in the context of the current language.
For this reason, the corresponding language abbreviation to which the array <code>data</code> is assigned is determined.</p>
</div>
<div class="paragraph">
<p>In the preview, the contents of the section are output directly.
Otherwise, the last step adds the section to the <code>blocks</code> array defined in the page template, which contains all sections of a page and integrates them into the <em>CaaS</em> item to be generated.
Since the overview page is based on a <a href="#rp_contentpage">dynamic content page</a>, the corresponding page template is the <a href="#rp_dcp_pagetemp"><code>contentpage</code></a>.</p>
</div>
<div class="listingblock">
<div class="title">Processing of editorial content in the output channel of the sectionsection.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(data, {:})$
$CMS_SET(void, data.put("moleculename", "fs-magazine-overview"))$
$CMS_SET(void, data.put("featuredTeasers", featuredTeasers))$
$CMS_SET(void, data.put("teasers", teasers))$

$CMS_SET(locale, #global.language.getLocale())$
$CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$
$CMS_SET(localizedData, {:})$
$CMS_SET(void, localizedData.put(localeAbbr, data))$
$CMS_SET(void, block.put("data", localizedData))$

$CMS_IF(#global.is("WEBEDIT") &amp;&amp; !isSet(caas_preview_generation))$
   $CMS_VALUE(block.toJSON)$
$CMS_ELSE$
   $CMS_SET(void, blocks.add(block))$
$CMS_END_IF$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_m_twigtemplates"><a class="anchor" href="#rp_m_twigtemplates"></a>4.5.4. Twig Templates</h4>
<div class="paragraph">
<p>Both the magazine articles and the overview page are based on <a href="#rp_contentpage">dynamic content pages</a> and are therefore represented by the Twig template <a href="#rp_dcp_twigtemp"><code>fs-content-page.twig</code></a> on Spryker side.
This contains the placeholders <code>content_top</code> and <code>content_body</code>, which reference the CMS blocks assigned to them.
In this way, the molecule <code>fs-magazine-intro.twig</code> is called for the intro data of the magazine articles and the molecule <code>fs-magazine-overview.twig</code> for the teaser information of the overview page.
The molecule <code>fs-magazine-overview.twig</code> in turn references the molecule <code>fs-magazine-teaser.twig</code>, which provides the teaser information of a single magazine article.
All three molecules control the output of the editorial content.</p>
</div>
<div class="paragraph">
<p>The output of the remaining sections of the magazine articles takes place via the Twig Templates belonging to them.
Both the templates of these sections as well as the molecules for the magazine articles and the overview page are part of the <a href="#sp_twigtemplates">Spryker module <code>firstspirit-reference-components</code></a> included in the delivery.</p>
</div>
<div class="paragraph">
<p>As with the molecules of the <a href="#rp_twigtemplates">Shoppable Video section</a> and the <a href="#rp_cp_twigtemp">Banner</a>, the names of the molecules are defined within the three Twig Templates for the magazine articles and the overview page and then the fsBlockData object is created.
It provides access to the structured data defined in the output channel of the <a href="#rp_m_tabletemplate">FirstSpirit table template</a>.
The fsBlockData object and the JSON object created in FirstSpirit thus each have the same structure.</p>
</div>
<div class="paragraph">
<p>The block <code>body</code> describes the output of the editorial contents in the molecules.
In the template for the magazine articles, these correspond to their intro data, which consist of a title, a sub-title, and a banner.
The template for the overview page contains the teaser data of the magazine articles, which consist of an image, a title, a text and a reference.
The teaser data is provided using the molecule for the teasers.</p>
</div>
<div class="paragraph">
<p>The following code examples show the contents of the molecules.</p>
</div>
<div class="listingblock">
<div class="title">Twig template fs-magazine-intro.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
    name: 'fs-magazine-intro'
} %}

{% define data = {
    fsBlockData: [],
} %}

{% block body %}
   &lt;article class="magazine"&gt;
      &lt;header&gt;
         &lt;h1&gt;{{ data.fsBlockData.title }}&lt;/h1&gt;
         {% if data.fsBlockData.subtitle is defined %}
            &lt;h2&gt;{{ data.fsBlockData.subtitle }}&lt;/h2&gt;
         {% endif %}
         {% if data.fsBlockData.banner.imageUrl is defined %}
            &lt;figure class="picture picture-responsive"&gt;
               &lt;img class="img-fluid" src="{{ data.fsBlockData.banner.imageUrl | raw }}"
                  {% if  data.fsBlockData.banner.previewId is defined %}
                     data-preview-id="{{ data.fsBlockData.banner.previewId }}"
                  {% endif %}
                  data-tpp-context-image-resolution="MAGAZINE_ARTICLE_BANNER"&gt;
            &lt;/figure&gt;
         {% endif %}
      &lt;/header&gt;
   &lt;/article&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Twig template fs-magazine-overview.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
    name: 'fs-magazine-overview'
} %}

{% define data = {
    fsBlockData: [],
} %}

{% block body %}
   {% if isFsPreview() %}
      &lt;div style="padding-top: 24px;"&gt;&lt;/div&gt;
   {% endif %}
   {% if data.fsBlockData.featuredTeasers is not empty %}
      &lt;h2 style="text-align: left;"&gt;Featured&lt;/h2&gt;
   {% endif %}

   &lt;div class="featured-magazine-teasers"&gt;
      {% for teaser in data.fsBlockData.featuredTeasers %}
         {% include molecule('fs-magazine-teaser', 'FirstSpiritReferenceComponents') with {
            data: {
               fsBlockData: teaser
            }
         } only %}
      {% endfor %}
   &lt;/div&gt;

   {% if data.fsBlockData.featuredTeasers is not empty %}
      &lt;hr class="magazine-featured-divider"&gt;
   {% endif %}

   &lt;div class="magazine-teasers"&gt;
      {% for teaser in data.fsBlockData.teasers %}
         {% include molecule('fs-magazine-teaser', 'FirstSpiritReferenceComponents') with {
            data: {
               fsBlockData: teaser
            }
         } only %}
      {% endfor %}
   &lt;/div&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Twig template fs-magazine-teaser.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
   name: 'fs-magazine-teaser'
} %}

{% define data = {
   fsBlockData: [],
} %}

{% block body %}
   &lt;article class="magazine-teaser"
      {% if data.fsBlockData.previewId is defined %}
         data-preview-id="{{ data.fsBlockData.previewId }}"
      {% endif %}&gt;
      {% set cmsPageUrl = getCmsPageUrl(data.fsBlockData.page_identifier) %}

      {% if cmsPageUrl is not null %}
         &lt;a href="{{ cmsPageUrl }}"&gt;
      {% endif %}

         {% if data.fsBlockData.picture.imageUrl is defined %}
            &lt;figure class="picture picture-responsive"&gt;
               &lt;img src="{{ data.fsBlockData.picture.imageUrl }}"
                  {% if  data.fsBlockData.picture.previewId is defined %}
                     data-preview-id="{{ data.fsBlockData.picture.previewId }}"
                  {% endif %}
                  data-tpp-context-image-resolution="CONTENT_IMAGE"&gt;
            &lt;/figure&gt;
         {% endif %}
         &lt;h3&gt;{{ data.fsBlockData.title | raw }}&lt;/h3&gt;
         &lt;p&gt;{{ data.fsBlockData.text | raw }}&lt;/p&gt;

      {% if cmsPageUrl is not null %}
         &lt;/a&gt;
      {% endif %}
   &lt;/article&gt;
{% endblock %}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_navigation"><a class="anchor" href="#rp_navigation"></a>4.6. Extension of the main navigation</h3>
<div class="paragraph">
<p>In addition to the different page types, the main navigation of the Spryker B2C Demo Shop can be edited in the ContentCreator.
In FirstSpirit the navigation is represented by a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/GlobalStore/GlobalContentArea/navigation_extensions">global page</a>, a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/navigation_node_reference">section template</a> and a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigations">technical page reference</a>.
These enable the creation of further menu items in the first level of the navigation and their transfer to the <em>Preview CaaS</em> and to the <em>Online CaaS</em>.</p>
</div>
<div class="paragraph">
<p>In order to enable the main navigation to be extended, the following Twig templates must also be adapted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>navigation-header.twig</p>
</li>
<li>
<p>navigation-multilevel-node.twig</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="rp_navigation_globalpage"><a class="anchor" href="#rp_navigation_globalpage"></a>4.6.1. Global page</h4>
<div class="paragraph">
<p>The navigations of the Spryker B2C Demo Shop are represented in FirstSpirit via the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigation_extension">page template <code>navigation_extension</code></a>,
which is used to automatically create a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/GlobalStore/GlobalContentArea/navigation_extensions">global page</a> for each navigation.
It includes an <code>FS_CATALOG</code> input component, which uses the section template <a href="#rp_navigation_section"><code>navigation_node_reference</code></a>
to refer all start nodes of the menu items <strong>maintained in FirstSpirit</strong>.
Each of these start nodes corresponds to a structure folder, which is to be selected within an editing dialog in the ContentCreator.
Therefore the main navigation in the ContentCreator has a button which allows the addition of new menu items in the first level of the navigation.
If a referenced structure folder contains further subfolders, these are automatically interpreted as sub-items of the new menu item.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The button for adding further menu items is only visible for those roles that have the right to edit and delete.
Otherwise the button is hidden.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/img_navigation.png" alt="img navigation">
</div>
<div class="title">Figure 25. Button to extend the navigation</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_navigation_section"><a class="anchor" href="#rp_navigation_section"></a>4.6.2. Section template</h4>
<div class="paragraph">
<p>The global page <a href="#rp_navigation_globalpage"><code>navigation_extension</code></a> contained in the reference project enables the extension of the main navigation in the ContentCreator.
The navigation can be enhanced by adding menu items on the first level, each of which corresponds to a structure folder and serves as a start node.
Subfolders contained in such a structure folder are automatically interpreted as sub-items of the new menu item.</p>
</div>
<div class="paragraph">
<p>For all new start nodes, the <code>FS_CATALOG</code> input component of the global page is enhanced with an entry based on the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/navigation_node_reference"><code>navigation_node_reference</code> section template</a>.
This section template in turn contains an <code>FS_REFERENCE</code> input component, which is used to reference the respective menu item.</p>
</div>
<div class="paragraph">
<p>In its <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/navigation_node_reference/ChannelSource_CaaS_CaaS.json">output channel</a>, the section template additionally contains the navigation function <code>fr_mainNav</code>.
Starting from the selected structure folder, this function generates the sub-navigation of the new menu item for this folder and the subfolders contained in it.
All these sub-navigations of the individual menu items are combined using the technical page template <a href="#rp_navigation_page"><code>navigations</code></a> and transferred to the <em>CaaS</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_navigation_page"><a class="anchor" href="#rp_navigation_page"></a>4.6.3. Page template</h4>
<div class="paragraph">
<p>In addition to the <a href="#rp_navigation_globalpage">global page</a> the reference project contains the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigations">technical page reference <code>navigations</code></a>.
This is used to transfer all navigation changes made <strong>in FirstSpirit</strong> to the <em>CaaS</em>.</p>
</div>
<div class="paragraph">
<p>Using the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/Scripts/get_navigation_gca_pages">script <code>get_navigation_gca_pages</code></a>, the page reference determines all global pages,
which are based on the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigation_extension">page template <code>navigation_extension</code></a>.
The global pages represent the navigations in FirstSpirit that can be extended using the ContentCreator.
Within the reference project, this is the main navigation of the Spryker B2C Demo Shop.</p>
</div>
<div class="paragraph">
<p>Each of these global pages contains an <code>FS_CATALOG</code> input component,
which uses the section template <a href="#rp_navigation_section"><code>navigation_node_reference</code></a> to reference the start nodes of all menu items <strong>maintained in FirstSpirit</strong>.
The section template in turn generates a sub-navigation for each of these start nodes.
The technical page reference combines all these sub-navigations and creates a JSON document containing all navigations that are <strong>extendable in FirstSpirit</strong>.</p>
</div>
<div class="paragraph">
<p>For the release of the navigation changes made, the reference project provides the workflow <a href="#fs-nav-wf"><em>Release Navigation</em></a>, which requires the release right for its execution.
This workflow only performs the release, but not the publication of the corresponding global page.
At the same time, it triggers a script that ensures that the technical page reference is transferred to the <em>Preview CaaS</em>.
The publication of the adaptations and their transfer to the <em>Online CaaS</em> only takes place in the context of a <a href="#fs-deployment">full generation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_navigation_twigtemplates"><a class="anchor" href="#rp_navigation_twigtemplates"></a>4.6.4. Twig templates</h4>
<div class="paragraph">
<p>In addition to the described FirstSpirit templates, the adaptation of the following Twig templates is required in Spryker,
to enable the extension of the main navigation of the Spryker B2C Demo Shop in the ContentCreator.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>navigation-header.twig</p>
</li>
<li>
<p>navigation-multilevel-node.twig</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The necessary adjustments are part of the <a href="#sp_navigation">installation</a> and are therefore not described here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Spryker, the Twig templates represent the main navigation.
They reference the menu items and control their display in the preview and in the live state.
The adaptations provide the main navigation with a button in the ContentCreator, which allows the addition of further menu items.</p>
</div>
<div class="paragraph">
<p>If other navigations should be editable in the ContentCreator, only an adjustment of the corresponding Twig templates is necessary.
The chapter <a href="#uc_navigation">navigation maintenance</a> explains the required steps for this.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_links"><a class="anchor" href="#rp_links"></a>4.7. Links</h3>
<div class="paragraph">
<p>The editorial contents maintained in FirstSpirit can contain the following references, which link them with other contents.
They are based on various link templates that are already included in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.</p>
</div>
<div class="paragraph">
<p>All link templates exist twice because they differ in the way they are integrated:
In contrast to the general references, the DOM references can only be used within DOM Editors - according to their name.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Category and product link</dt>
<dd>
<p>The <em>FirstSpirit Connect</em> module provides a report for products and categories in ContentCreator.
They serve to display the category and product information coming from Spryker, which can be used for links to category or product detail pages.</p>
<div class="paragraph">
<p>Therefore, the reference project contains the link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/category_link"><code>category_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/product_link"><code>product_link</code></a> as well as <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_category_link"><code>dom_category_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_product_link"><code>dom_product_link</code></a>, which correspond to a category or product link.
They enable category or product detail pages to be referenced and are equivalent to each other.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In contrast to a category, a referenced product is identified by its sku and not by the node ID.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Content page link</dt>
<dd>
<p>The link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/content_link"><code>content_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_content_link"><code>dom_content_link</code></a> contained in the reference project correspond to a content page link.
This allows referencing <a href="#rp_staticsite">static pages</a> and <a href="#rp_contentpage">dynamic content pages</a> maintained within the FirstSpirit project.
Within the reference project, the selection of the link target is therefore restricted to page references in the structure folder <code>content_pages</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For editors it is not obvious whether a link target is a dynamic content page or a static page.
However, since static pages do not have a URL by default, links to them would generally not be possible.
The <a href="#fs-projectsettings">project settings</a> therefore provide a way of assigning a URL to them.
The technical adjustments made in the reference project are described in the following <a href="#rp_staticcontentlinks">subchapter</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Magazine article link</dt>
<dd>
<p>The reference project contains the link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/magazine_article_link"><code>magazine_article_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_magazine_article_link"><code>dom_magazine_article_link</code></a>, which correspond to a magazine article link.
Like the content page link, it enables the referencing of editorial content maintained within the FirstSpirit project.
In contrast to this, the magazine article link refers to <a href="#rp_magazine">magazine articles</a> according to its name.</p>
</dd>
<dt class="hdlist1">External link</dt>
<dd>
<p>Just like the content page link and the magazine article link described above, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/external_link">external link</a> enables the referencing of editorial content.
However, in contrast to them it refers exclusively to external content.</p>
</dd>
<dt class="hdlist1">Search link</dt>
<dd>
<p>The reference project contains the link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/search_link"><code>search_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_search_link"><code>dom_search_link</code></a>, which correspond to a search link.
It enables the linking of a search result page to a defined search term.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All of the link templates for the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links">DOM references</a> contain in their output channel a call to the corresponding <a href="#sp_widgets">widget</a> which controls the Spryker-side output of the reference.
This way, the HTML for the reference is generated automatically.
A project-specific adaptation of the HTML is not possible.</p>
</div>
<div class="listingblock">
<div class="title">Widget call within the DOM category reference</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">{% widget 'FirstSpiritCategoryLinkWidget' args [$CMS_VALUE(lt_category.values[0].getNodeId)$, "$CMS_VALUE(lt_linkText.convert2)$"] only %}{% endwidget %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In contrast, the link templates for <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links">general references</a> only contain the definition of two parameters.
They thus follow the same concept as the page and section templates.
In this way, only the URL of the reference is generated and the HTML is freely definable on the Spryker side.</p>
</div>
<div class="listingblock">
<div class="title">Parameter definition within the category reference</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(set_id)$
   $CMS_VALUE(lt_category.values[0].getNodeId)$
$CMS_END_SET$
$CMS_SET(void, set_link.put("id", set_id.toString()))$
$CMS_SET(void, set_link.put("type","category"))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Processing the general references is controlled by the <code>link.twig</code> Twig template, which is part of the <a href="#sp_modules">FirstSpiritPreview module</a> and determines the corresponding URL based on the reference type.</p>
</div>
<div class="listingblock">
<div class="title">Twig template link.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">{% define data = {link: link} %}
{%- if data.link.type is defined -%}
   {%- set type = data.link.type -%}
   {%- if data.link.id is defined and data.link.id is not empty -%}
      {%- set id = data.link.id -%}
      {%- if  type == "cmspage" -%}
         {%- set url = getCmsPageUrl(id) -%}
      {%- elseif type == "category" -%}
         {%- set url = getCategoryPageUrl(id) -%}
      {%- elseif type == "product" -%}
         {%- set url = getProductPageUrl(id) -%}
      {%- endif -%}
   {%- else -%}
      {%- if type == "search" -%}
         {%- set url = path('search') ~ '?q=' ~ data.link.query -%}
      {%- elseif type == "external" -%}
         {%- set url = data.link.url -%}
      {%- elseif type == "static" -%}
         {%- set url = data.link.url -%}
      {%- endif -%}
   {%- endif -%}
{%- endif -%}

{%- if url is defined and url is not null -%}
   {{- url -}
}{%- endif -%}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Twig template is called in the individual components that represent the FirstSpirit sections in Spryker:</p>
</div>
<div class="listingblock">
<div class="title">Example call for the Twig template link.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP"> &lt;a href="{% include template('link', 'FirstSpiritPreview') with { link: data.fsBlockData.link } %}"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the Twig functions for determining the general references can also be called directly:</p>
</div>
<div class="listingblock">
<div class="title">calls of the Twig functions to determine the general references</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% set url = getCmsPageUrl(cms_page_id) %}
{% set url = getProductPageUrl(productId) %}
{% set url = getCategoryPageUrl(categoryId) %}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="rp_staticcontentlinks"><a class="anchor" href="#rp_staticcontentlinks"></a>4.7.1. Content page links to static pages</h4>
<div class="paragraph">
<p>When creating content page links, editors are not able to see any difference between static and dynamic pages.
However, since static pages do not have a URL by default, links to them would generally not be possible.
The <a href="#fs-projectsettings">project settings</a> therefore provide a way of assigning a URL to them.
For this purpose, the project settings contain the FS_CATALOG <code>ps_staticLinks</code>, which is filled via the <b class="button">Static Page Templates Import</b> button.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A future modification of the URLs defined in the project settings requires the execution of both the <a href="#fs-deployment">full generation</a> and the <a href="#fs-previewdeployment">preview generation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The button <b class="button">Static Page Templates Import</b> calls the executable <code>ProjectPropertiesStaticPageUrlListExecutable</code> which determines the content of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/static_pages">template folder <code>static_pages</code></a>.
For each template contained in this folder it adds an entry to the FS_CATALOG based on the technical <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/static_page_url">section template <code>static_page_url</code></a>.
Every entry contains a reference to the respective template and a language-dependent field for the relative URL to be defined.</p>
</div>
<div class="paragraph">
<p>For creating the entries and referencing the templates automatically within these entries, the button has the following parameters,
which are predefined within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>staticPageCatalog</strong>: This parameter defines the FS_CATALOG component in the project settings.</p>
</li>
<li>
<p><strong>staticPageUrlTemplateUid</strong>: This parameter specifies the reference name of the technical section template on which the entries in the FS_CATALOG are created.</p>
</li>
<li>
<p><strong>staticPageTemplateFolder</strong>: This parameter defines the reference name of the template folder that contains all templates for static pages.</p>
</li>
<li>
<p><strong>pageTemplateFsReference</strong>: The name of the FS_REFERENCE component from the technical section template is assigned to this parameter for referencing the static page templates automatically.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable content page links to static pages, the URLs defined in the project settings must be available in the link templates.
Therefore, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/technical/project_settings/ChannelSource_CaaS_CaaS.json">output channel</a> of the project settings contains the following code that stores the URL of a static page template in the variable <code>set_ps_staticLinks</code>.</p>
</div>
<div class="listingblock">
<div class="title">output channel of the project settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JAVA hljs" data-lang="JAVA">$CMS_SET(set_ps_staticLinks,{:})$
$CMS_FOR(for_staticLink,ps_staticLinks.filter(x-&gt;!x.item.st_pageTemplate.isEmpty))$
   $CMS_SET(void, set_ps_staticLinks
      .put(
         for_staticLink.item.st_pageTemplate.get.uid,
         for_staticLink.item.st_url.convert2
      )
   )$
$CMS_END_FOR$
$CMS_SET(set_ps_contentPageList,["contentpage"])$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the reference project the variable is queried in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/LinkTemplates/links/content_link/ChannelSource_CaaS_CaaS.json">output channel</a> of the content page link.
This way editors do not have to distinguish between static and dynamic content pages when selecting a link target.</p>
</div>
<div class="listingblock">
<div class="title">Code snippet of the content page link</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JAVA hljs" data-lang="JAVA">$CMS_SET(set_pageUid,lt_pageRef.get().page.template.uid)$
$CMS_IF(set_pageUid == "contentpage")$
[...]
$CMS_ELSIF(!set_ps_staticLinks.isEmpty)$
   $CMS_IF(set_ps_staticLinks.containsKey(set_pageUid) &amp;&amp; !set_ps_staticLinks.get(set_pageUid).isEmpty)$
      $CMS_SET(void, set_link.put("url", set_ps_staticLinks.get(set_pageUid)))$
      $CMS_SET(void, set_link.put("type","static"))$
      [...]
   $CMS_END_IF$
   [...]
$CMS_END_IF$</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usecases"><a class="anchor" href="#usecases"></a>5. Use cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within the progress of a project, different situations can arise that require certain steps to be taken.
The following subchapters describe situations that can typically occur in integration projects,
 and describe the necessary steps for resolving them by using the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> supplied as a reference.</p>
</div>
<div class="sect2">
<h3 id="uc-datasync"><a class="anchor" href="#uc-datasync"></a>5.1. Content Exchange</h3>
<div class="paragraph">
<p>The integration requires that the data within the FirstSpirit project, the corresponding <em>CaaS</em> instance and in Spryker are consistent to each other.
However, this consistency will be violated by the following situations that may occur during the progress of a project:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Project transfer to a new deployment environment (Dev, Prod, QA)</dt>
<dd>
<p>Creating a new deployment environment always involves importing an existing FirstSpirit project.
The import creates a constellation in which contents already exist in FirstSpirit, whereas the <em>CaaS</em> instances and Spryker are empty or have different contents.</p>
</dd>
<dt class="hdlist1">ContentTransport</dt>
<dd>
<p>In contrast to the previous point, which involves the transfer of entire projects to another deployment environment,
the <a href="https://docs.e-spirit.com/odfs/documentation/modules/developers/CONT_EN_FirstSpirit_CorporateContent.pdf">ContentTransport</a> is used to transfer editorial content between two projects.
During the progress of a project, for example, the contents of the production environment can be transferred back to the test and development environment in this way,
to exchange existing test data with real information.</p>
<div class="paragraph">
<p>Contrary to the project transfer, the target project therefore already exists and will not be created.
This implies that the corresponding <em>CaaS</em> instances and Spryker also already contain content.
After the ContentTransport these contents differ from those of the FirstSpirit project.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The transfer of content to the <em>Preview CaaS</em> and its generation in Spryker is done automatically each time new content is saved.
In contrast, existing content - as in the situations described - would have to be saved again separately for their persistence.
For this reason, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> has the schedule <a href="#fs-previewdeployment"><em>Spryker Preview Deployment</em></a>,
which handles both the filling of the <em>Preview CaaS</em> and the updating of the preview contents in Spryker.
It is created within the <code><strong>ServerManager</strong></code> in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Schedule management</b></span></strong></code> area and can only be executed by project administrators.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The schedule requires all configuration steps to have been completed beforehand - on both the FirstSpirit and the Spryker side.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the schedule has been performed, the <em>Preview CaaS</em> is filled with the preview contents of the FirstSpirit project.
Furthermore, on the spryker side, all <a href="#rp_contentpage">content pages</a> and <a href="#rp_magazine">magazine pages</a> included in the project were created in addition to the existing <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>.
Afterwards the contents are available for the editors in the preview.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The schedule <a href="#fs-previewdeployment"><em>Spryker Preview Deployment</em></a> can be executed at any time.
If required, the consistency of the preview data can thus be ensured whenever needed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If, in addition to the consolidation of the preview content, a transfer to the storefront is required, the content needs to be released and published.
The reference project provides a <a href="#fs-wf">workflow</a> for the release, which also enables the <a href="#fs-wf-adaptions">publication of single pages</a>.
In addition, it contains the <a href="#fs-deployment"><em>Spryker Deployment</em></a> schedule, which transfers all released contents of the project to the <em>Online CaaS</em> and triggers their import to Spryker.
The schedule can be started by <code>ChiefEditors</code> using the action <code><strong>Publication</strong></code> available in ContentCreator.</p>
</div>
</div>
<div class="sect2">
<h3 id="uc_navigation"><a class="anchor" href="#uc_navigation"></a>5.2. Navigation maintenance</h3>
<div class="paragraph">
<p>In addition to a <a href="#sp_navigation">main navigation</a>, a shop generally has numerous other navigations.
The integration realised with the <em>FirstSpirit Connect</em> module offers the possibility to maintain these navigations with FirstSpirit and to add further menu items.
This requires the following steps to be carried out first.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The steps described refer to the <strong>enhancement</strong> of an existing navigation.
If instead an existing navigation should be managed completely in FirstSpirit, its menu items must be deleted in Spryker.</p>
</div>
<div class="paragraph">
<p>Alternatively, a new navigation can be maintained in FirstSpirit.
For this, it must first be created in Spryker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Replacement of the ContentNavigationWidget</dt>
<dd>
<p>The <a href="#sp_widgets"><code>FirstSpiritPreviewContentNavigationWidget</code></a> contained in the delivery replaces the <code>ContentNavigationWidget</code> existing in Spryker.
In Spryker, therefore, a replacement must be done by deleting the <code>ContentNavigationWidget</code> and adding the <code>FirstSpiritPreviewContentNavigationWidget</code> instead.</p>
</dd>
<dt class="hdlist1">Addition of a further menu item</dt>
<dd>
<p>In the preview, an additional menu item is required to display the navigation.
It serves as a placeholder and must be added within the twig template that represents the first level menu items:</p>
<div class="listingblock">
<div class="title">Addition of a further menu item</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">[..]
&lt;ul class="menu {{ menuClass }} grid grid--center grid--no-wrap"&gt;
   {% for node in data.nodes %}
      [..]
   {% endfor %}

   {% if isFsPreview() %}
      &lt;li class="fs-navigation-extension"
         style="padding-left: 1rem; transform: translate(0,15% );"&gt;
      &lt;/li&gt;
   {% endif %}
&lt;/ul&gt;
[..]</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Definition of the Preview ID</dt>
<dd>
<p>In addition to the placeholder, a preview ID is required for the preview.
It must be defined in the twig template that controls the output of the individual menu items:</p>
<div class="listingblock">
<div class="title">Definition of the Preview ID</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% block attributes %}
   {% if isFsPreview() and data.node.previewId is defined and data.node.previewId is not empty %}
      data-preview-id="{{ data.node.previewId }}" style="min-height: unset;"
   {% endif %}
{% endblock %}</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After the changes have been made, it may be necessary to empty the cache for the twig templates and to rebuild the frontend.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After a successful completion of the described steps, the corresponding navigation in ContentCreator is extended by a button, which allows the addition of further menu items.
The addition of further menu items requires the right to edit and delete.
If a user does not have these rights, the button is hidden.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/img_navigation.png" alt="img navigation">
</div>
<div class="title">Figure 26. Button for extending the navigation</div>
</div>
<div class="paragraph">
<p>A click on the button opens an editing dialog, in which a structure folder has to be selected as target of the new menu item.
If the referenced structure folder contains further subfolders, these are automatically displayed as sub-items of the new menu item.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mixing menu items maintained in FirstSpirit and those originating from Spryker is not possible.
For this reason, menu items created using the ContentCreator are only appended to the existing navigation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The changes done to the navigation finally require a release.
Therefore, the workflow <a href="#fs-nav-wf"><em>Release Navigation</em></a> can be executed via via a button that appears by hovering over the navigation.
This workflow only performs a release, but not a publication.
The publication of the adaptations only takes place in the context of a <a href="#fs-deployment">full generation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The button to execute the workflow requires the release right.
If a user does not have this right, hovering over the navigation has no effect.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="uc-pageattributes"><a class="anchor" href="#uc-pageattributes"></a>5.3. Maintenance of page attributes</h3>
<div class="paragraph">
<p>In contrast to the sections, the content pages do not have an EasyEdit frame, and so neither the buttons provided with it.
Therefore, no direct editing options are available for content pages in the ContentCreator.
Because of that, the <code><strong>Actions</strong></code> menu contains the menu item <code><strong>Edit Page</strong></code>, which is only visible for <a href="#rp_contentpage">content pages</a>.
It opens the edit dialog of the page and allows the maintenance of page attributes and metadata.
The attributes are required both for creating the corresponding page in Spryker and for SEO configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/actions_editpage.png" alt="actions editpage">
</div>
<div class="title">Figure 27. Edit Page</div>
</div>
</div>
<div class="sect2">
<h3 id="uc_orphanedpages"><a class="anchor" href="#uc_orphanedpages"></a>5.4. Removal of orphaned product and category pages</h3>
<div class="paragraph">
<p>In the course of a project, a Spryker-sided deletion or deactivation of no longer needed products or categories can occur at any time.
However, these are possibly still referenced within the FirstSpirit project.
The deletion or deactivation results in orphaned <a href="#rp_productpages">product</a> and <a href="#rp_categorypages">category pages</a>, which can cause errors and warnings during the import.
These orphaned pages can no longer be accessed and therefore cannot be identified by editors.</p>
</div>
<div class="paragraph">
<p>The ContentCreator therefore provides the report <code><strong>Lost and Found</strong></code>.
It shows an overview of all orphaned pages within the FirstSpirit project and allows filtering for product or category pages.
Each entry has a delete button that appears when hovering over it and, after confirming a security question, triggers a <a href="#fs-delete-wf-report">delete workflow</a>.
The workflow removes the corresponding page from the FirstSpirit project, releases the parent structure, and finally performs a <a href="#fs-deployment">full deployment</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The execution of the delete workflow requires both delete and release rights.
If the editor is missing one of these rights, the delete button is hidden for him and the removal of orphaned pages is therefore not possible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/img_lostandfound.png" alt="img lostandfound">
</div>
<div class="title">Figure 28. Report Lost and Found</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal_notices"><a class="anchor" href="#_legal_notices"></a>6. Legal notices</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>FirstSpirit Connect</em> is a product of e-Spirit AG, Dortmund, Germany.
Only a license agreed upon with e-Spirit AG is valid for using the module.</p>
</div>
<div class="paragraph">
<p>Details regarding any third-party software products in use but not created by e-Spirit AG, as well as the third-party licenses and, if applicable, update information can be found in the file <code>THIRD-PARTY.txt</code> included with the module.</p>
</div>
<div class="paragraph">
<p>All pictures contained in the delivered <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project <em>FirstSpirit Connect Reference Project</em></a> are taken from the provider <a href="https://pixabay.com/en">pixabay</a>.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
