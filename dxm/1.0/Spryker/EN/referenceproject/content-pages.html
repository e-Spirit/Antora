<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/dxm/1.0/Spryker/EN/referenceproject/content-pages.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../../_'</script>
    <link rel="icon" href="../../../../../_/img/shortcut-icon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/index.html">Spartacus</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Crownpeak</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="dxm" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">DXM</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../chapters/loggingin.html">Logging into DXM</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../chapters/requirements.html">Requirements to use DXM</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../chapters/setup_firsttime.html">Setting up DXM for the first time</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">DXM</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../index.html">DXM</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../ecom/1.0/index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../ecom/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../cloud/1.0/index.html">FirstSpirit Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../cloud/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../headless/1.0/index.html">Headless</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../headless/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/dxm/edit/main/modules/Spryker/pages/EN/referenceproject/content-pages.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect2">
<h3 id="rp_contentpage"><a class="anchor" href="#rp_contentpage"></a>Creation of dynamic content pages</h3>
<div class="paragraph">
<p>In addition to the extension of existing <a href="#rp_staticsite">static pages</a> or <a href="#rp_categorypages">category pages</a>, the <em>{modulname}</em> module allows the creation of dynamic content pages.
These correspond, for example, to the imprint, the data security explanation or the general terms and conditions.
Just like the other pages, the dynamic content pages can also be displayed in {cc} using the <em>{ocm}</em> and enriched with editorial content.
However, since the dynamic pages are newly created and not only extended, they are initially empty, unlike the other pages.</p>
</div>
<div class="paragraph">
<p>To create the dynamic content pages, it is also necessary to fill the output channel of the <a href="#rp_dcp_pagetemp">page template</a> within the {fs} project.
In addition, the existence of the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a> is assumed in  .
The template is part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery.</p>
</div>
<div class="paragraph">
<p>The section templates contained in the reference project are allowed for all pages.
For this reason, no additional extensions are required that go beyond the requirements already described for the <a href="#rp_section">Shoppable Video section</a>.</p>
</div>
<div class="sect3">
<h4 id="rp_dcp_pagetemp"><a class="anchor" href="#rp_dcp_pagetemp"></a>Page template</h4>
<div class="paragraph">
<p>Just like <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, the maintenance of dynamic content pages in the {fs} project is based on a page reference.
However, in contrast to the other pages that already exist in the project, dynamic content pages are created using the familiar editing process.
For this reason, they are initially empty.</p>
</div>
<div class="paragraph">
<p>The creation of the page reference in the {cc} triggers an event of the <em>{ocm}</em>, which triggers the creation of the corresponding CMS page in  .
This is necessary for displaying the CMS page in the preview.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New dynamic content pages must be created in the <em>Content Pages</em> structure folder.
This ensures their storage in the corresponding <em>{c}</em> collection and thereby their automatic creation in  .</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Under certain circumstances it is possible that the {fs} project contains a dynamic content page for which there is no CMS page on the   side.
In this case, the first time the content page is called in the {cc}, the <em>{ocm}</em> event is also triggered, which triggers the creation of the corresponding CMS page in  .</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reference project contains the page template <code>contentpage</code>.
It is an example for dynamic content pages and maps the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a>, which has to be created on the   side.</p>
</div>
<div class="paragraph">
<p>Within the {contentpage_caas_channel}[output channel] of the page template, various general information is first defined and stored in the JSON object of the <em>{c}</em> item to be generated:
The <code>previewId</code> serves to identify the page reference and allows its decoration in the {cc} as well as its mapping to the   Twig template.
The automatically determined name and path of this template are specified using the fields <code>template_name</code> and <code>template_path</code>.
The page reference is identified using the <a href="#sp_basetemp">JavaScript of the <em>{ocm}</em></a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to the name of the Twig template, the ID of the corresponding CMS page is also determined automatically.
It is stored in a hidden input component of the {fs} page template.
Since the ID is only required for the preview and is read directly from the page form, it is not required within the <em>{c}</em> item.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, the <code>pagetype</code> parameter is used to define the page type.
In the case of dynamic content pages, the field must have the value <code>cmspage</code>.</p>
</div>
<div class="paragraph">
<p>The <code>is_active</code> and <code>store_names</code> fields indicate that the Twig template represented by the page is active on the   side and visible in the store selected in the <a href="#fs-projectsettings">Project settings</a>.
The <code>is_searchable</code> field can also be used to configure whether the page can be searched by its name in  .
In contrast to the <code>previewId</code>, which only serves for the preview, the unique <code>identifier</code> also allows the referencing of the <em>{c}</em> item on   side.</p>
</div>
<div class="listingblock">
<div class="title">Definition of general information in the output channel of the page template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(json, {:})$
$CMS_SET(previewId, previewId(element:#global.node))$
$CMS_SET(void, json.put("previewId", "" + previewId))$
$CMS_SET(void, json.put("template_name", pt_cmsPageTemplateName))$
$CMS_SET(void, json.put("template_path", "@Cms/templates/fs-content-page/fs-content-page.twig"))$
$CMS_SET(void, json.put("pagetype", "cmspage"))$
$CMS_SET(void, json.put("is_active", "1"))$
$CMS_SET(void, json.put("store_names", [ps_activeStore]))$
$CMS_SET(void, json.put("is_searchable", "1"))$
$CMS_SET(void, json.put("identifier", #global.node.uid))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the general information, the <code>localizedAttributes</code> array is used to pass specific information to the JSON object, which   requires for each content page.
They are used to define various metadata, a page name, and the URL at which the page will be accessible in  .
While the various metadata can optionally be entered by the editor in the form of the page, the URL is a language-dependent mandatory field.
It must have the structure <code>/language abbreviation/subpath</code>, with the language abbreviation automatically prefixed to the URL during generation.
The importer expects this information in the context of the current language.
For this reason, the corresponding language abbreviation, which is passed to each attribute, is determined.</p>
</div>
<div class="listingblock">
<div class="title">Definition of specific information</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(locale, #global.language.getLocale())$
$CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$

$CMS_SET(attributes, {:})$
$CMS_IF(pt_url != null &amp;&amp; !pt_url.isEmpty())$
   $CMS_SET(url, "/" + locale.getLanguage() + if(!pt_url.startsWith("/"), "/") + pt_url.convert2)$
   $CMS_SET(void, attributes.put("url", {localeAbbr: url}))$
$CMS_ELSE$
   $CMS_SET(void,#global.logError(
      "Missing url for contentpage " + #global.node.uid + ". Contentpages without url can't create and generate."))$
   $CMS_SET(#global.stopGenerate,true)$
$CMS_END_IF$
$CMS_SET(pageName, #global.page.getDisplayName(#global.language))$
$CMS_SET(void, attributes.put("name", {localeAbbr: if(pageName.toString() != null, pageName, "")}))$
$CMS_SET(void, attributes.put("meta_title", {localeAbbr: if(!pt_metaTitle.isEmpty, pt_metaTitle.convert2, "")}))$
$CMS_SET(void, attributes.put("meta_description", {localeAbbr: if(!pt_metaDescription.isEmpty, pt_metaDescription.convert2, "")}))$
$CMS_SET(void, attributes.put("meta_keywords", {localeAbbr: if(!pt_metaKeywords.isEmpty, pt_metaKeywords.convert2, "")}))$
$CMS_SET(void, json.put("localizedAttributes", attributes))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page template for dynamic content pages contains the two content areas <code>content_top</code> and <code>content_body</code>.
They enable the creation of editorial content, for which different section templates are available in the reference project.
Their contents are added one after the other to the JSON object <code>json</code> created in the template.</p>
</div>
<div class="listingblock">
<div class="title">Determination of editorial content</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(blocks, [])$
$CMS_VALUE(#global.page.body("content_top"))$
$CMS_SET(contentTopBlocks, [])$
$CMS_SET(void, contentTopBlocks.addAll(blocks))$

$CMS_SET(blocks, [])$
$CMS_VALUE(#global.page.body("content_body"))$
$CMS_SET(contentBodyBlocks, [])$
$CMS_SET(void, contentBodyBlocks.addAll(blocks))$

$CMS_SET(resultingBlocks, [])$
$CMS_SET(void, resultingBlocks.addAll(contentTopBlocks))$
$CMS_SET(void, resultingBlocks.addAll(contentBodyBlocks))$
$CMS_SET(void, json.put("blocks", resultingBlocks))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, dynamic content pages have so-called placeholders.
These correspond to the content areas of the {fs} page template and contain only references to the CMS blocks assigned to them.
After the editorial content has been entered, these references are created for each content area.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The placeholders must also be created in the case of empty content pages.
This is especially necessary for the initial creation of the pages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Creation of the block references</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(placeholder, {:})$
$CMS_SET(contentTopPlaceholder, "")$

$CMS_IF(!contentTopBlocks.isEmpty())$
   $CMS_FOR(contentTopBlock, contentTopBlocks)$
      $CMS_SET(contentTopPlaceholder, contentTopPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentTopBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$CMS_SET(contentBodyPlaceholder, "")$
$CMS_IF(!contentBodyBlocks.isEmpty())$
   $CMS_FOR(contentBodyBlock, contentBodyBlocks)$
      $CMS_SET(contentBodyPlaceholder, contentBodyPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentBodyBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$-- Placeholders values have to exist in Spryker for synchronization purposes, therefore allowing even empty placeholder values for online CaaS --$
$CMS_IF(!contentTopPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_top", {localeAbbr: contentTopPlaceholder}))$
$CMS_END_IF$
$CMS_IF(!contentBodyPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_body", {localeAbbr: contentBodyPlaceholder}))$
$CMS_END_IF$

$CMS_SET(void, json.put("placeholder", placeholder))$
$CMS_VALUE(json.toJSON)$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_dcp_twigtemp"><a class="anchor" href="#rp_dcp_twigtemp"></a>Twig template</h4>
<div class="paragraph">
<p>In  , the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a> represents a dynamic content page.
Unlike <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, dynamic content pages have placeholders.
To make the placeholders editable in {cc}, it is necessary to use the Twig function <code>fsSpyCms</code> to include them.</p>
</div>
<div class="paragraph">
<p>Each placeholder represents a content area of the corresponding <a href="#rp_dcp_pagetemp">{fs} page template</a>.
For this reason, the name of the placeholder and the name of the content area must be identical.
Each of the content areas can contain any number of <a href="#rp_section">sections</a>, for which a Twig template must also exist in  .</p>
</div>
<div class="paragraph">
<p>The {contentpage_caas_channel}[{fs} page template <code>contentpage</code>] contained in the reference project is an example for dynamic content pages.
It has the content areas <code>content_top</code> and <code>content_body</code> and maps the Twig template <code>fs-content-page.twig</code>.</p>
</div>
<div class="paragraph">
<p>Within the Twig template, specific metadata and the page title are first defined.
Then the output of the two placeholders <code>content_top</code> and <code>content_body</code> is handled within the blocks <code>title</code> and <code>content</code>.
They reference the CMS blocks assigned to them, which in turn control the output of the editorial content.</p>
</div>
<div class="paragraph">
<p>The following code example shows the content of the template.</p>
</div>
<div class="listingblock">
<div class="title">Twig template fs-content-page.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends template('page-layout-main') %}

{% define data = {
   title: _view.pageTitle | default('global.spryker.shop' | trans),
   metaTitle: _view.pageTitle | default('global.spryker.shop' | trans),
   metaDescription: _view.pageDescription | default(''),
   metaKeywords: _view.pageKeywords | default('')
} %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
   &lt;!-- CMS_PLACEHOLDER : "content-top" --&gt;
   &lt;div class="cms-page__title"&gt;
      {{ fsSpyCms('content_top') | raw }}
   &lt;/div&gt;
{% endblock %}

{% block content %}
   &lt;!-- CMS_PLACEHOLDER : "content-body" --&gt;
   &lt;div class="cms-page__content"&gt;
      {{ fsSpyCms('content_body') | raw }}
   &lt;/div&gt;
{% endblock %}</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../../../../_/js/site.js"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
