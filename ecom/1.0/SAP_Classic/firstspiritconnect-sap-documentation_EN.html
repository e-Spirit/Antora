<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FirstSpirit Connect for SAP Commerce Cloud :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/ecom/1.0/SAP_Classic/firstspiritconnect-sap-documentation_EN.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://e-spirit.github.io/Antora/cloud/1.0/index.html">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS/CaaS_FSM_Documentation_EN.html">CaaS</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Connect/CaaS_Connect_FSM_Documentation_EN.html">CaaS Connect</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Platform/CaaS_Platform_Documentation_EN.html">CaaS Platform</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_FSM/index.html">Navigation Service (FSM)</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_Platform/documentation.html">Navigation Service (Platform)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/chapters/introduction.html">Spartacus</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Salesforce/index.html">Salesforce</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/SAP_Classic/firstspiritconnect-sap-documentation_EN.html">SAP Classic</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Crownpeak</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/dxm/1.0/index.html">DXM</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ecom" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">E-Commerce</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../Spryker/index.html">Spryker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/spryker-installation/spryker-installation.html">Spryker - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/fs-installation/fs-installation.html">FirstSpirit - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/use-cases/use-cases.html">Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/legal-notice.html">Legal Notice</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spartacus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../Spartacus/chapters/introduction.html">Main Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/sapcc-installation/sapcc-installation.html">Spartacus - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/fs-installation/fs-installation.html">FirstSpirit - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/use-cases/use-cases.html">Use Cases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spartacus/FS_Connect_SAP_hl_ServeradminManual_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Salesforce/index.html">Salesforce</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SAP Classic</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="firstspiritconnect-sap-documentation_EN.html">Main Documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="firstspiritconnect-sap-admindoc_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">E-Commerce</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dxm/1.0/index.html">DXM</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dxm/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cloud/1.0/index.html">FirstSpirit Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cloud/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../headless/1.0/index.html">Headless</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../headless/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">E-Commerce</a></li>
    <li>SAP Classic</li>
    <li><a href="firstspiritconnect-sap-documentation_EN.html">Main Documentation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/ecom/edit/main/modules/SAP_Classic/pages/firstspiritconnect-sap-documentation_EN.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">FirstSpirit Connect for SAP Commerce Cloud</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FirstSpirit is used for creating versatile and project-specific content.
Thanks to the <em>FirstSpirit Connect for SAP Commerce Cloud</em> module, it is now possible to transfer this content to the SAP Commerce Cloud e-commerce shop system and use it there.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the remainder of this document, the abbreviated form Commerce Cloud will be used instead of SAP Commerce Cloud.
This abbreviated form refers to SAP Commerce Cloud in all cases.</p>
</div>
<div class="paragraph">
<p>Furthermore, the entire document is geared towards connecting to the B2B Accelerator storefront.
Mention of the storefront refers to the B2B Accelerator storefront in all cases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The module combines the functional strengths of both systems, delivering the key advantages that each offers and creating a highly effective overall system
made up of two areas that work in parallel and are largely decoupled from one another:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Components on the FirstSpirit side</dt>
<dd>
<p>These components are used for creating and maintaining editorial data.
The data is transferred in JSON and media format to the relevant <em>Content as a Service</em> instance, and queried from this instance by the Commerce Cloud.</p>
</dd>
<dt class="hdlist1">Components on the Commerce Cloud side</dt>
<dd>
<p>These components are used for integrating editorial content created in FirstSpirit.
Commerce Cloud integrates this data into the shop.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Included in the delivery of the <em>FirstSpirit Connect for SAP Commerce Cloud</em> module is the reference project <em>FirstSpirit Connect Reference Project</em>.
This documentation is consistently based on the reference project and provides an explanation of the functions made available by the module using common use cases.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This document is aimed both at SAP developers and at FirstSpirit developers, who should be able to perform integration using this document as a guide.<br>
It is <strong>not</strong> intended as a handbook for FirstSpirit editors.</p>
</div>
<div class="paragraph">
<p>It is assumed that the reader is confident in the use of FirstSpirit and Commerce Cloud, <em>CaaS</em> and <em>Omnichannel Manager</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_range_of_functions"><a class="anchor" href="#_range_of_functions"></a>1.1. Range of functions</h3>
<div class="paragraph">
<p><em>FirstSpirit Connect</em> allows editors to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create Commerce Cloud content using FirstSpirit for one or more sites of a Commerce Cloud instance</p>
</li>
<li>
<p>Access to product and category information</p>
</li>
<li>
<p>Display shop elements and editorial content in the FirstSpirit preview simultaneously</p>
</li>
<li>
<p>Transfer of content to Commerce Cloud</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding functions are made available when the module is installed and configured in ContentCreator.</p>
</div>
<div class="paragraph">
<p>Familiar FirstSpirit tools are used to maintain the content, meaning that editors who are already familiar with FirstSpirit do not require any additional knowledge.
The content is made available to Commerce Cloud as part of a deployment so that it can be imported.
It integrates the information into the shop.</p>
</div>
<div class="paragraph">
<p>As far as Commerce Cloud is concerned, this means there is no difference when it comes to delivering editorial content to the live state.
Even if the FirstSpirit server is shut down because of maintenance work, for example, this has no effect on Commerce Cloud.</p>
</div>
</div>
<div class="sect2">
<h3 id="_architecture"><a class="anchor" href="#_architecture"></a>1.2. Architecture</h3>
<div class="paragraph">
<p>FirstSpirit and Commerce Cloud are linked by an architecture made up of a range of components (see figure <a href="#img_architecture">Architecture</a>).</p>
</div>
<div class="paragraph">
<p>These components are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The modules installed on the FirstSpirit server:</p>
<div class="ulist">
<ul>
<li>
<p><em>FirstSpirit Connect</em></p>
</li>
<li>
<p><em>Omnichannel Manager</em></p>
</li>
<li>
<p><em>Content as a Service</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Commerce Cloud-Instanz</p>
</li>
</ul>
</div>
<div id="img_architecture" class="imageblock">
<div class="content">
<img src="_images/architecture.png" alt="architecture">
</div>
<div class="title">Abbildung 1. Architecture</div>
</div>
<div class="paragraph">
<p>The individual components always interact in accordance with the following schema:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In FirstSpirit, the editorial content is created and edited in ContentCreator.
With the help of the <em>Omnichannel Manager</em>, the staged storefront of the Commerce Cloud is embedded in it.</p>
</li>
<li>
<p>The Staged Storefront in turn accesses the <em>Preview CaaS</em> and determines the current FirstSpirit contents from it.
It also integrates the <code>Omnichannel Manager JavaScript</code>, which enables the content in ContentCreator to be edited and highlighted.</p>
</li>
<li>
<p>The product and category information is provided via a report.
The report accesses the product catalog and obtains the required data via the <code>CMS WebServices</code> interface of the Commerce Cloud.</p>
</li>
<li>
<p>The module also uses the <code>CMS WebServices</code> interface.
It triggers the automatic synchronization of content pages created or modified in FirstSpirit in the content catalog of the staged storefront.
The automatic synchronization of the information in the online storefront must always be developed on a project-specific basis, so there is no predefined mechanism for this process.</p>
</li>
<li>
<p>The released editorial content is transferred via a generation process to the <em>Online CaaS</em>.
This process makes the content available to the online storefront, which is then used to integrate it into the shop.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Commerce Cloud thus represents the main component in this architecture.
In addition to providing all shop functionality, this system queries content created or maintained in FirstSpirit from <em>Online CaaS</em> and provides it to customers.
There is only one loose link between the two systems; they primarily work in parallel with one another.
If the FirstSpirit server is shut down because of maintenance work, for example, this has no effect on Commerce Cloud.</p>
</div>
</div>
<div class="sect2">
<h3 id="_technical_requirements"><a class="anchor" href="#_technical_requirements"></a>1.3. Technical requirements</h3>
<div class="paragraph">
<p>To use the <em>FirstSpirit Connect</em> module, the following technical requirements must be met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The latest versions of the <em>FirstSpirit Connect</em> and <em>Content as a Service</em> modules</p>
</li>
<li>
<p><em>Omnichannel Manager</em> in version 1.2.27 or higher</p>
</li>
<li>
<p>FirstSpirit 2018-11 (Legacy or Isolated mode)</p>
</li>
<li>
<p>Java 8 or 11</p>
</li>
<li>
<p>SAP Commerce Cloud 18.08</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using the supplied <em>FirstSpirit Connect Reference Project</em>, the latest version of the <em>BasicWorkflows</em> module must also be installed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The version number of the delivery differs from the version numbers of the individual components of the delivery.
It follows a scheme of two-digit year, month number and the number of the release within the respective month (for example: <code>20.10.0</code> for the first release in October 2020)
In contrast, the module, the reference project, and the add-on receive their own version numbers, which are separated from the version number of the delivery.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commerce_cloud_installation_and_configuration"><a class="anchor" href="#_commerce_cloud_installation_and_configuration"></a>2. Commerce Cloud - Installation and configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FirstSpirit is used to create and maintain editorial data, which is then transferred to and persisted by <em>CaaS</em>.
To integrate the data into the shop, Commerce Cloud requires access to <em>CaaS</em>.
This access is provided by an add-on included in the delivery package which must be installed and configured on the Commerce Cloud side.
The delivery also includes storefront modifications that already incorporate the add-on.</p>
</div>
<div class="paragraph">
<p>The following chapters explain all necessary steps for installing and configuring the add-on and the required Commerce Cloud expansions.</p>
</div>
<div class="sect2">
<h3 id="addon"><a class="anchor" href="#addon"></a>2.1. Add-on</h3>
<div class="paragraph">
<p>The <em>CaaS</em> content is queried by the Commerce Cloud using an add-on.
This add-on is included in the delivery in the form of a <code>fscontentconnect-&lt;Versionsnumber&gt;.zip</code> file requiring installation and configuration in Commerce Cloud.
The FirstSpiritPreviewFilter included in the add-on must also be activated in Commerce Cloud.</p>
</div>
<div class="paragraph">
<p>The following chapters describe how to execute the required steps.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Commerce Cloud server must be stopped before the steps described below are carried out.
Otherwise this can lead to malfunctions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="addon-install"><a class="anchor" href="#addon-install"></a>2.1.1. Installing the add-on</h4>
<div class="paragraph">
<p>The zip file that must first be unzipped in order to install the add-on contains the directory <code><strong>fscontentconnect</strong></code>, which must be copied to the <code><strong>$HYBRISHOME/hybris/bin/custom</strong></code> directory on the Commerce Cloud server.
The add-on must also be introduced to the Commerce Cloud server.
This is achieved by entering the add-on in the <code>localextensions.xml</code> file in the <code><strong>$HYBRISHOME/hybris/config directory</strong></code>.</p>
</div>
<div class="listingblock">
<div class="title">Entering the add-on in the localextensions.xml file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hybrisconfig&gt;
   &lt;extensions&gt;
      [...]
      &lt;extension name='fscontentconnect' /&gt;
   &lt;/extensions&gt;
&lt;/hybrisconfig&gt;</code></pre>
</div>
</div>
<div id="addon-build" class="paragraph">
<p>In the next installation step, the add-on must be built.
This can be achieved using the following command sequence, which must be executed in the <code><strong>$HYBRISHOME/hybris/bin/platform</strong></code> directory of the previously stopped Commerce Cloud server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">// 1.
. ./setantenv.sh

// 2.
ant addoninstall -Daddonnames="fscontentconnect"
-DaddonStorefront.yb2bacceleratorstorefront="yb2bacceleratorstorefront"

// 3.
ant clean all</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first command sets environment variables, the second command adds the add-on to the Commerce Cloud, and the final command triggers the compilation.</p>
</div>
<div class="paragraph">
<p>To complete the installation of the add-on, the last step is to update the Commerce Cloud server.
The update can be executed via the <code><strong><span class="menuseq"><b class="menu">Platform</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Update</b></span></strong></code> area in the <code><strong>hybris administration console</strong></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="addon-config"><a class="anchor" href="#addon-config"></a>2.1.2. Configuring the add-on</h4>
<div class="paragraph">
<p>The integration of the content maintained in FirstSpirit into the store requires a connection of the Commerce Cloud to the <em>CaaS</em>.
For this, the following information is required after the <a href="#addon-install">installation of the add-on</a> for both the productive environment as well as the preview:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CaaS API Key</p>
</li>
<li>
<p>CaaS Database</p>
</li>
<li>
<p>CaaS Host</p>
</li>
<li>
<p>CaaS Port</p>
</li>
<li>
<p>CaaS Scheme</p>
</li>
<li>
<p>Content Catalog ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They are to be specified either <a href="#addon-sites">for each site used</a> or in the <code>project.properties</code> file in the <code><strong>fscontentconnect</strong></code> directory of the add-on.
In contrast to the specifications at the respective site, the parameters in the configuration file always refer to <strong>all</strong> sites.
Therefore they serve as fallback parameters.</p>
</div>
<div class="paragraph">
<p>The following code block shows an example for the content of the <code>project.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Example configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">caas-online.apikey=abcdefghijklmn1234567890
caas-online.database=MyProject
caas-online.host=caas.mydomain.com
caas-online.port=80
caas-online.scheme=http

caas-staged.apikey=abcdefghijklmn1234567890
caas-staged.database=MyProject
caas-staged.host=caas-preview.mydomain.com
caas-staged.port=80
caas-staged.scheme=http

content-catalog-id=powertoolsContentCatalog

fscontentconnect.dev=true</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">apikey</dt>
<dd>
<p>A valid API key is required to access the data stored in <em>CaaS</em>.
This key requires read permissions for the project in question.
It can be generated in the <em>CaaS Admin Interface</em> and must be entered in this line.</p>
</dd>
<dt class="hdlist1">database</dt>
<dd>
<p>The value of this parameter corresponds to the name of the project stored in <em>CaaS</em>.
It can be determined via the <em>CaaS Admin Interface</em>.</p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>This parameter requires the host name to be entered under which <em>CaaS</em> can be reached.</p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>This parameter requires the port to be entered under which <em>CaaS</em> can be reached.</p>
</dd>
<dt class="hdlist1">scheme</dt>
<dd>
<p>This parameter indicates whether communication with <em>CaaS</em> is to take place via http or https.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Further information on using <em>CaaS</em> is provided in the <em><a href="https://docs.e-spirit.com/module/caas-platform/CaaS_Platform_Documentation_EN.html">Content as a Service Manual</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">content-catalog-id</dt>
<dd>
<p>The value of this parameter corresponds to the ID of the content catalog used (for example, <code>powertoolsContentCatalog</code>).</p>
</dd>
<dt class="hdlist1">fscontentconnect.dev</dt>
<dd>
<p>In addition to the other parameters, the configuration parameter <code>fscontentconnect.dev</code> is optionally definable.
It controls the inclusion of the <code>fs-tpp-api</code> JavaScript library and is <strong>exclusively</strong> usable in the configuration file of the add-on.
If the value <code>true</code> is specified, the <code>cloud-sap-acc-dev</code> tag is used when loading the <code>fs-tpp-api</code> library.
If the parameter is missing or set to <code>false</code>, the <code>cloud-sap-acc</code> tag is used.
Which versions are behind these two tags can be seen at any time on the corresponding <a href="https://www.npmjs.com/package/fs-tpp-api">npm page</a> in the tab <code>Versions</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>cloud-sap-acc-dev</code> tag is upgraded by e-Spirit on every DEV/QA patchday to the latest compatible version of the <code>fs-tpp-api</code> library.
The <code>cloud-sap-acc</code> tag on every PROD patchday.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="addon-sites"><a class="anchor" href="#addon-sites"></a>2.1.3. Connection of multiple sites</h4>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module allows editors to create Commerce Cloud content using FirstSpirit and to integrate it into the shop.
This requires the Commerce Cloud to be connected to the <em>CaaS</em>.
The parameters needed for the connection are definable either in the <a href="#addon-config">configuration file</a> of the previously installed add-on or for each site.
The <em>FirstSpirit Connect</em> module thus allows multiple sites to be connected to FirstSpirit.</p>
</div>
<div class="paragraph">
<p>The configuration of the sites is done in the Commerce Cloud backoffice.
Under the item <code><strong>Administration</strong></code> each site has the fields visible in the following figure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/config_parameters.png" alt="config parameters">
</div>
<div class="title">Abbildung 2. configuration parameters of a site</div>
</div>
<div class="paragraph">
<p>The information defined in the fields always refers to the corresponding site only.
If no entry exists for a field, the parameter specified in the <a href="#addon-config">configuration file of the add-on</a> represents a fallback value.
Since the data stored in the configuration file applies to all sites, mixed operation can be implemented in this way.
For example, it is possible to store the API Key, the protocol as well as the URL and the port of the <em>CaaS</em> centrally in the configuration file,
while the name of the database to be used is specified separately for each site.
The site-specific parameters always overwrite the data persisted in the configuration file.</p>
</div>
</div>
<div class="sect3">
<h4 id="addon-filter"><a class="anchor" href="#addon-filter"></a>2.1.4. Activating the FirstSpiritPreviewFilter</h4>
<div class="paragraph">
<p>The previously installed and configured <a href="#addon-install">add-on <code>FSContentConnect</code></a> contains the FirstSpiritPreviewFilter.
This filter sets the session variables that are required for the integration to work.
It requires activation in Commerce Cloud and must be added to the <code>PlatformFilterChain</code> for this purpose.</p>
</div>
<div class="paragraph">
<p>The delivery includes a B2B accelerator storefront, which contains a <code>spring-filter-config.xml</code> file with the <code>firstSpiritPreviewFilter</code> bean already added to the FilterChainList.</p>
</div>
<div class="listingblock">
<div class="title">Activating the FirstSpiritPreviewFilter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;alias
 name="defaultStorefrontTenantDefaultFilterChainList"
 alias="storefrontTenantDefaultFilterChainList" /&gt;
&lt;util:list id="defaultStorefrontTenantDefaultFilterChainList"&gt;

   [...]
   &lt;!-- filter to handle requests from FirstSpirit --&gt;
   &lt;ref bean="firstSpiritPreviewFilter"/&gt;

&lt;/util:list&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="viewextension_tags"><a class="anchor" href="#viewextension_tags"></a>2.1.5. JSP tags</h4>
<div class="paragraph">
<p>The <a href="#addon-install">add-on <code>FSContentConnect</code></a>, which is included in the delivery and was previously installed and configured, provides the following JSP tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>caas:includeOcmScripts</code></p>
</li>
<li>
<p><code>caas:request</code></p>
</li>
<li>
<p><code>caas:whenFirstSpiritPreview</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These tags are used to query the <em>CaaS</em> content and can be used in the required Commerce Cloud page templates.</p>
</div>
<div id="ocmscript" class="dlist">
<dl>
<dt class="hdlist1">caas:includeOcmScripts</dt>
<dd>
<p><em>Omnichannel Manager</em> requires various JavaScript files; in the preview, the tag creates the script tags required for the integration of these files.
It determines the preview using the session attributes, which are set by the <a href="#addon-filter">FirstSpiritPreviewFilter</a> contained within the <a href="#addon-install">add-on</a>.
It is only necessary to integrate the tag for this purpose.</p>
<div class="listingblock">
<div class="title">Integration - JSP tag caas:includeOcmScripts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;caas:includeOcmScripts/&gt;</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">caas:request</dt>
<dd>
<p>The tag enables data to be requested from <em>CaaS</em>.
In order to do this, the element to be determined and the collection containing the element must be specified.
This information can be assigned to the tag using the attributes <code>itemId</code> and <code>collection</code>.
The result of the query is stored in a variable, the name of which is defined via the <code>var</code> variable.
Once the indicated <em>CaaS</em> item has been successfully queried, the variable is stored in the page scope.</p>
<div class="listingblock">
<div class="title">Example - caas:request JSP tag</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;caas:request itemId="homepage" collection="contentpages" var="homepageItem" /&gt;

&lt;!-- Display the revision of the current content --&gt;
${homepageItem['fs_revision_id']}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no content exists in <em>CaaS</em> for a defined request, this can be dealt with using standard JSP techniques:</p>
</div>
<div class="listingblock">
<div class="title">Specification of fallback content</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;c:choose&gt;
   &lt;c:when test = "${homepageItem != null}"&gt;
      &lt;!-- do this if we have a response --&gt;
      &lt;%-- ${homepageItem['slots']['section1']} --%&gt;
   &lt;/c:when&gt;
   &lt;c:otherwise&gt;
      &lt;!-- do this when nothing else is true, i.e. output the fallback content. --&gt;
   &lt;/c:otherwise&gt;
&lt;/c:choose&gt;</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">caas:whenFirstSpiritPreview</dt>
<dd>
<p>The tag enables code to be executed exclusively in the FirstSpirit preview.
For this purpose, it evaluates a session attribute set by the <a href="#addon-filter">FirstSpiritPreviewFilter</a>.
This is contained within the previously installed <a href="#addon-install">add-on</a>.</p>
<div class="listingblock">
<div class="title">Example - JSP tag whenFirstSpiritPreview</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;caas:whenFirstSpiritPreview&gt;
   &lt;script type="text/javascript"&gt;
      const PAGE_PREVIEW_DATA = {
         pageType: '${cmsPage.typeCode}',
         pagePreviewId: '${pagePreviewId}',
         pageId: '${cmsPage.uid}',
         pageTemplate: '${cmsPage.masterTemplate.uid}'
      };
   &lt;/script&gt;
&lt;/caas:whenFirstSpiritPreview&gt;</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Further information on the use of <em>CaaS</em> and the <em>Omnichannel Manager</em> is provided in the <em><a href="https://docs.e-spirit.com/module/caas-platform/CaaS_Platform_Documentation_EN.html">Content as a Service Manual</a></em> and in the <em><a href="https://docs.e-spirit.com/tpp/index.html.en">Omnichannel Manager Manual</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="javascript"><a class="anchor" href="#javascript"></a>2.1.6. Integrating Omnichannel Manager into the storefront</h4>
<div class="paragraph">
<p>In FirstSpirit, the editorial content is created and edited in the ContentCreator.
With the help of the <em>Omnichannel Manager</em>, the staged storefront of the Commerce Cloud is embedded in it.
The Staged Storefront in turn accesses the <em>Preview CaaS</em> and determines the current FirstSpirit contents from it.</p>
</div>
<div class="paragraph">
<p>To enable the content from the storefront to be edited in ContentCreator, the <em>Omnichannel Manager</em> JavaScript must be integrated into Commerce Cloud.
For this purpose, the Taglib and the <a href="#ocmscript">tag <code>caas:includeOcmScripts</code></a> must be integrated into the <code>javaScript.tag</code> file.
The delivery includes storefront modifications with <em>Omnichannel Manager</em> already integrated, which renders this step unnecessary.</p>
</div>
<div class="listingblock">
<div class="title">Integration of the Taglib and the tag caas:includeOcmScripts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;%@ taglib prefix="caas" tagdir="/WEB-INF/tags/addons/fscontentconnect/responsive/caas"%&gt;

&lt;caas:includeOcmScripts/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_oauth_configuration"><a class="anchor" href="#_oauth_configuration"></a>2.2. OAuth configuration</h3>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module requires OAuth authentication to query information from Commerce Cloud.
For this purpose, an OAuth client must be configured within Commerce Cloud.
There are two options for creating this type of OAuth client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatically, by importing the following ImpExes<br>
(in the <code><strong>Hybris Admin Console</strong></code> under <code><strong><span class="menuseq"><b class="menu">Console</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">ImpEx Import</b></span></strong></code>)</p>
</li>
<li>
<p>Manually, in the back office under <code><strong><span class="menuseq"><b class="menu">System</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">OAuth</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">OAuth Clients</b></span></strong></code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">INSERT_UPDATE OAuthClientDetails;clientId[unique=true] ;resourceIds;scope ;authorizedGrantTypes ;authorities ;clientSecret;registeredRedirectUri
;firstspirit ;hybris ;extended,previewwebservices;authorization_code,refresh_token,password,client_credentials;ROLE_TRUSTED_CLIENT ;secret; ;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The validity scope of the OAuth client used for the <a href="#configPreview">Preview</a> must be set to <code>previewwebservices</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="searchrestrictions"><a class="anchor" href="#searchrestrictions"></a>2.3. FlexibleSearch Restrictions</h3>
<div class="paragraph">
<p>The <a href="#productreport">product report</a> in ContentCreator shows all of the products in a product catalog.
It therefore requires access to all of the detail pages for all displayed products.
If search restrictions exist that prevent the product detail pages for specific products in a product catalog from being called up, these restrictions must be expanded with the condition described below.
Within the condition, the placeholder must be replaced with the ID of the product catalog.</p>
</div>
<div class="listingblock">
<div class="title">Additional condition within the filter query of a search restriction for products</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- existing conditions such as approval status check
OR
   ({{ SELECT {PK} FROM {CatalogVersion} WHERE {Catalog} IN
      ({{ SELECT {PK} FROM {Catalog as c} WHERE {c.id} = '&lt;Catalog Id of product catalog&gt;'}})
      AND {version} = 'Staged' AND {PK} IN (?session.catalogversions)
   }}) IS NOT NULL</code></pre>
</div>
</div>
<div class="paragraph">
<p>This additional condition prevents the relevant search restriction from being used in the context of the <code>Staged</code> version of the product catalog.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Search restrictions are configured in the back office under <code><strong><span class="menuseq"><b class="menu">System</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Personalization</b></span></strong></code>.
For example, in the B2B accelerator, the search restriction <code>Frontend_ProductApprovalStatus</code> must be modified as described.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Search restrictions, that affect content pages, also need to be extended.
Again, the placeholder within the condition needs to be replaced with the ID of the content catalog.</p>
</div>
<div class="listingblock">
<div class="title">Additional condition within the filter query of a search restriction for pages</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- existing conditions such as approval status check
OR
   ({{ SELECT {PK} FROM {CatalogVersion} WHERE {Catalog} IN
      ({{ SELECT {PK} FROM {Catalog as c} WHERE {c.id} = '&lt;Catalog Id of content catalog&gt;'}})
      AND {version} = 'Staged' AND {PK} IN (?session.catalogversions)
   }}) IS NOT NULL</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, in the B2B accelerator, the search restriction <code>Frontend_PageApprovalStatus</code> must be modified as described.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_firstspirit_installation_and_configuration"><a class="anchor" href="#_firstspirit_installation_and_configuration"></a>3. FirstSpirit - Installation and configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Various components must be installed and configured in FirstSpirit in order to use the functions of the <em>FirstSpirit Connect</em> module.
The following sub-chapters describe the steps required to do this.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the <em>FirstSpirit Connect</em> module, the <em>Content as a Service</em> and the <em>Omnichannel Manager</em> modules must also be configured.
The steps required to do this are described in the <em><a href="https://docs.e-spirit.com/module/caas-module/CaaS_FSM_Documentation_EN.html">Content as a Service Manual</a></em> and in the <em><a href="https://docs.e-spirit.com/tpp/index.html.en">Omnichannel Manager Manual</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to the standard groups <code>Everyone</code>, <code>Administrators</code> and <code>Developers</code>, there are three further <strong>external</strong> user groups in the reference project: <code>Editors</code>, <code>ChiefEditors</code> and <code>ProjectAdmins</code>.
The groups have different rights, which are selected according to their tasks and defined for the different stores.
Users outside these groups are not allowed to use the reference project by default.</p>
</div>
<div class="paragraph">
<p>If there is a need for additional accounts or groups, their creation must be requested by contacting the <a href="https://help.e-spirit.com/">Technical Support</a>.
For new accounts, the following information is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first and last name</p>
</li>
<li>
<p>e-mail address</p>
</li>
<li>
<p>groups to be assigned</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="pcomp"><a class="anchor" href="#pcomp"></a>3.1. Configuring the project component</h3>
<div class="paragraph">
<p>A project-specific configuration is required in order to use the <em>FirstSpirit Connect</em> module.
It is set up using the project component, which is already added to the reference project supplied.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the <em>FirstSpirit Connect</em> module, the <em>Content as a Service</em> and the <em>Omnichannel Manager</em> modules must also be configured.
The steps required to do this are described in the <em><a href="https://docs.e-spirit.com/module/caas-module/CaaS_FSM_Documentation_EN.html">Content as a Service Manual</a></em> and in the <em><a href="https://docs.e-spirit.com/tpp/index.html.en">Omnichannel Manager Manual</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The reference project also includes the project component of the <em>CXT ContentCreator Extension</em>.
This contains a predefined configuration, the modification of which can lead to a change in the behavior of the ContentCreator.
An adjustment of the configuration is therefore only to be made after prior consultation with the <a href="https://help.e-spirit.com/">Technical Support</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform configuration, open the <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Project components</b></span></strong></code>.</p>
</div>
<div id="projectComponents" class="imageblock">
<div class="content">
<img src="_images/projectcomponents.png" alt="Server properties - Project components">
</div>
<div class="title">Abbildung 3. Server properties - Project components</div>
</div>
<div class="paragraph">
<p>A list of all existing project components is displayed in the main panel.
Select the entry <code>FirstSpirit Connect for SAP Commerce Cloud Project Configuration</code> and open the corresponding configuration dialog via <b class="button">Configure</b>.</p>
</div>
<div id="config" class="imageblock">
<div class="content">
<img src="_images/config-general.png" alt="config general">
</div>
<div class="title">Abbildung 4. Project component - General</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">URI</dt>
<dd>
<p>The indicated URI is the server URI to the Commerce Cloud instance.</p>
</dd>
<dt class="hdlist1">Connection timeout (sec)</dt>
<dd>
<p>This parameter defines the time that elapses (in seconds) before the process of establishing a connection for communication with Commerce Cloud times out.</p>
</dd>
<dt class="hdlist1">Connection retries</dt>
<dd>
<p>This parameter defines the number of attempts the system will make to establish a connection for communication with Commerce Cloud.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following fields are used to configure authentication and are available in each tab.
To overwrite the settings defined on the <code>General</code> tab, the other tabs provide an option to <code>Override general OAuth</code> settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Auth Server URI</dt>
<dd>
<p>This parameter defines the standard end point for OAuth authentication (relative to the URI of the Commerce Cloud instance).</p>
</dd>
<dt class="hdlist1">Username</dt>
<dd>
<p>This field is used to enter the standard user for OAuth authentication.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The user specified here must belong to the following user groups in the Commerce Cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>previewmanagergroup</code> to generate a preview ticket</p>
</li>
<li>
<p><code>basecmsmanagergroup</code> to load product and category information in the reports</p>
</li>
<li>
<p><code>cmsmanagergroup</code> to create and update pages in the Commerce Cloud</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Password</dt>
<dd>
<p>This field is used to enter the password associated with the user provided in the previous field.</p>
</dd>
<dt class="hdlist1">OAuth Client ID</dt>
<dd>
<p>This field is used to indicate the standard client ID used for OAuth authentication.
It has an impact on the rights of the users.</p>
</dd>
<dt class="hdlist1">OAuth Client Secret</dt>
<dd>
<p>A secret is used for OAuth authentication; this secret must match the indicated client ID.</p>
</dd>
<dt class="hdlist1">OAuth Grant Type</dt>
<dd>
<p>OAuth authentication requires a standard grant type.
This can either be set to <code>password</code> or <code>client credentials</code>.</p>
</dd>
<dt class="hdlist1">Test OAuth Settings</dt>
<dd>
<p>This button is used to test the established connection based on the authentication settings entered.
If the <code>Override general OAuth settings</code> option is checked on the other tabs, these settings are also tested.</p>
</dd>
</dl>
</div>
<div id="config2" class="imageblock">
<div class="content">
<img src="_images/config-product-dap.png" alt="config product dap">
</div>
<div class="title">Abbildung 5. Project component - Product DAP</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Collection</dt>
<dd>
<p>This field is used to define the end point for product data queries.</p>
</dd>
</dl>
</div>
<div id="pdp_url" class="dlist">
<dl>
<dt class="hdlist1">PDP URL</dt>
<dd>
<p>The URL of a product detail page must be entered in this field.
Both absolute and relative URLs are permitted.
<code>{code}</code> can be used as a placeholder for the product code.
The default value is <code>p/{code}</code>.</p>
</dd>
<dt class="hdlist1">Header/Extract/Icon/Thumbnail</dt>
<dd>
<p>By default, search results in the product report show the product name in the header, the catalogue ID in the extract, and a thumbnail.
The fields <code>Header</code>, <code>Extract</code>, <code>Icon</code>, and <code>Thumbnail</code> allow the configuration of this information.
For this purpose the following placeholders are available in addition to simple text entries:</p>
<div class="ulist">
<ul>
<li>
<p><code>${catalogId}</code></p>
</li>
<li>
<p><code>${catalogVersion}</code></p>
</li>
<li>
<p><code>${code}</code></p>
</li>
<li>
<p><code>${description}</code></p>
</li>
<li>
<p><code>${name}</code></p>
</li>
<li>
<p><code>${thumbnailMediaUrl}</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>The entries in the fields replace the standard information in the search results of the product report.
Textual entries are adopted unchanged.
If the fields remain empty, the search results display the standard information.</p>
</dd>
<dt class="hdlist1">Override general OAuth settings</dt>
<dd>
<p>The fields for OAuth authentication contained in this tab enable the overwriting of the entries in the tab <code><strong>General</strong></code>.
The overwriting is done by activating the checkbox <code>Override general OAuth settings</code>.
Otherwise, the entries from the <code><strong>General</strong></code> tab will be used for authentication.</p>
</dd>
</dl>
</div>
<div id="configCategoryDap" class="imageblock">
<div class="content">
<img src="_images/config-category-dap.png" alt="config category dap">
</div>
<div class="title">Abbildung 6. Project component - Category DAP</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Katalog Id</dt>
<dd>
<p>The catalog defined here is used as the source of the categories for the category DAP.</p>
</dd>
<dt class="hdlist1">Katalog Version</dt>
<dd>
<p>For configuration purposes, this field is used to specify the version of the product catalog from which the categories for the category DAP were taken.</p>
</dd>
</dl>
</div>
<div id="cdp_url" class="dlist">
<dl>
<dt class="hdlist1">CDP URL</dt>
<dd>
<p>The URL of a category detail page must be entered in this field.
Both absolute and relative URLs are permitted.
<code>{code}</code> can be used as a placeholder for the category code.
The default value is <code>c/{code}</code>.</p>
</dd>
<dt class="hdlist1">Override general OAuth settings</dt>
<dd>
<p>The fields for OAuth authentication contained in this tab enable the overwriting of the entries in the tab <code><strong>General</strong></code>.
The overwriting is done by activating the checkbox <code>Override general OAuth settings</code>.
Otherwise, the entries from the <code><strong>General</strong></code> tab will be used for authentication.</p>
</dd>
</dl>
</div>
<div id="configPreview" class="imageblock">
<div class="content">
<img src="_images/config-preview.png" alt="config preview">
</div>
<div class="title">Abbildung 7. Project component - Preview</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Language</dt>
<dd>
<p>The language abbreviation entered in this field sets the language of the generated preview ticket.</p>
</dd>
<dt class="hdlist1">Resource Path</dt>
<dd>
<p>This field defines the resource URL of the generated preview ticket.</p>
</dd>
<dt class="hdlist1">Page Id</dt>
<dd>
<p>This field indicates the ID of the page of the generated preview ticket.</p>
</dd>
<dt class="hdlist1">Catalog Versions</dt>
<dd>
<p>This field is used to enter the catalog versions of the generated preview ticket.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The previously mentioned settings on the <code>Preview</code> tab correspond to the parameters of a
<a href="https://help.sap.com/doc/65f54fc80c71428cb3425c97daf250e5/1808/en-US/previewwebservices/index.html#_previewticket">preview ticket</a> in the <code>Preview API</code> of Commerce Cloud.
This ticket is requested by FirstSpirit to allow a protected storefront to be previewed in ContentCreator.
The delivery includes the file <code>fs-preview-session-initializer.js</code>, which is used as necessary by the <code>caas:includeOcmScripts</code> tag and triggers the generation of a preview ticket by calling up an executable.
If necessary, additional parameters can be transferred during this call to overwrite the settings on the <code>Preview</code> tab shown here.
The structure of the parameter object must match the structure of one of the
<a href="https://help.sap.com/doc/65f54fc80c71428cb3425c97daf250e5/1808/en-US/previewwebservices/index.html#_previewticket">preview tickets</a> in the <code>Preview API</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Override general OAuth settings</dt>
<dd>
<p>The fields for OAuth authentication contained in this tab enable the overwriting of the entries in the tab <code><strong>General</strong></code>.
The overwriting is done by activating the checkbox <code>Override general OAuth settings</code>.
Otherwise, the entries from the <code><strong>General</strong></code> tab will be used for authentication.</p>
</dd>
</dl>
</div>
<div id="configContent" class="imageblock">
<div class="content">
<img src="_images/config-content.png" alt="config content">
</div>
<div class="title">Abbildung 8. Project component - Contents</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Site Id</dt>
<dd>
<p>The ID of the Commerce Cloud site (e.g. <code>powertools</code>) must be entered in this field.</p>
</dd>
<dt class="hdlist1">Content Catalog Id</dt>
<dd>
<p>As with the Site Id, this field is used to enter the ID of the content catalog (e.g. <code>powertoolsContentCatalog</code>).</p>
</dd>
<dt class="hdlist1">Content Catalog Version</dt>
<dd>
<p>In this field, the version of the content catalog to be used must be selected (<code>Staged</code> or <code>Online</code>).</p>
</dd>
</dl>
</div>
<div id="template_mappings" class="dlist">
<dl>
<dt class="hdlist1">Template Mappings</dt>
<dd>
<p>To maintain existing Commerce Cloud pages in FirstSpirit, a FirstSpirit template must be assigned to each Commerce Cloud template.
For this purpose, a mapping between the <code>Commerce Cloud Template Item IDs</code> and the corresponding <code>FirstSpirit Page Template UIDs</code> must be defined at this point.</p>
<div class="paragraph">
<p>Since the content pages based on the templates can have different URLs, the <code>Commerce Cloud URL Pattern</code> column enables the creation of a specific preview URL in each case.
The URL can be entered either relative to the storefront or the host (see example below).
Furthermore, it is also possible to use the placeholder <code>pageUid</code>.
If the column remains empty, the URL defined in the <a href="#contentpage_url"><code>Contentpage URL</code></a> field is used instead for the preview of the corresponding page.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong><br>
The configuration visible in the figure would have the following meaning:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 1. Commerce Cloud URL Pattern - Example</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">FirstSpirit template</th>
<th class="tableblock halign-left valign-top">Entry</th>
<th class="tableblock halign-left valign-top">resulting URL</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content_page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/magazin/outdoor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http(s)://&lt;host&gt;/magazin/outdoor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the entry starts with a slash, only the server URL is extended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content_page_1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http(s)://&lt;host&gt;/&lt;storefront-context-root&gt;/preview-content?uid={pageUid}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since no specific URL is defined in this case, the general <code>Contentpage URL</code> is used instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content_page_2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assortment/{pageUid}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http(s)://&lt;host&gt;/&lt;storefront-context-root&gt;/assortment/{pageUid}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This entry has no leading slash.
  It therefore represents a URL relative to the storefront.
  Furthermore, it contains the placeholder <code>pageUid</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content_page_3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indoor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http(s)://&lt;host&gt;/&lt;storefront-context-root&gt;/indoor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This entry also does not contain a leading slash and therefore also leads to an extension of the storefront URL.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Content Page Attribute Mapping</dt>
<dd>
<p>The data entered here corresponds to the mapping of the FirstSpirit content page attributes to the Commerce Cloud content page attributes.</p>
<div class="paragraph">
<p>The following FirstSpirit input components are supported for entering the FirstSpirit content page attributes: <code>CMS_INPUT_TEXT</code>, <code>CMS_INPUT_TOGGLE</code>, <code>CMS_INPUT_RADIOBUTTON</code>, <code>CMS_INPUT_CHECKBOX</code>, <code>CMS_INPUT_COMBOBOX</code>, <code>CMS_INPUT_LIST</code>, <code>CMS_INPUT_DATE</code>, <code>CMS_INPUT_NUMBER</code>, <code>CMS_INPUT_TEXTAREA</code>.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="title">Example configuration of attribute mapping</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">[{
   "templateUid": "landinglayout2",
   "uidType": "TEMPLATESTORE",
   "attributeMappings": [
      { "source": "pt_title",
        "target": "title",
        "languageDependent": true
      },
      { "source": "pt_label",
        "target": "label",
        "languageDependent": false
      }
   ]
},
{
   "templateUid": "news.news_article",
   "uidType": "TEMPLATESTORE_SCHEMA",
   "attributeMappings": [
      { "source": "tt_title",
        "target": "title",
        "languageDependent": true
      },
      { "source": "tt_label",
        "target": "label",
        "languageDependent": false
      }
   ]
}]</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Content Pages Sitestore Folder UID</dt>
<dd>
<p>In this field, the UID of the structure folder in which the content pages managed in FirstSpirit are stored must be entered.</p>
</dd>
</dl>
</div>
<div id="contentpage_url" class="dlist">
<dl>
<dt class="hdlist1">Contentpage URL</dt>
<dd>
<p>Content pages can have specific URLs that are optionally specified during the definition of the <a href="#template_mappings"><code>Template Mapping</code></a> which have to be configured beforehand.
If a content page does not have a specific URL, the general <code>Contentpage URL</code> entered in this field is used instead for displaying the content page in the preview.
Both absolute and relative URLs as well as the use of the placeholder <code>{pageUid}</code> are permitted in this field.
The default value is <code>preview-content?uid={pageUid}</code>.</p>
</dd>
<dt class="hdlist1">Override general OAuth settings</dt>
<dd>
<p>The fields for OAuth authentication contained in this tab enable the overwriting of the entries in the tab <code><strong>General</strong></code>.
The overwriting is done by activating the checkbox <code>Override general OAuth settings</code>.
Otherwise, the entries from the <code><strong>General</strong></code> tab will be used for authentication.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="wcomp"><a class="anchor" href="#wcomp"></a>3.2. Adding web components</h3>
<div class="paragraph">
<p>The ContentCreator requires a web component that has already been added to the reference project supplied.
By default it is installed globally in the <code><strong>ServerManager</strong></code> in the area <code><strong><span class="menuseq"><b class="menu">Server Properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Web applications</b></span></strong></code>.
In this case, all installation or configuration steps required for the web component have already been performed by the e-Spirit AG.</p>
</div>
<div class="paragraph">
<p>Alternatively, you may install the web component in the <code><strong>Project properties</strong></code>.
<strong>Only in this case</strong> it still needs to be installed on an active web server.
To do this, open the <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Web components</b></span></strong></code>.</p>
</div>
<div id="webcomponents" class="imageblock">
<div class="content">
<img src="_images/webcomponents.png" alt="webcomponents">
</div>
<div class="title">Abbildung 9. Web components in the project properties</div>
</div>
<div class="paragraph">
<p>Inside the main panel, various tab pages are visible.
Each tab page contains a list of the existing web components.
This list contains the following entries for <code><strong>ContentCreator</strong></code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BasicWorkflows_ContentCreator_Library</code> (only required when using the <em>BasicWorkflows</em>)</p>
</li>
<li>
<p><code>CXT ContentCreator Extension Extension: WebApp for ContentCreator</code> (only required when using the reference project)</p>
</li>
<li>
<p><code>FirstSpirit Connect for SAP Commerce Cloud Web App</code></p>
</li>
<li>
<p><code>FirstSpirit ThirdPartyPreview WebApp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Select an <code>Active web server</code> on the tab page via the selection box of the same name and start the installation by clicking the <b class="button">Install</b> button.
After successful installation, a dialog opens, in which the activation of the <code>Web server</code> must be confirmed.</p>
</div>
<div class="paragraph">
<p>Detailed information on how to configure web components is available in the <em><a href="https://docs.e-spirit.com/odfs/edocs/admi/introduction/index.html">FirstSpirit Manual for Administrators</a></em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="install_previewurl"><a class="anchor" href="#install_previewurl"></a>3.3. Definition of the external preview URL</h3>
<div class="paragraph">
<p>By using the <em>Omnichannel Manager</em>, the ContentCreator displays external content from the storefront of the Commerce Cloud to which the <em>Omnichannel Manager</em> needs access.
The preview URL of the storefront must therefore be specified in the ContentCreator properties.
This must be extended by the parameter <code>firstSpiritPreview=1</code>, which is required for initializing the preview.
Since the specification of the URL is always project-specific, there is no default configuration for it within the reference project.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> <code>https://sap-storefront.e-spirit.com?site=e-spirit&amp;firstSpiritPreview=1</code></p>
</div>
<div class="paragraph">
<p>Open the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">ContentCreator</b></span></strong></code> area within the <code><strong>ServerManager</strong></code> and enter the URL of the storefront in the <code>External preview URL</code> field.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/previewurl.png" alt="previewurl">
</div>
<div class="title">Abbildung 10. External Preview URL</div>
</div>
</div>
<div class="sect2">
<h3 id="_presentation_channel"><a class="anchor" href="#_presentation_channel"></a>3.4. Presentation channel</h3>
<div class="paragraph">
<p>An additional XML channel is required in addition to the presentation channels that already exist for the project.
For empty projects, this channel must be created manually; however, it is already contained within the supplied <em>FirstSpirit Connect Reference Project</em>.</p>
</div>
<div class="paragraph">
<p>The presentation channel was created in the <code><strong>ServerManager</strong></code> under <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Template sets</b></span></strong></code> and is configured as follows:</p>
</div>
<div id="templateset" class="imageblock">
<div class="content">
<img src="_images/templateset.png" alt="templateset">
</div>
<div class="title">Abbildung 11. Presentation channel</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the selection box of the same name, the conversion rule to be created for <em>CaaS</em> must be selected.
The steps required to do this are described in the <em><a href="https://docs.e-spirit.com/module/caas-module/CaaS_FSM_Documentation_EN.html">Content as a Service Manual</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The presentation channel is activated and is therefore available in the project.
It is used to define the content to be transferred, which is summarized in messages during the generation operation and transferred to <em>CaaS</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="install_workflow"><a class="anchor" href="#install_workflow"></a>3.5. Release workflow</h3>
<div class="paragraph">
<p>Within the supplied <em>FirstSpirit Connect Reference Project</em>, content is released by editors via the release workflow of the <em>BasicWorkflows</em>.
This can be used as an alternative to project-specific workflows.</p>
</div>
<div class="paragraph">
<p><strong class="underline">Installing the BasicWorkflows module</strong></p>
</div>
<div class="paragraph">
<p>Before using the release workflow, you must install the <em>BasicWorkflows</em> module on the FirstSpirit Server and activate the web component.
The steps required to do this are the same as those required for the installation of the other modules and the activation of the associated <a href="#wcomp">web component</a>.
By default, these steps are already performed.</p>
</div>
<div class="paragraph">
<p>In addition, to use <em>BasicWorkflows</em> in the ContentCreator, the provided <code>BasicWorkflows Status Providers</code> must be selected in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">ContentCreator</b></span></strong></code> area within the <code><strong>ServerManagers</strong></code>.
This setting has already been applied in the <em>FirstSpirit Connect Reference Project</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/statusprovider.png" alt="statusprovider">
</div>
<div class="title">Abbildung 12. Element Status Provider</div>
</div>
<div class="paragraph">
<p><strong class="underline">Templates</strong></p>
</div>
<div class="paragraph">
<p>The <em>BasicWorkflows</em> require various templates.
Usually, these templates need to be imported via the context menu in the FirstSpirit project used.
However, they are already contained within the reference project and importing the templates is therefore not necessary.</p>
</div>
<div class="paragraph">
<p><strong class="underline">Permission assignment</strong></p>
</div>
<div class="paragraph">
<p>In the final step, the release workflow must be authorized in the individual stores so that they can be executed on FirstSpirit elements.
To do this, select <code><strong><span class="menuseq"><b class="menu">Extras</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Change permissions</b></span></strong></code> from the context menu of the stores' root nodes to call up the permission assignment.
This step has also already been carried out in the reference project and is therefore omitted.</p>
</div>
<div class="paragraph">
<p>The permissions for executing the workflow set on the stores' root nodes relate to the Everyone group.
This can only be changed by modifying the permissions manually.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>More detailed information on the installation, configuration, and functionality of the workflow can be found in the <em><a href="https://docs.e-spirit.com/module/basicworkflows/BasicWorkflows_Documentation_EN.html">BasicWorkflows Manual</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="install_pset"><a class="anchor" href="#install_pset"></a>3.6. Project settings</h3>
<div class="paragraph">
<p>There is some essential project-specific information that needs to be entered for the connection between FirstSpirit and Commerce Cloud.
It is entered using the project settings form and must be specified within the project being used.</p>
</div>
<div class="paragraph">
<p>Within the supplied reference project, the project settings page with the required configuration already exists.
In this case, there is no need to create the template or the required components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changes to the project settings do not take effect straight away, as they are saved in the session of the user.
They require the client to be restarted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/project_set.png" alt="project set">
</div>
<div class="title">Abbildung 13. Project settings</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CONTENT PAGE | LANDINGPAGE2 TEMPLATE</dt>
<dd>
<p>For the maintenance of <a href="#edit-existing-content-pages">existing Commerce Cloud content pages</a> in FirstSpirit each Commerce Cloud page template must be assigned to a FirstSpirit template.
The FirstSpirit template selected in this field is used to maintain Commerce Cloud content pages based on the Commerce Cloud template <code>LandingPage2Template</code>.
To support different or further Commerce Cloud templates the project settings form must be extended by similar fields.
This information enables the scripts <code>page_type_mapping</code> and <code>get_page_type</code> to correctly map Commerce Cloud and FirstSpirit content pages.
Therefore changes in the project settings page have to be reflected in these two scripts.</p>
</dd>
<dt class="hdlist1">CONTENT PAGE FOLDER</dt>
<dd>
<p>Within the FirstSpirit project, all content pages are created in the same content folder, which is defined in this field.
The script <code>page_type_mapping</code> requires the details of the folder for the maintenance of <a href="#edit-existing-content-pages">existing Commerce Cloud content pages</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="install_schedule"><a class="anchor" href="#install_schedule"></a>3.7. Deployment schedule</h3>
<div class="paragraph">
<p>By default, the release of content does not involve any update to <em>Online CaaS</em> or any transfer for data to the Commerce Cloud.
Instead, it only involves the FirstSpirit release process, which can be mapped, for example, using the <a href="#install_workflow">Release workflow of the <em>BasicWorkflows</em></a>.
The <em>Online CaaS</em> update and data transfer to the Commerce Cloud only takes place when the content is deployed.</p>
</div>
<div class="paragraph">
<p>The deployment of released editorial content is executed via a <em>CaaS</em> schedule.
This executes a <em>CaaS</em> generation and transfers the data to <em>Online CaaS</em>, which then makes it available to Commerce Cloud.
The schedule can also be used to synchronize the online content catalog in Commerce Cloud.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The update of the online content catalog may involve various dependencies.
For this reason, a decision as to whether the approval and synchronization processes form part of the import process or not must be made on a project-specific basis.</p>
</div>
<div class="paragraph">
<p>It is also possible to simply carry out an approval and a <a href="#direct_release">direct publication in the online content catalogue</a>.
In this case, the synchronization of the data must be ensured on a project-specific basis.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The supplied reference project contains a schedule that incorporates the following actions:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/schedule.png" alt="schedule">
</div>
<div class="title">Abbildung 14. Generation schedule actions</div>
</div>
<div class="paragraph">
<p>The actions <code>Initialize CaaSGeneration</code>, <code>CaaS Generate</code>, <code>CaaS CleanUp</code>, and <code>Finalize CaaS Generation</code> make up the <em>CaaS</em> schedule.
The actions described in the following sub-chapters are added to the schedule.
As the <a href="#bulk_update">Bulk Update</a> requires access to the <a href="#app_sync">Approval or Sync Definition</a>, these actions are described in reverse order.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em><a href="https://docs.e-spirit.com/module/caas-module/CaaS_FSM_Documentation_EN.html">Content as a Service Manual</a></em> contains further information on the <em>CaaS</em> schedule.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="bulk_update"><a class="anchor" href="#bulk_update"></a>3.7.1. SAPCC - Bulk Update</h4>
<div class="paragraph">
<p>Product detail pages maintained in FirstSpirit are generally based on pages that already exist in Commerce Cloud.
When these pages are edited, only the content is changed; the page creation process is separate.
Their publication therefore only requires an update of the data stored in the <em>Online CaaS</em>.
There is no need to synchronize the online content catalog in Commerce Cloud.</p>
</div>
<div class="paragraph">
<p>Unlike product detail pages, content pages can be created in FirstSpirit.
For this type of page, it is not sufficient to just update <em>Online CaaS</em> to trigger deployment.
Deployment also involves importing the content pages into Commerce Cloud.
This import process must be added to the deployment schedule as the last action in the form of the script <em>SAPCC - Bulk Update</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To update the online storefront, the bulk update accesses the approval and sync definition.
These match the action described in the <a href="#app_sync">following chapter</a>.</p>
</div>
<div class="paragraph">
<p>However, the update of the online content catalog may involve various dependencies.
For this reason, the action is optional and a decision as to whether or not it is included in the import process must be made on a project-specific basis.
If the action is not included, the bulk update script only updates the staged storefront.</p>
</div>
<div class="paragraph">
<p>It is also possible to simply carry out an approval and a <a href="#direct_release">direct publication in the online content catalogue</a>.
In this case, the synchronization of the data must be ensured on a project-specific basis.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">SAPCC - Bulk Update</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">#! executable-class
com.espirit.moddev.contentconnect.sap.module.synchronization.CommerceCloudBulkUpdate</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create and update content pages in Commerce Cloud, the import process must know the mapping of the FirstSpirit and Commerce Cloud content pages.
For this purpose, a mapping must be configured in the project component under <a href="#configContent"><code><strong>Content</strong></code></a>.</p>
</div>
<div class="paragraph">
<p>The reference name of the structure folder in which the content pages within the FirstSpirit project are stored must be entered at the same position.
The structure folder allows the import process to identify the pages to be transferred.
For this reason, the folder must only contain content pages that are managed by FirstSpirit.
During deployment, the import process updates or creates all pages contained in this folder in the Commerce Cloud.</p>
</div>
</div>
<div class="sect3">
<h4 id="app_sync"><a class="anchor" href="#app_sync"></a>3.7.2. Content Page Approval &amp; Sync Definition</h4>
<div class="paragraph">
<p>By default, <a href="#bulk_update">Bulk-Update</a> only updates the staged content catalog in Commerce Cloud.
To initiate an update of the online catalog content as well, the relevant pages must be approved and synchronized.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The update of the online content catalog may involve various dependencies.
For this reason, a decision as to whether the approval and synchronization processes form part of the import process or not must be made on a project-specific basis.</p>
</div>
<div class="paragraph">
<p>It is also possible to simply carry out an approval and a <a href="#direct_release">direct publication in the online content catalogue</a>.
In this case, the synchronization of the data must be ensured on a project-specific basis.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In such cases, the import process permits the execution of an additional update logic, which is applied to each content page that is to updated or created.
This logic can be added to the deployment schedule in the form of the <em>Content Page Approval &amp; Sync Definition</em> script.
As the previously described <a href="#bulk_update">Bulk Update</a> uses the update logic, the logic must be executed before the update.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Approval and synchronization take place via the API of the <em>FirstSpirit Connect</em> module.
The associated manual and the JavaDoc-JAR is included in the delivery.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Content in the staged content catalog may contain references to products in the staged product catalog.
To avoid inconsistencies in the online catalogs, it is a good idea to synchronize the product catalog before synchronizing the content catalog.</p>
</div>
<div class="paragraph">
<p>A standard process for synchronizing various catalogs always involves complex and project-specific requirements.
For this reason, it is not possible to define this kind of process here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code extract below shows an example definition of the approval process for an imported content page and its synchronization with the online content catalog.</p>
</div>
<div class="listingblock">
<div class="title">Update logic for the approval and synchronization of a content page</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">import com.espirit.moddev.contentconnect.sap.module.ServiceFactory;
import com.espirit.moddev.contentconnect.sap.module.synchronization.ContentPageAdditionalUpdate;
import com.espirit.moddev.contentconnect.sap.module.catalogs.cmsitem.CMSItemService;
import com.espirit.moddev.contentconnect.sap.module.catalogs.cmsitem.CMSItem;

contentPageAdditionalUpdate = new ContentPageAdditionalUpdate() {
   updateCMSContentPage(cmsContentPage, pageRef) {
      cmsItemService = ServiceFactory.getCMSItemService(context);

      context.logInfo("Approving content page " + cmsContentPage.getUid() + "..");

      // Approving CMSContentPage
      cmsContentPage.setApprovalStatus("APPROVED");
      updatedCMSContentPageOpt = cmsItemService.updateCMSContentPage(cmsContentPage);

      if(updatedCMSContentPageOpt.isPresent()) {
         // Synchronizing CMSContentPage to online catalog
         context.logInfo("Synchronizing content page " + cmsContentPage.getUid() + "..");
         cmsItemService.synchronizeItem(cmsContentPage, "Online");
      } else {
         context.logWarning("Approving content page " + cmsContentPage.getUid() + " failed!");
      }
   }
};

context.setProperty("sapcc_additional_contentpage_update", contentPageAdditionalUpdate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-process"><a class="anchor" href="#custom-process"></a>3.7.3. Expansion of the standard process</h4>
<div class="paragraph">
<p>The previously described standard process for the release and deployment of content can be modified and expanded as required on a project-specific basis.
This chapter describes possible use cases and contains information on how to use them.</p>
</div>
<div id="preview-page-attributes" class="dlist">
<dl>
<dt class="hdlist1">Preview of changes to Commerce Cloud-specific page attributes</dt>
<dd>
<p>Editorial changes to content or product detail pages are automatically transferred to <em>Preview CaaS</em>, which renders them available for display in the preview.
However, changes to Commerce Cloud-specific page attributes of content pages are processed in a different way:
These changes are not stored in <em>CaaS</em>, but are transferred to the staged content catalog during <a href="#install_schedule">deployment</a>.</p>
<div class="paragraph">
<p>If these changes need to be reflected in the preview, it must be possible to manually transfer them to the staged content catalog.
To do so, the system requires a schedule which, like the <a href="#install_schedule">deployment schedule</a>, is comprised of a generation operation and the subsequent import process.
In such cases, instead of a <em>CaaS</em> full generation, a <em>CaaS</em> partial generation must be selected.
The update logic for the import process must also contain an unapproval of the content page and must <strong>not</strong> trigger synchronization.</p>
</div>
</dd>
<dt class="hdlist1">Approval of a content page during page release</dt>
<dd>
<p>Using the <a href="#install_workflow">release workflow</a>, the user can execute an automatic approval of the corresponding Commerce Cloud page in the staged content catalog in parallel to the FirstSpirit release process.
To achieve this, the workflow must be modified to call up the relevant <a href="#install_schedule">deployment schedule</a>.
In order to update only the single released page, the <em>CaaS</em> full generation must be replaced with a <em>CaaS</em> partial generation.
As is the case with the <a href="#preview-page-attributes">preview of changes to Commerce Cloud-specific page attributes</a>, the update logic must <strong>not</strong> trigger synchronization.</p>
</dd>
<dt class="hdlist1">Hot deployment</dt>
<dd>
<p>A hot deployment - the publication of a single page - works in the same way as a standard <a href="#install_schedule">released page deployment</a>.
However, instead of a delta or full generation, only a partial generation of the page to be deployed should be carried out.</p>
</dd>
</dl>
</div>
<div id="direct_release" class="dlist">
<dl>
<dt class="hdlist1">Direct publication in the online content catalogue</dt>
<dd>
<p>The described <a href="#install_schedule">deployment schedule</a> updates both the Staged and the Online Content Catalog.
Therefore it triggers an approval and synchronization of the affected content pages.
Alternatively, it is also possible to trigger only an approval and a direct publication into the online content catalog.
In this case, automatic synchronization is not necessary.</p>
<div class="paragraph">
<p>The following steps are required to implement direct publication:</p>
</div>
<div class="paragraph">
<p>In the first step the sync definition must be removed within the <a href="#app_sync">schedule action <code>Content Page Approval &amp; Sync Definition</code></a>.
For this purpose, the update logic must be adapted as shown in the code snippet.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to the direct publication and the adaptation of the update logic, the automatic synchronization of both content catalogs will be omitted.
For this reason, it must be ensured on a project-specific basis that the contents of both catalogs remain identical.
Otherwise, divergences are unavoidable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Update logic for the approval of a content page</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">import com.espirit.moddev.contentconnect.sap.module.ServiceFactory;
import com.espirit.moddev.contentconnect.sap.module.synchronization.ContentPageAdditionalUpdate;
import com.espirit.moddev.contentconnect.sap.module.catalogs.cmsitem.CMSItemService;
import com.espirit.moddev.contentconnect.sap.module.catalogs.cmsitem.CMSItem;

contentPageAdditionalUpdate = new ContentPageAdditionalUpdate() {
   updateCMSContentPage(cmsContentPage, pageRef) {
      cmsItemService = ServiceFactory.getCMSItemService(context);

      context.logInfo("Approving content page " + cmsContentPage.getUid() + "..");

      // Approving CMSContentPage
      cmsContentPage.setApprovalStatus("APPROVED");
      updatedCMSContentPageOpt = cmsItemService.updateCMSContentPage(cmsContentPage);

      if(!updatedCMSContentPageOpt.isPresent()) {
         context.logWarning("Approving content page " + cmsContentPage.getUid() + " failed!");
      }
   }
};

context.setProperty("sapcc_additional_contentpage_update", contentPageAdditionalUpdate);</code></pre>
</div>
</div>
<div class="paragraph">
<p>An identical, second schedule is created by a subsequent duplication of the existing schedule.
Without any further configuration, both schedules would write into the Content Catalog that is selected as the <code>Content Catalog Version</code> in the <a href="#configContent">Content tab</a> of the project component.
In the reference project, this is the Staged Content Catalog.</p>
</div>
<div class="paragraph">
<p>In order for the second schedule to write into the online content catalog, the parameter <code>catalogVersion</code> must be added to the properties of the schedule action <code>SAPCC - Bulk Update</code> and configured with the value <code>Online</code>.
If the value is missing or the configuration is incorrect, the bulk update terminates and an exception occurs.
Otherwise, the log contains the information about which content catalog is used for deployment.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/schedule-parameter.png" alt="schedule parameter">
</div>
<div class="title">Abbildung 15. Parameter catalogVersion</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If, as described in this section, writing to the Online Content Catalog is done by a separate schedule, the <em>CaaS</em> generation must be adjusted in the schedule that writes to the Staged Content Catalog.
This must fill the <em>Preview CaaS</em> equivalent to writing to the Staged Content Catalog.
Information on the necessary adaptation of the <em>CaaS</em> generation is contained in the <em>Initialize CaaSGeneration</em> section of the <em><a href="https://docs.e-spirit.com/module/caas-module/CaaS_FSM_Documentation_EN.html">Content as a Service Manual</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use_cases"><a class="anchor" href="#use_cases"></a>4. Use cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module provides various options for accessing Commerce Cloud content and for using this in FirstSpirit.
These options are described below using use cases based on the supplied <em>FirstSpirit Connect Reference Project</em>.</p>
</div>
<div class="sect2">
<h3 id="edit-existing-content-pages"><a class="anchor" href="#edit-existing-content-pages"></a>4.1. Maintenance of existing Commerce Cloud content pages</h3>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module enables editors to maintain content pages that already exist in Commerce Cloud in FirstSpirit.
For this purpose, the content pages are displayed in ContentCreator via <em>Omnichannel Manager</em>, enabling them to be seamlessly integrated into the familiar FirstSpirit editorial process.</p>
</div>
<div class="paragraph">
<p>As well as <a href="#javascript">integrating <em>Omnichannel Manager</em></a>, which is an installation step, the presentation channel of the page and section templates must be completed in order to maintain content pages in FirstSpirit.
In addition, the relevant page template must also be modified in Commerce Cloud.</p>
</div>
<div class="sect3">
<h4 id="existingcpoutput"><a class="anchor" href="#existingcpoutput"></a>4.1.1. Page template</h4>
<div class="paragraph">
<p>Generally, content pages in a FirstSpirit project are edited based on a FirstSpirit page reference.
This reference and the page on which it is based must be created for content pages that already exist in Commerce Cloud.
In the <em>FirstSpirit Connect Reference Project</em>, the creation of this page reference and the associated page takes place in the background, in a process that is invisible to the editor.
The script <code>page_type_mapping</code> uses the page template of the Commerce Cloud page to determine the corresponding FirstSpirit page template, which is referenced in the <a href="#install_pset">project settings</a>.</p>
</div>
<div class="paragraph">
<p>When a content page is created, the ID of the associated Commerce Cloud page is stored in its form.
This ID is required to display the page in the preview.
The page template therefore contains the hidden input component <code>pt_cc_identifier</code>.
If additional page templates are added to the project, their form must also contain this input component.</p>
</div>
<div class="listingblock">
<div class="title">Input component pt_cc_identifier</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;CMS_INPUT_TEXT name="pt_cc_identifier" hFill="yes" hidden="yes" useLanguages="no"&gt;
   &lt;LANGINFOS&gt;
      &lt;LANGINFO lang="*" label="Commerce Cloud Identifier"/&gt;
   &lt;/LANGINFOS&gt;
&lt;/CMS_INPUT_TEXT&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code extract shows a shortened form of the presentation channel for the page template in the reference project:</p>
</div>
<div id="pagetemplatechannel" class="listingblock">
<div class="title">Presentation channel for the page template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">$CMS_TRIM(level:1)$
   $CMS_SET(json, {:})$
   $CMS_SET(previewId, previewId(element:#global.node))$
   $CMS_SET(void, json.put("previewId", "" + previewId))$
   $CMS_SET(void, json.put("pageRevisionId", #global.page.revision.id))$

   $CMS_SET(slotList, {:})$

   $CMS_IF(#global.page.body("stage_body").children.toList().size &gt; 0)$
      $CMS_SET(dynamicContent, {:})$
      $CMS_SET(content)$
         $CMS_TRIM(level:4)$$CMS_VALUE(#global.page.body("stage_body"))$$CMS_END_TRIM$
      $CMS_END_SET$
      $CMS_SET(stage_body, {:})$
      $CMS_SET(void, stage_body.put("content", content.toString))$
      $CMS_SET(void, stage_body.put("dynamic",
         if(dynamicContent.get("active") != null, dynamicContent.get("active"), false)))$
      $CMS_SET(void, slotList.put("stage_body", stage_body))$
   $CMS_END_IF$

   [...]

   $CMS_SET(void, json.put("slots", slotList))$
   $CMS_VALUE(json.toJSON)$
$CMS_END_TRIM$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page has three content areas - the <code>stage_body</code>, <code>tiles_body</code>, and <code>main_body</code> - and represents a <code>landingLayout2Page.jsp</code> page.
While the first two content areas are used to edit existing content from Commerce Cloud, the third allows further sections to be added.
In the reference project, the section templates <code>banner_section</code>, <code>category_teaser_section</code>, and <code>text_picture_section</code> are available for this purpose.
The content of these templates is added to the JSON object <code>slots</code> generated in the template.</p>
</div>
<div class="paragraph">
<p>For this purpose, two instructions are required for each content area to enable the system to distinguish between static and <a href="#dynamiccontent">dynamic content</a>.
Dynamic content can only be incorporated into combined text-image sections, as this is the only type of section that can include dynamic product data.
The section uses the link template <code>a_product_price_link</code>, with the value of the <code>active</code> parameter in the presentation channel configured as <code>true</code> for the <code>dynamicContent</code> variable.</p>
</div>
<div class="paragraph">
<p>In addition to the editorial content, the <code>previewId</code> and <code>pageRevisionId</code> of the page reference are also transferred to the JSON object created in the template:
The <code>previewId</code> is stored in the <code>PAGE_PREVIEW_DATA</code> object in the template in Commerce Cloud, and is used to identify the page reference.
Identification takes places via the <a href="#javascript">JavaScript of <em>Omnichannel Manager</em></a>.
The <code>pageRevisionId</code> is a technical dependency field and ensures that <a href="#dynamiccontent">dynamic content</a> is always displayed correctly in ContentCreator.</p>
</div>
<div class="paragraph">
<p>The JSON object is part of the <em>CaaS</em> item to be generated and can be read out within the <a href="#ccpagetemplate">Commerce Cloud templates</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="fssectiontemplate"><a class="anchor" href="#fssectiontemplate"></a>4.1.2. Section template</h4>
<div class="paragraph">
<p>The slots contained within a Commerce Cloud page are represented in FirstSpirit by the sections <code>banner_section</code>, <code>category_teaser_section</code>, and <code>text_picture_section</code>.
If a corresponding content page is to be created in the FirstSpirit project for an existing Commerce Cloud page, the relevant sections are created automatically and populated with the existing content.</p>
</div>
<div class="paragraph">
<p>The following code extract shows the presentation channel for the text-image section from the reference project:</p>
</div>
<div class="listingblock">
<div class="title">Presentation channel for the text-image section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div data-preview-id="$CMS_VALUE(previewId())$"&gt;
   [...]
   &lt;div class="yCmsComponent" style="margin: 20px;"&gt;
      $CMS_IF(!st_headline.isEmpty())$
         &lt;h1 style="text-align:center;"&gt;$CMS_VALUE(st_headline.convert2)$&lt;/h1&gt;
      $CMS_END_IF$

      $CMS_IF(!st_picture.isEmpty())$
         &lt;img
            data-preview-id="$CMS_VALUE(previewId(element:st_picture))$"
            class="js-responsive-image"
            style="margin: 20px;float:$CMS_VALUE(st_picturePosition, default:"left")$"
            $CMS_IF(!st_pictureDescription.isEmpty())$
               title="$CMS_VALUE(st_pictureDescription.convert2)$"
               alt="$CMS_VALUE(st_pictureDescription.convert2)$"
            $CMS_END_IF$
            data-media="{}"
            src="$CMS_REF(st_picture,resolution:"CATEGORY_TEASER_ITEM",abs:1)$"&gt;
      $CMS_END_IF$
      $CMS_IF(!st_text.isEmpty())$
         $CMS_VALUE(st_text)$
      $CMS_END_IF$
   &lt;/div&gt;
   [...]
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This section has various input components for entering a heading and text and adding an image with a definable position and image description.
The heading, text and image are displayed within a DIV, with a <code>data-preview-id</code> attribute configured to the value <code>$CMS_VALUE(previewId())$</code>.
This attribute serves to decorate and identify the section; again, this process is executed by the <a href="#javascript">JavaScript of <em>Omnichannel Manager</em></a>.
To enable media-specific actions, such as release or image cropping, the same attribute is also provided for the img tag.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em><a href="https://docs.e-spirit.com/tpp/index.html.en">Omnichannel Manager Manual</a></em> contains additional information on the use of the preview ID.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ccpagetemplate"><a class="anchor" href="#ccpagetemplate"></a>4.1.3. Commerce Cloud Page Template</h4>
<div class="paragraph">
<p>In FirstSpirit, the editorial content is created and edited in ContentCreator.
With the help of the <em>Omnichannel Manager</em>, the staged storefront of the Commerce Cloud is embedded in it.
The Staged Storefront in turn accesses the <em>Preview CaaS</em> and determines the current FirstSpirit contents from it.
This also applies to the online storefront and the <em>Online CaaS</em>.</p>
</div>
<div class="paragraph">
<p>This link requires modifications to the page template of the Commerce Cloud content page; these modifications are explained in this chapter.
The modifications are contained in the <code>landingLayout2Page.jsp</code> page, which is part of the delivery, and can be reproduced in this page.</p>
</div>
<div class="paragraph">
<p>The following code extract shows the querying of a <em>CaaS</em> item that is saved in the variable <code>caasItem</code>.
The first step of this process is to determine the <em>CaaS</em> collection in which the data is stored:
The FirstSpirit content pages from the reference project are always stored in the <em>contentpages</em> collection, while other content is stored in the standard collection <em>content</em>.</p>
</div>
<div class="listingblock">
<div class="title">Example - Querying of the CaaS item</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;%@ taglib prefix="caas" uri="/WEB-INF/tld/addons/fscontentconnect/caas.tld" %&gt;

&lt;c:choose&gt;
   &lt;c:when test="${cmsPage.typeCode == 'ContentPage'}"&gt;
      &lt;c:set var="caasCollection" value="contentpages"/&gt;
   &lt;/c:when&gt;
   &lt;c:otherwise&gt;
      &lt;c:set var="caasCollection" value="content"/&gt;
   &lt;/c:otherwise&gt;
&lt;/c:choose&gt;

&lt;caas:request itemId="${cmsPage.uid}" collection="${caasCollection}" var="caasItem" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To edit editorial content, ContentCreator displays the familiar EasyEdit buttons, which appear together with a frame while hovering.
Via Omnichannel Manager, ContentCreator can display external content.
However, <em>Omnichannel Manager</em> requires information from Commerce Cloud to highlight this content.
This information is read from a data object, which is populated via the corresponding page template in Commerce Cloud.</p>
</div>
<div class="paragraph">
<p>The following code extract shows an example of how this type of data object may be populated; the page type, preview ID, and page ID are transferred to this object.
The preview ID matches the ID of the previously determined <em>CaaS</em> item.
If it was not possible to query a <em>CaaS</em> item, the preview ID in the data object remains empty.</p>
</div>
<div class="listingblock">
<div class="title">Example - Population of a data object</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">[... Determine the CaaS item (see above) ...]

&lt;c:set var="pagePreviewId" value="${not empty caasItem and not empty caasItem['previewId'] ? caasItem['previewId'] : ''}"/&gt;

&lt;caas:whenFirstSpiritPreview&gt;
   &lt;script type="text/javascript"&gt;
      const PAGE_PREVIEW_DATA = {
         pageType: '${cmsPage.typeCode}',
         pagePreviewId: '${pagePreviewId}',
         pageId: '${cmsPage.uid}',
         pageTemplate: '${cmsPage.masterTemplate.uid}'
      };
   &lt;/script&gt;
&lt;/caas:whenFirstSpiritPreview&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For product detail pages, the product code must be defined as the page ID instead of the UID:</p>
</div>
<div class="listingblock">
<div class="title">Example - Defining the product code</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">const PAGE_PREVIEW_DATA = {
   [...]
   pageId: '${productCode}',
   [...]
};</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to determining the <em>CaaS</em> item and populating the data object, the output must also be defined.
As part of this process, a check is needed whether the previously determined <em>CaaS</em> item includes content for the relevant content area.
If this is not the case, fallback content can be defined.</p>
</div>
<div class="paragraph">
<p>The following code extract shows the definition of the output for the content area <code>stage_body</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example - Definition of output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;%@ taglib prefix="caas" uri="/WEB-INF/tld/addons/fscontentconnect/caas.tld" %&gt;

[... Determine the CaaS item and set the PAGE_PREVIEW_DATA object (see above) ...]

&lt;c:choose&gt;
   &lt;c:when test="${not empty caasItem and not empty caasItem['slots']['stage_body']}"&gt;
      &lt;div data-slot-name="stage_body"&gt;
         ${caasItem['slots']['stage_body']}
      &lt;/div&gt;
   &lt;/c:when&gt;
   &lt;c:otherwise&gt;
      &lt;div data-slot-name="stage_body" data-fs-content-editing&gt;
         &lt;cms:pageSlot position="Section1" var="feature"&gt;
            &lt;cms:component component="${feature}"/&gt;
         &lt;/cms:pageSlot&gt;
      &lt;/div&gt;
   &lt;/c:otherwise&gt;
&lt;/c:choose&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whether the outcome is positive or the fallback is applied, a Dom element must be defined to mark the FirstSpirit content area.
This element allows external content to be visually highlighted and maintained in ContentCreator.
The name of the content area must be transferred to the Dom element via the <code>data-slot-name</code> attribute.
In the event of a fallback, the Dom element also requires the attribute <code>data-fs-content-editing</code>.
This attribute controls the display of a plus button in ContentCreator, which shows the label <code>override content</code> or <code>add content</code> when hovering.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">override content</dt>
<dd>
<p>If the fallback is applied and existing content from Commerce Cloud is displayed, the button is displayed with the <code>override content</code> label while hovering.
This means that there is not yet any content in FirstSpirit for the content area.
For this reason, the existing content can only be overwritten and not edited.
The previously described code extract shows this option.</p>
<div class="imageblock">
<div class="content">
<img src="_images/overridecontent.png" alt="overridecontent">
</div>
<div class="title">Abbildung 16. override content button</div>
</div>
</dd>
<dt class="hdlist1">add content</dt>
<dd>
<p>If the fallback is applied and the Dom element does not contain any content, the button is displayed with the <code>add content</code> label while hovering.
This situation can arise when there is no content on an empty page for the area in Commerce Cloud, or if no content has been defined for the Dom element.
Within the <code>landingLayout2Page.jsp</code> page, which is included in the delivery, this option is used for the output of the <code>main_body</code> content area:</p>
<div class="listingblock">
<div class="title">Example - Fallback for output of main_body content area</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;c:choose&gt;
   &lt;c:when test="${not empty caasItem and not empty caasItem['slots']['main_body']}"&gt;
      [... show Content ...]
   &lt;/c:when&gt;
   &lt;c:otherwise&gt;
      &lt;div data-slot-name="main_body" data-fs-content-editing&gt;&lt;/div&gt;
   &lt;/c:otherwise&gt;
&lt;/c:choose&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/addcontent.png" alt="addcontent">
</div>
<div class="title">Abbildung 17. add content button</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="edit-new-content-pages"><a class="anchor" href="#edit-new-content-pages"></a>4.2. Maintaining content on new Commerce Cloud content pages</h3>
<div class="paragraph">
<p>The maintenance of content on new Commerce Cloud content pages is subject to the same requirements as the maintenance of <a href="#edit-existing-content-pages">existing Commerce Cloud content pages</a>.</p>
</div>
<div class="paragraph">
<p>However, the creation of new pages must be configured in the <a href="#configContent">project component</a>.
Once this configuration is complete, the familiar ContentCreator functions can be used to create new pages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>label</code> attribute of new Commerce Cloud content pages is set by the <em>FirstSpirit Connect</em> module and by default starts with a slash (<code>/</code>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dynamiccontent"><a class="anchor" href="#dynamiccontent"></a>4.3. Dynamic content</h3>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module allows the maintenance of dynamic content.
This content is code that is defined in the presentation channel of the FirstSpirit template and stored in the generated <em>CaaS</em> item.
This content is evaluated when the content area is output in the Commerce Cloud page template.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Modifications in FirstSpirit</strong></span></p>
</div>
<div class="paragraph">
<p>In the supplied reference project, the dynamic content is integrated via the link template <code>a_product_price_link</code>.
This can be used in text-image sections and uses the template language <a href="http://velocity.apache.org/">Apache Velocity</a> to integrate the name and price of a product.
To do so, it accesses the context objects <code>productOptions</code> and <code>productFacade</code>, which provides the <a href="#addon">add-on</a> in the storefront during the evaluation process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>productOptions</code> context object is a list of all values of the
<a href="https://help.sap.com/doc/a4265d5ea8314eb2929e6cf6fb8e35a5/1811/en-US/de/hybris/platform/commercefacades/product/ProductOption.html">ProductOption enum</a>.</p>
</li>
<li>
<p>The <code>productFacade</code> context object is a reference to the <a href="https://help.sap.com/doc/a4265d5ea8314eb2929e6cf6fb8e35a5/1811/en-US/de/hybris/platform/commercefacades/product/ProductFacade.html">ProductFacade</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code extract shows the presentation channel of the link template <code>a_product_price_link</code> in the reference project:</p>
</div>
<div class="listingblock">
<div class="title">Presentation channel for the link template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">$CMS_SET(productCode,lt_productRef.values.iterator.next.getValueMap().get("code"))$
$CMS_SET(void,dynamicContent.put("active",true))$
&lt;span data-dynamic-content="true"&gt;
   #set( $product = $productFacade.getProductForCodeAndOptions("$CMS_VALUE(productCode)$", $productOptions))
   #if( $product )
      &lt;a href="$CMS_RENDER(template:"product_link_render", prodRef:lt_productRef)$"&gt;
         $product.getName()
         #set( $priceData = $product.getPrice())
         #if ( $priceData )
            ($priceData.getFormattedValue())
         #end
      &lt;/a&gt;
   #end
&lt;/span&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the template, the first action is to determine the product code of the referenced product and to transfer it to the <code>getProductForCodeAndOptions</code> method together with the <code>productOptions</code> context object.
This step ensures that all product information is available within the <code>product</code> variable.
The <code>dynamicContent</code> variable is needed to determine the product information to be used in the generation of the <em>CaaS</em> item.
This variable is evaluated in the <a href="#existingcpoutput">FirstSpirit page template</a> and the <code>active</code> parameter must be set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Unlike static content, dynamic content is pulled from the staged storefront for display in ContentCreator, so it must be identifiable.
For this purpose, this content must be enclosed in a Dom element with the attribute <code>data-dynamic-content</code> set to <code>true</code>.
Furthermore, the page template must also indicate the <code>pageRevisionId</code>.
This ID is used to ensure that the revision of the <em>CaaS</em> item always corresponds to the pages displayed in ContentCreator and allows the content to be updated if necessary.
The dynamic content must be queried from the staged storefront as the initial evaluation of this content takes place in this location.
If the content were to be determined directly from FirstSpirit, like static content, ContentCreator would only show the code defined for it in the presentation channel.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Modifications in Commerce Cloud</strong></span></p>
</div>
<div class="paragraph">
<p>The code for dynamic content is evaluated in the <a href="#ccpagetemplate">Commerce Cloud page template</a>.
This evaluation is executed during access to the relevant content area within the result object of the <a href="#viewextension_tags">caas:request tag</a>; the process returns a string.
The output is therefore the same as that for static content and is defined as such.</p>
</div>
<div class="paragraph">
<p>The following code extract shows a shortened form of the definition of the output for the content area <code>stage_body</code> on the <code>landingLayout2Page.jsp</code> page, which is included in the delivery:</p>
</div>
<div class="listingblock">
<div class="title">Example - Definition of output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;%@ taglib prefix="caas" uri="/WEB-INF/tld/addons/fscontentconnect/caas.tld" %&gt;

[... Determine the CaaS item and set the PAGE_PREVIEW_DATA object (see above) ...]

&lt;c:choose&gt;
   &lt;c:when test="${not empty caasItem and not empty caasItem['slots']['stage_body']}"&gt;
      &lt;div data-slot-name="stage_body"&gt;
         ${caasItem['slots']['stage_body']}
      &lt;/div&gt;
   &lt;/c:when&gt;
   &lt;c:otherwise&gt;
      [...]
   &lt;/c:otherwise&gt;
&lt;/c:choose&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maintaining_content_on_product_detail_pages"><a class="anchor" href="#_maintaining_content_on_product_detail_pages"></a>4.4. Maintaining content on product detail pages</h3>
<div class="paragraph">
<p>To maintain content on product detail pages, in addition to the relevant <a href="#addon">storefront expansions</a>, the modifications to the presentation channel of the templates - as described in chapter <a href="#edit-existing-content-pages">Maintenance of existing Commerce Cloud content pages</a> - must also have been implemented.</p>
</div>
<div class="paragraph">
<p>Once these requirements are met, product detail pages can be maintained in the same way as content pages.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Product detail and content pages must be stored in different structure and content folders in FirstSpirit and in different collections in <em>CaaS</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deleting_content_pages_managed_in_firstspirit"><a class="anchor" href="#_deleting_content_pages_managed_in_firstspirit"></a>4.5. Deleting content pages managed in FirstSpirit</h3>
<div class="paragraph">
<p>When maintaining content on CCommerce Cloud content pages, FirstSpirit is the leading system used to manage and delete pages.
The FirstSpirit executable <code>CMSItemRemoval</code> can be used to delete these pages from Commerce Cloud.
This executable can be called up by entering an <code>itemUid</code> parameter that contains the UID of the page reference to be deleted.
Alternatively, the executable can be used within a workflow.
In such cases, ensure that a <code>trigger_finish_full</code> transition exists, as the executable will move on to this transition once deletion has been completed successfully.
This allows the deletion of pages from Commerce Cloud to be integrated into a deletion workflow.
The following code extract shows the call-up of the executable within a script.</p>
</div>
<div class="listingblock">
<div class="title">Call-up of the CMSItemRemoval executable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">#!executable-class
com.espirit.moddev.contentconnect.sap.module.catalogs.cmsitem.CMSItemRemoval</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After deleting a page, the editor is redirected to the start page.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_product_referencing"><a class="anchor" href="#_product_referencing"></a>4.6. Product referencing</h3>
<div class="paragraph">
<p>Product referencing requires modifications to the <a href="#productform">form</a> and <a href="#productchannel">presentation channel</a> of a template.</p>
</div>
<div class="sect3">
<h4 id="productform"><a class="anchor" href="#productform"></a>4.6.1. Form</h4>
<div class="paragraph">
<p>To reference products in a template, this template must first include the appropriate form.
The form requires an <code>FS_INDEX</code> component to store the product ID as a minimum.</p>
</div>
<div id="template-form" class="listingblock">
<div class="title">Form</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;CMS_MODULE&gt;
   &lt;FS_INDEX name="st_products"&gt;
      &lt;LANGINFOS&gt;
         &lt;LANGINFO lang="*" label="Products"/&gt;
      &lt;/LANGINFOS&gt;
      &lt;SOURCE name="ContentConnectSAPCommerceCloud/ContentConnectSAPCommerceCloud_ProductDataAccessPlugin"/&gt;
   &lt;/FS_INDEX&gt;
&lt;/CMS_MODULE&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="productchannel"><a class="anchor" href="#productchannel"></a>4.6.2. Presentation channel</h4>
<div class="paragraph">
<p>The presentation channel permits access to the <a href="#productform"><code>FS_INDEX</code> component</a> and the referenced products it contains.
Each element of the <code>FS_INDEX</code> component provides methods for querying information on the relevant product and, for example, to output this information.</p>
</div>
<div class="listingblock">
<div class="title">Use of a product in the presentation channel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">$CMS_FOR(for_product, st_products.values())$
   $CMS_VALUE(for_product.getValueMap().get("name_de"))$
$CMS_END_FOR$</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 2. Methods</caption>
<colgroup>
<col style="width: 16.129%;">
<col style="width: 16.129%;">
<col style="width: 16.129%;">
<col style="width: 51.613%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Return value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">get</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name: String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the value of the stated attribute or <code>null</code> if the attribute does not exist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getValueMap</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, String&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a map of all attributes of the product.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The description of the <a href="https://help.sap.com/doc/adfb51f81d064d95a5cc925140553000/1808/en-US/smartedit/cmswebservices/index.html#_productwsdto">ProductWsDTOs</a>
in the <code>Cmswebservices API</code> provides an overview of the available attributes and their identifiers.</p>
</div>
<div class="paragraph">
<p>Some attributes, such as <code>name</code>, contain language-dependent values.
For this reason, their identifier must be expanded for the purposes of the query: <code>name_de</code>.</p>
</div>
<div class="paragraph">
<p>The code extract <a href="#product-link-template">Use of the product code within a product link template</a> shows an example of how the product code can be used to link a product.
It uses various input components from the project settings, which are defined as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 3. Input components in the project settings</caption>
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value (example)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_hybrisAcceleratorName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yb2bacceleratorstorefront</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Commerce Cloud storefront</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_hybrisSiteName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">powertools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Commerce Cloud site</p></td>
</tr>
</tbody>
</table>
<div id="product-link-template" class="listingblock">
<div class="title">Use of the product code within a product link template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">$CMS_IF(!lt_ref.isEmpty &amp;&amp; !lt_ref.values.isEmpty)$
   $CMS_VALUE(ps_hybrisAcceleratorName.replace("/", ""))$/$CMS_VALUE(ps_hybrisSiteName.replace("/", ""))$/$CMS_VALUE(#global.language.abbreviation.toLowerCase())$/p/$CMS_VALUE(lt_ref.values.iterator.next.getValueMap().get("code"))$
$CMS_END_IF$</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_category_referencing"><a class="anchor" href="#_category_referencing"></a>4.7. Category referencing</h3>
<div class="paragraph">
<p>Category referencing requires modifications to the <a href="#categoryform">form</a> and <a href="#categorychannel">presentation channel</a> of a template.</p>
</div>
<div class="sect3">
<h4 id="categoryform"><a class="anchor" href="#categoryform"></a>4.7.1. Form</h4>
<div class="paragraph">
<p>To reference categories in a template, this template must first include the appropriate form.
The form requires an <code>FS_INDEX</code> component to store the category ID as a minimum.</p>
</div>
<div class="listingblock">
<div class="title">Form</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;CMS_MODULE&gt;
   &lt;FS_INDEX name="st_categories" useLanguages="no"&gt;
      &lt;LANGINFOS&gt;
         &lt;LANGINFO lang="*" label="Categories"/&gt;
      &lt;/LANGINFOS&gt;
      &lt;SOURCE name="ContentConnectSAPCommerceCloud/ContentConnectSAPCommerceCloud_CategoryDataAccessPlugin"/&gt;
   &lt;/FS_INDEX&gt;
&lt;/CMS_MODULE&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="categorychannel"><a class="anchor" href="#categorychannel"></a>4.7.2. Presentation channel</h4>
<div class="paragraph">
<p>The presentation channel permits access to the <a href="#categoryform"><code>FS_INDEX</code> component</a> and the referenced categories it contains.
Each element of the <code>FS_INDEX</code> component is an object of type <code>com.espirit.moddev.contentconnect.sap.module.catalogs.productcatalogs.Category</code>,
which is described in the JavaDoc of the API included in delivery.</p>
</div>
<div class="paragraph">
<p>The following code extract shows an example use of a category in the presentation channel:</p>
</div>
<div class="listingblock">
<div class="title">Use of a category in the presentation channel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">$CMS_FOR(for_category, st_categories.values())$
   $CMS_VALUE(for_category.getName(#global.language))$
$CMS_END_FOR$</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generating_the_navigation_structure"><a class="anchor" href="#_generating_the_navigation_structure"></a>4.8. Generating the navigation structure</h3>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module allows the navigation structure to be generated in FirstSpirit.
The generation process produces a JSON document in <em>CaaS</em>.</p>
</div>
<div class="paragraph">
<p>To use this function, a navigation function that generates the JSON document is required.
The following code extract shows an example of this kind of function, taking into account all of the elements in the structure folder <code>contentpages</code>.</p>
</div>
<div id="navigation-function" class="listingblock">
<div class="title">Navigation function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;CMS_HEADER&gt;
   &lt;CMS_FUNCTION name="Navigation" resultname="nav"&gt;
      &lt;CMS_PARAM name="root" value="pagefolder:contentpages" /&gt;
      &lt;CMS_PARAM name="expansionVisibility" value="all"/&gt;
      &lt;CMS_PARAM name="siteMap" value="0" /&gt;
      &lt;CMS_ARRAY_PARAM name="beginHTML"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..4"&gt;{&lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
      &lt;CMS_ARRAY_PARAM name="delimiter"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..4"&gt;,&lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
      &lt;CMS_ARRAY_PARAM name="selectedDelimiter"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..4"&gt;,&lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
      &lt;CMS_ARRAY_PARAM name="innerBeginHTML"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..3"&gt;,"children":[&lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
      &lt;CMS_ARRAY_PARAM name="unselectedHTML"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..4"&gt;
            "label":"$CMS_VALUE(#nav.label)$",
            "id":"$CMS_VALUE(#nav.id)$",
            "pageRef":"$CMS_VALUE(#nav.ref.getUid())$"
         &lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
      &lt;CMS_ARRAY_PARAM name="selectedHTML"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..4"&gt;
            "label":"$CMS_VALUE(#nav.label)$",
            "id":"$CMS_VALUE(#nav.id)$",
            "pageRef":"$CMS_VALUE(#nav.ref.getUid())$"
         &lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
      &lt;CMS_ARRAY_PARAM name="innerEndHTML"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..3"&gt;]&lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
      &lt;CMS_ARRAY_PARAM name="endHTML"&gt;
         &lt;CMS_ARRAY_ELEMENT index="0..4"&gt;}&lt;/CMS_ARRAY_ELEMENT&gt;
      &lt;/CMS_ARRAY_PARAM&gt;
   &lt;/CMS_FUNCTION&gt;
&lt;/CMS_HEADER&gt;{"navigation":[$CMS_IF(!nav.isEmpty)$$CMS_VALUE(nav)$$CMS_END_IF$]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The execution of this function requires a page and a page reference based on this page, which must also be created.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The page reference must contain the reference name <code>main_navigation</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The navigation function shown only incorporates the start page of a menu level.
If you wish to incorporate all page references, the function must be modified accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each time an element is created, modified, moved, or deleted in the structure area, the <em>FirstSpirit Connect</em> module starts generating the page reference <code>main_navigation</code>.
As a result, the document in <em>CaaS</em> always reflects the most up-to-date navigation structure in FirstSpirit.
The <em>CaaS</em> configuration for the higher level structure folder determines which collection the document will be stored in.
The name of the document saved in <em>CaaS</em> is <code>main_navigation_&lt;LANGUAGE&gt;</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="productreport"><a class="anchor" href="#productreport"></a>4.9. Selection of a product or a category</h3>
<div class="paragraph">
<p>The module provides a product and a category report in ContentCreator.
These reports present the products and categories originating from <em>Commerce Cloud</em>.
The lists can be filtered via the search field in the report.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/reports.png" alt="reports">
</div>
<div class="title">Abbildung 18. Products and categories in the report</div>
</div>
</div>
<div class="sect2">
<h3 id="_inclusion_of_a_product_or_category"><a class="anchor" href="#_inclusion_of_a_product_or_category"></a>4.10. Inclusion of a product or category</h3>
<div class="paragraph">
<p>A product or category can be dragged from the report and dropped into an <code>FS_INDEX</code> input component in the editing dialog.
Alternatively, the component has an <b class="button">Add</b> button which opens a selection dialog.
This dialog lists all the available products and categories.</p>
</div>
<div class="paragraph">
<p>The selection is saved using the button of the same name.</p>
</div>
</div>
<div class="sect2">
<h3 id="_calling_up_a_content_page_or_productcategory_detail_page"><a class="anchor" href="#_calling_up_a_content_page_or_productcategory_detail_page"></a>4.11. Calling up a content page or product/category detail page</h3>
<div class="paragraph">
<p>Content pages as well as product and category detail pages can be accessed via the shop navigation and via the product, category or search report.
In the report, these pages are called up by clicking on one of them.
Thereby detail pages that are not yet available in the shops main navigation can also be called up.</p>
</div>
<div class="paragraph">
<p>To determine the URL of product and category detail pages, the reports use the URLs from the fields <a href="#pdp_url"><code>PDP URL</code></a> and <a href="#cdp_url"><code>CDP URL</code></a>
that must be specified during the configuration of the project component.<br>
Content pages can have specific URLs that are optionally specified during the definition of the <a href="#template_mappings"><code>Template Mappings</code></a>.
If a content page does not have a specific URL, the general <a href="#contentpage_url"><code>Contentpage URL</code></a> is used for it instead.
If one of these fields contains a relative URL, this is converted into an absolute URL based on the URL of the current shop page.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Wichtig"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The product report shows all of the products in the configured product catalog.
This means that the detail pages of all products in the catalog must be accessible.
To ensure that this is the case, the <a href="#searchrestrictions">configuration of the FlexibleSearch Restrictions</a> must be checked.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal_notices"><a class="anchor" href="#_legal_notices"></a>5. Legal notices</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>FirstSpirit Connect for SAP Commerce Cloud</em> is a product of e-Spirit AG, Dortmund, Germany.<br>
Only a license agreed upon with e-Spirit AG is valid with respect to the user for using the module.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_help"><a class="anchor" href="#_help"></a>6. Help</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://help.e-spirit.com/">Technical Support</a> of the e-Spirit AG provides expert technical support covering any topic related to the FirstSpirit product.
You can get and find more help concerning relevant topics in our <a href="https://community.e-spirit.com/">community</a>.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
