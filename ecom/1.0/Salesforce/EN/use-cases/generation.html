<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/ecom/1.0/Salesforce/EN/use-cases/generation.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../../_'</script>
    <link rel="icon" href="../../../../../_/img/shortcut-icon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://e-spirit.github.io/Antora/cloud/1.0/index.html">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS/CaaS_FSM_Documentation_EN.html">CaaS</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Connect/CaaS_Connect_FSM_Documentation_EN.html">CaaS Connect</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Platform/CaaS_Platform_Documentation_EN.html">CaaS Platform</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_FSM/index.html">Navigation Service (FSM)</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_Platform/documentation.html">Navigation Service (Platform)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/chapters/introduction.html">Spartacus</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Salesforce/index.html">Salesforce</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/SAP_Classic/firstspiritconnect-sap-documentation_EN.html">SAP Classic</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <a class="navbar-item" href="https://e-spirit.github.io/Antora/dxm/1.0/index.html">DXM</a>
        <a class="navbar-item" href="https://community.crownpeak.com/t5/DQM/ct-p/dqm">DQM</a>
        <a class="navbar-item" href="https://community.crownpeak.com/t5/DG/ct-p/dg">DG</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ecom" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">E-Commerce</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../Spryker/index.html">Spryker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spryker/EN/spryker-installation/spryker-installation.html">Spryker - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spryker/EN/fs-installation/fs-installation.html">FirstSpirit - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spryker/EN/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spryker/EN/use-cases/use-cases.html">Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spryker/EN/legal-notice.html">Legal Notice</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spartacus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../Spartacus/chapters/introduction.html">Main Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/sapcc-installation/sapcc-installation.html">Spartacus - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/fs-installation/fs-installation.html">FirstSpirit - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/use-cases/use-cases.html">Use Cases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spartacus/FS_Connect_SAP_hl_ServeradminManual_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Salesforce</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SAP Classic</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../SAP_Classic/firstspiritconnect-sap-documentation_EN.html">Main Documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../SAP_Classic/firstspiritconnect-sap-admindoc_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">E-Commerce</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../dxm/1.0/index.html">DXM</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../dxm/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../cloud/1.0/index.html">FirstSpirit Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../cloud/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../headless/1.0/index.html">Headless</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../headless/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/ecom/edit/main/modules/Salesforce/pages/EN/use-cases/generation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect2">
<h3 id="generation"><a class="anchor" href="#generation"></a>Generation</h3>
<div class="paragraph">
<p>In order to deploy editorial content, {fs} generates two XML files, which contain content assets and <a href="#slot_configuration">slot configurations</a>, and are transferred to the {ccloud}.
The corresponding <a href="#generation_and_deployment">generation and deployment schedule</a> has already been described.
This description also explains that templates in their presentation channels populate XML collectors with content (content assets) and <a href="#slot_configuration">slot configurations</a>.
These collectors are initialized in the <a href="#project_settings">project settings</a>.
All content and configurations to be deployed must be written to the XML collectors.
Otherwise, they will not be transferred.</p>
</div>
<div class="paragraph">
<p>One asset and one slot configuration are typically generated for each section, allowing for personalization at the section level.
<a href="#contentpage">Content pages</a> are the only exception.
In this case, a total of precisely one content asset and one slot configuration are created.</p>
</div>
<div class="paragraph">
<p>This chapter explains how the content and configurations of the project are collected and the XML files generated.</p>
</div>
<div class="sect3">
<h4 id="_content_assets"><a class="anchor" href="#_content_assets"></a>Content Assets</h4>
<div class="paragraph">
<p>Populating the XML collector for content assets involves the following steps:</p>
</div>
<div class="paragraph">
<p><strong>Generating a content asset ID using a project-wide convention</strong></p>
</div>
<div class="paragraph">
<p>In the reference project, the ID of a content asset is comprised of a project-wide prefix, the ID of the generated page reference, and the section ID.
These components are separated from one another by means of a hyphen and any underscores are substituted with hyphens.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case of a content page the content asset ID simply consists of the prefix and the ID of the generated page reference.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(set_xml_id, ps_dwAssetIdPrefix + "-" + #global.node.uid + "-" + #global.section.id)$
$CMS_SET(set_xml_id, set_xml_id.replaceAll("_","-"))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Creating a new content asset in the XML collector</strong></p>
</div>
<div class="paragraph">
<p>Once the ID has been determined, a new content asset is created in the XML collector using the <code>useOrCreateContentNode</code> method.
This asset must be populated with the content of all generated languages during the full generation.
For this reason, <code>useOrCreateContentNode</code> only generates a new asset if no asset with the specified ID already exists.
All subsequent method calls on the XML collector then operate on this asset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.useOrCreateContentNode(set_xml_id))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a new content asset is created, the <code>fsGenerationTime</code> custom attribute is automatically added along with the current time stamp of the generation.
This is necessary to ensure that the <a href="#sfcccleanup">content cleanup</a> only deletes obsolete content assets from the {ccloud} after deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The value of this attribute must not be changed manually following this.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="generationlocale" class="paragraph">
<p><strong>Determining the locale</strong></p>
</div>
<div class="paragraph">
<p>Some of the following actions require a locale to be specified for the {ccloud}.
For this purpose, the <em>language_mapping</em> format template maps a {fs} language onto a locale of this kind, and is therefore included in each page.
In the template, two variables are generated in the context of the page: <code>set_previewLang</code> and <code>set_xml_lang</code>.
The first of these is used for generating the preview and has the format <code>&lt;language_COUNTRY&gt;</code>.
An example of a potential value is <code>fr_FR</code>.
The <a href="#hp">Homepage</a> chapter also describes this aspect of the template in greater detail.</p>
</div>
<div class="paragraph">
<p>The <code>set_xml_lang</code> variable is used during the process of populating the content assets.
Its value for the master language is x-<code>default</code>.
In all other cases, it assumes the value of <code>set_previewLang</code>, but substitutes the underscore with a hyphen.</p>
</div>
<div class="paragraph">
<p>Since both variables are set in the context of the generated page, they are available in all sections of the page and can therefore be used both for generating the preview and for populating the XML collectors.</p>
</div>
<div class="paragraph">
<p><strong>Setting the display-name property</strong></p>
</div>
<div class="paragraph">
<p>For each language, the display name of the generated page reference corresponds to the display name of the associated content asset, which is set during generation by means of the <code>addContentAttribute</code> method.
The <code>set_xml_lang</code> variable described above is required for this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addContentAttribute({
    "name":"display-name",
    "value":#global.node.getDisplayName(#global.language).toString(),
    "attributes":{
        "xml:lang":set_xml_lang
    }
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting the searchable-flag property to true</strong></p>
</div>
<div class="paragraph">
<p>The content asset needs to be included in the search index of the {ccloud}, which is why the <code>searchable-flag</code> attribute is set to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addContentAttribute({
    "name":"searchable-flag",
    "value":"true"
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting the online-flag property to true</strong></p>
</div>
<div class="paragraph">
<p>The asset also needs to be available in the shop, which is why the <code>online-flag</code> attribute is also set to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addContentAttribute({
    "name":"online-flag",
    "value":"true"
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting the body property</strong></p>
</div>
<div class="paragraph">
<p>The editorial content from {fs} is saved in the <code>body</code> custom attribute.
The <code>set_xml_body</code> variable is first created in the reference project, and the rendered content is then stored in this variable.
The variable is then transferred to the XML collector.
The collector automatically embeds the content in a CDATA section, which means that no special preparation is required.
Since the content is language-dependent, the locale in <code>set_xml_lang</code> is used in this step too.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addCustomAttribute({
    "id":"body",
    "cdata":set_xml_body.toString(),
    "attributes":{
        "xml:lang":set_xml_lang
    }
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Folder</strong></p>
</div>
<div class="paragraph">
<p>The {ccloud} makes it possible to specify a library folder in which it is to store a content asset.
For this purpose, the XML collector provides the <code>addFolderAttribute</code> method, which receives the ID of this kind of folder.
In the reference project, the folder containing all the content assets for a page is stored in the form for the page itself.
Each page template transfers the value of the corresponding form field to the <code>set_parent_id</code> variable.
The sections then use this variable to generate their assets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addFolderAttribute({
    "id":set_parent_id
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Folders that are referenced in this way must be identified to the {ccloud} by means of corresponding nodes in the generated XML file.
This allows the {ccloud} to create any missing folders.
The <a href="#xml_generation">XML</a> template takes responsibility for this task, and generates a defined set of folders.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unless any additional measures are taken, only the IDs of these folders can be reliably used in the reference project when generating content assets.
This is because {fs} is only able to guarantee that precisely these folders exist.
In the reference project, the corresponding form elements are therefore hidden in the page templates and assigned fallback values.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_slot_configurations"><a class="anchor" href="#_slot_configurations"></a>Slot configurations</h4>
<div class="paragraph">
<p>The XML collector for <a href="#slot_configuration">slot configurations</a> is populated in the <em>Slot Configuration</em> link template.
Therefore, both pages as well as sections output the corresponding form elements directly via <code>$CMS_VALUE$</code> calls:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_IF(!st_slotConfig.isEmpty)$
    $CMS_FOR(_slotConfig,st_slotConfig)$
        $CMS_VALUE(_slotConfig)$
    $CMS_END_FOR$
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML for slot configurations is manually assembled in the <em>Slot Configuration</em> template and written to the appropriate collector using the <code>addXml</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollectorContentSlot.addXml(null, set_slotConfig.toString(), null))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the process of creating the content asset, the <code>fsGenerationTime</code> custom attribute is automatically added to a slot configuration along with the current time stamp of the generation.
This is necessary to ensure that the <a href="#sfcccleanup">content cleanup</a> only deletes obsolete slot configurations from the {ccloud} after the deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The value of this attribute must not be changed manually following this.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="xml_generation"><a class="anchor" href="#xml_generation"></a>Generating the XML files</h4>
<div class="paragraph">
<p>Both generated XML files are based on the XML page template, which reads out the collected content and slot configurations from the XML collectors.
For this purpose, the <a href="#schedule">deployment schedule</a> performs three generations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <a href="#fdeployment">full generation</a> for populating the XML collectors,</p>
</li>
<li>
<p>a <a href="#pdeployment">partial generation</a> for writing the content assets to an XML file, and</p>
</li>
<li>
<p>a <a href="#pdeployment">partial generation</a> for writing the slot configurations to an XML file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The full generation must be completed before {fs} can generate the XML files, which is why this step cancels the generation of the XML template.
This is done using the <code>dwre_xmlGeneration</code> schedule variable, which has the value <code>false</code> in the <a href="#fdeployment">full generation</a> and the value <code>true</code> in both <a href="#pdeployment">partial generations</a>.</p>
</div>
<div class="paragraph">
<p>Since both files are based on the same template, a feature is necessary in order to determine which XML collector is read out.
This feature is the <code>ps_importType</code> form field, which can assume the <code>content_library</code> and <code>content_slot</code> values.</p>
</div>
<div class="paragraph">
<p>In the case of <code>content_library</code>, a defined set of library folders is first written to the XML collector for content assets.
The <code>getXml</code> method is then executed on this collector and the result - an XML document - is output via a <code>$CMS_VALUE$</code> call.
If <code>ps_importType</code> has the value <code>content_slot</code>, <code>getXml</code> is called up on the collector for slot configurations instead and the result is also output.</p>
</div>
<div class="paragraph">
<p>The <code>{modulname} Technical Pages</code> content folder contains two pages that are based on the <em>XML</em> template:
<code>Shop Assets</code>, for which <code>ps_importType</code> has the value <code>content_library</code>, and <code>Shop Slot Configurations</code>, for which this form field is set to <code>content_slot</code>.
These pages form the basis of the <code>Shop Assets</code> and <code>Shop Slot Configurations</code> page references in the <code>{modulname} Export Files</code> structure folder;
a <a href="#pdeployment">partial generation</a> is executed for each of these page references.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../../../../_/js/site.js"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
