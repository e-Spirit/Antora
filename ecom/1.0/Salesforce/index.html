<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ContentConnect: For Salesforce Commerce Cloud :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/ecom/1.0/Salesforce/index.html">
    <meta name="description" content="Dieses Dokument enthält die Dokumentation für das {modulname}-Modul von {fs}.">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/shortcut-icon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/index.html">Spartacus</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Crownpeak</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ecom" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">E-Commerce</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../Spryker/index.html">Spryker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/spryker-installation/spryker-installation.html">Spryker - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/fs-installation/fs-installation.html">FirstSpirit - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/use-cases/use-cases.html">Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spryker/EN/legal-notice.html">Legal Notice</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spartacus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../Spartacus/chapters/introduction.html">Main Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/sapcc-installation/sapcc-installation.html">Spartacus - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/fs-installation/fs-installation.html">FirstSpirit - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Spartacus/chapters/use-cases/use-cases.html">Use Cases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Spartacus/FS_Connect_SAP_hl_ServeradminManual_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html">Salesforce</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SAP Classic</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../SAP_Classic/firstspiritconnect-sap-documentation_EN.html">Main Documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../SAP_Classic/firstspiritconnect-sap-admindoc_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">E-Commerce</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../headless/1.0/index.html">Headless</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../headless/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">E-Commerce</a></li>
    <li><a href="index.html">Salesforce</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/ecom/edit/main/modules/Salesforce/pages/index.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">ContentConnect: For Salesforce Commerce Cloud</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FirstSpirit is used for creating versatile and project-specific content.
Thanks to the <em>ContentConnect</em> module, it is now possible to transfer this content to the Salesforce Commerce Cloud e-commerce shop system and use it there.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the remainder of this document, the abbreviated form &#8220;Commerce Cloud&#8221; will be used instead of &#8220;Salesforce Commerce Cloud&#8221;.
This abbreviated form refers to Salesforce Commerce Cloud in all cases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The module combines the functional strengths of both systems,
delivering the key advantages that each offers and creating a highly effective overall system made up of two areas that work in parallel and are largely decoupled from one another:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Components on the FirstSpirit side</em></dt>
<dd>
<p>These components are used for creating and maintaining editorial data, which is transferred to Commerce Cloud in the form of XML files and media.</p>
</dd>
<dt class="hdlist1"><em>Components on the Commerce Cloud side</em></dt>
<dd>
<p>These components are used for processing editorial content created in FirstSpirit.
Commerce Cloud integrates this data into the shop and transfers it to the live state.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A part of the delivery of the <em>ContentConnect</em> module is a StarterPackage, including a reference project and various cartridge components, which in large part are set up on the Storefront Reference Architecture.
This documentation is consistently based on the reference project and provides an explanation of the functions made available by the module using common use cases.
Description is given from the view of an editor as well as a FirstSpirit developer.</p>
</div>
<div class="sect2">
<h3 id="_range_of_functions"><a class="anchor" href="#_range_of_functions"></a>1.1. Range of functions</h3>
<div class="paragraph">
<p><em>ContentConnect</em> allows editors to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create native Commerce Cloud content using FirstSpirit</p>
</li>
<li>
<p>Access product information via the <code>Open Commerce API</code> (OC API)</p>
</li>
<li>
<p>Display shop elements and editorial content in the FirstSpirit preview simultaneously</p>
</li>
<li>
<p>Transfer content to the Commerce Cloud storage location via <code>WebDAV</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding functions are made available in both the SiteArchitect and the ContentCreator when the module is installed and configured.</p>
</div>
<div class="paragraph">
<p>Familiar FirstSpirit tools are used to maintain the content, meaning that editors who are already familiar with FirstSpirit do not require any additional knowledge.
The content is made available to Commerce Cloud as part of a deployment so that it can be imported.
Commerce Cloud then transfers the information to the live state.</p>
</div>
<div class="paragraph">
<p>As far as Commerce Cloud is concerned, this means there is no difference when it comes to delivering editorial content to the live state.
Even if the FirstSpirit server is shut down because of maintenance work, for example, this has no effect on Commerce Cloud.</p>
</div>
</div>
<div class="sect2">
<h3 id="_architecture"><a class="anchor" href="#_architecture"></a>1.2. Architecture</h3>
<div class="paragraph">
<p>FirstSpirit and Commerce Cloud are linked by an architecture made up of a range of components (see figure <a href="#img_architecture">Architecture</a>).
These components are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The modules installed on the FirstSpirit server:</p>
<div class="ulist">
<ul>
<li>
<p>ContentConnect module</p>
</li>
<li>
<p>WebDAV module</p>
</li>
<li>
<p>JSTL module</p>
</li>
</ul>
</div>
</li>
<li>
<p>Commerce Cloud instances (Staging &amp; Production)</p>
</li>
</ul>
</div>
<div id="img_architecture" class="imageblock">
<div class="content">
<img src="_images/architecture.png" alt="architecture">
</div>
<div class="title">Figure 1. Architecture</div>
</div>
<div class="paragraph">
<p>The individual components always interact in accordance with the following schema:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The editorial content is created and edited in FirstSpirit.
The content replaces placeholders in the HTML framework; however, the framework - like the products displayed on the live page - comes from Commerce Cloud.
It is transferred via <code>https</code> to FirstSpirit, where it is required in order to display the preview in full.
For product and category pages, this also requires communication with controllers that are part of the delivered cartridge.
Products are transferred to FirstSpirit via the <code>OC API</code> interface of the Commerce Cloud Staging instance.
This interface is also used to start various actions in the Commerce Cloud.</p>
</li>
<li>
<p>All content changes carried out in FirstSpirit are made available to the Commerce Cloud Staging instance via <code>WebDAV</code> as part of a deployment.
They are stored in various <code>WebDAV</code> directories in the form of media and XML files.
From this point, they are then imported into the Commerce Cloud Staging instance library via jobs, which are initiated by a deployment action.</p>
</li>
<li>
<p>This library is replicated in the live Commerce Cloud instance together with the product catalog.
As far as Commerce Cloud is concerned, this means there is no difference when it comes to delivering editorial content to the live state.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Commerce Cloud thus represents the main component in this architecture.
It delivers the content that has been created and/or maintained in FirstSpirit to the customer and provides all shop functions.
There is only one loose link between the two systems; they primarily work in parallel with one another.
If the FirstSpirit server is shut down because of maintenance work, for example, this has no effect on Commerce Cloud.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concept"><a class="anchor" href="#_concept"></a>1.3. Concept</h3>
<div class="paragraph">
<p>The <em>ContentConnect</em> module enables editorial content to be maintained in FirstSpirit and this to be transferred into Commerce Cloud via deployment.
For this, the processing of content in both systems must be coordinated and be mutually compatible.
The sub-chapters below describe the underlying concept used to achieve this compatibility.</p>
</div>
<div class="sect3">
<h4 id="slot_concept"><a class="anchor" href="#slot_concept"></a>1.3.1. Pages</h4>
<div class="paragraph">
<p>Similar to FirstSpirit, the pages in Commerce Cloud are based on a structure of various components.
To enable editorial content to be exchanged between both systems, these components must be coordinated.</p>
</div>
<div class="paragraph">
<p>Within the reference project <em>ContentConnect Reference Project</em> included in the delivery, the slots are represented by the content areas of a page template.
Sections can be added to them; each one corresponds to an asset and, depending on the use cases, also has a slot configuration (see figure <a href="#rendering">Page Rendering</a>).
With the aid of these configurations, it is possible to define which target group can see the corresponding content, or for how long this remains visible, for example.
Each slot configuration refers to exactly one asset.</p>
</div>
<div class="paragraph">
<p>With FirstSpirit assets can thus be generated that are displayed on a page via slots.</p>
</div>
<div id="rendering" class="imageblock">
<div class="content">
<img src="_images/salesforce.png" alt="salesforce">
</div>
<div class="title">Figure 2. Page Rendering</div>
</div>
</div>
<div class="sect3">
<h4 id="_preview"><a class="anchor" href="#_preview"></a>1.3.2. Preview</h4>
<div class="paragraph">
<p>The integration effected by the <em>ContentConnect</em> module only allows FirstSpirit to generate and maintain editorial content and to publish it in the form of assets.
Commerce Cloud, however, continues to determine the framework of a page, whose slots integrate the generated assets.</p>
</div>
<div class="paragraph">
<p>To present the preview of a page, FirstSpirit therefore determines its current view in Commerce Cloud Storefront and downloads the HTML.
The slots it contains are uniquely labeled with HTML comments.
FirstSpirit substitutes these areas with the appropriate editorial content and displays the result in the preview.</p>
</div>
</div>
<div class="sect3">
<h4 id="_velocity"><a class="anchor" href="#_velocity"></a>1.3.3. Velocity</h4>
<div class="paragraph">
<p>Salesforce provides the <code>Content Integration API (CI API)</code> as an alternative to the <a href="#slot_concept">slot-based approach</a> described previously.
This API enables Velocity fragments to be evaluated on the Salesforce side, and therefore provides an easy way of implementing business logic on a page.
In addition, it affords editors more control over the page layout than they have in the slot-based approach.
The Velocity fragments, including the business logic, are maintained within FirstSpirit.</p>
</div>
</div>
<div class="sect3">
<h4 id="_languages"><a class="anchor" href="#_languages"></a>1.3.4. Languages</h4>
<div class="paragraph">
<p>Editorial content is maintained in different languages on both the Salesforce and the FirstSpirit side.
For integration, an assignment between the languages of both systems is therefore required.
For this, a convention has been adopted for the languages used in the reference project, which relates to their abbreviation defined in FirstSpirit.
This is oriented towards the existing languages in Salesforce and ensures every abbreviation is designated in accordance with the formula <code>LANGUAGE CODE_COUNTRY CODE</code> (see figure <a href="#img_languages">Languages</a>).
The language code corresponds to ISO 639 and the country code to ISO 3166.</p>
</div>
<div class="paragraph">
<p>Furthermore, in the project it is ensured that the FirstSpirit master language is assigned to the default language in Salesforce.</p>
</div>
<div id="img_languages" class="imageblock">
<div class="content">
<img src="_images/languages.png" alt="languages">
</div>
<div class="title">Figure 3. Languages</div>
</div>
<div class="paragraph">
<p>This information is presented in more detail in the <a href="#generation">Generation</a> and <a href="#hp">Homepage</a> chapters.</p>
</div>
</div>
<div class="sect3">
<h4 id="generation_and_deployment"><a class="anchor" href="#generation_and_deployment"></a>1.3.5. Generation &amp; deployment</h4>
<div class="paragraph">
<p>It is Commerce Cloud that transfers the content created in FirstSpirit to the live state.
The content must be made available to Commerce Cloud in the form of two XML files, which have been created during generation.
While one of these files contains all the slot configurations created in the FirstSpirit project, the second contains all the assets.</p>
</div>
<div class="paragraph">
<p>The <a href="#wddeployment">WebDAV deployment</a> transfers both XML files together with the generated media to Commerce Cloud and stores them in the Commerce Cloud storage location.
From this point, they are then imported via a <a href="#sfcc_job_schedules">job schedule</a>, which is initiated by means of the FirstSpirit schedule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete"><a class="anchor" href="#_delete"></a>1.3.6. Delete</h4>
<div class="paragraph">
<p>The content of a FirstSpirit project can be changed or deleted at any time as part of the usual editorial process.
These changes have to be applied to Salesforce.
In the same way that new content is transferred, it is also deleted by means of <a href="#schedule">deployment</a>.</p>
</div>
<div class="paragraph">
<p>A current time stamp is added to all assets and slot configurations at the start of each full generation.
Therefore, its time stamp diverges from the time stamps of the content, which is still present in Salesforce, but which has already been deleted in the FirstSpirit project.
The last action of the generation schedule identifies the assets and slot configurations with an outdated time stamp and triggers their deletion.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_technical_requirements"><a class="anchor" href="#_technical_requirements"></a>1.4. Technical requirements</h3>
<div class="paragraph">
<p>The <em>ContentConnect</em> module has the following technical requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FirstSpirit version: FirstSpirit (isolated or legacy mode) since 2020-01</p>
</li>
<li>
<p>Commerce Cloud e-commerce shop system</p>
</li>
<li>
<p>Storefront Reference Architecture version 4.4.1</p>
</li>
<li>
<p>e-Spirit LINK Cartridges <code>int_espirit_core</code>, <code>int_espirit_sfra</code> resp. <code>int_espirit_sitegenesis</code> version 20.1.0</p>
</li>
<li>
<p>Open Commerce API version 19.5 (Compatibility Mode 18.10 or 19.10)</p>
</li>
<li>
<p>Latest JSTL version (provided with the <a href="#jstlmodule">JSTL module</a>)</p>
</li>
<li>
<p>Java 11 or higher</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hints"><a class="anchor" href="#hints"></a>1.5. Important information</h3>
<div class="paragraph">
<p>This section contains information that should be noted when using the <em>ContentConnect</em> module.</p>
</div>
<div class="sect3">
<h4 id="_content_asset_id"><a class="anchor" href="#_content_asset_id"></a>1.5.1. Content asset ID</h4>
<div class="paragraph">
<p>Content assets that are created in FirstSpirit get a unique ID from FirstSpirit.
If a content asset with the exact same ID is created in Commerce Cloud, this is overwritten by FirstSpirit when it is deployed.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_components"><a class="anchor" href="#_components"></a>2. Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>ContentConnect</em> consists of various components.
The functionality of these components is described in the following sub-chapters.</p>
</div>
<div class="sect2">
<h3 id="module"><a class="anchor" href="#module"></a>2.1. ContentConnect module</h3>
<div class="paragraph">
<p>The <em>ContentConnect</em> module is the main component for connecting FirstSpirit and Commerce Cloud.
It is extremely important for bidirectional data exchange between the FirstSpirit server and Commerce Cloud.</p>
</div>
<div class="paragraph">
<p>The module provides a report in both SiteArchitect and ContentCreator, showing the product information obtained from Commerce Cloud.
The module determines which data is required and transfers it to the report when an editor initiates a query prompting it to do so.
The data that is returned can then be used again for creating and maintaining editorial content.</p>
</div>
<div class="paragraph">
<p>If a generation is performed once the content has been created, the module combines the content in the form of two XML files.
The <a href="#wdmodule">WebDAV module</a> then transfers the files to the Commerce Cloud storage location.
Commerce Cloud reads out the data from this location and transfers it to the live state.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>ContentConnect</em> module provides an API for the implementation of product-specific functions.
More information is available in the accompanying Javadoc documentation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="wdmodule"><a class="anchor" href="#wdmodule"></a>2.2. WebDAV module</h3>
<div class="paragraph">
<p>The editorial content is created and edited in FirstSpirit.
In this case, however, it is Commerce Cloud that transfers it to the live state.
This means that the content has to be made available to Commerce Cloud.
For this purpose, the <a href="#module"><em>ContentConnect</em> module</a> creates one XML file for the library and one for the <a href="#slot_configuration">slot configuration</a> as part of a <a href="#schedule">deployment</a>.
These files must be transferred to Commerce Cloud along with the referenced media.</p>
</div>
<div class="paragraph">
<p>This is the task of the WebDAV module, which acts as a link between FirstSpirit and Commerce Cloud and stores the data in the Commerce Cloud storage location.
Commerce Cloud reads out the data from this location.</p>
</div>
</div>
<div class="sect2">
<h3 id="jstlmodule"><a class="anchor" href="#jstlmodule"></a>2.3. JSTL module</h3>
<div class="paragraph">
<p>Within the reference project, JSTL is required to <a href="#uc_preview">preview</a> certain pages.
The JSTL module enables this.
However, the module only needs to be installed on the FirstSpirit Server if JSTL has not yet been integrated on the server in any other way.</p>
</div>
</div>
<div class="sect2">
<h3 id="cartridges"><a class="anchor" href="#cartridges"></a>2.4. Commerce Cloud Cartridges</h3>
<div class="paragraph">
<p>The delivery includes the three cartridges <code>int_espirit_core</code>, <code>int_espirit_sfra</code>, and <code>int_espirit_sitegenesis</code>.
They work with all locales and are not subject to any particular restrictions in this respect.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">int_espirit_core</dt>
<dd>
<p>The <code>int_espirit_core</code> cartridge contains scripts, which are used in the other two cartridges.
The functions provided are used, for example, to map Commerce Cloud render templates on FirstSpirit page templates and thereby to make it possible to create category and product pages
(see <a href="#product_page_template_mapping">Product Page Template Mapping</a>, <a href="#cagegory_page_template_mappings">Category Page Template Mappings</a>, and <a href="#detail_pages">Category and product pages</a>).</p>
</dd>
<dt class="hdlist1">int_espirit_sfra</dt>
<dd>
<p>The <code>int_espirit_sfra</code> cartridge overwrites a few templates from the Storefront Reference Architecture in order to enable a <a href="#uc_preview">preview</a> on the FirstSpirit side.
The cartridge also contains the following controllers:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Common:</strong> The <code>Common</code> controller provides the standard components of a Salesforce shop as individual widgets.</p>
</li>
<li>
<p><strong>Content:</strong> The <code>Content</code> controller receives the Velocity fragments maintained in FirstSpirit and returns the HTML rendered on this basis.</p>
</li>
<li>
<p><strong>CategorySearchResult:</strong> The <code>CategorySearchResult</code> controller determines the products of a sub-category and provides these as a separate widget.</p>
</li>
<li>
<p><strong>Product:</strong> The <code>Product</code> controller provides the widgets of a product detail page and controls how the product detail page is displayed when the website is live.</p>
</li>
<li>
<p><strong>RenderTemplate:</strong> The <code>RenderTemplate</code> controller determines the Commerce Cloud render template for a specified product or a specified category.
It uses the options of the Storefront Reference Architecture and draws on the functions of the <code>int_espirit_core</code> cartridge.</p>
</li>
<li>
<p><strong>Search:</strong> The <code>Search</code> controller enables <a href="#catdetailpage">FirstSpirit category detail pages</a> to be displayed in the live state.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">int_espirit_sitegenesis</dt>
<dd>
<p>For shops that are not based on the Storefront Reference Architecture, the <code>int_espirit_sitegenesis</code> cartridge contains a corresponding implementation of the <code>RenderTemplate</code> controller.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commerce_cloud_installation_and_configuration"><a class="anchor" href="#_commerce_cloud_installation_and_configuration"></a>3. Commerce Cloud - Installation and configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Various components must be installed and configured in order to use the functions of the <em>ContentConnect</em> module.
The following sub-chapters explain the necessary steps for installing and configuring components in Commerce Cloud.
The corresponding import file is located in the <code>data</code> folder.</p>
</div>
<div class="sect2">
<h3 id="_setting_up_the_cartridges"><a class="anchor" href="#_setting_up_the_cartridges"></a>3.1. Setting up the cartridges</h3>
<div class="paragraph">
<p>The delivery includes three cartridges, which must be transferred to Commerce Cloud initially.
Different methods for this are described in the Commerce Cloud documentation under
<a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/SiteDevelopment/Cartridges.html"><span class="menuseq"><b class="menu">B2C Commerce Development</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Development Components</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Cartridges</b></span></a>.</p>
</div>
<div class="paragraph">
<p>Next, the <code>int_espirit_core</code> cartridge must be added to all sites that are to receive FirstSpirit content.
You can find relevant instructions in the Commerce Cloud documentation under
<a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/SiteDevelopment/RegisterYourCartridge.html"><span class="menuseq"><b class="menu">B2C Commerce Development</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Getting Started for Developers</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Register Your Cartridge</b></span></a>.
Sites that are set up on the Storefront Reference Architecture and are maintained in FirstSpirit also require <code>int_espirit_sfra</code> in their cartridge path.
However, if a site is based on SiteGenesis, its cartridge path must include <code>int_espirit_sitegenesis</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The three cartridges work with all locales and are not subject to any particular restrictions in this respect.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sfcc_zip_file_import"><a class="anchor" href="#sfcc_zip_file_import"></a>3.2. Import of the zip file importExamples</h3>
<div class="paragraph">
<p>For the setup of the <a href="#sfcc_job_schedules">job schedules</a> and the <a href="#sfcc_content_cleanup">content cleanup</a> as well as for the <a href="#sfcc_import_slot_configs">slot configurations</a>
various files are required, which are stored in the file <em>importExamples.zip</em>.
The zip file is included in the <em>metadata</em> directory within the delivery and must be added to the Commerce Cloud.
To do so, it must be imported via the <code><strong><span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Site Development</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Site Import &amp; Export</b></span></strong></code> page.
The files contained in it require different configuration steps, which are explained in detail in the corresponding subchapters.</p>
</div>
</div>
<div class="sect2">
<h3 id="sfcc_job_schedules"><a class="anchor" href="#sfcc_job_schedules"></a>3.3. Setting up the job schedules</h3>
<div class="paragraph">
<p>To import the content and <a href="#slot_configuration">slot configurations</a> generated by FirstSpirit into Commerce Cloud, a job schedule must be created in Commerce Cloud for each site.
Therefore, the <em>metadata</em> directory of the delivery contains the zip file <em>importExamples.zip</em>, which requires an <a href="#sfcc_zip_file_import">import</a> into the Commerce Cloud as described previously.</p>
</div>
<div class="paragraph">
<p>The jobs imported with the zip file have the job IDs <code>FirstSpirit-Import-RefArch</code> and <code>FirstSpirit-Import-RefArchGlobal</code> by default.
The ID ensures the uniqueness of the jobs for the different sites and can be adjusted as required on the <code><strong><span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Operations</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Jobs</b></span></strong></code> page.
It is recommended to include the ID of the respective site in the corresponding job ID to ensure uniqueness.</p>
</div>
<div class="paragraph">
<p>The job schedules configured in the file consist of three job steps.
These are of the types <code>Import Content</code>, <code>Import Content Slots</code>, and <code>Rebuild Search Index</code>.
All three job steps initially have the scope <code>RefArch</code> or <code>RefArchGlobal</code>, which must be changed to the appropriate site.
In addition, these define different parameters whose default values can be kept mostly.
Only the parameters <code>WorkingFolder</code> and <code>FileNamePattern</code> need to be adapted to the specific project.
The editing dialog opens by clicking on the job step&#8217;s name.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">WorkingFolder</dt>
<dd>
<p>The parameter <code>WorkingFolder</code> specifies - relative to the <code><strong>IMPEX</strong></code> directory - the path to the directory containing the XML files generated by FirstSpirit.
Its value must be identical for both job steps.</p>
</dd>
<dt class="hdlist1">FileNamePattern</dt>
<dd>
<p>The parameter defines the name of the XML files generated by FirstSpirit.
In the case of the <code>ImportContent</code> job step, it must have the <code>fs_import_library.xml</code> value and for the <code>ImportContentSlots</code> job step, it must have the <code>fs_import_slot_configuration.xml</code> value.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>General information about creating job schedules can be found in the Commerce Cloud documentation in chapter
<a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/Jobs/CreatingJobs.html"><span class="menuseq"><b class="menu">Administering Your Organization</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Jobs</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Creating Jobs</b></span></a></p>
</div>
<div class="paragraph">
<p>The three job steps and their parameters are described in the Commerce Cloud documentation in the chapters
<a href="https://documentation.b2c.commercecloud.salesforce.com/DOC1/index.jsp?topic=%2Fcom.demandware.dochelp%2FDWAPI%2Fjobstepapi%2Fhtml%2Fapi%2Fjobstep.ImportContent.html"><em>ImportContent</em></a>,
<a href="https://documentation.b2c.commercecloud.salesforce.com/DOC1/index.jsp?topic=%2Fcom.demandware.dochelp%2FDWAPI%2Fjobstepapi%2Fhtml%2Fapi%2Fjobstep.ImportContentSlots.html"><em>ImportContentSlots</em></a>, and
<a href="https://documentation.b2c.commercecloud.salesforce.com/DOC1/index.jsp?topic=%2Fcom.demandware.dochelp%2FDWAPI%2Fjobstepapi%2Fhtml%2Fapi%2Fjobstep.SearchReindex.html"><em>SearchReindex</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sfcc_content_cleanup"><a class="anchor" href="#sfcc_content_cleanup"></a>3.4. Setting up content cleanup</h3>
<div class="paragraph">
<p>In order to delete assets and <a href="#slot_configuration">slot configurations</a> managed and deleted by FirstSpirit from Commerce Cloud too, the following steps must be taken:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#import_attributes">Import the user-defined system object attributes</a></p>
</li>
<li>
<p><a href="#additional_custom_attributes_assets">Optional: Create additional custom attributes for assets</a></p>
</li>
<li>
<p><a href="#search_refinements">Generate search refinements for assets</a></p>
</li>
<li>
<p><a href="#ocapisettings">Adjust the OC API settings</a></p>
</li>
<li>
<p><a href="#schedule">Set up the deployment schedule</a></p>
</li>
</ol>
</div>
<div id="import_attributes" class="paragraph">
<p><strong>Importing the user-defined system object attributes</strong><br>
For the persistence of time stamps assigned during generation, content cleanup uses the user-defined <code>fsGenerationTime</code> attribute as part of assets and <a href="#slot_configuration">slot configurations</a>.
This must initially be added to the system objects (content and slot configurations).
To create the user-defined system object attributes, the zip file <em>importExamples.zip</em> must be available in the Commerce Cloud.
It is stored within the <em>metadata</em> directory, which is included in the delivery.
Its provision is done via the previously described <a href="#sfcc_zip_file_import">import process</a>.</p>
</div>
<div id="additional_custom_attributes_assets" class="paragraph">
<p><strong>Create additional custom attributes for assets</strong><br>
The number of content assets to be deleted can be additionally restricted on the basis of any other custom attributes.
If this is desired, appropriate attributes must be created for content assets.
A description can be found in the Commerce Cloud documentation under <a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/CustomObjects/CreatingCustomattributesforsystemObjects.html"><span class="menuseq"><b class="menu">B2C Commerce Development</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Business Objects</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Creating Custom Attributes for Business Objects</b></span></a></p>
</div>
<div id="search_refinements" class="paragraph">
<p><strong>Generating search refinements for assets</strong><br>
For the newly created <code>fsGenerationTime</code> attribute and the additionally created <a href="#additional_custom_attributes_assets">custom attributes</a>, a Commerce Cloud Search Refinement is to be generated.
The Commerce Cloud documentation describes this under
<a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/Content/CreatingContentSearchRefinements.html"><span class="menuseq"><b class="menu">Merchandising Your Site</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Content Assets</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Working with Content Assets</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Creating Content Search Refinements</b></span></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After importing the user-defined system object attributes and creating the search refinement, it is necessary to rebuild the site&#8217;s search indexes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ocapisettings"><a class="anchor" href="#ocapisettings"></a>3.5. OC API Settings</h3>
<div class="paragraph">
<p>The OC API is used for aspects including <a href="#reports">reports</a> and <a href="#schedule">deployment</a>.
Therefore, the corresponding permissions must be set in Salesforce for the <a href="#clientid"><code>Client ID</code></a> that is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The rights adjustments described below can also be found in the separate files <em><a href="OCAPI-Shop.txt">Shop OCAPI-Settings</a></em> and <em><a href="OCAPI-Data.txt">Data OCAPI-Settings</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Client ID</code> that is used requires permission to execute GET queries via the ShopAPI for the resources indicated below.
These must be implemented in the global or site-specific context according to the use case.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/products/&#42;/variations</code></p>
</li>
<li>
<p><code>/products/&#42;</code></p>
</li>
<li>
<p><code>/product_search/variations</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition when using content cleanup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/content_search</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Permissions are additionally required to execute GET, POST, and DELETE queries via the DataAPI for the resources indicated below.
They are to be exclusively defined in the global context.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/catalogs</code> (GET only)</p>
</li>
<li>
<p><code>/catalogs/&#42;/categories</code> (GET only)</p>
</li>
<li>
<p><code>/jobs/&#42;/executions</code> (GET &amp; POST)</p>
</li>
<li>
<p><code>/jobs/&#42;/executions/&#42;</code> (GET only)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition when using content cleanup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/sites/&#42;/slot_configuration_search</code> (POST only)</p>
</li>
<li>
<p><code>/libraries/&#42;/content/&#42;</code> (DELETE only)</p>
</li>
<li>
<p><code>/sites/&#42;/slots/&#42;/slot_configurations/&#42;</code> (DELETE only)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, the usage of the Sorting Rules requires the following definition:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/sites/*/sorting_rule_search (nur POST)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If, as an option, workflows are to be used for deleting library folders and folder assignments, permissions are then required to execute DELETE queries via the DataAPI for the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/libraries/&#42;/folders/&#42;</code></p>
</li>
<li>
<p><code>/libraries/&#42;/folder_assignments/&#42;/&#42;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sfcc_import_slot_configs"><a class="anchor" href="#sfcc_import_slot_configs"></a>3.6. Slot configurations</h3>
<div class="paragraph">
<p>The templates from the <code>int_espirit_sfra</code> cartridge are used to add new slots to the site.
Therefor, the delivery provides the zip file <em>importExamples.zip</em> with slot configurations for these slots.
It is stored within the <em>metadata</em> directory, which is included in the delivery.
The provision of the zip file <em>slotConfigurations.xml</em> in the Commerce Cloud is done via the previously described <a href="#sfcc_zip_file_import">import process</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_firstspirit_installation_and_configuration"><a class="anchor" href="#_firstspirit_installation_and_configuration"></a>4. FirstSpirit - Installation and configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Various components must be installed and configured in order to use the functions of the <em>ContentConnect</em> module.
The following sub-chapters explain the necessary steps for installing and configuring components in FirstSpirit.</p>
</div>
<div class="sect2">
<h3 id="install"><a class="anchor" href="#install"></a>4.1. Installing the modules</h3>
<div class="paragraph">
<p>The <em>ContentConnect</em> delivery contains three modules that must be added to the FirstSpirit server.
To install the modules, open the <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Server properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Modules</b></span></strong></code>.</p>
</div>
<div id="modules" class="imageblock">
<div class="content">
<img src="_images/modules.png" alt="modules">
</div>
<div class="title">Figure 4. Module management in the server properties</div>
</div>
<div class="paragraph">
<p>The main panel contains a list of all the modules installed on the FirstSpirit server.
Click <b class="button">Install</b>, then select the <em>contentconnect-fsm-&lt;version number&gt;.fsm</em> file provided first, followed by the <em>WebDavDeployment-&lt;version number&gt;.fsm</em> and <em>jstl.fsm</em> files.
Each time you make a selection, click <b class="button">Open</b> to confirm it.
Once installation has been successfully completed, the folders <code>ContentConnect</code>, <code>WebDavDeployment</code> and <code>JSTL</code> are added to the list.
Each of these must be given <code>All permissions</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JSTL module only needs to be installed on the FirstSpirit Server if JSTL has not yet been integrated on the server in any other way.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After any module installation or update, the FirstSpirit server needs to be restarted.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_webdav_with_https"><a class="anchor" href="#_using_webdav_with_https"></a>4.2. Using WebDAV with https</h3>
<div class="paragraph">
<p>To use the WebDAV server with <code>https</code> instead of <code>http</code>, it is not necessary to perform any additional configuration work.
However, a local certificate authority managed by the company is normally used for <code>https</code>.
The certificate in question, including the entire chain up to the certificate on the WebDAV server, must be made available to the FirstSpirit server&#8217;s JVM.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JVM expects public certificates of this kind to be in the form of a <code>PKCS12</code> file or a <code>JKS</code> file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the command below, import the public root or intermediate certificates into a <code>JKS</code> file and select <b class="button">Yes</b> in answer to the question whether the certificate is to be trusted.
You must repeat this process for each certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>keytool -import -file cert1.crt -keystore truststore.jks –storepass changeit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the <code>Trust Store</code> that is generated into the <code><strong><span class="menuseq"><b class="menu">firstspirit5</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">conf</b></span></strong></code> directory of your FirstSpirit server and add the following lines to the file <code><strong><span class="menuseq"><b class="menu">firstspirit5</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">conf</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">fs-wrapper.conf</b></span></strong></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>wrapper.java.additional.100=-Djavax.net.ssl.trustStore=conf/truststore.jks
wrapper.java.additional.101=-Djavax.net.ssl.trustStorePassword=changeit
wrapper.java.additional.102=-Djavax.net.ssl.trustStoreType=JKS</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The parameters must be activated by restarting the FirstSpirit Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the WebDAV server is expecting mutual SSL authentication, you must use the following calls to create and sign a client certificate as a first step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>openssl genrsa -out private.key 2048
openssl req -new -key private.key -out request.csr</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file <code>request.csr</code> is sent to the certificate authority, which responds with the file <code>cert.crt</code>.
The private key, the public certificate, and the certificate from the certificate authority must then be collected in a <code>Key Store</code> to be read by the <code>JVM</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>cd firstspirit5/conf
openssl pkcs12 -export -in public.crt -inkey private.key \
-out clientcert.p12 -CAfile authority.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the certificate chain consists of one or more intermediate certificates, you can import them via <code>keytool</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>keytool -import -file intermediate1.crt -trustcacerts \
-keystore clientcert.p12 -storepass changeit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Key Store</code> can be transferred to the <code>JVM</code> of the FirstSpirit Server by adding the following lines to <code><strong><span class="menuseq"><b class="menu">firstspirit5</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">conf</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">fs-wrapper.conf</b></span></strong></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>wrapper.java.additional.103=-Djavax.net.ssl.keyStore=conf/clientcert.p12
wrapper.java.additional.104=-Djavax.net.ssl.keyStorePassword=changeit
wrapper.java.additional.105=-Djavax.net.ssl.keyStoreType=PKCS12</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_import"><a class="anchor" href="#_project_import"></a>4.3. Project import</h3>
<div class="paragraph">
<p>A part of the StarterPackage included in the delivery is the reference project <em>ContentConnect Reference Project</em>, which must be installed on the FirstSpirit server.
To do this, open the import dialog in the <code><strong>ServerManager</strong></code> via the menu item <code><strong><span class="menuseq"><b class="menu">Project</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Import</b></span></strong></code> and click the <b class="button">Lokal</b> button to select the <code>ContentConnectReferenceProject.tar.gz</code> file from your local data system.
Then assign a project name and description and confirm the import with <b class="button">Yes</b>.
After successful installation, the project is added to the list in the main panel (see figure <a href="#importedproject">Imported project in the ServerManager</a>).</p>
</div>
<div id="importedproject" class="imageblock">
<div class="content">
<img src="_images/importedproject.png" alt="importedproject">
</div>
<div class="title">Figure 5. Imported project in the ServerManager</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to the standard groups <code>Everyone</code> and <code>Administrators</code>, there are four further user groups in the reference project: <code>Editors</code>, <code>ChiefEditors</code>, <code>Developers</code> and <code>ProjectAdmins</code>.
The groups have different rights, which are selected according to their tasks and defined for the different stores.
Users outside these groups are not allowed to use the reference project by default.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pcomp"><a class="anchor" href="#pcomp"></a>4.4. Configuring the project component</h3>
<div class="paragraph">
<p>A project-specific configuration is required in order to use the <em>ContentConnect</em> module.
It is set up using the project component, which is already added to the reference project supplied.</p>
</div>
<div class="paragraph">
<p>To configure the project component, open the <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Project components</b></span></strong></code>.
A list of all existing project components is displayed in the main panel.
Select the entry <code>ContentConnect Project Configuration</code> and click <b class="button">Configure</b> to open the associated dialog (see figure <a href="#config">Configuration dialog for the project component</a>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The subsequent configuration is used by the module services.
The service and all running clients must be restarted each time the configuration is changed.
Otherwise, the change in question will not be applied either to the services or to the clients.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="config" class="imageblock">
<div class="content">
<img src="_images/config.png" alt="config">
</div>
<div class="title">Figure 6. Configuration dialog for the project component</div>
</div>
<div id="project-app-config-base-url" class="dlist">
<dl>
<dt class="hdlist1">Base URL</dt>
<dd>
<p>Start by entering the <code>Base URL</code>, which is derived from the URL of the Commerce Cloud instance and the ID of the site being used:</p>
<div class="paragraph">
<p><code>https://&lt;SUBDOMAIN INSTANCE&gt;.demandware.net/s/&lt;SITE ID&gt;</code></p>
</div>
<div class="paragraph">
<p>Based on this structure, a unique connection between the FirstSpirit project and the Commerce Cloud site is always guaranteed.</p>
</div>
<div class="paragraph">
<p>The <code>Base URL</code> field is a mandatory field.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid problems concerning the certificate, it must be ensured that the subdomain does not contain any periods in its name.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="clientid" class="dlist">
<dl>
<dt class="hdlist1">Client ID</dt>
<dd>
<p>The <code>Client ID</code> is also a mandatory field.
This is required in order to be able to use the <code>Open Commerce Shop API</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>Client ID</code> and the <code>Base URL</code> are essential for the connection between Commerce Cloud and FirstSpirit.
If one of the two pieces of information is incorrect or is not available, then the relevant report for the product search is hidden in both FirstSpirit Clients.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Password</dt>
<dd>
<p>The components of the <em>ContentConnect</em> API require password-based authentication against Commerce Cloud.
For this reason, a password that is defined when the API client is registered with Commerce Cloud is required in addition to the client ID.</p>
</dd>
<dt class="hdlist1">Refinements</dt>
<dd>
<p>Refinements that improve product searches are defined in this configuration field.
Refinements are entered as key value pairs separated using commas.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Up to the first nine key value pairs entered are used (Commerce Cloud will not accept more than nine refinements).</p>
</div>
<div class="paragraph">
<p>The format of the values of the key value pairs matches the format Commerce Cloud expects for refinement values.
Both multiple values and sets of values can be entered for a refinement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cgid=new-arrivals|electronics</code></p>
</li>
<li>
<p><code>price=(0..100)</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since a refinement is also used for category searches, two special cases need to be considered:</p>
</div>
<div class="paragraph">
<p>In the first case,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the product search is filtered by a category and</p>
</li>
<li>
<p>the configuration contains nine refinement definitions,</p>
</li>
<li>
<p><strong>none</strong> of which is the <code>cgid</code> category refinement.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, there are a total of ten refinement definitions, which is not permitted.
Therefore, one of the refinements from the configuration is ignored so that the product search can be filtered by a category.</p>
</div>
<div class="paragraph">
<p>In the second case,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the product search is also filtered by a category and</p>
</li>
<li>
<p>the configuration contains the <code>cgid</code> category refinement.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, there is a duplicate definition for the <code>cgid</code> category refinement:
one from the module configuration and one from the product search; the latter is used.
The value from the configuration is then used as the default value. It can be overwritten by the editor.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Locale</dt>
<dd>
<p>The <code>Locale</code> identifies the language and region of the current project.
A maximum of one ID for an active locale that is permitted for storefront requests in the site configured at the top of the dialog may be entered.
If the field is left blank, the <code>locale</code> parameter will not be used in storefront requests.</p>
</dd>
<dt class="hdlist1">Auth User</dt>
<dd>
<p>If access restriction is activated in Commerce Cloud, the <code>storefront</code> user must be specified in this field.</p>
</dd>
<dt class="hdlist1">Auth Password</dt>
<dd>
<p>The password belonging to the <code>storefront</code> user is specified in this field.</p>
</dd>
</dl>
</div>
<div id="product_page_template_mapping" class="dlist">
<dl>
<dt class="hdlist1">Product Page Template Mapping</dt>
<dd>
<p>One of the functions supported by the product report is the user-friendly creation of product pages, which use the page template <em>Product Detail Page</em> in the reference project.
To enable this, this configuration field allows Salesforce render templates to be mapped to FirstSpirit page templates.
The following rules apply here:</p>
<div class="ulist">
<ul>
<li>
<p>The field contains either no content at all or one or more mappings.</p>
</li>
<li>
<p>If the field remains empty, the use of product pages in the project is disabled.</p>
</li>
<li>
<p>Mappings are specified using a list separated by commas: <strong>&lt;mapping&gt;,&lt;mapping&gt;</strong></p>
</li>
<li>
<p>Each mapping is arranged as follows: <strong>&lt;isml_template&gt;:&lt;fs_template&gt;</strong></p>
</li>
<li>
<p>To configure a page template for all ISML templates that do not have an explicit mapping, the following form must be used: <strong>default:&lt;fs_template&gt;</strong></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="default_folder" class="dlist">
<dl>
<dt class="hdlist1">Default Folder (Product Pages)</dt>
<dd>
<p>To create a new product page, it is essential to know where the page is to be integrated into the structure.
The reference name of the <em>Product Pages</em> structure folder has already been entered here.
All new product pages within the reference project are created in this folder.
If the field is left empty, the editor must select a menu level.</p>
</dd>
<dt class="hdlist1">Editable Folder (Product Pages)</dt>
<dd>
<p>This checkbox makes it possible to specify whether an editor can change the selection made in the <code>Default Folder (Product Pages)</code> field.
The function is activated initially.
If it is then deactivated, the corresponding input component is hidden in the dialog for <a href="#create_detailpage">creating a category or product page</a>.
In this case, it is not possible for the editor to select or change the menu item for a newly created category or product page.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The field <code>Default Folder (Product Pages)</code> and the checkbox <code>Editable Folder (Product Pages)</code> are ignored if the field <code>Product Page Template Mapping</code> is empty.
If, instead, a mapping is defined, it is <strong>mandatory</strong> that the reference name of a structure folder is specified or that the checkbox is activated.
Otherwise, it will not be possible to create new product pages due to the lack of assignment to a menu level, and errors will occur.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="cagegory_page_template_mappings" class="dlist">
<dl>
<dt class="hdlist1">Category Page Template Mappings</dt>
<dd>
<p>The mapping of page templates can be configured using this configuration field for the creation of <a href="#detail_pages">category pages</a> via the <a href="#category_report">category report</a>.
The following rules apply here:</p>
<div class="ulist">
<ul>
<li>
<p>The field contains either no content at all or one or more mappings.</p>
</li>
<li>
<p>If the field remains empty, the use of category pages in the project is disabled.</p>
</li>
<li>
<p>Mappings are specified using a list separated by commas: <strong>&lt;mapping&gt;,&lt;mapping&gt;</strong></p>
</li>
<li>
<p>Each mapping is arranged as follows: <strong>&lt;isml_template&gt;:&lt;fs_template&gt;[:fallback_category]</strong></p>
</li>
<li>
<p>The third part of the mapping is optional and is used to specify a <a href="#hidden_categories_note">fallback category</a> for category pages that are based on the specified ISML template</p>
</li>
<li>
<p>To configure a page template and an optional fallback category for all ISML templates that do not have an explicit mapping, the following form must be used: <strong>default:&lt;fs_template&gt;[:fallback_category]</strong></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="hidden_categories_note" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Categories can be marked as offline within Commerce Cloud.
These offline categories are not delivered via the storefront, whereby no preview can be generated for them.
To make it possible to also maintain category pages for offline categories via the FirstSpirit report, fallback categories must be specified for the associated ISML templates.
Within the preview for an offline category page, this is then replaced by the configured fallback category.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We recommend using separate FirstSpirit templates for product pages and category pages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Default Folder (Category Pages)</dt>
<dd>
<p>In the same way as with product pages, for each new category page it is essential to know where the page is to be integrated into the structure.
The reference name of the <em>Category Pages</em> structure folder has already been entered here.
All new category pages within the reference project are created in this folder.
If the field is left empty, the editor must select a menu level.</p>
</dd>
<dt class="hdlist1">Editable Folder (Category Pages)</dt>
<dd>
<p>In the same way as with the <code>Editable Folder (Product Pages)</code> checkbox, here it is possible to specify whether editors can change the selection made in the <code>Default Folder (Category Pages)</code> field.
The function is activated initially.
If it is then deactivated, the selection option is hidden in the dialog for <a href="#create_detailpage">creating a category page</a>.
In this case, it is not possible for the editor to select or change the menu item for a new page.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The field <code>Default Folder (Category Pages)</code> and the checkbox <code>Editable Folder (Category Pages)</code> are ignored if the field <code>Category Page Template Mapping</code> is empty.
If, instead, a mapping is defined, it is <strong>mandatory</strong> that the reference name of a structure folder is specified or that the checkbox is activated.
Otherwise, it will not be possible to create new category pages due to the lack of assignment to a menu level, and errors will occur.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="template_instantiation_script_uid" class="dlist">
<dl>
<dt class="hdlist1">Template Instantiation Script Uid</dt>
<dd>
<p>Select a script to be executed before and after <a href="#detail_pages">category or product pages</a> are created in this configuration field (the selection of a script is optional).
The <em>create_sfcc_item_wizard</em> script specified is used to execute project-specific actions, which are required to generate the preview.
In the reference project, it marks the created category or product page as translated for all languages.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that only the code from the HTML channel of the script is executed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">View Type Priority</dt>
<dd>
<p>Images of products from Commerce Cloud are always provided in a range of sizes, but an image will not necessarily have been stored for every size.
For this reason, the <code>View Type Priority</code> has been provided so that you can define which image sizes you wish to incorporate, separating the information you enter with commas.</p>
<div class="paragraph">
<p>In the case shown in the figure <a href="#config">Configuration dialog for the project component</a>, the <code>medium</code> image associated with each product is identified and is used if it exists.
If there is no medium image, the <code>large</code> image is called up, followed by the <code>small</code> one if necessary.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As this is not a mandatory input field, it may therefore remain empty if you do not wish to define an order of priority.
If this is the case, search results from a product query will be shown without an image.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Image Service Base URL</dt>
<dd>
<p>Commerce Cloud provides what is known as an <a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/ImageManagement/ImageTransformationService.html"><code>Image Service</code></a>.
If you wish to use it, you must specify the URL of the Image Service in the form <code>http[s]://&lt;image server host name&gt;</code> at this point.
Product images are then called up via the Image Service.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Specifying the <code>Image Service Base URL</code> is optional.
However, if the field is filled with a URL, then this entry must not contain any errors; otherwise, the relevant report for the product search is hidden in both FirstSpirit Clients.
This still applies even if the <code>Client ID</code> and the <code>Base URL</code> are correct (see above).</p>
</div>
</td>
</tr>
</table>
</div>
<div id="category-search" class="dlist">
<dl>
<dt class="hdlist1">Use Category Search</dt>
<dd>
<p>Next you must decide whether the reports for products and categories should provide filtering on categories in addition to the text search field.
The corresponding checkbox <code>Use Category Search?</code> is deactivated by default.
In this case, the category filter is not applied in the context of the product or category search.
The associated dropdown list is hidden in the report.
If filtering according to category is required, the checkbox must be activated.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Filtering by category differs depending on the report used.
In the report for the product search, filtering is possible across all categories.
In the report for the category search, however, filtering is only possible via the top-level categories.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="show_report" class="dlist">
<dl>
<dt class="hdlist1">Show Category Report</dt>
<dd>
<p>This checkbox can be used to control the display of the category report.
The checkbox is deactivated by default (i.e., only the report for product searches is active).</p>
<div id="category_report" class="imageblock">
<div class="content">
<img src="_images/category_report.png" alt="category report">
</div>
<div class="title">Figure 7. Category report</div>
</div>
</dd>
<dt class="hdlist1">Test Configuration</dt>
<dd>
<p>Click the <b class="button">Test Configuration</b> button to check the entries that have been entered.
For this, the <code>Client ID</code>, the <code>Base URL</code> and - if available - the <code>Image Service Base URL</code> as well as the configurations for the product and category pages are taken into account.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="wcomp"><a class="anchor" href="#wcomp"></a>4.5. Adding web components</h3>
<div class="paragraph">
<p>Two web components are required for the <code>Preview</code> and for <code>ContentCreator</code> and have already been added to the reference project supplied.
Nevertheless, they still need to be installed on an active web server.
To do this, open the <code><strong>ServerManager</strong></code> and select <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Web components</b></span></strong></code>.</p>
</div>
<div class="paragraph">
<p>Inside the main panel, various tab pages are visible.
Each tab page contains a list of the existing web components.
The list contains the following entries both for the <code>Preview</code> as well the <code>ContentCreator</code> (see figure <a href="#webcomponents">Web components in the project properties</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ContentConnect Web Component</code></p>
</li>
<li>
<p><code>FS_JSTL_WebApp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Select a <code>Web server</code> on both tab pages via the selection box and start the installation by clicking the <b class="button">Install</b> button.
After successful installation, a dialog opens, in which the activation of the <code>Web server</code> must be confirmed.</p>
</div>
<div class="paragraph">
<p>More detailed information on how to add web components is available in the <em><a href="https://docs.e-spirit.com/odfs/edocs/admi/introduction/index.html">FirstSpirit Documentation for Administrators</a></em>.</p>
</div>
<div id="webcomponents" class="imageblock">
<div class="content">
<img src="_images/webcomponents.png" alt="webcomponents">
</div>
<div class="title">Figure 8. Web components in the project properties</div>
</div>
</div>
<div class="sect2">
<h3 id="webconf"><a class="anchor" href="#webconf"></a>4.6. Configuration of the web component</h3>
<div class="paragraph">
<p>Part of the web component of the <em>ContentConnect</em> module are the Preview Proxy and the Preview Filter.
Both components can be configured via the <code>web.xml</code> and are described in more detail in the following two chapters.</p>
</div>
<div class="sect3">
<h4 id="previewproxy"><a class="anchor" href="#previewproxy"></a>4.6.1. Preview Proxy</h4>
<div class="paragraph">
<p>If problems with cross-origin requests occur during the preview due to the same-origin policy of modern web servers, then these can be remedied by using the Preview Proxy included in the <em>ContentConnect</em> module.</p>
</div>
<div class="paragraph">
<p>To do this, the calls to the resources concerned must be routed via the Preview Proxy.
The <a href="#uc_preview_proxy">Preview</a> chapter explains how this is done in the project.</p>
</div>
<div class="paragraph">
<p>The Preview Proxy is configurable via the <code>web.xml</code> with the following parameter:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connection.keepalive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration of maintaining a connection within the Preview Proxy in seconds. Too high values may cause problems when loading resources.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>An example snippet of the <code>web.xml</code>, in which the Preview Proxy&#8217;s parameter is configured and the preconfigured URL path has been adjusted, might look as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example web.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;servlet&gt;
    &lt;servlet-name&gt;ContentConnectPreviewProxy&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.espirit.moddev.demandware.preview.proxy.ProxyServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;0&lt;/load-on-startup&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;connection.keepalive&lt;/param-name&gt;
      &lt;param-value&gt;120&lt;/param-value&gt;
   &lt;/init-param&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ContentConnectPreviewProxy&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/assets/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="previewfilter"><a class="anchor" href="#previewfilter"></a>4.6.2. Preview Filter</h4>
<div class="paragraph">
<p>The <code>ContentConnect Preview Filter</code> determines the necessary information for displaying a page in the <a href="#uc_preview">FirstSpirit preview</a>.
In the slot-based approach, it identifies the correct storefront URL for this purpose, downloads the HTML on the basis of this URL, and substitutes the slots it contains with the corresponding editorial content.
If the <code>CI API</code> is being used, however, it has the Velocity fragments maintained in FirstSpirit evaluated on the Salesforce side, and displays the result at the corresponding point on the page in the <a href="#uc_preview">FirstSpirit preview</a>.</p>
</div>
<div class="paragraph">
<p>To carry out these steps, the filter requires some information that can be configured via various parameters in the <code>web.xml</code> of the <a href="#wcomp">added web components</a> (for the Preview as well as ContentCreator).
This information relates to various aspects, which can be divided into four groups.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>web.xml</code> of the <a href="#wcomp">added web component</a> added in the tab <code>preview</code> requires the adjustment of the parameter <code>dispatcher</code>.
By default, the <code>web.xml</code> contains the value <code>FORWARD</code> for this parameter.
However, in the case of the preview in the SiteArchitect, it requires the value <code>REQUEST</code> and must be replaced accordingly.</p>
</div>
<div class="listingblock">
<div class="title">Adjustment in the web.xml for the preview in the SiteArchitect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;filter-mapping&gt;
   &lt;filter-name&gt;ContentConnectPreviewFilter&lt;/filter-name&gt;
   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
&lt;/filter-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beyond that, a configuration of the individual parameters is only necessary if their default values do not match the project-specific conditions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Storefront URL parameters</strong></p>
</div>
<div class="paragraph">
<p>As described previously, the <code>Preview Filter</code> determines the necessary information on the Salesforce side - both in the slot-based approach and when using the <code>CI API</code>.
It then displays this information in the <a href="#uc_preview">FirstSpirit preview</a>.
To do this, a project-specific storefront URL is required.
As this is maintained in the <a href="#project_settings">project settings</a>, the <code>Preview Filter</code> requires the associated input component to be specified for its query.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.url.baseUrlFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontUrlBaseUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component for specifying the storefront&#8217;s base URL, which is extended with the page type and the ID of the element to be displayed (e.g., product, category, or asset ID).
The component is maintained in the project settings.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The syntax for the storefront base URL can be found in the <a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/SearchEngineOptimization/DigitalURLSyntaxWithoutSEO.html"><span class="menuseq"><b class="menu">Merchandising Your Site</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Search Engine Optimization</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">URL Syntax</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Salesforce B2C Commerce URL Syntax Without SEO</b></span></a> chapter of the Salesforce Commerce Cloud documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a value of the input component <code>ps_storefrontUrlBaseUrl</code>, only up to the locale, <strong>not</strong> the entire URL must be entered within the <a href="#project_settings">project settings</a>.</p>
</div>
<div class="paragraph">
<p>E.g.: https://www.mystore.com/on/demandware.store/​Sites-YourShopHere-Site/</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changes to the <a href="#project_settings">project settings</a> do not take effect straight away, as they are saved in the session of the user.
They require the client to be restarted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Storefront Crop Marks parameters</strong></p>
</div>
<div class="paragraph">
<p>The placeholders included in the editorial content consist of a start as well as an end comment and have the format <code>&lt;!-- CMS-&lt;IDENTIFIER&gt;-START -&#8594;</code> or <code>&lt;!-- CMS-&lt;IDENTIFIER&gt;-END -&#8594;</code> by default.
However, the use of individual affixes can be activated via a toggle in the <a href="#project_settings">project settings</a>, which must be added if necessary.
In this case, the default values are overwritten and specific prefixes and suffixes are used instead.
In order to grant the <code>Preview Filter</code> access to this information, it requires the associated input components to be specified.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cropMarks. customAffixes.enabledFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCropMarksCustomAffixesEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The toggle in the project settings for (de)activating the use of individual affixes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cropMarks. opening.prefixFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCropMarksOpeningPrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying a prefix for the start comment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cropMarks. opening.suffixFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCropMarksOpeningSuffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying a suffix for the start comment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cropMarks. closing.prefixFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCropMarksClosingPrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying a prefix for the end comment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cropMarks. closing.suffixFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCropMarksClosingSuffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying a suffix for the end comment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Storefront protection parameters</strong></p>
</div>
<div class="paragraph">
<p>It is possible to protect the connection to Commerce Cloud via an authentication.
This can be (de)activated in Salesforce and must be applied to FirstSpirit via the corresponding toggle in the <a href="#project_settings">project settings</a>.
If it is activated, the required access data must also be specified.
The <code>Preview Filter</code> must be able to access this information and therefore requires the associated input components to be specified.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.protection.enabledFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontProtectionEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for (de)activating the authentication for the storefront URL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.protection.userFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontProtectionUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for registering the storefront user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.protection.passwordFormField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontProtectionPassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for the password of the storefront user.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Storefront downloader parameters</strong></p>
</div>
<div class="paragraph">
<p>In addition to the other parameters, which are primarily used to determine the correct storefront URL, in the slot-based approach it must be possible to control the behavior of the <code>Preview Filter</code> while the HTML of the corresponding page is downloading.
For this, it has different parameters, which can be maintained in the <a href="#project_settings">project settings</a>.
The <code>Preview Filter</code> must be able to access this information and therefore requires the associated input components to be specified.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The storefront downloader parameters are used to initialize the filter in the slot-based approach.
As a result, they have a fixed fallback value for cases with a missing or empty input component.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="storefront-download-parameter" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.downloader.maxConnections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontDownloaderMaxConnections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying the maximum permissible number of parallel connections to Storefront.<br>
The fallback value is 100.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.downloader.socketTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontDownloaderSocketTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying the time span (in milliseconds) in which a response from Storefront is expected.<br>
The fallback value is 10000.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.downloader.retryCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontDownloaderRetryCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying the maximum number of connection attempts.<br>
The fallback value is 3.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of the following two parameters is only recommended in exceptional cases, as they bypass the certificate check for <code>https</code> requests.
This may be necessary if certificate errors prevent the preview from being displayed and the problem can not be resolved on the server side.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.downloader.certificatesCheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setting this parameter to <code>false</code> disables certificate checks for <code>https</code> requests.
As a result, all <code>https</code> requests for viewing the preview will be blocked initially.
To allow requests against individual pages, the host name of the corresponding pages must be entered in the <code>sslWhitelist</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.downloader.sslWhitelist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the certificate check is deactivated, the host names to be excluded from the blocking are maintained via the <code>sslWhitelist</code>.
Several host names have to be entered as a comma-separated list.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Storefront Cache Parameter</strong></p>
</div>
<div class="paragraph">
<p>The HTML of slot-based pages downloaded by the <code>Preview Filter</code> is stored in a cache so that it does not have to be retrieved from the Commerce Cloud every time it is called.
Such a cache exists across sessions for each project on the FirstSpirit server.
This cache has some parameters that can be maintained in the <a href="#project_settings">project settings</a>.
The <code>Preview Filter</code> must be able to access this information and therefore needs to specify the associated input components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Like the <a href="#storefront-download-parameter">downloader parameters</a>, the cache parameters are used to initialize the filter in the slot-based approach.
For this reason they have a fixed fallback value in case of a missing or empty input component.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cache.maxEntries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontDownloaderMaxCacheEntries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying the maximum number of elements in the cache.<br>
The fallback value is 500.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cache.refreshAfterWrite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCacheRefreshAfterWrite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying the time span (in hours) until an element in the cache is marked as obsolete.<br>
The fallback value is 1.<br>
If an entry is marked as obsolete, it will be retrieved asynchronously from the Commerce Cloud at the next request.
Until this process is completed, the cache returns the obsolete entry, so there is no delay.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cache.expireAfterWrite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCacheExpireAfterWrite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying the time span (in hours) until an item in the cache is marked as removable.<br>
The fallback value is 24.<br>
If an entry is marked as removable, it can be displaced from the cache by new elements.
If an item is requested again after being displaced, it must be retrieved from the Commerce Cloud again.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storefront.cache.excludePatterns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps_storefrontCacheExcludePatterns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input component in the project settings for specifying storefront URLs that should not be kept in the cache.
The URLs are specified in the form of a list of regular expressions.<br>
The fallback value is an empty list.<br>
Each element of the list component must have a text field named <code>st_storefrontCacheExcludePattern</code> containing the regular expression.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>An example snippet of the <code>web.xml</code>, in which two parameters of the Preview Filter are configured, might look like as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example web.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;filter&gt;
   &lt;filter-name&gt;ContentConnectPreviewFilter&lt;/filter-name&gt;
   &lt;filter-class&gt;com.espirit.moddev.demandware.preview.PreviewFilter&lt;/filter-class&gt;
   &lt;init-param&gt;
      &lt;param-name&gt;storefront.downloader.socketTimeout&lt;/param-name&gt;
      &lt;param-value&gt;ps_myCustomStorefrontDownloaderSocketTimeout&lt;/param-value&gt;
   &lt;/init-param&gt;
   &lt;init-param&gt;
      &lt;param-name&gt;storefront.downloader.retryCount&lt;/param-name&gt;
      &lt;param-value&gt;ps_myCustomStorefrontDownloaderRetryCount&lt;/param-value&gt;
   &lt;/init-param&gt;
&lt;/filter&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resolutions"><a class="anchor" href="#resolutions"></a>4.7. Resolutions</h3>
<div class="paragraph">
<p>The reference project <em>ContentConnect Reference Project</em> has different sections, with which images can be integrated on the various pages.
It should be possible for the editor to crop the images to a certain image section.
This function is activated by specifying a resolution.</p>
</div>
<div class="listingblock">
<div class="title">Specifying the resolution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$CMS_REF(st_picture, resolution:"RESOLUTION")$</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the reference project, the following resolutions are required: <code>BANNER</code>, <code>SLIDE</code>, <code>GRID_ELEMENT_HIGH</code>, <code>GRID_ELEMENT_WIDE</code>, <code>GRID_ELEMENT_SQUARE</code>, <code>IMAGE_MAP</code>, <code>ARTICLE_TEASER_IMAGE</code> and <code>TECHNOLOGY_IMAGE</code>.
They are already applied within the <code><strong>ServerManager</strong></code> in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Resolutions</b></span></strong></code> area and specified in the corresponding areas in the sections.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/resolutions.png" alt="resolutions">
</div>
<div class="title">Figure 9. Resolutions</div>
</div>
</div>
<div class="sect2">
<h3 id="schedule"><a class="anchor" href="#schedule"></a>4.8. Deployment schedule</h3>
<div class="paragraph">
<p>To transfer the content created in FirstSpirit to the Commerce Cloud storage location, the reference project supplied has a schedule, which contains the actions specified below (see figure <a href="#actions">Generation schedule actions</a>).
A description of the individual actions is provided in the subsequent sub-chapters.</p>
</div>
<div class="paragraph">
<p>More information on creating a schedule is available in the <em><a href="https://docs.e-spirit.com/odfs/edocs/admi/introduction/index.html">FirstSpirit Documentation for Administrators</a></em>.</p>
</div>
<div id="actions" class="imageblock">
<div class="content">
<img src="_images/actions.png" alt="actions">
</div>
<div class="title">Figure 10. Generation schedule actions</div>
</div>
<div class="sect3">
<h4 id="sfccinitializer"><a class="anchor" href="#sfccinitializer"></a>4.8.1. Initialize SFCC deployment</h4>
<div class="paragraph">
<p>The first step is to initialize the deployment.
This involves setting up <a href="#sfcc_content_cleanup">content cleanup</a>.
While this is under way, a time stamp prior to the generation is created.
This time stamp is used by the <a href="#sfcccleanup">cleanup action</a> in the last step of the schedule to delete outdated assets and <a href="#slot_configuration">slot configurations</a>.
It is for this reason that the schedule contains the action <code>Salesforce Commerce Cloud Initializer</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sfcc_initializer.png" alt="sfcc initializer">
</div>
<div class="title">Figure 11. Schedule action</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use <a href="#sfcc_content_cleanup">content cleanup</a>, the initialization must be the first action of the schedule.
Otherwise this can lead to inconsistencies in the data inventory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="fdeployment"><a class="anchor" href="#fdeployment"></a>4.8.2. Content preparation - Full generation</h4>
<div class="paragraph">
<p>To deploy the content that is relevant to Commerce Cloud, it must be determined from the project first.
This requires a full generation to be carried out, generating all the referenced media in the correct resolution.
The full generation also generates the XML collectors initialized in the <a href="#project_settings">project settings</a> and fills them on the basis of the xmlCollector calls in the templates.</p>
</div>
<div class="paragraph">
<p>The schedule therefore has the generation action <code>Content Preparation</code> in whose <code><strong>Properties</strong></code> the following options are activated (see figure <a href="#content_preparation">Content preparation action</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Perform FullGeneration</code></p>
</li>
<li>
<p><code>Clear generation directory beforehand</code></p>
</li>
<li>
<p><code>Generate Media in the generation directory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The defined <code>Prefix for absolute paths</code> <code>/firstspirit</code> is required for the <a href="#wddeployment">WebDAV deployment</a> action.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is only possible to use the <a href="#wdmodule">WebDAV module</a> in conjunction with the default URL creator.
To generate the path, the entry <code>Default URLs</code> is therefore selected, which is absolutely essential at this point.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The template sets for all the languages present in the project are also selected on the <code><strong>Extended</strong></code> tab page.
In addition, the variable <code>dwre_xmlGeneration</code> is added, which contains the value <code>false</code>.
This is set to the value <code>true</code> in the subsequent <a href="#pdeployment"><code>XML Import File</code> actions</a> and ensures that the XML files for the <a href="#slot_configuration">slot configurations</a> and assets are only created once the generation is complete.
The XML template in the project controls the process of generating the XML file.</p>
</div>
<div id="content_preparation" class="imageblock">
<div class="content">
<img src="_images/content_preparation.png" alt="content preparation">
</div>
<div class="title">Figure 12. Content preparation action</div>
</div>
</div>
<div class="sect3">
<h4 id="pdeployment"><a class="anchor" href="#pdeployment"></a>4.8.3. XML import file - Partial generations</h4>
<div class="paragraph">
<p>Commerce Cloud expects all data that is transferred to it to be in the form of XML files.
For this reason, the information determined during the <a href="#fdeployment">full generation</a> must be read out of the XML collectors that are generated.
In this case, the information must instead be written to an XML file that has to be created each time.</p>
</div>
<div class="paragraph">
<p>For each XML collector initialized in the <a href="#project_settings">project settings</a>, the schedule provides another generation action.
In contrast to the <a href="#fdeployment"><code>Content Preparation</code></a> action, these are, however, partial generations.
In their <code><strong>Properties</strong></code>, the option <code>Execute partial generation for following start nodes</code> is therefore activated.
As a starting point, one of the page references based on the XML template is used (see figure <a href="#content_libary">Partial generation</a>).</p>
</div>
<div class="paragraph">
<p>The variable <code>dwre_xmlGeneration</code>, which contains the value <code>true</code>, is also added to the <code><strong>Extended</strong></code> tab page for each of these actions.
Together with the start node selected in each case, this ensures that the selected page reference is not generated until this point in time.
This means that all the information required for creating the XML file will be available when this happens and it will not be possible for any gaps to appear.
The XML template in the project controls the process of generating the XML file.</p>
</div>
<div id="content_libary" class="imageblock">
<div class="content">
<img src="_images/content_libary.png" alt="content libary">
</div>
<div class="title">Figure 13. Partial generation</div>
</div>
</div>
<div class="sect3">
<h4 id="wddeployment"><a class="anchor" href="#wddeployment"></a>4.8.4. WebDAV deployment</h4>
<div class="paragraph">
<p>Next, the XML files generated by means of the <a href="#pdeployment">partial generations</a> must be transferred to Commerce Cloud.
They are published via a script action, for which the following parameters are defined in their <code><strong>Properties</strong></code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/wdparameter.png" alt="wdparameter">
</div>
<div class="title">Figure 14. Properties</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">url</dt>
<dd>
<p>The <code>URL</code> specifies the host and the path on the WebDAV server.
It always has the following structure:</p>
<div class="paragraph">
<p><code>https://&lt;SUBDOMAIN INSTANCE&gt;.demandware.net/on/demandware.servlet/webdav/Sites/Impex/&#8230;&#8203;/&lt;PREFIX&gt;/&lt;SITE ID&gt;</code></p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The path points to the location where the XML file in question is expected to be during the import.
It must refer to an existing directory.<br>
Additionally, the prefix must be the same as the <code>Prefix for absolute paths</code> used in the <a href="#fdeployment">full generation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">user</dt>
<dd>
<p>A technical user who is authorized to use the WebDAV interface is required in order to transfer the data.
This user must have write permissions and must be specified by name here.</p>
<div class="paragraph">
<p>Further information about these rights can be found under <a href="https://documentation.b2c.commercecloud.salesforce.com/DOC2/topic/com.demandware.dochelp/Permissions/Creatingroles.html"><span class="menuseq"><b class="menu">Administering Your Organization</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Permissions</a> in the Salesforce documentation.</p>
</div>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>A password is also required for the user specified in the previous step.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The technical user is subject to the password conditions defined by Commerce Cloud, which require the password to be changed at least every quarter.
The parameter value must be changed each time this is carried out.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">mediaurl</dt>
<dd>
<p>The media folder generated during the generation process, and its content, must be transferred to a separate directory so that Commerce Cloud can perform the import.
This directory is defined using the parameter <code>mediaurl</code>.
The <code>mediaurl</code> always has the following structure:</p>
<div class="paragraph">
<p><code>https://&lt;SUBDOMAIN INSTANCE&gt;.demandware.net/on/demandware.servlet/webdav/Sites/Libraries/&lt;SITE ID|LIBRARY ID&gt;/default/&lt;PREFIX&gt;</code></p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>mediaurl</code> must refer to an existing directory.<br>
Furthermore, as with the <code>url</code>, the prefix must be the same as the <code>Prefix for absolute paths</code> used in the <a href="#fdeployment">full generation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a private library is being used, it is necessary to specify the site ID instead of the library ID in the path.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">srcprefixdir</dt>
<dd>
<p>If only one particular directory is transferred to Commerce Cloud, it can be specified in relation to the root node of the generation directory using the optional parameter <code>srcprefixdir</code>.
If the parameter is not defined, or no value is saved for it, the entire generation directory will be transferred.</p>
</dd>
<dt class="hdlist1">purge</dt>
<dd>
<p>This parameter is optional and may only have the value <code>true</code> or <code>false</code>.
If <code>true</code> is set, all the files and directories under the specified <code>URL</code> will be deleted before the transfer starts.
If the parameter is set to <code>false</code> or no value at all, all the existing files and directories under the specified <code>URL</code> will be retained.
New data will either be added or, in the case of existing data, overwritten.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The WebDAV deployment must not be executed in the event of an error.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_trigger_sfcc_import_job_schedule"><a class="anchor" href="#_trigger_sfcc_import_job_schedule"></a>4.8.5. Trigger SFCC import job schedule</h4>
<div class="paragraph">
<p>Following the publication of the created XML files via <a href="#wddeployment">WebDAV deployment</a>, the <a href="#sfcc_job_schedules">created job schedule</a> is executed.
In Salesforce, the job schedule triggers the import of the generated content and <a href="#slot_configuration">slot configurations</a> into Commerce Cloud.
The <em>ContentConnect</em> module provides the <code>Salesforce Commerce Cloud Importer</code> schedule action for this purpose:</p>
</div>
<div id="sfcc_task" class="imageblock">
<div class="content">
<img src="_images/sfcc_task.png" alt="sfcc task">
</div>
<div class="title">Figure 15. Schedule action</div>
</div>
<div class="paragraph">
<p>The action loads a configuration dialog, in which two parameters must be defined in addition to a freely assignable name.</p>
</div>
<div id="sfcc_task_config" class="imageblock">
<div class="content">
<img src="_images/import_schedule_task.png" alt="import schedule task">
</div>
<div class="title">Figure 16. Schedule action parameters</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Import Job ID</dt>
<dd>
<p>This field contains the ID of the <a href="#sfcc_job_schedules">created job schedule</a>.</p>
</dd>
<dt class="hdlist1">Timeout</dt>
<dd>
<p>The value in this field displays the time span in seconds, in which the status of the job schedule will be queried every second.
If the job schedule has not completed in the specified time span, this schedule action is indicated as having an error.
The default value is 10 seconds.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As the <code><strong>Salesforce Commerce Cloud Importer</strong></code> requires a successful <a href="#wddeployment">WebDAV deployment</a>, this too must not be executed in the event of an error.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sfcccleanup"><a class="anchor" href="#sfcccleanup"></a>4.8.6. Salesforce Commerce Cloud Cleanup</h4>
<div class="paragraph">
<p>Once the <a href="#sfcc_job_schedules">created job schedule</a> has been executed, content cleanup is executed.
All outdated assets and <a href="#slot_configuration">slot configurations</a> are queried by the <a href="#ocapisettings">OC API</a> and then deleted.
The <em>ContentConnect</em> module provides the <code>Salesforce Commerce Cloud Cleanup</code> schedule action for this purpose:</p>
</div>
<div id="sfcc_task" class="imageblock">
<div class="content">
<img src="_images/sfcc_cleanup.png" alt="sfcc cleanup">
</div>
<div class="title">Figure 17. Schedule action</div>
</div>
<div class="paragraph">
<p>In addition to a freely assignable name for this schedule action, the associated configuration dialog contains the following parameters:</p>
</div>
<div id="sfcc_task_config" class="imageblock">
<div class="content">
<img src="_images/cleanup_schedule_task.png" alt="cleanup schedule task">
</div>
<div class="title">Figure 18. Schedule action parameters</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Use different site</dt>
<dd>
<p>Content cleanup uses a Commerce Cloud site to find the content assets and slot configurations to be deleted.
The checkbox <code>Use different site</code> allows the use of content cleanup for a site other than the <a href="#project-app-config-base-url">configured</a> site.</p>
</dd>
</dl>
</div>
<div id="cleanupSiteId" class="dlist">
<dl>
<dt class="hdlist1">Site Id</dt>
<dd>
<p>If the <code>Use different site</code> checkbox is active, the Commerce Cloud site to be used for content cleanup must be specified in this field.</p>
</dd>
<dt class="hdlist1"><span class="menuseq"><b class="menu">Content asset cleanup</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Enabled</b></span></dt>
<dd>
<p>This checkbox allows to enable/disable the content cleanup of assets.</p>
</dd>
<dt class="hdlist1">Library Id</dt>
<dd>
<p>The ID of the Content Library from that Content Assets are deleted must be entered in this field.
In the case of a private library, the library ID corresponds to the site ID.</p>
</dd>
</dl>
</div>
<div id="additionalRefinements" class="dlist">
<dl>
<dt class="hdlist1">Additional refinement(s)</dt>
<dd>
<p>In this field, attribute names and values can be specified for further filtering of the content assets to be deleted.
The specification must have the following form:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">ATTRIBUTE_NAME=ATTRIBUTE_VALUE [; ATTRIBUTE_NAME=ATTRIBUTE_VALUE] ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attribute values can contain the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Replacement by</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#36;&#123;projectId&#125;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the generated FirstSpirit project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#36;&#123;projectName&#125;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the generated FirstSpirit project</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The specified attributes must exist as custom attributes in the Commerce Cloud and have been filled with values via the <a href="#generation">FirstSpirit generation</a> before the filtering described here can be used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><span class="menuseq"><b class="menu">Slot configuration cleanup</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Enabled</b></span></dt>
<dd>
<p>This checkbox allows the de-/activation of the content cleanup from <a href="#slot_configuration">Slot configurations</a>.</p>
</dd>
<dt class="hdlist1">Filter query</dt>
<dd>
<p>This field is used to filter the <a href="#slot_configuration">slot configurations</a> to be deleted.
A filter is specified as a <a href="https://documentation.b2c.commercecloud.salesforce.com/DOC2/topic/com.demandware.dochelp/OCAPI/current/data/Documents/Query.html">query document</a> in JSON format.
Within the query, the parameters of the field <a href="#additionalRefinements">Additional refinement(s)</a> can be used, as the following example of a
<a href="https://documentation.b2c.commercecloud.salesforce.com/DOC2/topic/com.demandware.dochelp/OCAPI/current/data/Documents/TextQuery.html">TextQuery</a> illustrates:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"text_query": {
    "fields": ["c_fsProjectId"],
    "search_phrase": "${projectId}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>Filter query</code> field remains empty, the <em>ContentConnect</em> module uses a <a href="https://documentation.b2c.commercecloud.salesforce.com/DOC2/topic/com.demandware.dochelp/OCAPI/current/data/Documents/MatchAllQuery.html">MatchAllQuery</a>,
whereby the <a href="#slot_configuration">slot configurations</a> to be deleted are not further filtered.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid inconsistencies in the database or data loss, the action <code><strong>Salesforce Commerce Cloud Cleanup</strong></code> must be the last action of the schedule.
For the same reason, <a href="#sfcc_content_cleanup">content cleanup</a> requires that this action only performs full generations.
Furthermore, replication within the Commerce Cloud is not recommended during the execution of the cleanup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the <code><strong>Salesforce Commerce Cloud Cleanup</strong></code> requires a successful execution of the <a href="#sfcc_job_schedules">job schedules</a> and thus the import of the content, it must not be executed in the event of an error.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_workflows"><a class="anchor" href="#_workflows"></a>4.9. Workflows</h3>
<div class="paragraph">
<p>Content is released, deleted, and published by editors within the supplied reference project <em>ContentConnect Reference Project</em> via workflows.
For this reason, it contains a publish workflow, as well as the <em>BasicWorkflows</em>, which can be used as an alternative to project-specific workflows.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Installing the BasicWorkflows module</strong></span></p>
</div>
<div class="paragraph">
<p>Before using the workflows, you must install the <em>BasicWorkflows</em> module on the FirstSpirit server and activate the web component.
The necessary steps are the same as for <a href="#install">installing the other modules</a> and <a href="#wcomp">activating the associated web components</a>.
However, the web component for the <em>BasicWorkflows</em> is only needed on the <code>ContentCreator</code> tab page.</p>
</div>
<div class="paragraph">
<p>In addition, to use <em>BasicWorkflows</em> in the ContentCreator, the provided <code>BasicWorkflows Status Provider</code> must be selected in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">ContentCreator</b></span></strong></code> area within the <code><strong>ServerManager</strong></code>.
In the reference project <em>ContentConnect Reference Project</em>, this setting has already been applied (see figure <a href="#statusprovider">Element Status Provider</a>).</p>
</div>
<div id="statusprovider" class="imageblock">
<div class="content">
<img src="_images/statusprovider.png" alt="statusprovider">
</div>
<div class="title">Figure 19. Element Status Provider</div>
</div>
<div class="paragraph">
<p>In addition, in the <code><strong><span class="menuseq"><b class="menu">Project properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Options</b></span></strong></code> area, the <code>Workflow for deleting elements</code> is preselected.
As a result, any action to delete elements within the project (Del button, delete icon) is executed via this workflow.
The native (independent of a workflow) deletion of elements is therefore not available - not even for the administrator.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Templates</strong></span></p>
</div>
<div class="paragraph">
<p>The <em>BasicWorkflows</em> and the workflow supplied with the <em>StarterPackage</em> require different templates.
Usually, these need to be imported for the <em>BasicWorkflows</em> via the context menu in the FirstSpirit project used.
However, they are already available in the reference project and importing the templates is therefore not necessary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The publish workflow initiates the <a href="#schedule">deployment schedule</a> and requires its name for this.
If this deviates from the <em>Generate and deploy to SFCC</em> expression, the value of the <code>scheduleName</code> variables must be adjusted accordingly within the script <em>SFCC Release Deployment</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Permission assignment</strong></span></p>
</div>
<div class="paragraph">
<p>In the final step, the workflows must be authorized in the individual stores so that they can be executed on FirstSpirit elements.
To do this, select <code><strong><span class="menuseq"><b class="menu">Extras</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Change permissions</b></span></strong></code> from the context menu of the stores' root nodes to call up the permission assignment.
This step has also already been carried out in the reference project and is therefore omitted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The permissions for executing workflows set on the stores' root nodes relate to the <code>Everyone</code> group.
This can only be changed by modifying the permissions manually.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can find more detailed information in the <em><a href="https://docs.e-spirit.com/module/basicworkflows/BasicWorkflows_Documentation_EN.html">BasicWorkflows Documentation</a></em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="project_settings"><a class="anchor" href="#project_settings"></a>4.10. Project settings</h3>
<div class="paragraph">
<p>There is some essential project-specific information that needs to be entered for the connection between FirstSpirit and Commerce Cloud (see figure <a href="#p_settings">Project settings</a>).
It is entered using the project settings form and must be specified within the reference project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changes to the project settings do not take effect straight away, as they are saved in the session of the user.
They require the client to be restarted.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="p_settings" class="imageblock">
<div class="content">
<img src="_images/p_settings.png" alt="p settings">
</div>
<div class="title">Figure 20. Project settings</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Storefront Base URL</dt>
<dd>
<p>The field is used to specify the storefront&#8217;s base URL, which is extended with the page type and the ID of the element to be displayed (e.g., product, category, or asset ID).
It has the following format:</p>
<div class="paragraph">
<p><code>https://&lt;SUBDOMAIN INSTANCE&gt;/on/demandware.store/Sites-&lt;SIDE ID&gt;-Site</code></p>
</div>
<div class="paragraph">
<p>More information on the storefront base URL is available in the <em>Commerce Cloud Documentation</em> in the chapter <a href="https://documentation.demandware.com/DOC2/topic/com.demandware.dochelp/SearchEngineOptimization/DigitalURLSyntaxWithoutSEO.html"><span class="menuseq"><b class="menu">Merchandising Your Site</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Search Engine Optimization</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">URL Syntax</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Salesforce B2C Commerce URL Syntax Without SEO</b></span></a>.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a value of the storefront base URL, only up to the locale, <strong>not</strong> the entire URL must be entered in accordance with its specified format.</p>
</div>
<div class="paragraph">
<p>Example:<br>
<code>https://www.mystore.com/on/demandware.store/​Sites-YourShopHere-Site/</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SFCC Content Asset ID Prefix</dt>
<dd>
<p>To uniquely identify the content assets generated by FirstSpirit, a prefix for the content asset ID is to be defined at this point.</p>
</dd>
<dt class="hdlist1">Preview Protection (BasicAuth)</dt>
<dd>
<p>Within Commerce Cloud, it is possible to protect access to the storefront by activating the <code>Online (protected)</code> site status.
If this restriction is applied, the <code>storefront</code> user must be specified in FirstSpirit.
Activating the toggle displays the <code>User</code> and <code>Password</code> fields.</p>
</dd>
<dt class="hdlist1">User</dt>
<dd>
<p>If access restriction is activated in Commerce Cloud, the <code>storefront</code> user must be specified in this field.</p>
</dd>
<dt class="hdlist1">Password</dt>
<dd>
<p>The password belonging to the <code>storefront</code> user is specified in this field.</p>
</dd>
<dt class="hdlist1">StarterPackage Version</dt>
<dd>
<p>This field is solely utilized to display the version of the used reference project.</p>
</dd>
<dt class="hdlist1">Enable Custom Affixes</dt>
<dd>
<p>The toggle makes it possible to use individual affixes for the HTML comments included in the templates, which are used to indicate the content to be substituted for the preview.
These have the format <code>&lt;!-- CMS-&lt;IDENTIFIER&gt;-START -&#8594;</code> or <code>&lt;!-- CMS-&lt;IDENTIFIER&gt;-END -&#8594;</code> by default.
When the toggle is activated, all four affixes are overwritten and the default values are therefore no longer taken into account.
The specific values can then be specified using the following fields.
If one of the form fields is missing even though the toggle is activated, an empty string is used for the corresponding affix.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the individual affixes, the format <code>&lt;!-- [OPENING_PREFIX]&lt;IDENTIFIER&gt;[OPENING_SUFFIX] -&#8594;</code> or <code>&lt;!-- [CLOSING_PREFIX]&lt;IDENTIFIER&gt;[CLOSING_SUFFIX] -&#8594;</code> applies.</p>
</div>
<div class="paragraph">
<p>Spaces that are entered in the configuration fields in front of or behind an individual affix are ignored.</p>
</div>
<div class="paragraph">
<p>If the toggle is activated without at least one affix defined, this can lead to unexpected behavior.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Within the reference project, all HTML comments have the standard format.
For this reason, the template for the project settings does not include the toggle or the form fields for the use of individual affixes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Opening Prefix/Opening Suffix</dt>
<dd>
<p>Together with the identifier, the opening prefix and the opening suffix form the start HTML comment and mark the beginning of the content to be substituted.</p>
</dd>
<dt class="hdlist1">Closing Prefix/Closing Suffix</dt>
<dd>
<p>Together with the identifier, the closing prefix and the closing suffix form the end HTML comment and mark the end of the content to be substituted.</p>
</dd>
<dt class="hdlist1">Storefront-URL Controller Form Field</dt>
<dd>
<p>To determine the storefront URL, the ContentConnect Preview Filter must know which controller (e.g., Home, Page or Search) it needs to address.
This information generally depends on the page to be displayed, which is why the Preview Filter reads it out from an input component on the preview page form.
The Preview Filter uses the <code>pt_storefrontUrlController</code> field by default.
This behavior can be configured in the project settings using the <code>ps_storefrontUrlControllerFormField</code> field, in which the name of the form field to be read out is entered if required.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Within the reference project, all page templates have the <code>pt_storefrontUrlController</code> input component as standard.
For this reason, the field for configuring its name is not included in the template for project settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Storefront-URL Context ID Form Field</dt>
<dd>
<p>In addition to the controller, the ContentConnect Preview Filter may in some cases require an ID (such as a product, category, or content asset ID); it also determines this on the basis of the page form.
There is the option of configuring the corresponding form field in the project settings using the <code>ps_storefrontUrlContextIdFormField</code> field.
The Preview Filter reads out the <code>pt_storefrontUrlContextId</code> component by default.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Within the reference project, all page templates have the <code>pt_storefrontUrlContextId</code> input component as standard.
For this reason, the field for configuring its name is not included in the template for project settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, the template is used to initialize two XML collectors and a Product Manager, which are used in the other page and section templates of the project.
These page and section templates define which data is to be transferred to Commerce Cloud.
During the <a href="#fdeployment">generation process</a>, the data is collected on the basis of these definitions and the XML collectors are filled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If there are project-specific requirements for the XML collectors, then these can be adapted using the methods from the <code>XmlCollectorFactoryExecutable</code> class.
The information required for this is contained in the Javadoc for the class.</p>
</div>
<div class="paragraph">
<p>Information on calling up the Product Manager is contained in the Javadoc for the <code>ManagerFactoryExecutable</code> class.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_cases"><a class="anchor" href="#_use_cases"></a>5. Use cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>ContentConnect</em> module provides various options for accessing Commerce Cloud content and for using this in FirstSpirit.
These functions are equivalent in both clients and are described in the following using the reference project <em>ContentConnect Reference Project</em> supplied in the form of use cases.
The description of each use case is aimed at editors as well as FirstSpirit developers.</p>
</div>
<div class="sect2">
<h3 id="uc_preview"><a class="anchor" href="#uc_preview"></a>5.1. Preview</h3>
<div class="paragraph">
<p>To display the preview of a page, the <a href="#webconf">ContentConnect Preview Filter</a> determines the necessary information on the Salesforce side.
In the slot-based approach, it identifies the correct storefront URL for this purpose, downloads the HTML on the basis of this URL, and substitutes the slots it contains with the corresponding editorial content.
The slots are uniquely labeled with HTML comments and are represented in FirstSpirit by the content areas of a page template.
If the <code>Content Integration API</code> is being used, however, the Preview Filter has the Velocity fragments maintained in FirstSpirit evaluated on the Salesforce side, and displays the result at the corresponding point on the page.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The editorial content is created and maintained in FirstSpirit.
Editors have the standard tools available to them and do not require any additional knowledge.
From the view of an editor, the content of both systems is automatically merged and displayed in the preview or in the ContentCreator.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The pages within the reference project that is supplied are based on the slot-based approach as standard.
However, as is the case in the example of the <a href="#catdetailpage">category detail page</a>, it is also possible to use the <code>CI API</code>.
The two approaches are fundamentally different from one another, and whichever one is being used is automatically taken into account by the <a href="#webconf">ContentConnect Preview Filter</a> when a preview is being generated.</p>
</div>
<div class="paragraph">
<p><strong>Slot-based approach</strong><br>
Within the reference project supplied, the slots from Salesforce are represented by the content areas of the page templates.
Sections can be added to them; each one corresponds to an asset and, depending on the use case, also has a <a href="#slot_configuration">slot configuration</a>.
To display a page in the preview, the slots contained in the downloaded HTML are substituted by the editorial content.</p>
</div>
<div class="paragraph">
<p>For the substitution, all content relevant for the preview must be labeled with unique HTML comments.
From a technical point of view, these can occur in every template but are only included in page templates in the reference project.
Each consists of a start as well as an end comment and has the format <code>&lt;!-- CMS-&lt;IDENTIFIER&gt;-START -&#8594;</code> or <code>&lt;!-- CMS-&lt;IDENTIFIER&gt;-END -&#8594;</code> by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of individual affixes can be activated for HTML comments via a toggle in the <a href="#project_settings">project settings</a>, which must be added if necessary.
In this case, the default values are overwritten and specific prefixes and suffixes are used instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These exact same HTML comments must also be inserted into the storefront page by the Salesforce developer, and the slots to be substituted must be indicated.
It is important to make sure that the identifier in the FirstSpirit template and in the storefront page match.
Otherwise, there is an error in the presentation of the preview.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Using the Content Integration API</strong><br>
The <code>Content Integration API</code> enables Velocity fragments to be evaluated on the Salesforce side.
These fragments are maintained in the FirstSpirit templates and substituted when a page is displayed in the preview.
For this purpose, the Preview Filter receives the results of the evaluation conducted on the Salesforce side and inserts them at the corresponding points on the page.
The Velocity fragments must also be labeled with unique HTML comments to enable the Preview Filter to carry out this step.
The comments consist of a start comment and an end comment, and must always use the following format: <code>&lt;!-- CMS-VELOCITY-&lt;IDENTIFIER&gt;-START -&#8594;</code> or <code>&lt;!-- CMS-VELOCITY-&lt;IDENTIFIER&gt;-END -&#8594;</code>.</p>
</div>
<div class="paragraph">
<p><strong>Substitutions with regular expressions</strong><br>
Should further substitutions be additionally required, specific regular expressions can be defined.
These have their own syntax and always take the following form:</p>
</div>
<div class="listingblock">
<div class="title">Syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">&lt;!-- CMS-REGEX-PATTERN-START --&gt;
   regex-match="&lt;REGEX&gt;"
   regex-value="&lt;REPLACEMENT&gt;"
&lt;!-- CMS-REGEX-PATTERN-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>While the expression <code>regex-match</code> saves the regular expression, it is the expression <code>regex-value</code> that specifies the content, which will substitute all regex matches in the document.
Both expressions are to be summarized as an instruction by the HTML comments <code>&lt;!-- CMS-REGEX-PATTERN-START -&#8594;</code> and <code>&lt;!-- CMS-REGEX-PATTERN-END -&#8594;</code>.</p>
</div>
<div class="paragraph">
<p>With respect to the reference project, for example in the <em>Preview Generation</em> format template, this enables additional CSS to be integrated into each page template or any link on the <a href="#hp">Homepage</a> to be substituted:</p>
</div>
<div class="listingblock">
<div class="title">Format template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$-- Set Bootstrap CSS--$
&lt;!-- CMS-REGEX-PATTERN-START --&gt;
   regex-match="&lt;\/head&gt;"
   regex-value="$CMS_IF(#global.is("PREVIEW"))$$CMS_RENDER(template: "preview_css_additions")$$CMS_END_IF$&lt;/head&gt;"
&lt;!-- CMS-REGEX-PATTERN-END --&gt;

$-- Change Homepage Reference --$
&lt;!-- CMS-REGEX-PATTERN-START --&gt;
   regex-match="href=("|').*.home[?]"
   regex-value="href="$CMS_REF(pageref:"homepage")$""
&lt;!-- CMS-REGEX-PATTERN-END --&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a convert2 is used within the regular expressions applied, it is important to make sure that all special characters are correctly resolved.
It may be necessary to adjust the conversion rule, in particular in conjunction with the dollar sign (<code><strong><span class="menuseq"><b class="menu">ServerManager</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Server properties</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Conversion rules</b></span></strong></code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that the replacement of the URL depends on the new storefront URL.
The settings can be found under the menu item <code><strong><span class="menuseq"><b class="menu">Merchant Tools</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Site Preferences</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Storefront URL</b></span></strong></code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>ContentConnect Preview Language</strong></p>
</div>
<div class="paragraph">
<p>The following pattern is needed to configure the display language in the ContentCreator:</p>
</div>
<div class="listingblock">
<div class="title">Pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$-- Set Preview Language --$
&lt;!-- CMS-PARAM-PREVIEWLANG-START --&gt;
	$CMS_VALUE(set_previewLang)$
&lt;!-- CMS-PARAM-PREVIEWLANG-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The format of the language abbreviation that is provided within the pattern is explained by the paragraph <a href="#generationlocale">Determining the locale</a>.
If the Preview Filter cannot find this pattern it will use <code>default</code> as a value for the preview language.</p>
</div>
<div id="uc_preview_proxy" class="paragraph">
<p><strong>ContentConnect preview proxy</strong></p>
</div>
<div class="paragraph">
<p>If problems with cross-origin requests occur during the preview due to the same-origin policy of modern web servers, then these can be remedied by using the preview proxy included in the <em>ContentConnect</em> module.</p>
</div>
<div class="paragraph">
<p>In the supplied reference project, this is the case when loading the Font Awesome font via an integrated CSS file, for example.
If the preview proxy is not used, a cross-origin request will be executed when the font is loaded, which will be blocked by the same-origin policy.</p>
</div>
<div class="paragraph">
<p>To manage the loading of the resources in question via the preview proxy and therefore avoid cross-origin requests, the <em>Preview Generation</em> format template includes the following regular expression.
As a result, the configuration of the supplied web server does not need to be adapted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the preconfigured <code>/proxy</code> URL path is not to be used for the preview proxy, it must be adjusted in both the format template and in the <code>web.xml</code>.
A more detailed description of the configuration options via the <code>web.xml</code> is given in the chapter <a href="#webconf">Configuration of the web component</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Proxy integration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$-- Redirect to proxy --$
&lt;!-- CMS-REGEX-PATTERN-START --&gt;
   regex-match="[^"'(]*?\/on\/demandware\.static\/"
   $CMS_IF(#global.is("WEBEDIT"))$
      regex-value="/fs5webedit_$CMS_VALUE(#global.project.id)$/s=****/proxy/on/demandware.static/"
   $CMS_ELSE$
      regex-value="/fs5preview_$CMS_VALUE(#global.project.id)$/proxy/on/demandware.static/"
   $CMS_END_IF$
&lt;!-- CMS-REGEX-PATTERN-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Troubleshooting</strong></p>
</div>
<div class="paragraph">
<p>ContentConnect supports developers when analyzing problems and errors in the preview, such as erroneous substitutions or poor response times while generating a preview.</p>
</div>
<div class="paragraph">
<p>Developers can add special parameters to the URL of a preview page in order to influence how the Preview Filter works and receive useful information as a result.
The available URL extensions are <code>/debugTimings=true</code> and <code>/debugCCFilter=true</code>.</p>
</div>
<div class="paragraph">
<p><code>/debugTimings=true</code> instructs the Preview Filter to write the execution times of its processing steps as a comment at the end of the HTML document.
For this purpose, the Preview Filter measures the duration of the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Search for content to be substituted</p>
</li>
<li>
<p>Substitution of slots with the current editorial content</p>
</li>
<li>
<p>Execution of particular substitutions via specific regular expressions</p>
</li>
<li>
<p>Complete processing of the page</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this parameter is specified, the Preview Filter generates the following output for the homepage of the reference project:</p>
</div>
<div class="listingblock">
<div class="title">Output of the Preview Filter for the homepage with /debugTimings=true</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!--
*** TIMING STATS ***

LANGUAGE-DROPDOWN = 0ms
&amp;lt;script [^&amp;lt;]*?/dwux-init.js.*?&amp;lt;/script&amp;gt; = 0ms
[^&amp;quot;'(]*/s/SiteGenesisGlobal_MF_SP/[^&amp;quot;')]* = 53ms
Scanning for content replacement blocks = 1ms
CUSTOM-NAVIGATION-LEFT = 0ms
[^&amp;quot;'(]*?/on/demandware.static/ = 113ms
(&amp;lt;!-- dw.+?--&amp;gt;) = 1ms
&amp;lt;iframe.*?id=&amp;quot;DW-SFToolkit&amp;quot;&amp;gt;.*?&amp;lt;/iframe&amp;gt; = 1ms
LANGUAGE-DROPDOWN-MOBILE = 0ms
&amp;lt;a.*?sid=&amp;quot;([^&amp;quot;]*?)&amp;quot; = 1ms
&amp;lt;/head&amp;gt; = 0ms
WILL-IGNORE-FOR-PREVIEW = 0ms
HOME-CATEGORIES = 0ms
href=(&amp;quot;|').*.home[?] = 1ms
&amp;lt;!-- Demandware Analytics(([sS]*)&amp;lt;/script&amp;gt;) = 1ms
&amp;lt;!-- Demandware Active Data (([sS]*)&amp;lt;/script&amp;gt;) = 0ms
HOME-MAIN = 0ms
HOME-CC-OVERRIDE = 0ms

Total time = 172ms

--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, the Preview Filter logs some information in the FirstSpirit Server log if the <code>/debugTimings=true</code> parameter is specified.</p>
</div>
<div class="paragraph">
<p><code>/debugCCFilter=true</code> means that the Preview Filter does not download the storefront, perform substitutions or present the result in the preview.
The page actually generated by FirstSpirit is shown in the preview instead.
The HTML therefore contains the substitution comments and specifications in addition to the editorial content.
If this parameter is specified, the Preview Filter therefore generates the following output (in a shortened form) for the homepage of the reference project:</p>
</div>
<div class="listingblock">
<div class="title">Output of the Preview Filter for the homepage with /debugCCFilter=true</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!-- CMS-HOME-MAIN-START --&gt;
    [...]
&lt;!-- CMS-HOME-MAIN-END --&gt;

&lt;!-- CMS-HOME-CATEGORIES-START --&gt;
    [...]
&lt;!-- CMS-HOME-CATEGORIES-END --&gt;

[...]

&lt;!-- CMS-REGEX-PATTERN-START --&gt;
    regex-match="href=("|').*.home[?]"
    regex-value="href="/fs5webedit_90169/s=qgkM/preview/90169/site/EN_GB/current/90172/90361""
&lt;!-- CMS-REGEX-PATTERN-END --&gt;

[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using these functions requires a preview page to be called up.
The address of the preview page must have one of the parameters presented here added to it.
There are various ways of doing this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Via the iFrame address in the ContentCreator</p>
</li>
<li>
<p>Via the address of a page in the external preview</p>
</li>
<li>
<p>Via generated links in the FirstSpirit preview, as shown here using the example of links on the homepage:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!-- CMS-REGEX-PATTERN-START --&gt;
    regex-match="href=("|').*.home[?]"
    regex-value="href="$CMS_REF(pageref:"homepage")$/debugCCFilter=true""
&lt;!-- CMS-REGEX-PATTERN-END --&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to their functions, the <code>/debugTimings=true</code> and <code>/debugCCFilter=true</code> parameters cannot be used in combination with one another.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="generation"><a class="anchor" href="#generation"></a>5.2. Generation</h3>
<div class="paragraph">
<p>In order to deploy editorial content, FirstSpirit generates two XML files, which contain content assets and <a href="#slot_configuration">slot configurations</a>, and are transferred to the Commerce Cloud.
The corresponding <a href="#generation_and_deployment">generation and deployment schedule</a> has already been described.
This description also explains that templates in their presentation channels populate XML collectors with content (content assets) and <a href="#slot_configuration">slot configurations</a>.
These collectors are initialized in the <a href="#project_settings">project settings</a>.
All content and configurations to be deployed must be written to the XML collectors.
Otherwise, they will not be transferred.</p>
</div>
<div class="paragraph">
<p>One asset and one slot configuration are typically generated for each section, allowing for personalization at the section level.
<a href="#contentpage">Content pages</a> are the only exception.
In this case, a total of precisely one content asset and one slot configuration are created.</p>
</div>
<div class="paragraph">
<p>This chapter explains how the content and configurations of the project are collected and the XML files generated.</p>
</div>
<div class="sect3">
<h4 id="_content_assets"><a class="anchor" href="#_content_assets"></a>5.2.1. Content Assets</h4>
<div class="paragraph">
<p>Populating the XML collector for content assets involves the following steps:</p>
</div>
<div class="paragraph">
<p><strong>Generating a content asset ID using a project-wide convention</strong></p>
</div>
<div class="paragraph">
<p>In the reference project, the ID of a content asset is comprised of a project-wide prefix, the ID of the generated page reference, and the section ID.
These components are separated from one another by means of a hyphen and any underscores are substituted with hyphens.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case of a content page the content asset ID simply consists of the prefix and the ID of the generated page reference.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(set_xml_id, ps_dwAssetIdPrefix + "-" + #global.node.uid + "-" + #global.section.id)$
$CMS_SET(set_xml_id, set_xml_id.replaceAll("_","-"))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Creating a new content asset in the XML collector</strong></p>
</div>
<div class="paragraph">
<p>Once the ID has been determined, a new content asset is created in the XML collector using the <code>useOrCreateContentNode</code> method.
This asset must be populated with the content of all generated languages during the full generation.
For this reason, <code>useOrCreateContentNode</code> only generates a new asset if no asset with the specified ID already exists.
All subsequent method calls on the XML collector then operate on this asset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.useOrCreateContentNode(set_xml_id))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a new content asset is created, the <code>fsGenerationTime</code> custom attribute is automatically added along with the current time stamp of the generation.
This is necessary to ensure that the <a href="#sfcccleanup">content cleanup</a> only deletes obsolete content assets from the Commerce Cloud after deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The value of this attribute must not be changed manually following this.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="generationlocale" class="paragraph">
<p><strong>Determining the locale</strong></p>
</div>
<div class="paragraph">
<p>Some of the following actions require a locale to be specified for the Commerce Cloud.
For this purpose, the <em>language_mapping</em> format template maps a FirstSpirit language onto a locale of this kind, and is therefore included in each page.
In the template, two variables are generated in the context of the page: <code>set_previewLang</code> and <code>set_xml_lang</code>.
The first of these is used for generating the preview and has the format <code>&lt;language_COUNTRY&gt;</code>.
An example of a potential value is <code>fr_FR</code>.
The <a href="#hp">Homepage</a> chapter also describes this aspect of the template in greater detail.</p>
</div>
<div class="paragraph">
<p>The <code>set_xml_lang</code> variable is used during the process of populating the content assets.
Its value for the master language is x-<code>default</code>.
In all other cases, it assumes the value of <code>set_previewLang</code>, but substitutes the underscore with a hyphen.</p>
</div>
<div class="paragraph">
<p>Since both variables are set in the context of the generated page, they are available in all sections of the page and can therefore be used both for generating the preview and for populating the XML collectors.</p>
</div>
<div class="paragraph">
<p><strong>Setting the display-name property</strong></p>
</div>
<div class="paragraph">
<p>For each language, the display name of the generated page reference corresponds to the display name of the associated content asset, which is set during generation by means of the <code>addContentAttribute</code> method.
The <code>set_xml_lang</code> variable described above is required for this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addContentAttribute({
    "name":"display-name",
    "value":#global.node.getDisplayName(#global.language).toString(),
    "attributes":{
        "xml:lang":set_xml_lang
    }
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting the searchable-flag property to true</strong></p>
</div>
<div class="paragraph">
<p>The content asset needs to be included in the search index of the Commerce Cloud, which is why the <code>searchable-flag</code> attribute is set to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addContentAttribute({
    "name":"searchable-flag",
    "value":"true"
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting the online-flag property to true</strong></p>
</div>
<div class="paragraph">
<p>The asset also needs to be available in the shop, which is why the <code>online-flag</code> attribute is also set to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addContentAttribute({
    "name":"online-flag",
    "value":"true"
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting the body property</strong></p>
</div>
<div class="paragraph">
<p>The editorial content from FirstSpirit is saved in the <code>body</code> custom attribute.
The <code>set_xml_body</code> variable is first created in the reference project, and the rendered content is then stored in this variable.
The variable is then transferred to the XML collector.
The collector automatically embeds the content in a CDATA section, which means that no special preparation is required.
Since the content is language-dependent, the locale in <code>set_xml_lang</code> is used in this step too.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addCustomAttribute({
    "id":"body",
    "cdata":set_xml_body.toString(),
    "attributes":{
        "xml:lang":set_xml_lang
    }
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Folder</strong></p>
</div>
<div class="paragraph">
<p>The Commerce Cloud makes it possible to specify a library folder in which it is to store a content asset.
For this purpose, the XML collector provides the <code>addFolderAttribute</code> method, which receives the ID of this kind of folder.
In the reference project, the folder containing all the content assets for a page is stored in the form for the page itself.
Each page template transfers the value of the corresponding form field to the <code>set_parent_id</code> variable.
The sections then use this variable to generate their assets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollector.addFolderAttribute({
    "id":set_parent_id
}))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Folders that are referenced in this way must be identified to the Commerce Cloud by means of corresponding nodes in the generated XML file.
This allows the Commerce Cloud to create any missing folders.
The <a href="#xml_generation">XML</a> template takes responsibility for this task, and generates a defined set of folders.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unless any additional measures are taken, only the IDs of these folders can be reliably used in the reference project when generating content assets.
This is because FirstSpirit is only able to guarantee that precisely these folders exist.
In the reference project, the corresponding form elements are therefore hidden in the page templates and assigned fallback values.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_slot_configurations"><a class="anchor" href="#_slot_configurations"></a>5.2.2. Slot configurations</h4>
<div class="paragraph">
<p>The XML collector for <a href="#slot_configuration">slot configurations</a> is populated in the <em>Slot Configuration</em> link template.
Therefore, both pages as well as sections output the corresponding form elements directly via <code>$CMS_VALUE$</code> calls:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_IF(!st_slotConfig.isEmpty)$
    $CMS_FOR(_slotConfig,st_slotConfig)$
        $CMS_VALUE(_slotConfig)$
    $CMS_END_FOR$
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML for slot configurations is manually assembled in the <em>Slot Configuration</em> template and written to the appropriate collector using the <code>addXml</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(void, ps_xmlCollectorContentSlot.addXml(null, set_slotConfig.toString(), null))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the process of creating the content asset, the <code>fsGenerationTime</code> custom attribute is automatically added to a slot configuration along with the current time stamp of the generation.
This is necessary to ensure that the <a href="#sfcccleanup">content cleanup</a> only deletes obsolete slot configurations from the Commerce Cloud after the deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The value of this attribute must not be changed manually following this.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="xml_generation"><a class="anchor" href="#xml_generation"></a>5.2.3. Generating the XML files</h4>
<div class="paragraph">
<p>Both generated XML files are based on the XML page template, which reads out the collected content and slot configurations from the XML collectors.
For this purpose, the <a href="#schedule">deployment schedule</a> performs three generations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <a href="#fdeployment">full generation</a> for populating the XML collectors,</p>
</li>
<li>
<p>a <a href="#pdeployment">partial generation</a> for writing the content assets to an XML file, and</p>
</li>
<li>
<p>a <a href="#pdeployment">partial generation</a> for writing the slot configurations to an XML file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The full generation must be completed before FirstSpirit can generate the XML files, which is why this step cancels the generation of the XML template.
This is done using the <code>dwre_xmlGeneration</code> schedule variable, which has the value <code>false</code> in the <a href="#fdeployment">full generation</a> and the value <code>true</code> in both <a href="#pdeployment">partial generations</a>.</p>
</div>
<div class="paragraph">
<p>Since both files are based on the same template, a feature is necessary in order to determine which XML collector is read out.
This feature is the <code>ps_importType</code> form field, which can assume the <code>content_library</code> and <code>content_slot</code> values.</p>
</div>
<div class="paragraph">
<p>In the case of <code>content_library</code>, a defined set of library folders is first written to the XML collector for content assets.
The <code>getXml</code> method is then executed on this collector and the result - an XML document - is output via a <code>$CMS_VALUE$</code> call.
If <code>ps_importType</code> has the value <code>content_slot</code>, <code>getXml</code> is called up on the collector for slot configurations instead and the result is also output.</p>
</div>
<div class="paragraph">
<p>The <code>ContentConnect Technical Pages</code> content folder contains two pages that are based on the <em>XML</em> template:
<code>Shop Assets</code>, for which <code>ps_importType</code> has the value <code>content_library</code>, and <code>Shop Slot Configurations</code>, for which this form field is set to <code>content_slot</code>.
These pages form the basis of the <code>Shop Assets</code> and <code>Shop Slot Configurations</code> page references in the <code>ContentConnect Export Files</code> structure folder;
a <a href="#pdeployment">partial generation</a> is executed for each of these page references.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="navigation"><a class="anchor" href="#navigation"></a>5.3. Navigation</h3>
<div class="paragraph">
<p>The storefront&#8217;s main navigation function can be used in FirstSpirit to navigate both the shop and the content maintained on the FirstSpirit side.
Custom entries can also be added.</p>
</div>
<div class="sect3">
<h4 id="navigation"><a class="anchor" href="#navigation"></a>5.3.1. Main navigation</h4>
<div class="paragraph">
<p>The main menu is primarily used to navigate between the various <a href="#catlandingpage">category pages</a> within the preview (see figure <a href="#main_navigation">Navigation</a>).
The main menu is part of the HTML downloaded during the <a href="#uc_preview">preview</a> from the Commerce Cloud Storefront and is therefore predefined by Commerce Cloud.</p>
</div>
<div id="main_navigation" class="imageblock">
<div class="content">
<img src="_images/navigation.png" alt="navigation">
</div>
<div class="title">Figure 21. Navigation</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The main menu allows the editor to switch between <a href="#catlandingpage">category pages</a>.
If an equivalent exists within FirstSpirit for a category page that has been called up, then the content of this page is shown.
The editor is then able to edit the content originating from FirstSpirit.
If no equivalent to the category page that has been called up exists within FirstSpirit, the original content obtained from Commerce Cloud is issued instead.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
To display a <a href="#catlandingpage">category page</a> that exists in FirstSpirit to the editor, the links on the <a href="#catlandingpage">category pages</a> are redirected to a dispatcher page via a specific regular expression initially in the reference project.</p>
</div>
<div class="listingblock">
<div class="title">Redirecting the navigation links</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$-- Change Category Reference --$
&lt;!-- CMS-REGEX-PATTERN-START --&gt;
   regex-match="&lt;a.*?\sdata-cgid="([^"]*?)""
   regex-value="&lt;a href="$CMS_REF(pageref:"preview_dispatcher")$/forceRefresh=1?type=category&amp;id=$1" id="$1""
&lt;!-- CMS-REGEX-PATTERN-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This regular expression, along with other specific regular expressions, forms part of the <em>Preview Generation</em> format template.</p>
</div>
<div class="paragraph">
<p>The <em>Preview Dispatcher</em> referenced in this expression is a technical page based on the page template with the same name.
The <em>Preview Dispatcher</em> iterates over the content of the structure folder <em>category_pages</em> by using the FirstSpirit navigation function.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This structure folder corresponds to the folder that you configured as the target folder for creating new <a href="#catlandingpage">category pages</a> when <a href="#pcomp">configuring the project component</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For each page found, the <em>Preview Dispatcher</em> memorizes the associated category, together with a corresponding reference to the page.
As a result, for each call it can then decide whether a page exists in FirstSpirit for the requested category and forward accordingly.</p>
</div>
<div class="paragraph">
<p>If it was not possible to identify any pages created in FirstSpirit for a requested category, you are forwarded to a generic category preview page.</p>
</div>
</div>
<div class="sect3">
<h4 id="_expanding_the_navigation_function"><a class="anchor" href="#_expanding_the_navigation_function"></a>5.3.2. Expanding the navigation function</h4>
<div class="paragraph">
<p>Editors can expand the main navigation function.
New menu items are placed in front of those that already exist.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
To add a navigation item, simply place a <a href="#contentpage">content page</a> below the <code>Left Navigation</code> menu item.
Once the page has been released and transferred to the Commerce Cloud, the new navigation item will appear in the storefront.
As shown in the <a href="#custom_navigation">Example of expanding the main navigation function</a> figure, it is also possible to create nested menu structures.</p>
</div>
<div id="custom_navigation" class="imageblock">
<div class="content">
<img src="_images/custom_navigation.png" alt="custom navigation">
</div>
<div class="title">Figure 22. Example of expanding the main navigation function</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Menu structures may be nested up to a maximum of 4 levels deep.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The new <code>menu-custom-left</code> global slot has been introduced on the Salesforce side using the <code>menu.isml</code> template supplied, and is surrounded by the following comments:
<code>&lt;!-- CMS-CUSTOM-NAVIGATION-LEFT-START -&#8594;</code> and <code>&lt;!-- CMS-CUSTOM-NAVIGATION-LEFT-END -&#8594;</code>.
This slot can be populated by FirstSpirit in the same way as any other slot and substituted in the preview.
A content asset for this slot contains the HTML for all elements that are to be used for expanding the navigation function.</p>
</div>
<div class="paragraph">
<p>This markup is created in FirstSpirit in the <code>custom_navigation</code> format template.
This template contains a navigation function that searches all page references in the <code>Left Navigation</code> folder.
It then generates the required HTML for all the pages found - both for the preview and for the live state.
This is necessary so that the pages can be integrated into the main navigation function.
For the preview, the result is also enclosed within the following HTML comments: <code>&lt;!-- CMS-CUSTOM-NAVIGATION-LEFT-START -&#8594;</code> and <code>&lt;!-- CMS-CUSTOM-NAVIGATION-LEFT-END -&#8594;</code>.
The template outputs the HTML for the navigation function in both cases.</p>
</div>
<div class="paragraph">
<p>To enable this navigation function to be used in the preview, each page template must integrate the <code>custom_navigation</code> format template by calling up the <code>CMS_RENDER</code> function.</p>
</div>
<div class="paragraph">
<p>The <code>Left Navigation</code> page template, plus a page and a page reference based on this template, are provided for the purpose of generating a content asset.
The page reference is stored in the <code>Left Navigation</code> structure folder.
As described above, the page template integrates the <code>custom_navigation</code> format template and saves the generated content in a content asset via the XML collector.</p>
</div>
<div class="paragraph">
<p>Unlike the other page templates, <code>Left Navigation</code> does not provide any sections.
A <a href="#slot_configuration">slot configuration</a> that will be output in the event of a generation must therefore be maintained in its form.
For this purpose, the page template sets two variables prior to output.
The first of these is a <code>contentSlotId</code>, since there is no content area from that a slot ID could be derived.
The value of these variable is <code>menu-custom-left</code>, since the new slot referred to above is to be populated.
The second variable is <code>contentSlotTemplate</code>, which is set to the value of the <code>pt_sfccTemplate</code> form field.
The fallback value of this field is <code>slots/content/contentAssetBody.isml</code>.
Without this variable, the template for <a href="#slot_configuration">slot configurations</a> would attempt to derive the ISML template from the current section.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>Left Navigation</code> page reference as well as the corresponding page must be manually released once.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hp"><a class="anchor" href="#hp"></a>5.4. Homepage</h3>
<div class="paragraph">
<p>The homepage corresponds to the start page of the reference project supplied and is therefore displayed when the ContentCreator is first opened.
Since its structure differs from that of the other content pages, it has its own template.
This is referenced in the project just once.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The homepage offers the editor three options for entering content:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The header of the page displays a banner in which either a <a href="#banner_image">static image</a> or a <a href="#slider">slider</a> can be integrated.</p>
</li>
<li>
<p>In the main area of the page:</p>
<div class="ulist">
<ul>
<li>
<p>Up to five products can be displayed in the form of a <a href="#grid_container">grid container</a>, which provides seven different options for arranging the products.</p>
</li>
<li>
<p>Any number of products can be linked in the form of <a href="#hot_spots">hot spots</a> on a static image.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The sections required for entering content are covered in more detail in the corresponding sub-chapters.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The homepage template primarily defines how the page is displayed in the <a href="#uc_preview">FirstSpirit preview</a>, whereas assets are predominantly generated in the integrated sections.
However, certain requirements for generation are managed in the form as well as in the HTML channel.
The developer view must therefore take both aspects into account.</p>
</div>
<div class="paragraph">
<p><strong>Preview</strong><br>
Commerce Cloud supports a range of page types.
In order to display editorial content in the <a href="#uc_preview">FirstSpirit preview</a> or in ContentCreator, FirstSpirit must generate the correct storefront URL to query the corresponding page in Commerce Cloud.</p>
</div>
<div class="paragraph">
<p>The page type to be used for the FirstSpirit preview is defined in the <code>Preview Page Type</code> form field.
As <code>Home</code> is the only parameter provided for the homepage, it is selected as a default value and the input component is hidden.</p>
</div>
<div class="paragraph">
<p>To determine the desired storefront URL, it must also be ensured that the language codes used in FirstSpirit and in Commerce Cloud match.
This task is performed by the <em>language_mapping</em> format template, which is integrated in the HTML channel.
If the language codes do not match, FirstSpirit is unable to determine the corresponding page for the preview.</p>
</div>
<div class="paragraph">
<p>The sections maintained for the homepage are output within unique HTML comments.
These always consist of a start and an end expression and denote the individual content areas.
Based on the comments, FirstSpirit substitutes the slots in the preview with editorial content.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">&lt;!-- CMS-HOME-MAIN-START --&gt;
   $CMS_RENDER(template:"mpp_body_wrapper",body:"home_main_m")$
   $CMS_RENDER(template:"empty_content_slot",label:"Home Main",body:"home_main")$
&lt;!-- CMS-HOME-MAIN-END --&gt;

&lt;!-- CMS-HOME-CATEGORIES-START --&gt;
   $CMS_RENDER(template:"mpp_body_wrapper",body:"home_categories_m")$
   $CMS_RENDER(template:"empty_content_slot",label:"Home Categories",body:"home_categories")$
&lt;!-- CMS-HOME-CATEGORIES-END --&gt;

&lt;!-- CMS-HOME-CC-OVERRIDE-START --&gt;
   $CMS_RENDER(template: "cc_createsectionwe_api")$
&lt;!-- CMS-HOME-CC-OVERRIDE-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a content area has no sections, FirstSpirit displays a gray-shaded area in the preview instead (see figure <a href="#empty_slot_hp">Empty Slot</a>).
This shows the name of the content area and has a button that allows new sections to be generated in ContentCreator.
The display of the gray area controls the <em>empty_content_slot</em> format template, while the function of the button is implemented in the <em>cc_createsectionwe_api</em> format template.
It contains JavaScript, which may be integrated in the page only once.</p>
</div>
<div id="empty_slot_hp" class="imageblock">
<div class="content">
<img src="_images/empty_slot_hp.png" alt="empty slot hp">
</div>
<div class="title">Figure 23. Empty Slot</div>
</div>
<div class="paragraph">
<p>Should further substitutions be required in addition to the exchange of slots, specific regular expressions can be defined.
These have their own syntax and are summarized in the <em>Preview Generation</em> format template.
It controls the generation of the <a href="#uc_preview">preview</a> and is referenced in all page templates of the reference project.</p>
</div>
<div class="paragraph">
<p><strong>Generation</strong><br>
The assets created during the generation are filed in a folder structure in Salesforce.
A corresponding folder is therefore defined for each page template in the reference project.
The homepage form has the hidden <code>SFCC Parent Folder</code> field, whose value is assigned to the <code>set_parent_id</code> variable.
It is evaluated in the integrated sections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(set_parent_id,pt_sfcc_parentFolder)$</code></pre>
</div>
</div>
<div class="paragraph">
<p>A further requirement for generating assets is that the corresponding page must be marked as translated in FirstSpirit.
If this is not the case, the generation is canceled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_IF(!#global.preview &amp;&amp; !#global.page.isTranslated)$
   $CMS_SET(#global.stopGenerate, true)$
$CMS_END_IF$</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contentpage"><a class="anchor" href="#contentpage"></a>5.5. Content pages</h3>
<div class="paragraph">
<p>The content pages correspond to the standard pages of the project and are referenced multiple times.
Unlike the <a href="#hp">homepage</a> and the <a href="#detail_pages">category and product pages</a>, they play a special role as they generate just one asset for the entire page.
All editorial content from the content page and the sections added to it are summarized in this asset.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The content pages offer the editor three options for entering content:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The header of the page displays a banner in which either a <a href="#banner_image">static image</a> or a <a href="#slider">slider</a> can be integrated.</p>
</li>
<li>
<p>The main area of the page enables the display of:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#hot_spots">hot spots</a></p>
</li>
<li>
<p>a single blog article or an overview of all blog articles</p>
</li>
<li>
<p>a <a href="#video">video</a></p>
</li>
<li>
<p>a text with a heading</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The sections required for entering content are covered in more detail in the corresponding sub-chapters.
As the text section is self-explanatory, this is not described specifically.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Unlike for the remaining pages, the editorial content of the content page and its sections are summarized in a single asset.
This asset is created in the HTML channel of the page template, which differentiates between the display of the page in the <a href="#uc_preview">FirstSpirit preview</a> and in the live state.
The developer view must therefore take both aspects into account.</p>
</div>
<div class="paragraph">
<p><strong>Preview</strong></p>
</div>
<div class="paragraph">
<p>As the creation of the asset only affects generation, both developer views of the content page and the <a href="#hp">homepage</a> are nearly identical with regard to the FirstSpirit preview.</p>
</div>
<div class="paragraph">
<p>The only discrepancy between both templates is in the configuration of the page type that is used, which is also defined in the hidden <code>Preview Page Type</code> form field for the content pages.
In contrast to the <a href="#hp">homepage</a>, it can assume different values in theory.
For the reference project supplied, however, the <code>Page</code> parameter is required and is selected as the default value.</p>
</div>
<div class="paragraph">
<p>Furthermore, the content page has the hidden <code>SFCC Context ID</code> form field, in which a default content asset ID is saved.
As a page still does not have an asset ID before generation, it is required to create the <a href="#uc_preview">preview</a>.</p>
</div>
<div class="paragraph">
<p><strong>Generation</strong></p>
</div>
<div class="paragraph">
<p>For generation, it is important to ensure firstly that the corresponding page is marked as translated in FirstSpirit.
Only when this is the case is generation carried out and the asset for the content page is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_IF(!#global.preview &amp;&amp; !#global.page.isTranslated)$
   $CMS_SET(#global.stopGenerate, true)$
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this, the value of the hidden <code>SFCC Parent Folder</code> field is assigned to the <code>set_parent_id</code> variable initially.
This value specifies where the created asset is filed in the Salesforce folder structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(set_parent_id,pt_sfcc_parentFolder)$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The variables are evaluated while the XML collector is populated, which is carried out subsequently.
In the process, a new content node is created, to which the editorial content of the page, among other things, is added.</p>
</div>
</div>
<div class="sect2">
<h3 id="login_page"><a class="anchor" href="#login_page"></a>5.6. Login page</h3>
<div class="paragraph">
<p>Just like the <a href="#hp">homepage</a>, the login page has a special role to play.
This means that it differs from the other content pages.
It is used to log into the shop and is only referenced once in the project.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The login page offers the editor various options for entering content:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The header of the page displays a banner in which either a <a href="#banner_image">static image</a> or a <a href="#slider">slider</a> can be integrated.</p>
</li>
<li>
<p><a href="#textpicture">Text Picture sections</a> can be added to the top part of the main area of the page.</p>
</li>
<li>
<p>The bottom part of the main area of the page enables the display of:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#producttiles">Product Tiles</a>.</p>
</li>
<li>
<p><a href="#textpicture">Text Picture sections</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
As both the form and the content of the HTML channel for the login page and the <a href="#hp">homepage</a> broadly match, both developer views are also nearly identical.
Therefore, only the differences between the two templates will be described here.</p>
</div>
<div class="paragraph">
<p>The page type to be used for the FirstSpirit preview is also defined for the login pages in the hidden <code>Preview Page Type</code> form field.
Just as for <a href="#catdetailpage">category</a> and <a href="#proddetailpage">product detail pages</a>, the <code>Custom</code> value is required in this context.
It is used for the implementation of page types that are not covered by default by the <a href="#webconf"><code>Preview Filter</code></a> as well as for the manual specification of the controller to be used.
The controller must be specified using the hidden <code>pt_storefrontUrlCustomController</code> field.
For login pages, its default value is <code>Login-Show</code>, which is added to the Storefront URL.</p>
</div>
<div class="paragraph">
<p>For generation, as is the case with the <a href="#hp">homepage</a>, it is important to ensure that the login page is marked as translated in FirstSpirit.
Only then the generation is carried out and the associated assets will be created.</p>
</div>
</div>
<div class="sect2">
<h3 id="detail_pages"><a class="anchor" href="#detail_pages"></a>5.7. Category and product pages</h3>
<div class="paragraph">
<p>The <em>ContentConnect</em> module provides an individual report for products and categories in both SiteArchitect and ContentCreator.
These reports are used to display the category and product information originating from Commerce Cloud, which can be used to create and maintain editorial content (see figure <a href="#reports">Reports</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To display the category report, the <a href="#show_report"><code>Show Category Report</code></a> checkbox must be activated in the project component.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="reports" class="imageblock">
<div class="content">
<img src="_images/reports.png" alt="reports">
</div>
<div class="title">Figure 24. Reports</div>
</div>
<div class="paragraph">
<p>The corresponding report can be used to create both category pages as well as product pages.
To use this feature, you must define the templates on which these pages will be based, and where they are to be integrated into the structure, in the <a href="#pcomp">project component</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>SFCC Context ID</code> field must be included in the page template that is selected in each case so that the ID of the referenced object can be saved.
The field can be hidden.
If this field ought to have a differing identifier for project-specific reasons, then this must be specified within the <a href="#project_settings">project settings</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;CMS_INPUT_TEXT name="pt_storefrontUrlContextId" hidden="yes" useLanguages="no"&gt;
  &lt;LANGINFOS&gt;
    &lt;LANGINFO lang="*" label="SFCC Context ID"/&gt;
  &lt;/LANGINFOS&gt;
&lt;/CMS_INPUT_TEXT&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With regard to its category or product page, an object in the report can adopt one of three states:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A category or product page does not exist and therefore can be created.</p>
</li>
<li>
<p>A category or product page exists, which can be called up.</p>
</li>
<li>
<p>A category or product page exists but either its page reference or the page cannot be found.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The three cases are displayed in different ways and described below.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the objects in the report are not permanently updated, the display might not reflect the current status.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="create_detailpage" class="paragraph">
<p><span class="underline"><strong>Creating a category or product page</strong></span><br>
Objects for that a category or product page does not yet exist are identified in the report by a gray icon (see figure <a href="#report_create_normal">Creating a category or product page</a>).
If a page template has been defined in the <a href="#pcomp">project component</a>, the <span class="image"><img src="_images/new_detailpage.png" alt="Create Page"></span> button is displayed when such an object is hovered over.</p>
</div>
<div id="report_create_normal" class="imageblock">
<div class="content">
<img src="_images/report_create_normal.png" alt="report create normal">
</div>
<div class="title">Figure 25. Creating a category or product page</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A button is also displayed in the <a href="#uc_preview">FirstSpirit preview</a> on <a href="#catlandingpage">category landing pages</a>, <a href="#catdetailpage">category detail pages</a>, and <a href="#proddetailpage">product detail pages</a> that can be accessed via the navigation.
This button functions in the same way as the button in the report.
It is only visible if a corresponding category landing page, category detail page, or product detail page does not exist in the FirstSpirit project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/landingpagebutton.png" alt="landingpagebutton">
</div>
<div class="title">Figure 26. Creating a category landing page, category detail page, or product detail page</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Click on the button in the report or the button on a main category page to open a dialog that is split into two sections and in which a page can be created for the corresponding object.</p>
</div>
<div class="paragraph">
<p>The top section of the dialog is the <code>structure selection area</code>; it is completed automatically and as such is always the same.
Within the structure, the editor has the option to select the menu level at which to generate the new page.
The corresponding input component may already have been preassigned.
In this case, a <a href="#default_folder">structure folder</a> will already have been defined in the configuration dialog of the project component.
However, the editor is free to change this selection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In some cases, the <code>structure selection area</code> may be hidden in the dialog.
In this case, a <a href="#default_folder">structure folder</a> will also have been predefined in the project component.
At the same time, however, a setting will have been made to prevent the editor from changing this preassignment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unlike the <code>structure selection area</code>, the <code>form area</code> underneath is always project-specific.
It shows the form for the page template specified in the project component.
The rules defined in the template also apply here.</p>
</div>
<div id="detail_pages_dialog_not_shown_note" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Within the reference project, the form fields of the category or product pages are automatically populated or have corresponding default values.
In addition, a structure folder is predefined in the <a href="#pcomp">project component</a>, which cannot be changed by the editor.
Both for the structure selection area and the form area, there is therefore no need for the editor to input anything.
The dialog is not shown for this reason.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example dialog is shown in the figure below:</p>
</div>
<div id="report_dialog_newpage" class="imageblock">
<div class="content">
<img src="_images/report_dialog_newpage.png" alt="report dialog newpage">
</div>
<div class="title">Figure 27. Dialog for creating a category or product page</div>
</div>
<div class="paragraph">
<p>Click on <b class="button">Create</b> to generate the page reference for the category or product page at the selected menu level.
The corresponding page is created in a specific folder in the Page Store.
Within this folder, a distinction between category and product pages is made once again on the basis of subfolders.
The names of the page references and pages generated are based on the <code>product ID (product name)</code> or <code>category ID (category name) schema</code>.</p>
</div>
<div class="paragraph">
<p>If a script has also been specified in the <a href="#pcomp">project component</a>, it is usually executed before and after the category or product page is created.
The <em>create_sfcc_item_wizard</em> script included in the reference project supplied does, however, have a corresponding query, which is used to initiate the script, but only once the page has been created.
It marks each created category or product page as translated for all languages and saves its storefront ID in the form.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that only the code from the HTML channel of the script is executed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following parameters are transferred to this script:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 19.2307%;">
<col style="width: 19.2307%;">
<col style="width: 61.5386%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data type</th>
<th class="tableblock halign-left valign-top">Object name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BaseContext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context in which the script is executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">beforeInstantiation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the script is executed before the page is created; otherwise <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KeyProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The object for that a category or product page is being created. This is either a <code>product</code> or a <code>category</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Javadoc documentation supplied describes the <code>KeyProvider</code>, <code>Product</code>, and <code>Category</code> interfaces.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the process to generate the category or product page and the execution of the script have been completed, the new page is called up automatically.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Calling up an existing category or product page</strong></span><br>
Objects for that a category or product page already exists are identified in the report by a green icon (see figure <a href="#report_jump_to">Product with product page</a>).
When you hover over them, the <span class="image"><img src="_images/report_jump_icon.png" alt="report jump icon"></span> button is displayed.
Click this button to call up the corresponding category or product page.</p>
</div>
<div id="report_jump_to" class="imageblock">
<div class="content">
<img src="_images/report_jump_to.png" alt="report jump to">
</div>
<div class="title">Figure 28. Product with product page</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Broken reference to a category or product page</strong></span><br>
If there are objects with a category or product page but the page reference or underlying page cannot be found, the objects are identified in the report by a red icon (see figure <a href="#report_ref_broken">Broken object</a>).
When you hover over them, the <span class="image"><img src="_images/report_broken_icon.png" alt="Broken Reference"></span> button is displayed.
Click on this button to open a dialog containing more information.</p>
</div>
<div id="report_ref_broken" class="imageblock">
<div class="content">
<img src="_images/report_ref_broken.png" alt="report ref broken">
</div>
<div class="title">Figure 29. Broken object</div>
</div>
<div id="hidden_categories" class="paragraph">
<p><span class="underline"><strong>Hidden categories</strong></span><br>
When the category report is called up, both visible as well as hidden categories are displayed by default.
By removing the <code>Include hidden categories</code> check mark, the results list can be limited to include only visible categories:</p>
</div>
<div id="exclude_hidden_categories" class="imageblock">
<div class="content">
<img src="_images/category_report_hidden_excluded.png" alt="category report hidden excluded">
</div>
<div class="title">Figure 30. Hiding hidden categories</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The identification of existing, broken, and unavailable references to category pages described in this chapter applies also to hidden categories.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="catlandingpage"><a class="anchor" href="#catlandingpage"></a>5.7.1. Category landing pages</h4>
<div class="paragraph">
<p>Category landing pages are used to display the products originating from Commerce Cloud.
They provide an overview of all the products belonging to a selected main category.
The products are arranged and the product information is displayed automatically; this cannot be influenced by the FirstSpirit editor.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The category landing page offers the editor different options for entering content:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The header of the page displays a banner into which a <a href="#banner_image">static image</a> can be integrated.</p>
</li>
<li>
<p>The main area has two content areas, in which:</p>
<div class="ulist">
<ul>
<li>
<p>a <a href="#grid_container">grid containers</a>,</p>
</li>
<li>
<p>a <a href="#video">video</a> or</p>
</li>
<li>
<p>text with a heading</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>may be used.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
As both the form and the content of the HTML channel for the category landing page and the <a href="#hp">homepage</a> broadly match, both developer views are also nearly identical.
This is therefore where only the discrepancy between both templates is described:</p>
</div>
<div class="paragraph">
<p>The page type to be used for the FirstSpirit preview is also defined for the category landing pages in the hidden <code>Preview Page Type</code> form field.
In contrast to the homepage, it can assume different values in theory.
For the reference project supplied, however, only the <code>Search</code> parameter is required and is selected as the default value.</p>
</div>
<div class="paragraph">
<p>Furthermore, the form has the <code>SFCC Context ID</code> field.
The <code>SFCC Context ID</code> corresponds to the category ID from the storefront.
If the field is empty, a category landing page maintained in the FirstSpirit project does not exist and the <a href="#uc_preview">preview</a> shows the corresponding Storefront page.
A button to create a category landing page is added to the Storefront page via the <em>Create Page</em> template.
This button functions in the same way as the button in the <a href="#create_detailpage">report</a>.
When generating a category landing page, the category ID is automatically saved to the associated form field.</p>
</div>
<div class="paragraph">
<p>The <em>Preview Generation</em> format template needs the category ID to generate the preview for all pages.
For each page, it expects to receive the category ID in the form of the <code>SFCC Context ID</code> variable.
This ID must therefore be included in every page template, with the exception of the <a href="#hp">homepage</a>.
If the associated form field is empty or the corresponding page in FirstSpirit is not marked as translated, generation is canceled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_IF(!#global.preview &amp;&amp; !#global.page.isTranslated || pt_storefrontUrlContextId.isEmpty)$
   $CMS_SET(#global.stopGenerate, true)$
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>As described <a href="#detail_pages_dialog_not_shown_note">above</a>, the form for the category landing pages does not contain any elements to be completed by the editor.
No dialog is therefore shown when a page of this nature is created.
If a form only contains elements for that the attribute <code>hidden</code> has the value <code>yes</code>, the <em>ContentConnect</em> module decides for itself that the form does not need to be shown.
In the reference project, the form for the category landing pages does, however, contain an <code>FS_BUTTON</code>, which is only hidden dynamically in ContentCreator by means of a rule.
In both clients, this button should not result in the dialog being shown when a category landing page is created.
For this reason, the following elements were added to the form:</p>
</div>
<div class="listingblock">
<div class="title">Form</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;CMS_INPUT_TOGGLE name="pt_hideNewPageDialogCC" hFill="yes" hidden="yes" singleLine="no"&gt;
  &lt;LANGINFOS&gt;
    &lt;LANGINFO
      lang="*"
      label="Hide New Page Dialog in ContentCreator"
      description="Hide the dialog in the ContentCreator when creating a new landing page."
    /&gt;
  &lt;/LANGINFOS&gt;
&lt;/CMS_INPUT_TOGGLE&gt;

&lt;CMS_INPUT_TOGGLE name="pt_hideNewPageDialogSA" hFill="yes" hidden="yes" singleLine="no"&gt;
  &lt;LANGINFOS&gt;
    &lt;LANGINFO
      lang="*"
      label="Hide New Page Dialog in SiteArchitect"
      description="Hide the dialog in the SiteArchitect when creating a new landing page."
    /&gt;
  &lt;/LANGINFOS&gt;
&lt;/CMS_INPUT_TOGGLE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These explicitly instruct the <em>ContentConnect</em> module not to show the dialog in ContentCreator or in SiteArchitect.
Their fallback values are therefore <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="catdetailpage"><a class="anchor" href="#catdetailpage"></a>5.7.2. Category detail pages</h4>
<div class="paragraph">
<p>As with the <a href="#catlandingpage">category landing pages</a>, the category detail pages are used to display the products originating from Commerce Cloud.
However, unlike the category landing pages, they provide an overview of all products belonging to a subcategory.
The products are arranged and the product information displayed automatically and cannot be influenced by the FirstSpirit editor.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The category detail page only allows an editor to integrate a <a href="#banner_image">static image</a> into the header of the page.
Furthermore, the editor is unable to maintain content.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Unlike the other pages, which follow the slot-based approach, both <a href="#proddetailpage">product</a> and category detail pages use the <code>Content Integration API (CI API)</code>.
This API enables Velocity fragments that are maintained in the FirstSpirit template to be evaluated on the Salesforce side.</p>
</div>
<div class="paragraph">
<p>If the <code>CI API</code> is being used, the hidden <code>Use velocity rendering</code> toggle is activated in the form of the page template within the reference project,
and the <code>Custom</code> parameter is defined in the <code>Preview Page Type</code> form field.
The <code>Content-Render</code> value is also entered in the <code>Velocity rendering controller appendix</code> form field.
This value defines the call of the <code>Content</code> controller that is supplied in the <code>int_espirit_sfra</code> cartridge and carries out Velocity rendering on the Salesforce side.
The value must be adapted accordingly if an external controller is being used.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The chapter about the <a href="#login_page">login page</a> describes in more detail how an individual page type can be defined.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another difference compared to the other pages is that the category detail pages only generate a single asset, just like the <a href="#contentpage">content pages</a>.
This asset is created in the HTML channel of the page template, which differentiates between the display of the page in the <a href="#uc_preview">FirstSpirit preview</a> and in the live state.
The developer view must therefore take both the preview as well as the generation and the live state into account.</p>
</div>
<div class="paragraph">
<p><strong>Preview</strong></p>
</div>
<div class="paragraph">
<p>The Velocity fragments can be used to insert Salesforce widgets provided by the <code>Common</code> controller in a page.
The <code>$include.widget()</code> function, which is defined in the <code>Content</code> controller, deals with the integration process.
The required widget must be transferred to this function as a parameter.</p>
</div>
<div class="paragraph">
<p>The code example below shows the integration of the Salesforce Page Header in the category detail page:</p>
</div>
<div class="listingblock">
<div class="title">Page Header integration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">&lt;!-- CMS-VELOCITY-PAGE_HEADER-START --&gt;
   $include.widget('Common-PageHeader')
&lt;!-- CMS-VELOCITY-PAGE_HEADER-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the general widgets, the <code>CategorySearchResult</code> controller integrates specific data into the category detail page:
In the case of the preview, for example, it uses the category ID of the selected subcategory to determine the corresponding products, and then displays these in the <a href="#uc_preview">preview</a>.
This data is already provided in the live state and is available to use via the <code>$categorySearchResult</code> variable.</p>
</div>
<div class="listingblock">
<div class="title">Integrating subcategory products</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">&lt;!-- CMS-VELOCITY-SEARCH_RESULT-START --&gt;
   $CMS_IF(#global.preview)$
      $include.widget('CategorySearchResult-Show', 'cgid', '$CMS_VALUE(pt_storefrontUrlContextId)$')
   $CMS_ELSE$
      $categorySearchResult
   $CMS_END_IF$
   [...]
&lt;!-- CMS-VELOCITY-SEARCH_RESULT-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generation</strong></p>
</div>
<div class="paragraph">
<p>For generation purposes, it is important to ensure firstly that the corresponding page is marked as translated in FirstSpirit and that the <code>SFCC Context ID</code> field is populated.
The <code>SFCC Context ID</code> corresponds to the category ID from the storefront.
When a category detail page is being generated via the report, the ID is automatically saved to the associated form field.
The generation is only carried out and the asset for the category detail page is only created once the form field is populated and the corresponding page is marked as translated in FirstSpirit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_IF(!#global.preview &amp;&amp; !#global.page.isTranslated || pt_storefrontUrlContextId.isEmpty)$
   $CMS_SET(#global.stopGenerate, true)$
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The editorial content is then saved in the <code>set_pageContent</code> variable, and the <code>set_parent_id</code> variable is assigned the value of the hidden <code>SFCC Parent Folder</code> field.
This value specifies where the created asset is filed in the Salesforce folder structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_SET(set_parent_id,pt_dwre_parentFolder)$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both variables are evaluated while the XML collector is populated, a process that is carried out subsequently.
In the process, a new content node is created, to which the editorial content of the page, among other things, is added.</p>
</div>
<div class="paragraph">
<p><strong>Live state</strong></p>
</div>
<div class="paragraph">
<p>A category detail page already exists for subcategories on the Salesforce side as standard.
This page is used for the live state.
The display is controlled by the <a href="#cartridges">Search controller</a>, which has been expanded to take account of assets generated on the FirstSpirit side.
Using this expansion and a category ID assigned to it, the controller first checks whether a category detail page that has been generated with FirstSpirit is present.
If one is present, it is rendered in the live state with the Velocity engine.
Otherwise, the Salesforce standard page is displayed.</p>
</div>
</div>
<div class="sect3">
<h4 id="proddetailpage"><a class="anchor" href="#proddetailpage"></a>5.7.3. Product detail pages</h4>
<div class="paragraph">
<p>Like category detail pages, product pages are used to display products originating from Commerce Cloud.
However, unlike category detail pages, they do not display an overview of multiple products.
Instead, they provide a detail view of a single product.
The product information originates from Commerce Cloud and cannot be edited by the FirstSpirit editor.
However, the editor can choose to show and hide this information.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
Product detail pages offer the editor various options for entering content:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The page form contains various input components</p>
<div class="ulist">
<ul>
<li>
<p>to define a promotional text.
This text can contain a maximum of 1,024 characters.</p>
</li>
<li>
<p>to show/hide product information.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The header of the page displays a banner into which a <a href="#banner_image">static image</a> can be integrated.</p>
</li>
<li>
<p>The main area of the page enables the display of:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#producttiles">Product Tiles</a>.</p>
</li>
<li>
<p>a <a href="#video">video</a>.</p>
</li>
<li>
<p>a text with a heading.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The sections required for entering content are covered in more detail in the corresponding sub-chapters.
As the text section is self-explanatory, this is not described specifically.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Just like <a href="#catdetailpage">category detail pages</a>, product detail pages use the <code>Content Integration API (CI API)</code>.
This API enables Velocity fragments to be evaluated on the Salesforce side.
Moreover, product detail pages only generate a single asset. This asset is generated in the HTML channel of the page template.</p>
</div>
<div class="paragraph">
<p>As both the form and the content of the HTML channel for product and <a href="#catdetailpage">category detail pages</a> broadly match, both developer views are also identical in terms of form and content.
Therefore, only the differences between the two templates will be described here.</p>
</div>
<div class="paragraph">
<p>The Salesforce widgets of a product detail page are made available via the <a href="#cartridges"><code>Product</code> controller</a> and integrated into the page using Velocity fragments.
Here too, the <code>$include.widget()</code> function of the <code>Content</code> controller is used for integration purposes (the function transfers the required widget as a parameter).</p>
</div>
<div class="paragraph">
<p>The hidden input components necessary to use the <code>CI API</code> include, for example, the <code>Velocity rendering controller appendix</code> field.
Since product detail pages, like the <a href="#login_page">login page</a>, use an individual controller to generate the preview, this must be specified here.
Therefore, the field contains the <code>Content-Render</code> value, to which a reference to the <code>SFCC Context ID</code> field is added.
This corresponds to the ID of the product to be displayed and is required by the controller.
The <code>Preview Filter</code> reads out this value and adds it in the corresponding location.</p>
</div>
<div class="listingblock">
<div class="title">Default value for the Velocity rendering controller appendix form field</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">Content-Render?pid={pt_storefrontUrlContextId}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as the hidden input components, the form also contains a text field for the entry of a promotional text and various <code>CMS_INPUT_TOGGLEs</code>.
The toggles offer the editor the option to show or hide the widgets on the product detail page individually:</p>
</div>
<div class="listingblock">
<div class="title">Integration with CMS_INPUT_TOGGLE</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">$CMS_IF(!pt_hideProductInfo)$
   &lt;!-- CMS-VELOCITY-PRODUCT_INFO-START --&gt;
   $include.widget('Product-WrapProductTemplate','pid',$product.id,
                   'productTemplate','product/components/productInfo')
   &lt;!-- CMS-VELOCITY-PRODUCT_INFO-END --&gt;
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>For generation purposes, it is important to ensure that product detail pages are also marked as translated and that the <code>SFCC Context ID</code> field is populated.
In this case, the <code>SFCC Context ID</code> corresponds to the product ID from Storefront.
If no product detail page maintained in the FirstSpirit project exists, the preview shows the corresponding Storefront page.
The Storefront page display is based on the <code>Product Detail Page Preview</code> page template.
A button to create a product detail page is added to the Storefront page via the <em>Create Page</em> template.
This button functions in the same way as the button in the report.
When creating a product detail page, the <code>Product Detail Page</code> page template is then used and the product ID is automatically saved to the associated form field.
If the page is marked as translated and the <code>SFCC Context ID</code> field is populated, generation is carried out and the asset for the product detail page is created.</p>
</div>
<div class="paragraph">
<p>As well as providing the widgets, the <code>Product</code> controller also controls how the product detail page is displayed when the website is live.
It uses the product ID to check whether a product detail page that has been generated with FirstSpirit exists.
If it does, it is rendered in the live state with the Velocity engine.
If it does not, a product detail page that already exists by default on the Salesforce side is displayed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_banner"><a class="anchor" href="#_banner"></a>5.8. Banner</h3>
<div class="paragraph">
<p>The header of a page allows a banner to be displayed in which either a static image or a slider can be integrated.
Both variants each correspond to a section, which is available for the <a href="#hp">homepage</a> and for normal <a href="#contentpage">content pages</a>, as well as in <a href="#blog">articles</a> and for <a href="#detail_pages">category and product pages</a>.</p>
</div>
<div class="paragraph">
<p>These are described in detail in the following sub-chapters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/slider.png" alt="slider">
</div>
<div class="title">Figure 31. Slider</div>
</div>
<div class="sect3">
<h4 id="slider"><a class="anchor" href="#slider"></a>5.8.1. Slider</h4>
<div class="paragraph">
<p>The slider corresponds to an image list.
All entries in this list correspond to a slider item and are displayed one after another in the header of a page.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
With the slider, the editor is able to create a list of images, which can each be assigned a title as well as a link to a <a href="#detail_pages">category or product page</a>.
The images can be selected from the media store or uploaded with the help of the input component.</p>
</div>
<div class="paragraph">
<p>A <a href="#cat_prod_link">link</a> to a category or product page is specified by entering link text and the associated product or category ID.
Both fields are automatically populated when a product or category is transferred from one of the two reports.
As the link refers to the entire banner, its link text is only used as a tooltip and is not displayed as a clickable link.</p>
</div>
<div class="paragraph">
<p>The selected images are displayed as a slider in the header of the corresponding page and can be cropped individually using the corresponding FirstSpirit functionality.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The slider is based on the <a href="https://v4-alpha.getbootstrap.com/components/carousel/">Bootstrap carousel</a> and integrates the list of images selected by the editor.
The images are selected via an <code>FS_CATALOG</code> input component, whose individual entries use the template for the slider item.
The input component has the <code>upload=yes</code> parameter, which allows the editor to upload new images.</p>
</div>
<div class="paragraph">
<p>To crop the images, the <code>SLIDE</code> <a href="#resolutions">resolution</a> is required, which is already applied in the project properties of the reference project and must be specified in the HTML channel:</p>
</div>
<div class="listingblock">
<div class="title">Specifying the resolution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$CMS_RENDER(template:"media_link",mediaref: st_picture,res:"SLIDE")$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The entire slider is assigned to the <code>set_sectionContent</code> variable, which is required during generation of the <a href="#hp">homepage</a> or a <a href="#detail_pages">category or product page</a> to populate the corresponding XML file.
For a <a href="#contentpage">content page</a>, however, the variable is only output.</p>
</div>
<div class="paragraph">
<p>As the slider uses no content from Commerce Cloud, it does not have to be labeled with HTML tags, and is shown in the preview without substitution.</p>
</div>
</div>
<div class="sect3">
<h4 id="banner_image"><a class="anchor" href="#banner_image"></a>5.8.2. Banner image</h4>
<div class="paragraph">
<p>The banner image corresponds to a static image that is displayed in the header of a page.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The static banner image is selected either via the media store or by uploading a new image.
With the help of the standard FirstSpirit functionality, it can be cropped to the required image section.</p>
</div>
<div class="paragraph">
<p>In addition, the section offers editors the following further configuration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maintaining a one-line title</p>
</li>
<li>
<p>Specifying a link to a category or product page</p>
</li>
<li>
<p>Defining the size and banner display</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a title has been entered, it will have a blue background and can be positioned left, right, or center on the banner image.
In doing so, it should be specified whether the blue-shaded background is displayed on the left or right, only as a narrow strip, or over the entire height of the banner.
In the central position, it generally spans the entire height.
The input component for positioning only becomes visible when the title is entered and is otherwise hidden.</p>
</div>
<div class="paragraph">
<p>A <a href="#cat_prod_link">link</a> to a category or product page is specified by entering link text and the associated product or category ID.
Both fields are automatically populated when a product or category is transferred from one of the two reports.
As the link refers to the entire banner image, its link text is only used as a tooltip and is not displayed as a clickable link.</p>
</div>
<div class="paragraph">
<p>To define the size of the banner, the options <code>Small</code> and <code>Big</code> are available for editors.<br>
The <code>Small</code> option minimizes the height of the banner and displays it only as a narrow strip.
This could lead to a selected image being cropped at the bottom.<br>
The <code>Big</code> option displays the banner without any height restrictions and also allows the editor to define a design.</p>
</div>
<div class="paragraph">
<p>The options <code>None</code>, <code>Top</code>, and <code>Bottom</code> are available for the design.
The <code>None</code> option results in no changes being made to the banner, while for the other two options, a white overlay is added to the upper left or lower right corner.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/bannerimage.png" alt="bannerimage">
</div>
<div class="title">Figure 32. Banner image with 'Top' design</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The HTML channel references the selected image and displays it together with the configured title and link, while taking into account the image section and layout defined by the editor.
To crop the image, the <code>BANNER</code> <a href="#resolutions">resolution</a> is required, which is already applied in the project properties of the reference project and must be specified in the HTML:</p>
</div>
<div class="listingblock">
<div class="title">Specifying the resolution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$CMS_RENDER(template:"media_link",mediaref:st_picture,res:"BANNER")$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>st_picture</em> input component has the <code>upload=yes</code> parameter, which allows the editor to upload new images, as well as to select an existing image from the media store.</p>
</div>
<div class="paragraph">
<p>The entire content is assigned to the <code>set_sectionContent</code> variable, which is required during generation of the <a href="#hp">homepage</a> or a <a href="#detail_pages">category or product page</a> to populate the corresponding XML file. For a <a href="#contentpage">content page</a>, however, the variable is only output.</p>
</div>
<div class="paragraph">
<p>As the image is referenced from the media store of the FirstSpirit project and is therefore not affected by substitution of Salesforce content, it does not have to be labeled with HTML tags.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="grid_container"><a class="anchor" href="#grid_container"></a>5.9. Grid Container</h3>
<div class="paragraph">
<p>In contrast to simple <a href="#contentpage">content pages</a>, the <a href="#hp">homepage</a> and <a href="#catlandingpage">category landing pages</a> are able to display a group of three to five images via the grid container, each corresponding to a grid container element.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/grid.png" alt="grid">
</div>
<div class="title">Figure 33. Grid container</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
With the grid container, the editor is able to create a list of images, which can each be assigned a title as well as a link to a <a href="#detail_pages">product, category</a>, or <a href="#contentpage">content page</a>.
Depending on the configuration, three to five images are displayed from this list and can be individually cropped to the required image section.
The images can originate from the media store or can be uploaded with the help of the input component.</p>
</div>
<div class="paragraph">
<p>The images are arranged according to a certain layout that is predetermined by the editor.
The following seven options are available here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the list created by the editor contains more entries than is envisaged by the layout, then only the first entries are taken into account.
Surplus elements are ignored by the layout.
The editor receives a notification about this in the form.</p>
</div>
<div class="paragraph">
<p>If the list created by the editor contains fewer entries than is envisaged by the layout, or if the editor does not select an image for an element, placeholders are displayed instead.
In both cases, the page cannot be released until the layout is completed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/grid_opt.png" alt="grid opt">
</div>
<div class="title">Figure 34. Grid container - Layout options</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Within the HTML channel and based on the image section and layout chosen by the editor, the selected images are referenced and their configured titles and links displayed.
Only the number of images corresponding to the layout are taken into account, and all other entries ignored.</p>
</div>
<div class="paragraph">
<p>To crop the images, the <code>GRID_ELEMENT_SQUARE</code>, <code>GRID_ELEMENT_HIGH</code>, and <code>GRID_ELEMENT_WIDE</code> <a href="#resolutions">resolutions</a> are required.
They are already applied in the project properties of the reference project and must be specified in the HTML:</p>
</div>
<div class="listingblock">
<div class="title">Specifying the resolution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$CMS_REF(st_picture, resolution:"GRID_ELEMENT_SQUARE")$
$CMS_REF(st_picture, resolution:"GRID_ELEMENT_HIGH")$
$CMS_REF(st_picture, resolution:"GRID_ELEMENT_WIDE")$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>st_picture</em> input component has the <code>upload=yes</code> parameter, which allows the editor to upload new images, as well as to select an existing image from the media store.</p>
</div>
<div class="paragraph">
<p>The content is assigned to the <code>set_sectionContent</code> variable, which is required during generation of the <a href="#hp">homepage</a> or a <a href="#catlandingpage">category landing page</a> to populate the corresponding XML file.</p>
</div>
<div class="paragraph">
<p>As the images are referenced from the FirstSpirit media store and there is no substitution of Salesforce content, they do not have to be labeled with HTML tags and are displayed in the preview in the usual way.</p>
</div>
</div>
<div class="sect2">
<h3 id="hot_spots"><a class="anchor" href="#hot_spots"></a>5.10. Hot spots</h3>
<div class="paragraph">
<p>In addition to the <a href="#grid_container">grid container</a>, products can be displayed in the form of hot spots.
Each hot spot corresponds to a <a href="#cat_prod_link">product link</a>, which is defined on a single static image parallel to the other hot spots.
When you click, a flyout opens for each hot spot, which includes the name, an image, and a description of the corresponding product.</p>
</div>
<div class="paragraph">
<p>The static image is selected and the hot spots are defined with the help of the <em>Shop the look</em> section template, which can only be added to the <a href="#hp">homepage</a> and <a href="#contentpage">content pages</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/hotspot.png" alt="hotspot">
</div>
<div class="title">Figure 35. Hot spots</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
In addition to the static image, the editor can specify a title made up of maximum 20 characters, which can be positioned on the left, on the right or in the center on the image.
The image can either be selected from the media store or uploaded via drag-and-drop on the <b class="button">Upload a picture</b> button in the form.
It can be cropped with the help of the familiar FirstSpirit functionality.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the section is used within a <a href="#blog_article">blog article</a>, the image to be selected cannot be cropped.
This functionality is only available if the section is directly integrated into a page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The editor can create any number of hot spots on the image by selecting an image section and defining a <a href="#cat_prod_link">product link</a> for this.
The link expects a link text and a product ID.
Both fields are automatically populated when a product is transferred from the product report.
After the form has been saved, the created hot spots are displayed in the relevant location on the image and the link text corresponds to the displayed product name.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The HTML channel initially references the selected image and displays it together with the title.
The hot spots are then determined and positioned using the image sections specified by the editor.
For each hot spot, the associated flyout is also created, which appears when the hot spot is clicked and automatically displays the corresponding product information.</p>
</div>
<div class="paragraph">
<p>The entire content is assigned to the <code>set_sectionContent</code> variable, which is required during generation of the <a href="#hp">homepage</a> to populate the corresponding XML file.
For a <a href="#contentpage">content page</a>, however, the variable is only output.</p>
</div>
<div class="paragraph">
<p>As the image is referenced from the media store of the FirstSpirit project and is therefore not affected by substitution of Salesforce content, the content does not have to be labeled with HTML tags.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As the image map in FirstSpirit does not provide the option to upload and crop an image by default, the two scripts <em>cc_crop</em> and <em>cc_upload</em> have been added to the reference project.
They make both functionalities available to the editor.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_blog"><a class="anchor" href="#_blog"></a>5.11. Blog</h3>
<div class="paragraph">
<p>In contrast to the <a href="#hp">homepage</a> and <a href="#detail_pages">category and product pages</a>, <a href="#contentpage">content pages</a> have the option to display blog articles.
Every blog article corresponds to a dataset of the <em>Article</em> data source and must first be generated by the editor.</p>
</div>
<div class="paragraph">
<p>With the aid of two table templates, they can be presented either in the form of an overview of all available blog articles or as a detail view of one single article.
Both options are described in the sub-chapters below.</p>
</div>
<div class="sect3">
<h4 id="_article_overview"><a class="anchor" href="#_article_overview"></a>5.11.1. Article overview</h4>
<div class="paragraph">
<p>The article overview presents all blog articles included in the project sorted by their creation date.
In each case, the display is limited to the heading of an article plus the teaser and teaser image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/article_overview.png" alt="article overview">
</div>
<div class="title">Figure 36. Article overview</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The teaser image must be created with the resolution of <code>ARTICLE_TEASER_IMAGE</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
As the overview is generated automatically, the editor can only define the number of blog articles to be displayed as well as their distribution across one or more pages.
It is configured using the familiar FirstSpirit functionality on the <code>Data</code> tab of the relevant page reference.</p>
</div>
<div class="paragraph">
<p>Apart from this, the editor has no access to the function other than to integrate the table template.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The HTML channel of the table template determines the datasets of the <em>Article</em> data source and in each case outputs the heading, the teaser, and the teaser image of all blog articles one after the other.
The individual articles are separated by a horizontal line and their headings match the link to the relevant detail page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To link the detail page, its reference name must be known to the overview page.
In the reference project, the reference name of the relevant page reference (<em>magazine_article</em>) was therefore permanently included to the template for the overview page.
In individual scenarios, this is therefore to be adapted accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, a navigation function is inserted in the first position before the list of blog articles.
This enables users to browse through the blog articles if they are distributed across several pages.
If all blog articles are presented on a single page, the navigation function is hidden.</p>
</div>
</div>
<div class="sect3">
<h4 id="blog_article"><a class="anchor" href="#blog_article"></a>5.11.2. Articles</h4>
<div class="paragraph">
<p>Every blog article corresponds to a dataset of the <em>Article</em> data source and makes various input options available to the editor.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
To create a blog article, the editor must first enter a heading and teaser text as well as select a teaser image.
A creation date and an author must also be specified.
The editor also has the option of specifying a banner or slider for the article.
These paragraphs are created as described in chapter <a href="#banner">Banner</a>.</p>
</div>
<div class="paragraph">
<p>To record the editorial content, the following sections are also available to the editor.
The <em>Article Tiles</em> section can only be used within blog articles.
It is not included in the section selection for the page templates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Shop the look</strong><br>
The section enables products to be presented as what are known as hot spots.
It corresponds to the section of the same name, which can be added to the <a href="#hp">homepage</a> and <a href="#contentpage">content pages</a> and which has already been described in the previous <a href="#hot_spots">chapter</a>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the section is used within a <a href="#blog_article">blog article</a>, the image to be selected cannot be cropped.
This functionality is only available if the section is directly integrated into a page.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Article Tiles</strong><br>
This section can be used to present three blog articles side by side in a column view.
In each case, the view comprises the heading, the teaser image, and the teaser text plus the author and the creation date of the article.
Clicking the heading calls up the detail page of the corresponding blog article.</p>
<div class="paragraph">
<p>A heading can be specified for the section and displayed left-aligned, right-aligned, or centered above the blog articles.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/article_tiles.png" alt="article tiles">
</div>
<div class="title">Figure 37. Article Tiles</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To link the detail page, the reference name of the relevant page reference (<em>magazine_article</em>) was permanently included to the template for the section.
In individual scenarios, this must be adapted accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Product Tiles</strong><br>
This section is available for blog articles and <a href="#proddetailpage">product detail pages</a>.
It is described in the <a href="#producttiles">chapter of the same name</a>.
In the same way as <em>Article Tiles</em>, this section presents three products side by side in a column view.</p>
<div class="imageblock">
<div class="content">
<img src="_images/product_tiles.png" alt="product tiles">
</div>
<div class="title">Figure 38. Product Tiles</div>
</div>
</li>
</ul>
</div>
<div id="text_picture_section" class="ulist">
<ul>
<li>
<p><strong>Text Picture</strong><br>
The section provides five ways of adding text and/or images.
It corresponds to the section of the same name, which can be added to <a href="#login_page">login pages</a> and blog articles and is described in the <a href="#textpicture">corresponding chapter</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The HTML channel first outputs the heading of the blog article along with the name of the author and the creation date.
It then determines the sections generated by the editor and displays these one after the other.</p>
</div>
<div class="paragraph">
<p>As there is no substitution of Salesforce content, the blog content does not have to be labeled with HTML tags.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="textpicture"><a class="anchor" href="#textpicture"></a>5.12. Text Picture</h3>
<div class="paragraph">
<p>As its name suggests, this section is used to add text and/or images.
It is only permitted in <a href="#blog_article">blog articles</a> and <a href="#login_page">login pages</a>.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
This section provides editors with five different options for entering content.
These options are selected from within a form:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Option 1 - only text</dt>
<dd>
<p>With the first option, only text can be added.</p>
</dd>
<dt class="hdlist1">Option 2 - 1 picture</dt>
<dd>
<p>The second option enables a single image to be added.</p>
</dd>
<dt class="hdlist1">Option 3 - 2 pictures side by side</dt>
<dd>
<p>In addition to the second option, the editor can use the third option to add two images, which are displayed side by side.</p>
</dd>
<dt class="hdlist1">Option 4 - picture left, text right</dt>
<dd>
<p>This option enables the image and text to be displayed simultaneously.
The image is displayed on the left of the text.</p>
</dd>
<dt class="hdlist1">Option 5 - text left, picture right</dt>
<dd>
<p>The fourth and fifth option are equivalent to one another.
In this case, however, the image is displayed on the right of the text.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The content selected by the editor is displayed and positioned accordingly within the HTML channel based on the option selected by the editor.
As the content does not come from Commerce Cloud, it does not have to be labeled with HTML tags.
It is shown in the preview without substitution.</p>
</div>
</div>
<div class="sect2">
<h3 id="producttiles"><a class="anchor" href="#producttiles"></a>5.13. Product Tiles</h3>
<div class="paragraph">
<p>Like article tiles, which can only be used in <a href="#blog_article">blog articles</a>, this section presents three products side by side in a column view.
It is only permitted in a blog article or on a product detail page and shows the name, image, and a description for each product.
Clicking the product name opens the corresponding <a href="#proddetailpage">product detail page</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/product_tiles.png" alt="product tiles">
</div>
<div class="title">Figure 39. Product Tiles</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
In addition to the three products to be selected, the editor can specify an optional title made up of a maximum of 50 characters to be positioned on the left, on the right, or in the center above the product tiles.
The products can be referenced in the form using drag-and-drop (the product name is added as link text).
Unlike the product information, the product name can be edited.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the selection created by the editor contains fewer than three products, the page cannot be released.
It is not possible to select more than three products.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The products selected by the editor are referenced and the title is positioned within the HTML channel.
For each product, its name, a product image, and a description are determined and displayed.
As the information is taken from Salesforce without substitutions, HTML tags are not required.</p>
</div>
</div>
<div class="sect2">
<h3 id="video"><a class="anchor" href="#video"></a>5.14. Video</h3>
<div class="paragraph">
<p>A page in the reference project can also contain videos alongside purely textual information.
Each video corresponds to a section, which provides different configuration options.
The associated section template can only be added to <a href="#contentpage">content pages</a> and <a href="#catlandingpage">category landing pages</a>, not the <a href="#hp">homepage</a>.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
To reference videos, editors can make use of the <em>YouTube</em> and <em>Vimeo</em> platforms.
Both providers use a unique ID, which in each case forms part of the video URL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Youtube</strong>: https://www.youtube.com/watch?v=&lt;VIDEO ID&gt;</p>
</li>
<li>
<p><strong>Vimeo</strong>: https://vimeo.com/&lt;VIDEO ID&gt;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding video for the page can be added using this ID.
The video is displayed in the standard format of <code>16:9</code>.
For YouTube videos, however, the options <code>21:9</code>, <code>4:3</code>, or <code>1:1</code> are also available.
Furthermore, the editor can define whether playback is started automatically and whether the video may be displayed in full screen mode.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Within the HTML channel, the selected video is first referenced in direct relation to the defined video platform.
For this, the display format as well as the different URL parameters are set and, in a final step, the correct video URL generated in accordance with the editor&#8217;s configured settings in the form.</p>
</div>
<div class="paragraph">
<p>This content is assigned to the <code>set_sectionContent</code> variable, which is required during generation of a <a href="#catlandingpage">category landing page</a> to populate the corresponding XML file.
For a <a href="#contentpage">content page</a>, however, the variable is only output.</p>
</div>
<div class="paragraph">
<p>As the embedded video does not come from Commerce Cloud, it does not have to be labeled with HTML tags.
It is shown in the preview without substitution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_social_media"><a class="anchor" href="#_social_media"></a>5.15. Social Media</h3>
<div class="paragraph">
<p>Editors can use content from Facebook, Twitter, and Instagram in the reference project and embed it in a content page.
There is also the option to place buttons on a page so that visitors can use them to share the website link via various platforms.</p>
</div>
<div class="sect3">
<h4 id="_embedding_content"><a class="anchor" href="#_embedding_content"></a>5.15.1. Embedding content</h4>
<div class="paragraph">
<p>Content from social networking sites can be embedded in a website.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The <em>Social Media Embedding</em> section template is used for embedding content from social networking sites.
It requires one of the available platforms - Facebook, Twitter, or Instagram - to be selected within the section form.</p>
</div>
<div class="paragraph">
<p>If Facebook is being used as a platform, the type of post to be embedded must also be defined.
Posts, comments, and videos are available for selection.
In all cases, the URL of the post must then be entered in the corresponding form field.
There may also be additional options available for changing the way in which a post is displayed, depending on the type of post.</p>
</div>
<div class="paragraph">
<p>Twitter also provides a whole host of different options for editors:
It is possible to choose the List, Profile, or Collection Timelines option in the form in order to embed it in the page.
To do this, the editor must enter the name of the Twitter account associated with the timeline in the <code>Screen Name</code> form field.
List and Collection Timelines also require the timeline to be identified in the <code>ID</code> field.</p>
</div>
<div class="paragraph">
<p>Embedding an Instagram post simply requires the URL of the post to be entered in the form.</p>
</div>
<div class="paragraph">
<p>A <a href="#slot_configuration">slot configuration</a> must also be specified for all page templates, with the exception of the <a href="#contentpage">content page</a>.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The section template uses various mechanisms to embed the post in the page, depending on the selected platform.
The resulting HTML markup saves them in the <code>set_sectionContent</code> variable, which simply outputs them if a <a href="#uc_preview">FirstSpirit preview</a> is generated.
When a content page is being generated, the value of the variable must also be output so that the value can be included in the content asset of the content page.
A new asset is created on other pages instead, and the value of <code>set_sectionContent</code> is stored in this asset.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sharing_the_page"><a class="anchor" href="#_sharing_the_page"></a>5.15.2. Sharing the page</h4>
<div class="paragraph">
<p>It is possible to give visitors to the website the option of sharing the page via various social networking sites.
A button for each supported platform can be placed on the page.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The <em>Social Media Share</em> section template is provided for using this function.
In this template, editors first select one or more social networking sites, for which they would like to add buttons in their page.
The size and position of the buttons only need to be defined once for all the selected platforms.
The supported platforms are Facebook and Twitter.</p>
</div>
<div class="paragraph">
<p>In the case of Facebook, there is the option to add individual text to the button; this text is maintained in the section form.
In the case of Twitter, editors have the option of storing the tweet text and hashtags.</p>
</div>
<div class="paragraph">
<p>A <a href="#slot_configuration">slot configuration</a> must also be specified for all page templates, with the exception of the <a href="#contentpage">content page</a>.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Depending on the selected networks, this template also generates different HTML content for the implementation of buttons.
Unlike <a href="#contentpage">content pages</a>, which simply output the markup, the other pages save the markup in a content asset.
In the case of a <a href="#uc_preview">preview</a>, the markup is simply displayed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_changing_the_language"><a class="anchor" href="#_changing_the_language"></a>5.16. Changing the language</h3>
<div class="paragraph">
<p>The reference project supplied uses English as the master language.
It also has Italian, French, Japanese, and Chinese as project languages.
To switch the view of a page to one of these languages, the project provides the option of changing languages in the <a href="#uc_preview">preview</a>.
This is displayed either as a dropdown menu or within a menu as a list item, depending on the screen size used.</p>
</div>
<div id="langs" class="imageblock">
<div class="content">
<img src="_images/langs.png" alt="langs">
</div>
<div class="title">Figure 40. Changing the language</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
Within the preview of the reference project, the change of language is displayed on the <a href="#hp">homepage</a>, on <a href="#contentpage">content pages</a>, and on <a href="#detail_pages">category and product pages</a>.
This enables the editor to maintain editorial content on each page for all the languages contained within the project.</p>
</div>
<div class="paragraph">
<p>As the selection of existing languages is determined automatically based on the project languages and the display also cannot be influenced, the editor has no access to the function other than to simply use it.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The change of language option is generated through the <em>Language Dropdown</em> format template and made available for use in the <a href="#uc_preview">preview</a> with the <em>Preview Generation</em> format template.
This is displayed either as a dropdown menu or within a menu as a list item, depending on the screen size used (see figure <a href="#langs">Changing the language</a>).</p>
</div>
<div class="paragraph">
<p>Both variants reference the <em>Language Dropdown</em> format template, which controls the display of variants via the <code>showInMenu</code> parameter to be transferred.
As the change of language replaces all of the corresponding Salesforce content, both variants must be labeled with unique HTML comments.</p>
</div>
<div class="listingblock">
<div class="title">Changing the language in the Preview Generation format template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$-- Preview Language Switch --$
&lt;!-- CMS-LANGUAGE-DROPDOWN-START --&gt;
   $CMS_RENDER(template:"sfcc_language_dropdown", mobile:false)$
&lt;!-- CMS-LANGUAGE-DROPDOWN-END --&gt;

&lt;!-- CMS-LANGUAGE-DROPDOWN-MOBILE-START --&gt;
   $CMS_RENDER(template:"sfcc_language_dropdown", mobile:true)$
&lt;!-- CMS-LANGUAGE-DROPDOWN-MOBILE-END --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>Language Dropdown</em> format template first determines the language currently displayed in the preview and shows this along with the corresponding icon as the first entry in the dropdown or language menu.
The list of all languages contained within the project is then queried and made available as further selection options with the exception of the previously defined language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_links"><a class="anchor" href="#_links"></a>5.17. Links</h3>
<div class="paragraph">
<p>The editorial content maintained on the FirstSpirit side contains links that can be used to link content.
In addition, links can be used to provide documents for download or for contact details.</p>
</div>
<div class="paragraph">
<p>These are based on different link templates, which are described in detail in the following sub-chapters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All link templates - with the exception of the article link - have the hidden <em>Add link tags</em> toggle component.
It ensures that the corresponding link has <code>&lt;a&gt;</code> tags when the associated link template is used within a <code>CMS_INPUT_DOM</code>.
If it is used in the context of a <code>CMS_INPUT_LINK</code>, the link does not get any <code>&lt;a&gt;</code> tags.
The toggle is activated via a rule.</p>
</div>
<div class="listingblock">
<div class="title">Add link tags</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">$CMS_IF(lt_linkTags)$
   &lt;a href="$CMS_VALUE(lt_url)$"
    $CMS_IF(!lt_linktext.isEmpty)$ title="$CMS_VALUE(lt_linktext)$"$CMS_END_IF$
    target="_blank"&gt;
      $CMS_VALUE(lt_linktext, default: "Link")$
   &lt;/a&gt;
$CMS_ELSE$
   href="$CMS_VALUE(lt_url)$"
   $CMS_IF(!lt_linktext.isEmpty)$ title="$CMS_VALUE(lt_linktext)$"$CMS_END_IF$
   target="_blank"
$CMS_END_IF$</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="cat_prod_link"><a class="anchor" href="#cat_prod_link"></a>5.17.1. Category link and product link</h4>
<div class="paragraph">
<p>The category link and product link make it possible to link to <a href="#detail_pages">category and product pages</a>.
They are almost equivalent to one another and are therefore described jointly in this chapter.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
A link to a <a href="#detail_pages">category or product page</a> is specified by entering link text and the associated product or category ID.
Both fields are automatically populated when a product or category is transferred from one of the two reports.
While the ID cannot be changed, the link text can be changed at will by the editor.
If the editor deletes the link text or if the form field remains empty for other reasons, the term <code>Product</code> or <code>Category</code> is used instead.</p>
</div>
<div class="paragraph">
<p>In addition, category links allow the selection of a Sorting Rule.
Sorting Rules are used to sort the products displayed on a category page according to predefined criteria.
If the editor does not make a selection, the sorting of the products on the displayed category page is based on the Sorting Rule <code>Best Matches</code> by default.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Within the HTML channel of both templates, a differentiation is made between the preview and the generated state for the generation of links.
In the case of the generated state, an instruction is created, which triggers the determination of the correct URL on the Salesforce side.
For a preview, the <a href="#main_navigation">dispatcher</a> included in the Site Store performs this task.
To start with, it checks whether a FirstSpirit page reference exists for the transferred product or category ID.
If no such page reference exists, it determines the associated page from the storefront instead and displays this in the <a href="#uc_preview">preview</a>.
Furthermore, the URL of a category link is extended by a corresponding URL parameter if a Sorting Rule is selected for it.
If the editor has not made a selection, a category page displays the <code>Best Matches</code> by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At the current time, the <a href="#main_navigation">dispatcher</a> is not yet able to correctly assign references to variations of products to a FirstSpirit page reference.
Therefore, the corresponding page from Storefront is always displayed whenever references to variations of products appear.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of Sorting Rules is only possible in the live state.
There is no sorting of any kind within the preview.
It always displays only the <code>Best Matches</code> - regardless of a selected Sorting Rule.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="content_link"><a class="anchor" href="#content_link"></a>5.17.2. FS content link</h4>
<div class="paragraph">
<p>The FS content link is used to link page references within FirstSpirit.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
To create a content link, the editor selects a page reference from the Site Store and specifies any link text.
Unlike the link text, selecting the page reference is a mandatory field.
If the field for the link text remains empty, the term <code>Link</code> is used instead.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a link to a page that exists exclusively in the storefront is required, the <a href="#ex_link">external link</a> must be used instead of the content link.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
As an FS content link is an internal link within the project, the page reference selected by the editor for the preview can be directly referenced.
Contrary to this, for the generated state, an instruction is created, which triggers the determination of the correct URL on the Salesforce side.
For this, the asset ID, which is calculated beforehand within the link template, is transferred as a URL parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="article_link"><a class="anchor" href="#article_link"></a>5.17.3. Article link</h4>
<div class="paragraph">
<p>The article link enables individual <a href="#blog_article">blog articles</a> within a continuous text to be linked.
For this reason, it can only be used within the text or <a href="#text_picture_section">Text Picture</a> section.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The article link is equivalent to the <a href="#content_link">FS content link</a>.
The difference is the link target, which, in the case of the article link, corresponds to a blog article.
It therefore expects a dataset from the <em>Article</em> data source to be referenced in addition to the link text.
While the selection of the blog article is a mandatory field, the link text is optional.
If the field remains empty, the heading of the blog article is used initially.
If this has also not been specified, the term <code>Article Link</code> is used instead.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
As with the content link, the article link is an internal link within the project.
For this reason, the selected blog article can be referenced directly in the preview based on its FS ID.
For the generated state, an instruction is created instead, which triggers the determination of the correct URL on the Salesforce side.
The asset ID is also transferred to it as a URL parameter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To link the blog article, the reference name of the relevant page reference (<em>magazine_article</em>) was permanently added to the link template.
In individual scenarios, this must be adapted accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ex_link"><a class="anchor" href="#ex_link"></a>5.17.4. External link</h4>
<div class="paragraph">
<p>The external link is used to link external websites.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The external link functions similarly to the <a href="#content_link">content link</a>.
Unlike this, however, it links to external content and therefore expects a URL in addition to the link text, rather than a page reference.
While the URL is a mandatory field, the link text is optional.
If the field for it remains empty, the term <code>Link</code> is used instead.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By entering the corresponding storefront URL, the external link can also be used for links to content in Commerce Cloud.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Within the HTML channel, only the external link defined by the editor is created.
As with the <a href="#content_link">content link</a>, it is not necessary to use the <a href="#main_navigation">dispatcher</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_download_link"><a class="anchor" href="#_download_link"></a>5.17.5. Download link</h4>
<div class="paragraph">
<p>The download link is used to provide documents on the website.
They can be downloaded by website visitors and provide them with additional information.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
To provide a document on the website for downloading, the editor must select this from the media store and enter any link text.
While selecting a document is mandatory, the field for the link text can remain empty.
In this case, the term <code>Download</code> is used.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
Using the information entered by the editor, the download link is created in the HTML channel.
For the generated state, the <code>$staticlink</code> parameter is added to it, which triggers the determination of the correct URL on the Salesforce side.
In addition, the presentation channel does not contain any additional content.</p>
</div>
<div class="paragraph">
<p>More information about linking static content in Salesforce can be found under <a href="https://documentation.b2c.commercecloud.salesforce.com/DOC2/index.jsp?topic=%2Fcom.demandware.dochelp%2FContent%2FLinkingtoAnotherSiteURL.html"><span class="menuseq"><b class="menu">Merchandising Your Site</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Content Assets</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Content Assets for Developers</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Using Content Link Functions</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Linking to Another Site URL</b></span></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_e_mail_link"><a class="anchor" href="#_e_mail_link"></a>5.17.6. E-mail link</h4>
<div class="paragraph">
<p>The e-mail link gives the option of getting in touch via e-mail.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The form for the e-mail link consists of just two text fields.
In these, the editor enters any link text as well as an e-mail address, the validity of which is checked using a regular expression in the Rules tab.
Unlike the e-mail address, specifying link text is optional.
If the field for it remains empty, the term <code>E-Mail</code> is used instead.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The information entered by the editor is used to create and output a mailto link in the HTML channel.
In addition, the presentation channel does not contain any additional content.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="slot_configuration"><a class="anchor" href="#slot_configuration"></a>5.18. Slot configurations</h3>
<div class="paragraph">
<p>Within the supplied reference project <em>ContentConnect Reference Project</em>, assets are represented by sections.
Depending on the use case, they each have a slot configuration, which makes it possible to deliver editorial content in a way that is specific to the target group and tailored to the customer.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The option to configure a slot is provided to an editor in the reference project in the form of an input component.
It is included in the sections available to the editor and may include an unlimited number of slot configurations.
A slot configuration is also defined as a default value for the input component in all available sections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The preconfigured slot configuration is activated and selected as the default configuration for the associated slot.
To change this, these properties must be modified manually.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike the <a href="#hp">homepage</a>, the <a href="#login_page">login page</a>, and the <a href="#catlandingpage">category pages</a>, the <a href="#contentpage">content page</a>, the <a href="#catdetailpage">category detail page</a>, and the <a href="#proddetailpage">product detail pages</a> only creates a single asset and summarizes all sections added to the page in this.
For this reason, it is not possible to define a slot configuration for each section in these cases.
The corresponding input component is therefore hidden for all sections of a content page, a category detail page, or a product detail page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The slot configuration can be (de)activated by the editor and selected as the default configuration for the associated slot.
In addition, it makes it possible to define the schedule parameters known from Salesforce.
By adding several sections of the same type (e.g. several sliders) but that have different slot configurations, it is possible to implement different types of content.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One of the schedule parameters to be defined is the <code>Schedule Type</code>, for which the <code>Default</code> value, among others, can be selected.
In this case, a <code>Rank</code> must also be entered, as otherwise errors will occur on the Salesforce side.
Without this information, it is not possible to release the associated page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
An individual slot configuration is represented by the <em>SFCC Slot Configuration</em> link template, which is used within the following sections of the <em>Slot Configuration</em> input component:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Banner Image</p>
</li>
<li>
<p>Slider</p>
</li>
<li>
<p>Grid container</p>
</li>
<li>
<p>Shop the look</p>
</li>
<li>
<p>Text</p>
</li>
<li>
<p>Video</p>
</li>
<li>
<p>Product Tiles</p>
</li>
<li>
<p>Social Media Share</p>
</li>
<li>
<p>Social Media Embedding</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Within the HTML channel of the link template, the XML expected by Commerce Cloud is created in line with the configuration defined by the editor and written in the collector provided.
The XML is transferred to Commerce Cloud using a deployment.</p>
</div>
<div class="sect3">
<h4 id="variants"><a class="anchor" href="#variants"></a>5.18.1. Variants</h4>
<div class="paragraph">
<p>Slot configurations enable the realisation of different content variants and thus the delivery of target group-specific and customer-specific editorial content.
In order to generate these content variants:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>either multiple slot configurations for a section</p>
</li>
<li>
<p>or several sections of the same type (e.g. several sliders) with different slot configurations in a content area</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>must be created.</p>
</div>
<div class="paragraph">
<p>Since in the second case all variants would be displayed in the <a href="#uc_preview">preview</a> by default,
the reference project has a variant selection for the <a href="#hp">homepage</a>, the <a href="#login_page">login page</a> and for <a href="#catlandingpage">category landing pages</a> (see figure <a href="#img_variants">Variant selection</a>).
As soon as a content area contains more than one section, the variant selection is visible and only the section selected in it is displayed in the preview.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a section has multiple slot configurations, the variant selection only considers the first one.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="img_variants" class="imageblock">
<div class="content">
<img src="_images/variants.png" alt="variants">
</div>
<div class="title">Figure 41. Variant selection</div>
</div>
<div class="paragraph">
<p>Each entry of the variant selection shows the title of the corresponding slot configuration and the parameters defined for it, whereby the default option is visualized in the form of a house icon and the rank as a double arrow.
If the title of a slot configuration is missing, the variant selection represents the section type instead.
In addition, deactivated slot configurations receive a gray background and a corresponding label.</p>
</div>
<div class="paragraph">
<p>In addition to the single entries, the variant selection has the <b class="button">Create a new variant</b> button, which is used to create new sections in the corresponding content area.
It has the same function as the Easy Edit button on existing sections.</p>
</div>
<div class="paragraph">
<p>The variant selection is integrated via so-called wrappers, which are integrated into the page or section templates in the form of the <em>MPP Body Wrapper</em> and <em>MPP Section Wrapper</em> format templates.
Calling the <em>MPP Section Wrapper</em> replaces the output of the variable <code>set_sectionContent</code> in sections, to which all editorial contents of a section are assigned in the reference project.
Equivalent to this, the <em>MPP Body Wrapper</em> in page templates replaces the output of the respective content area, which must be passed to the wrapper instead.</p>
</div>
<div class="listingblock">
<div class="title">MPP Body Wrapper call for the main area of the homepage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-FirstSpirit hljs" data-lang="FirstSpirit">&lt;!-- CMS-HOME-MAIN-START --&gt;
   $CMS_RENDER(template:"mpp_body_wrapper",body:"home_main_m")$
   $CMS_RENDER(template:"empty_content_slot",label:"Home Main",body:"home_main_m")$
&lt;!-- CMS-HOME-MAIN-END --&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_release_deleting_and_deployment"><a class="anchor" href="#_release_deleting_and_deployment"></a>5.19. Release, deleting, and deployment</h3>
<div class="paragraph">
<p>Content is released, deleted, and deployed within the supplied reference project <em>ContentConnect Reference Project</em> via workflows.
For this reason, it contains a publish workflow, as well as the <em>BasicWorkflows</em>.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Editor view</strong></span><br>
The <em>BasicWorkflows</em> provide an editor with the option to release modified content and to remove FirstSpirit elements both from the Current State and the Release State.
Both workflows are based on the four-eyes principle and are always executed in the context of a page.
If a conflict arises while a workflow is running, the workflow can be continued once the conflict has been rectified.</p>
</div>
<div class="paragraph">
<p>The publish workflow is available to editors to synchronize changes made in the FirstSpirit project on the Salesforce side.
It initiates the <a href="#schedule">deployment schedule</a> and is therefore executed without any context.
For this reason, it is started in ContentCreator via the <code><strong>Actions</strong></code> menu and in SiteArchitect via the <code><strong>Task list</strong></code>.
The deployment schedule transfers all released content to Commerce Cloud and triggers the deletion of assets and <a href="#slot_configuration">slot configurations</a>, which have been removed in FirstSpirit, on the Salesforce side.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/publish_wf.png" alt="publish wf">
</div>
<div class="title">Figure 42. Publish workflow in ContentCreator</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Developer view</strong></span><br>
The release workflow and the delete workflow correspond to those of the <em>BasicWorkflows</em> module and have not been changed.
The release workflow is oriented towards the administrative direct release and provides its functionality for the editor.
The delete workflow makes it possible to remove elements from the Current State and the Release State.</p>
</div>
<div class="paragraph">
<p>To transfer the changes made in the FirstSpirit project, the publish workflow has also been added to the reference project.
Using the <em>SFCC Release Deployment</em> script, this determines the <a href="#schedule">deployment schedule</a> and executes it.
Unlike the other two workflows, it does not refer explicitly to one single page.
For this reason, the option <code>Workflow executable without context</code> is activated in its <code><strong>Properties</strong></code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/wf_options.png" alt="wf options">
</div>
<div class="title">Figure 43. Publish workflow options</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To also remove the assets and <a href="#slot_configuration">slot configurations</a> deleted in the FirstSpirit project on the Salesforce side, the publish workflow must be executed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal_notices"><a class="anchor" href="#_legal_notices"></a>6. Legal notices</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>ContentConnect</em> is a product of e-Spirit AG, Dortmund, Germany.<br>
Only a license agreed upon with e-Spirit AG is valid with respect to the user for using the module.</p>
</div>
<div class="paragraph">
<p>Details regarding any third-party software products in use but not created by e-Spirit AG, as well as the third-party licenses and, if applicable,
update information can be found in the file <code>THIRD-PARTY.txt</code> included with the module.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
