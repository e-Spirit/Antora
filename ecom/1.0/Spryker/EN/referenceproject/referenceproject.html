<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/EN/referenceproject/referenceproject.html">
    <meta name="description" content="Dieses Dokument enthält die Dokumentation für das {modulname}-Modul von {fs}.">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../../_'</script>
    <link rel="icon" href="../../../../../_/img/shortcut-icon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/index.html">Spartacus</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Crownpeak</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ecom" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">E-Commerce</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Spryker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spryker-installation/spryker-installation.html">Spryker - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fs-installation/fs-installation.html">FirstSpirit - Installation and Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../use-cases/use-cases.html">Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../legal-notice.html">Legal Notice</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spartacus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../Spartacus/chapters/introduction.html">Main Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/sapcc-installation/sapcc-installation.html">Spartacus - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/fs-installation/fs-installation.html">FirstSpirit - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/use-cases/use-cases.html">Use Cases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spartacus/FS_Connect_SAP_hl_ServeradminManual_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../Salesforce/index.html">Salesforce</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SAP Classic</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../SAP_Classic/firstspiritconnect-sap-documentation_EN.html">Main Documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../SAP_Classic/firstspiritconnect-sap-admindoc_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">E-Commerce</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../headless/1.0/index.html">Headless</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../headless/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">E-Commerce</a></li>
    <li><a href="../../index.html">Spryker</a></li>
    <li><a href="referenceproject.html">Reference Project</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/ecom/edit/main/modules/Spryker/pages/EN/referenceproject/referenceproject.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="ref-project"><a class="anchor" href="#ref-project"></a>1. Reference project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module provides different ways to access shop content from Spryker and use it in FirstSpirit.
This requires different templates both within the FirstSpirit project and on the Spryker side.
These templates and the dependencies between them are described in the following subchapters using the
<a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The section and page templates contained in the reference project require different <a href="#sp_twigtemplates">Twig templates</a> for their use in Spryker.
The descriptions in the following subchapters assume the existence of these templates.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="rp_staticsite"><a class="anchor" href="#rp_staticsite"></a>1.1. Extension of existing static pages</h3>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module allows editors to enrich static pages that already exist on Spryker side with FirstSpirit content.
The pages are displayed within the ContentCreator using the <em>Omnichannel Manager</em> and thus integrate seamlessly into the editorial process familiar from FirstSpirit.</p>
</div>
<div class="paragraph">
<p>Besides the integration of the <em>Omnichannel Manager</em>, which is a step of the installation, the extension of static pages in FirstSpirit requires the filling of the output channel of the page and section templates.
In addition, an adaptation of the corresponding Twig templates is necessary on Spryker side.</p>
</div>
<div class="sect3">
<h4 id="rp_pagetemp"><a class="anchor" href="#rp_pagetemp"></a>1.1.1. Page template</h4>
<div class="paragraph">
<p>Editorial content in the FirstSpirit project is always edited on the basis of a page reference.
It and the page on which it is based must first be created in the FirstSpirit project.
Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project <em>FirstSpirit Connect Reference Project</em></a>, the creation of the page reference and its page runs automatically in the background and invisible to the editor.
The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/Scripts/omnichannel_manager/infer_page_storage_information"><code>infer_page_storage_information</code> script</a> uses the page ID defined in the <a href="#sp_controller">IndexController</a> to determine the corresponding FirstSpirit page template.</p>
</div>
<div class="paragraph">
<p>The page template <code>homepage</code> contained in the reference project is an example of a static page.
The following code fragment shows the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage/ChannelSource_CaaS_CaaS.json">output channel</a> of this page template:</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template homepage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_TRIM(level:1)$
   $CMS_SET(json, {:})$
   $CMS_SET(previewId, previewId(element:#global.node))$
   $CMS_SET(void, json.put("previewId", "" + previewId))$
   $CMS_SET(void, json.put("pagetype", "static"))$
   $CMS_SET(void, json.put("identifier", #global.node.uid))$

   $CMS_SET(blocks, [])$
   $CMS_FOR(bodyName, #global.page.template.bodies.map(body -&gt; body.name))$
      $CMS_VALUE(#global.page.body(bodyName))$
   $CMS_END_FOR$

   $CMS_SET(void, json.put("blocks", blocks))$

   $CMS_VALUE(json.toJSON)$
$CMS_END_TRIM$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page template maps the Twig template <code>home.twig</code> and contains the content areas <code>fs_slt_2</code>, and <code>fs_slt_3</code>.
The content areas enable the addition of editorial content, for which various section templates are available in the reference project.
Their content is added to the <code>json</code> object created in the template.</p>
</div>
<div class="paragraph">
<p>In addition to the editorial content, the <code>previewId</code>, the <code>identifier</code> and the <code>pagetype</code> are passed to the JSON object:
The <code>previewId</code> serves to identify the page reference and allows its decoration in the ContentCreator as well as its mapping to the Spryker Twig template.
The page reference for the preview is identified by the <a href="#sp_basetemp">JavaScript of the <em>Omnichannel Manager</em></a>.
The generation of the page in Spryker is done using the <code>identifier</code>.
It ensures the unique identification in Spryker.
It must also be known whether the underlying page is static or dynamic.
This information is indicated by the <code>pagetype</code>.</p>
</div>
<div class="paragraph">
<p>The generated JSON object is part of the <em>CaaS</em> item to be generated, which is persisted on the Spryker side by the importer.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_section"><a class="anchor" href="#rp_section"></a>1.1.2. Section template</h4>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage">page template <code>homepage</code></a> contained in the reference project is an example of a static page.
It contains the content areas <code>fs_slt_2</code>, and <code>fs_slt_3</code>.
The content areas allow the addition of editorial content.
Different section templates are available for this, all based on the same principle.
One of them is the <code>shoppable_video</code> section template, which is described here as an example.</p>
</div>
<div class="paragraph">
<p>Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json">output channel</a> of the Shoppable Video section, various general information is first defined and stored in the <code>block</code> array:
The <code>previewId</code> serves the identification of the section and enables it to be edited in the ContentCreator.
The fields <code>active</code> and <code>store_names</code> indicate that the CMS block represented by the section is active on the Spryker side and visible in the store selected in the <a href="#fs-projectsettings">project settings</a>.</p>
</div>
<div class="paragraph">
<p>The output of the section on Spryker side is handled by the <a href="#fs_molecule">Twig template <code>fs_molecule_block</code></a>.
This corresponds to a generic template that controls the output of all molecules.
In order to ensure the output of the section both in the preview and in the live state, the name and path of this Twig template must be stored within the <em>CaaS</em> item.
Both details are therefore included in the general information of the section.</p>
</div>
<div class="listingblock">
<div class="title">Definition of general information in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(block,{:})$

$-- Defining general block data --$
$CMS_SET(void, block.put("previewId", "" + previewId()))$
$CMS_SET(void, block.put("active", "1"))$
$CMS_SET(void, block.put("store_names",[ps_activeStore]))$
$CMS_SET(void, block.put("template_name", "fs_molecule_block"))$
$CMS_SET(void, block.put("template_path", "@CmsBlock/template/fs_molecule_block.twig"))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/block_name_render/ChannelSource_CaaS_CaaS.json"><code>block_name_render</code> render template</a> then determines the block name.
This is composed of the name of the parent content area and the ID of the section.</p>
</div>
<div class="paragraph">
<p>The <code>block_key_render</code> render template behaves in the same way as the <code>block_name_render</code> render template.
In contrast to this, however, it does not determine the block name, but the unique key of the corresponding block.</p>
</div>
<div class="paragraph">
<p>Using the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/additional_block_attributes_render/ChannelSource_CaaS_CaaS.json">render template <code>additional_block_attributes_render</code></a>, additional attributes are added to the block.
These attributes are the slot key and the position of the block within the slot, as well as the page type and a unique ID.</p>
</div>
<div class="paragraph">
<p>The importer requires the <code>placeholders</code> field to be in the generated <em>CaaS</em> item.
Therefore, it has to be created here, even though it does not have any data.</p>
</div>
<div class="listingblock">
<div class="title">Determination of specific information in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(set_pageType, json.get("pagetype"))$

$-- Add block name attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_name_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add block key attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_key_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add additional block attributes to block object (page type dependent) --$
$CMS_RENDER(template: "additional_block_attributes_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Defining placeholder data of the block --$
$CMS_SET(placeholders,{:})$
$CMS_SET(void, block.put("placeholder",placeholders))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The array <code>data</code> contains the editorial contents maintained in the form of the section.
These correspond to the video ID of the selected YouTube video and a list of video items based on the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/list_elements/shoppable_video_item"><code>shoppable_video_item</code> section template</a> described below.
They are displayed at defined times of the video.
To display the video, the player needs the <code>previewId</code> specified here.
On Spryker side, the section is represented by the molecule <code>fs-shoppable-video</code>, whose name is also contained in the <code>data</code> array.</p>
</div>
<div class="paragraph">
<p>The importer expects the information in the context of the current language.
For this reason, the corresponding language abbreviation to which the array <code>data</code> is assigned is determined.</p>
</div>
<div class="paragraph">
<p>In the preview, the contents of the section are output directly.
Otherwise, the last step adds the section to the <code>blocks</code> array defined in the page template, which contains all sections of a page and integrates them into the <em>CaaS</em> item to be generated.</p>
</div>
<div class="listingblock">
<div class="title">Processing of editorial content in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(data,{:})$
$CMS_SET(void, data.put("moleculename", "fs-shoppable-video"))$
$CMS_SET(void, data.put("videoId", if(!st_video.empty,st_video.values.first.id)))$
$CMS_SET(void, data.put("previewId", previewId()))$

$CMS_SET(items,[])$
$CMS_VALUE(st_items)$
$CMS_SET(void, data.put("items", items))$

$CMS_SET(locale, #global.language.getLocale())$
$CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$
$CMS_SET(localizedData,{:})$
$CMS_SET(void, localizedData.put(localeAbbr, data))$
$CMS_SET(void, block.put("data", localizedData))$

$CMS_IF(#global.is("WEBEDIT") &amp;&amp; !isSet(caas_preview_generation))$
   $CMS_VALUE(block.toJSON)$
$CMS_ELSE$
   $CMS_SET(void, blocks.add(block))$
$CMS_END_IF$</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned before, the various video items are based on the <code>shoppable_video_item</code> section template.
Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/list_elements/shoppable_video_item/ChannelSource_CaaS_CaaS.json">output channel</a> of this template, the editorial content for a single video item is determined and stored in the <code>item</code> array.
The editorial content corresponds to the time at which the video item is displayed, an image, a text and a reference to the detail page of a product to be selected.
The last step adds the single video item to the <code>items</code> array defined in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json"><code>shoppable_video</code> section template</a>, which contains all video items and integrates them into the <em>CaaS</em> item to be generated.</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the video item</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(item, {"time": st_time})$

$CMS_IF(!st_picture.empty)$
	$CMS_SET(void, item.put("picture", {
		"imageUrl": ref(st_picture, res:"CONTENT_IMAGE", abs:1).url,
		"ambilight": !st_ambilight.empty &amp;&amp; st_ambilight
	}))$
	$CMS_IF(!#global.release)$
		$CMS_SET(void, item.picture.put("previewId", previewId(element: st_picture)))$
	$CMS_END_IF$
$CMS_END_IF$

$CMS_IF(!st_text.empty)$
	$CMS_SET(void, item.put("text", st_text.normalize.toText(true)))$
$CMS_END_IF$

$CMS_IF(!st_product.empty)$
	$CMS_SET(void, item.put("productId", st_product.identifiers.get(0)))$
$CMS_END_IF$

$CMS_SET(void, items.add(item))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The edit dialog in the ContentCreator has the <b class="button">Open Video</b> button for entering the display time, the image, the text and the reference of a video item.
This button opens another dialog in which the selected video is visible and playable.
With the help of a timeline, the video items can be intuitively created, edited or deleted within this dialog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/videoitem.png" alt="videoitem">
</div>
<div class="title">Figure 1. Editing dialog for video items</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_twigtemplates"><a class="anchor" href="#rp_twigtemplates"></a>1.1.3. Twig templates</h4>
<div class="paragraph">
<p>In FirstSpirit, the creation and editing of editorial content takes place in ContentCreator.
The storefront is embedded in it using the <em>Omnichannel Manager</em>.
This in turn accesses the <em>Preview CaaS</em> and determines the current FirstSpirit contents from there.
These contents are transferred to the <em>Online CaaS</em> via a <a href="#fs-deployment">FirstSpirit deployment</a>.
The latter makes them available to the importer, who transfers them to Spryker and persists them there.</p>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code> represents a static page on the Spryker side and can be found under the path <code><strong>src/Pyz/Yves/HomePage/Theme/default/views/home</strong></code>.
To make this page editable in ContentCreator, it is necessary to replace the CMS slots contained in it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The slots represent the content areas of the respective <a href="#rp_pagetemp">FirstSpirit page template</a>.
For this reason, the key of the CMS slot and the name of the content area must match and start with the prefix <code>fs-slt</code> and <code>fs_slt</code> respectively.
It is important to note that hyphens in the key of the slot are replaced by underscores within FirstSpirit.
The slot <code>fs-slt-2</code> thus corresponds to the content area <code>fs_slt_2</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The inclusion of a slot is done via the Spryker standard command <code>cms_slot</code>, which in turn calls the <a href="#sp_plugin"><code>FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</code></a>.
This is part of the delivery and requires an extension of the <code>ShopCmsSlotDependencyProvider</code>.
Unlike the <code>CmsSlotBlockWidget</code> included in Spryker, it only takes into account the data stored in <em>CaaS</em>.</p>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code> is represented by the  <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage">page template <code>homepage</code></a> contained in the reference project.
It is an example for a static page and has the content areas <code>fs_slt_2</code> and <code>fs_slt_3</code>.
The following code example shows the integration of the slots of the same name within the Twig template to make the static page editable in ContentCreator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Within the Twig template the ID <code>idCmsPage</code> has to be defined and passed to each block.
It is composed of the page type and the name of the FirstSpirit page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Extension of the Twig template home.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends template('page-layout-main') %}

{% define data = {
   idCmsPage: 'static_homepage',
} %}

{% block pageInfo %}{% endblock %}

{% block container %}
   {% cms_slot 'fs-slt-2' with{
      idCmsPage: data.idCmsPage,
   }%}

   &lt;div class="container container--home-page"&gt;
      &lt;main&gt;
         {% block content %}
            {% cms_slot 'fs-slt-3' with{
               idCmsPage: data.idCmsPage,
            }%}
         {% endblock %}
      &lt;/main&gt;
   &lt;/div&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The content areas <code>fs_slt_2</code> and <code>fs_slt_3</code> contained in the <a href="#rp_pagetemp">page template <code>homepage</code></a> allow the addition of editorial content.
For this purpose, various section templates are available within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>, for which a corresponding block Twig template must exist on the Spryker side.
One of these templates is the <a href="#rp_section">section template <code>shoppable_video</code></a>, which is represented by the molecule <code>fs-shoppable-video</code> on the Spryker side.
This molecule is part of the <a href="#sp_twigtemplates">Spryker module <code>firstspirit-reference-components</code></a> included in the delivery and is stored in the directory <code><strong>FirstSpiritReferenceComponents</strong></code> in Spryker.</p>
</div>
<div class="paragraph">
<p>The following code extract shows the content of the molecule <code>fs-shoppable-video</code> in a highly abbreviated form:</p>
</div>
<div class="listingblock">
<div class="title">Molecule fs-shoppable-video</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
   name: 'fs-shoppable-video',
   tag: 'fs-shoppable-video'
} %}

{% define data = {
   fsBlockData: [],
} %}

{% block body %}
   [...]
   &lt;fs-youtube-player video-id="{{ data.fsBlockData.videoId }}" nocookie muted&gt;
      {% for item in data.fsBlockData.items %}
         &lt;div data-time="{{ item.time }}"&gt;
            {% set url = item.productId is defined ? getProductPageUrl(item.productId):null %}
            &lt;a href="{{url}}"&gt;
               {% set ambilight = item.picture.ambilight is defined and item.picture.ambilight %}
               &lt;span class="picture{{ambilight ? 'with-ambilight':''}}"
                  style="background-image: url('{{ item.picture.imageUrl }}');"&gt;
               &lt;/span&gt;
               [...]
               {{ item.text | raw }}
               [...]
            &lt;/a&gt;
            [...]
         &lt;/div&gt;
      {% endfor %}
   &lt;/fs-youtube-player&gt;
   &lt;script type="module" src="https://www.unpkg.com/fs-youtube-player"&gt;&lt;/script&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the template, the name and tag of the molecule are defined first.
The fsBlockData object is then created.
It provides access to the structured data defined in the output channel of the <a href="#rp_section">FirstSpirit section template</a>.
In the preview case, this data is obtained directly from the <em>Preview CaaS</em>.
In contrast, the data for the live state comes from Spryker.
Therefore, they are imported during a <a href="#fs-deployment">FirstSpirit generation</a> from the <em>Online CaaS</em> and persisted in Spryker.
The fsBlockData object and the JSON object created in FirstSpirit thus have the same structure in both cases.</p>
</div>
<div class="paragraph">
<p>The block <code>body</code> describes the output of the editorial content.
These correspond to the time at which the video item is displayed, an image, a text and a reference to the detail page of a product to be selected.</p>
</div>
<div class="paragraph">
<p>The following figure shows the representation of the CMS block.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/section.png" alt="section">
</div>
<div class="title">Figure 2. Representation of the section</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_categorypages"><a class="anchor" href="#rp_categorypages"></a>1.2. Extension of existing category pages</h3>
<div class="paragraph">
<p>Just like the <a href="#rp_staticsite">static pages</a> described above, category pages that already exist on the Spryker side can also be displayed in ContentCreator using the <em>Omnichannel Manager</em> and enriched with editorial content.
This also requires the filling of the output channel of the page and section template within the FirstSpirit project as well as a adaptation of the corresponding Twig templates in Spryker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If there are references to categories or products within the FirstSpirit project which have been deleted or are inactive in Spryker, so-called orphaned pages occur.
These can be removed from the project via the <a href="#uc_orphanedpages">report <code><strong>Lost and Found</strong></code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="rp_cp_pagetemp"><a class="anchor" href="#rp_cp_pagetemp"></a>1.2.1. Page template</h4>
<div class="paragraph">
<p>Just like <a href="#rp_pagetemp">static pages</a>, the extension of a category page in the FirstSpirit project is based on a page reference.
It and its associated page are also automatically created in the background and invisible to the editor.</p>
</div>
<div class="paragraph">
<p>The reference project contains the page template <code>categorypage</code>, which is an example of a category page and maps the Twig template <code>catalog-with-cms-slot.twig</code>.
The following code fragment shows the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">output channel</a> of this page template:</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template categorypage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_TRIM(level:1)$
   $CMS_SET(json, {:})$
   $CMS_SET(previewId, previewId(element:#global.node))$
   $CMS_SET(void, json.put("previewId", "" + previewId))$
   $CMS_SET(void, json.put("pageRevisionId", #global.page.revision.id))$
   $CMS_SET(void, json.put("pagetype", "category"))$
   $CMS_SET(blocks, [])$

   $CMS_VALUE(#global.page.body("banner"))$
   $CMS_VALUE(#global.page.body("top"))$
   $CMS_VALUE(#global.page.body("bottom"))$
   $CMS_SET(void, json.put("blocks", blocks))$

   $CMS_VALUE(json.toJSON)$
$CMS_END_TRIM$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">output channel</a> of the category page is almost identical to that of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/static_pages/homepage/ChannelSource_CaaS_CaaS.json">homepage</a>, which corresponds to a <a href="#rp_pagetemp">static page</a>.
It differs only in the page type, the revision id and in the number of content areas.
The page type is used to determine the block name and must have the value <code>category</code> at this point.
The block name is determined depending on the page type using the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/block_name_render/ChannelSource_CaaS_CaaS.json">render template <code>block_name_render</code></a>, which is referenced in the output channel of the respective <a href="#rp_section">section</a>.
The content areas of the page template correspond to the CMS block positions defined on the Spryker side.
They must therefore be named identically.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_cp_sectiontemp"><a class="anchor" href="#rp_cp_sectiontemp"></a>1.2.2. Section template</h4>
<div class="paragraph">
<p>In addition to the already described <a href="#rp_section">Shoppable Video section</a> and the Text-Image section, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/carousel_section">section template <code>carousel_section</code></a> is available for adding editorial content to category pages.
The carousel section in turn embeds one or more <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/banner_section">banners</a>.</p>
</div>
<div class="paragraph">
<p>The banner allows the selection of an image that can be cut to size as well as the definition of a link, a title and a subtitle.
For both the heading and the subtitle, a text color can be selected.
Unlike the other sections, which can be used only on subcategory pages, the banner can be embedded on all category pages.</p>
</div>
<div class="paragraph">
<p>The banner corresponds to the Spryker molecule <code>fs-banner.twig</code>, whose output is also controlled by the generic Twig template <code>fs_molecule_block.twig</code>.
This corresponds to a generic template that regulates the output of all molecules.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/banner_section/ChannelSource_CaaS_CaaS.json">output channel</a> of the banner is almost identical to that of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json">Shoppable Video section</a> and only differs in the evaluation of the available input components.
For this reason, no additional extensions are required that go beyond the requirements already described for the Shoppable Video section.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_cp_twigtemp"><a class="anchor" href="#rp_cp_twigtemp"></a>1.2.3. Twig Templates</h4>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">FirstSpirit page template <code>categorypage</code></a> contained in the reference project is an example of a category page.
It has the content areas <code>banner</code>, <code>top</code> and <code>bottom</code> and maps the Twig template <code>catalog-with-cms-slot.twig</code>.
This is stored in Spryker under the path <code><strong>src/Pyz/Yves/CatalogPage/Theme/default/views/catalog-with-cms-slot</strong></code>
and extends the parent template <code>page-layout-catalog.twig</code>, which defines the base layout of all category pages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To make category pages editable in ContentCreator, the CMS blocks within both templates must be integrated using the Twig function <code>fsSpyCmsBlock</code>.</p>
</div>
<div class="paragraph">
<p>Unlike the CMS block <code>banner</code>, which is available on all category pages, the CMS blocks <code>top</code> and <code>bottom</code> can only be used on subcategory pages.
If they should also be available on all category pages, the template <code>Catalog + CMS Slot</code> must be selected for them in Spryker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code example shows the Twig template <code>catalog-with-cms-slot.twig</code> including the adjustments necessary for editing in FirstSpirit.
Since only for the positions <code>top</code> and <code>bottom</code> content areas exist in the FirstSpirit page template, the integration of the CMS blocks takes place exclusively in these two cases via the Twig function <code>fsSpyCmsBlock</code>.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the Twig template catalog-with-cms-slot.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends template('page-layout-catalog', 'CatalogPage') %}

[...]

{% block catalogContent %}
   {% if data.categoryId %}
      &lt;div class="catalog-cms-block catalog-cms-block--top"&gt;
         {{ fsSpyCmsBlock({category: data.categoryId, position: 'top'}) }}
         {% cms_slot 'slt-4' required ['idCategory'] with {
            idCategory: data.categoryId,
         } %}
      &lt;/div&gt;
   {% endif %}

   {{ parent() }}

   {% if data.categoryId %}
      &lt;div class="catalog-cms-block catalog-cms-block--bottom"&gt;
         {{ fsSpyCmsBlock({category: data.categoryId, position: 'bottom'}) }}
         {% cms_slot 'slt-6' required ['idCategory'] with {
            idCategory: data.categoryId,
         } %}
      &lt;/div&gt;
   {% endif %}
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each CMS block corresponds to a FirstSpirit section placed at a specific position on the category page.
The use of positions in category pages is enabled Spryker sided by the <code>CMS Block Category Connector</code> feature, which is already configured within the demo shop.
The feature provides by default the positions <code>top</code>, <code>middle</code> and <code>bottom</code>.
In FirstSpirit, the positions are represented by the content areas of the corresponding page template.
For this reason, the names of the content areas and the names of the positions defined for category pages must be identical.</p>
</div>
<div class="paragraph">
<p>For the integration of the <a href="#rp_cp_sectiontemp">banner</a> the feature must be additionally extended by the position <code>banner</code>.
For this the file <code>cms_block_category_position.csv</code> within the directory <code><strong>data/import</strong></code> has to be adapted accordingly.
The transfer of the new position is then done via the following command, which has to be executed in the Spryker project directory.</p>
</div>
<div class="listingblock">
<div class="title">Update command</div>
<div class="content">
<pre>console data:import:cms-block-category-position</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A more detailed description of the configuration of positions for category pages can be found in the chapter
<a href="https://documentation.spryker.com/docs/enabling-category-cms-block#usage-for-demoshop">Usage for Demoshop</a> of the <em>Spryker documentation</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Furthermore, the CMS block <code>banner</code> has to be added to the superior Twig template <code>page-layout-catalog.twig</code>, which is stored in the directory <code><strong>src/Pyz/Yves/CatalogPage/Theme/default/templates/page-layout-catalog</strong></code>.
Therefore, the existing <code>block title</code> section within the template must be replaced by the following code.</p>
</div>
<div class="listingblock">
<div class="title">Integration of the banner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% block title %}
   {{ fsSpyCmsBlock({category:data.category.id_category, position: 'banner'}) }}
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Spryker, the banner corresponds to the molecule <code>fs-banner</code>.
The following code fragment shows the content of the molecule in a highly abbreviated form:</p>
</div>
<div class="listingblock">
<div class="title">Molecule fs-banner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
   name: 'fs-banner',
   tag: 'fs-banner'
} %}

{% define data = {
   fsBlockData: []
} %}

{% block body %}
   {% set url -%}
      {%- if data.fsBlockData.link is defined and data.fsBlockData.link is not empty -%}
         {%- include template('link', 'FirstSpiritPreview') with { link: data.fsBlockData.link } -%}
      {%- endif -%}
   {%- endset %}
   &lt;figure class="fs-banner"
      {% if data.fsBlockData.variantEditorName is defined %}
         data-variant-editor-name="{{ data.fsBlockData.variantEditorName }}"
      {% endif %}
      {% if data.fsBlockData.variant is defined and data.fsBlockData.variant is not empty %}
         data-variant="{{data.fsBlockData.variant}}"
      {% endif %}
      {% if data.fsBlockData.previewId is defined and data.fsBlockData.previewId is not empty %}
         data-preview-id="{{data.fsBlockData.previewId}}"
      {% endif %}&gt;

      [...]

      &lt;img src="{{ data.fsBlockData.picture.imageUrl }}"
         {% if data.fsBlockData.picture.previewId is defined %}
            data-preview-id="{{ data.fsBlockData.picture.previewId }}"
            data-tpp-context-image-resolution="BANNER_IMAGE"
         {% endif %}&gt;

      [...]

   &lt;/figure&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the template, the name and the tag of the molecule are defined first and then the fsBlockData object is created.
It provides access to the structured data defined in the output channel of the <a href="#rp_cp_sectiontemp">FirstSpirit section template</a>.
In the preview case, this data is obtained directly from the <em>Preview CaaS</em>.
In contrast, the data for the live state comes from Spryker.
For this they are imported during the <a href="#fs-deployment">FirstSpirit generation</a> from the <em>Online CaaS</em> and persisted in Spryker.
The fsBlockData object and the JSON object created in FirstSpirit thus have the same structure.</p>
</div>
<div class="paragraph">
<p>The block <code>body</code> describes the output of the editorial content.
These correspond to a cropable image and a link as well as a title and a subtitle, for each of which a text color is defined.</p>
</div>
<div class="paragraph">
<p>The following figure shows the representation of a carousel with an embedded banner in the ContentCreator.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/banner.png" alt="banner">
</div>
<div class="title">Figure 3. Carousel with a single element</div>
</div>
<div id="fs_molecule" class="paragraph">
<p>The output of all molecules is controlled by the generic Twig template <code>fs_molecule_block.twig</code>.
The following code fragment shows the content of this template:</p>
</div>
<div class="listingblock">
<div class="title">Generic Twig template for the output of all molecules</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% define data = {
   fsBlockData: fsBlockData()
} %}

{% block content %}
   {% include molecule( data.fsBlockData.moleculename, 'FirstSpiritReferenceComponents') with{
      data: {
         fsBlockData: data.fsBlockData
      }
      attributes: {
         'data-attributes': data.fsBlockData.attributes | default('') | json_encode
      }
   }only %}
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the Twig template of the molecule, the fsBlockData object is first created in the generic template.
The block <code>content</code> then includes the molecule specified in the <a href="#rp_section">FirstSpirit section template</a> for the parameter <code>moleculename</code>.
In Spryker, the molecule is stored in the <a href="#sp_twigtemplates">directory <code><strong>FirstSpiritReferenceComponents</strong></code></a>.
In this way, the Twig template generically controls the output of all molecules and creates the mapping between the FirstSpirit section template and the respective Spryker block Twig template.</p>
</div>
<div class="paragraph">
<p>The <code>attributes</code> attribute provides additional configuration attributes that can be defined in the output channel of a section template.
They are provided in this way directly in the tag of the corresponding molecule, so that they can be easily accessed via TypeScript.
If no configuration attributes are defined within the output channel of a section, the <code>attributes</code> attribute remains empty.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_productpages"><a class="anchor" href="#rp_productpages"></a>1.3. Extension of existing product pages</h3>
<div class="paragraph">
<p>Product pages that already exist in Spryker are equivalent to the <a href="#rp_categorypages">category pages</a> described in the previous chapter.
They can also be displayed and edited in the ContentCreator using the Omnichannel Manager.
This also requires the filling of the output channel of the FirstSpirit page template and an adaptation of the corresponding Twig templates in Spryker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If there are references to categories or products within the FirstSpirit project which have been deleted or are inactive in Spryker, so-called orphaned pages occur.
These can be removed from the project via the <a href="#uc_orphanedpages">report <code><strong>Lost and Found</strong></code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="rp_pdp_pagetemp"><a class="anchor" href="#rp_pdp_pagetemp"></a>1.3.1. Page template</h4>
<div class="paragraph">
<p>Editing a product page is equivalent to extending a <a href="#rp_categorypages">category page</a> and is, in the FirstSpirit project, also based on a page reference.
This and its associated page are automatically created in the background and invisible to the editor.</p>
</div>
<div class="paragraph">
<p>The page template <code>productpage</code> provided with the reference project represents a product page.
It maps the Twig template <code>pdp.twig</code> and comes with the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/productpage/ChannelSource_CaaS_CaaS.json">output channel</a> displayed in the following code snippet.</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template productpage</div>
<div class="content">
<pre>$CMS_TRIM(level:1)$
   $CMS_SET(json, {:})$
   $CMS_SET(previewId, previewId(element:#global.node))$
	$CMS_SET(void, json.put("previewId", "" + previewId))$
	$CMS_SET(void, json.put("pageRevisionId", #global.page.revision.id))$
	$CMS_SET(void, json.put("pagetype", "product"))$
	$-- Page uid is needed for later identification when setting the SKU of the page --$
	$CMS_SET(void, json.put("page_uid", #global.page.uid))$
	$CMS_SET(void, json.put("product_sku", pt_productSku))$
	$CMS_SET(blocks, [])$

	$CMS_VALUE(#global.page.body("content"))$
	$CMS_SET(void, json.put("blocks", blocks))$

	$CMS_VALUE(json.toJSON)$
$CMS_END_TRIM$</pre>
</div>
</div>
<div class="paragraph">
<p>The output channel of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/productpage/ChannelSource_CaaS_CaaS.json">product page</a> and the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/categorypage/ChannelSource_CaaS_CaaS.json">category page</a> are almost identical.
They only differ in the specification of the Page UID, the Product SKU and in the number of content areas.
The Product SKU is a unique product ID which, together with the Page UID, is used to uniquely identify the product page in Spryker.
By using the script <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Scripts/omnichannel_manager/set_product_sku/ChannelSource_HTML_html.html"><code>set_product_sku</code></a>, the Product SKU is automatically saved in the form of the page when a product page is created in the FirstSpirit project.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_pdp_twigtemp"><a class="anchor" href="#rp_pdp_twigtemp"></a>1.3.2. Twig template</h4>
<div class="paragraph">
<p>The Twig template <code>product-cms-block.twig</code> represents a product section on the Spryker side and extends the parent template <code>pdp.twig</code>, in which the basic layout of all product pages is defined.
It is a part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery and must be stored under the path`<strong>src/Pyz/Yves/CmsBlockWidget/Theme/default/components/molecules/product-cms-block</strong>` in Spryker.</p>
</div>
<div class="paragraph">
<p>The template <code>pdp.twig</code> requires the following adaptation to enable the integration of product sections.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the Twig template pdp.twig</div>
<div class="content">
<pre>[...]
&lt;div class="container__inner"&gt;
   {% include molecule('product-detail', 'ProductDetailPage') with {
      [...]
   } only %}

   {% include molecule('product-cms-block', 'CmsBlockWidget') ignore missing with {
      data: {
         idProductAbstract: data.product.idProductAbstract,
      }
   } only %}
&lt;/div&gt;
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>The following code example shows the content of the Twig template <code>product-cms-block.twig</code>.
It first contains the name of the molecule and specifies that the specification of a Product SKU is required.
This is passed to the Twig template via the parent Twig template <code>pdp.twig</code>.
The block <code>body</code> is used to output the contents that are maintained for the corresponding product page.</p>
</div>
<div class="listingblock">
<div class="title">Twig template product-cms-block.twig</div>
<div class="content">
<pre>{% extends model('component') %}

{% define config = {
   name: 'product-cms-block'
} %}

{% define data = {
   idProductAbstract: required
} %}

{% block body %}
   {{ fsSpyCmsBlock({ product: data.idProductAbstract }) }}
{% endblock %}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_contentpage"><a class="anchor" href="#rp_contentpage"></a>1.4. Creation of dynamic content pages</h3>
<div class="paragraph">
<p>In addition to the extension of existing <a href="#rp_staticsite">static pages</a> or <a href="#rp_categorypages">category pages</a>, the <em>FirstSpirit Connect</em> module allows the creation of dynamic content pages.
These correspond, for example, to the imprint, the data security explanation or the general terms and conditions.
Just like the other pages, the dynamic content pages can also be displayed in ContentCreator using the <em>Omnichannel Manager</em> and enriched with editorial content.
However, since the dynamic pages are newly created and not only extended, they are initially empty, unlike the other pages.</p>
</div>
<div class="paragraph">
<p>To create the dynamic content pages, it is also necessary to fill the output channel of the <a href="#rp_dcp_pagetemp">page template</a> within the FirstSpirit project.
In addition, the existence of the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a> is assumed in Spryker.
The template is part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery.</p>
</div>
<div class="paragraph">
<p>The section templates contained in the reference project are allowed for all pages.
For this reason, no additional extensions are required that go beyond the requirements already described for the <a href="#rp_section">Shoppable Video section</a>.</p>
</div>
<div class="sect3">
<h4 id="rp_dcp_pagetemp"><a class="anchor" href="#rp_dcp_pagetemp"></a>1.4.1. Page template</h4>
<div class="paragraph">
<p>Just like <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, the maintenance of dynamic content pages in the FirstSpirit project is based on a page reference.
However, in contrast to the other pages that already exist in the project, dynamic content pages are created using the familiar editing process.
For this reason, they are initially empty.</p>
</div>
<div class="paragraph">
<p>The creation of the page reference in the ContentCreator triggers an event of the <em>Omnichannel Manager</em>, which triggers the creation of the corresponding CMS page in Spryker.
This is necessary for displaying the CMS page in the preview.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New dynamic content pages must be created in the <em>Content Pages</em> structure folder.
This ensures their storage in the corresponding <em>CaaS</em> collection and thereby their automatic creation in Spryker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Under certain circumstances it is possible that the FirstSpirit project contains a dynamic content page for which there is no CMS page on the Spryker side.
In this case, the first time the content page is called in the ContentCreator, the <em>Omnichannel Manager</em> event is also triggered, which triggers the creation of the corresponding CMS page in Spryker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reference project contains the page template <code>contentpage</code>.
It is an example for dynamic content pages and maps the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a>, which has to be created on the Spryker side.</p>
</div>
<div class="paragraph">
<p>Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">output channel</a> of the page template, various general information is first defined and stored in the JSON object of the <em>CaaS</em> item to be generated:
The <code>previewId</code> serves to identify the page reference and allows its decoration in the ContentCreator as well as its mapping to the Spryker Twig template.
The automatically determined name and path of this template are specified using the fields <code>template_name</code> and <code>template_path</code>.
The page reference is identified using the <a href="#sp_basetemp">JavaScript of the <em>Omnichannel Manager</em></a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="TIP"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to the name of the Twig template, the ID of the corresponding CMS page is also determined automatically.
It is stored in a hidden input component of the FirstSpirit page template.
Since the ID is only required for the preview and is read directly from the page form, it is not required within the <em>CaaS</em> item.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, the <code>pagetype</code> parameter is used to define the page type.
In the case of dynamic content pages, the field must have the value <code>cmspage</code>.</p>
</div>
<div class="paragraph">
<p>The <code>is_active</code> and <code>store_names</code> fields indicate that the Twig template represented by the page is active on the Spryker side and visible in the store selected in the <a href="#fs-projectsettings">Project settings</a>.
The <code>is_searchable</code> field can also be used to configure whether the page can be searched by its name in Spryker.
In contrast to the <code>previewId</code>, which only serves for the preview, the unique <code>identifier</code> also allows the referencing of the <em>CaaS</em> item on Spryker side.</p>
</div>
<div class="listingblock">
<div class="title">Definition of general information in the output channel of the page template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(json, {:})$
$CMS_SET(previewId, previewId(element:#global.node))$
$CMS_SET(void, json.put("previewId", "" + previewId))$
$CMS_SET(void, json.put("template_name", pt_cmsPageTemplateName))$
$CMS_SET(void, json.put("template_path", "@Cms/templates/fs-content-page/fs-content-page.twig"))$
$CMS_SET(void, json.put("pagetype", "cmspage"))$
$CMS_SET(void, json.put("is_active", "1"))$
$CMS_SET(void, json.put("store_names", [ps_activeStore]))$
$CMS_SET(void, json.put("is_searchable", "1"))$
$CMS_SET(void, json.put("identifier", #global.node.uid))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the general information, the <code>localizedAttributes</code> array is used to pass specific information to the JSON object, which Spryker requires for each content page.
They are used to define various metadata, a page name, and the URL at which the page will be accessible in Spryker.
While the various metadata can optionally be entered by the editor in the form of the page, the URL is a language-dependent mandatory field.
It must have the structure <code>/language abbreviation/subpath</code>, with the language abbreviation automatically prefixed to the URL during generation.
The importer expects this information in the context of the current language.
For this reason, the corresponding language abbreviation, which is passed to each attribute, is determined.</p>
</div>
<div class="listingblock">
<div class="title">Definition of specific information</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(locale, #global.language.getLocale())$
$CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$

$CMS_SET(attributes, {:})$
$CMS_IF(pt_url != null &amp;&amp; !pt_url.isEmpty())$
   $CMS_SET(url, "/" + locale.getLanguage() + if(!pt_url.startsWith("/"), "/") + pt_url.convert2)$
   $CMS_SET(void, attributes.put("url", {localeAbbr: url}))$
$CMS_ELSE$
   $CMS_SET(void,#global.logError(
      "Missing url for contentpage " + #global.node.uid + ". Contentpages without url can't create and generate."))$
   $CMS_SET(#global.stopGenerate,true)$
$CMS_END_IF$
$CMS_SET(pageName, #global.page.getDisplayName(#global.language))$
$CMS_SET(void, attributes.put("name", {localeAbbr: if(pageName.toString() != null, pageName, "")}))$
$CMS_SET(void, attributes.put("meta_title", {localeAbbr: if(!pt_metaTitle.isEmpty, pt_metaTitle.convert2, "")}))$
$CMS_SET(void, attributes.put("meta_description", {localeAbbr: if(!pt_metaDescription.isEmpty, pt_metaDescription.convert2, "")}))$
$CMS_SET(void, attributes.put("meta_keywords", {localeAbbr: if(!pt_metaKeywords.isEmpty, pt_metaKeywords.convert2, "")}))$
$CMS_SET(void, json.put("localizedAttributes", attributes))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page template for dynamic content pages contains the two content areas <code>content_top</code> and <code>content_body</code>.
They enable the creation of editorial content, for which different section templates are available in the reference project.
Their contents are added one after the other to the JSON object <code>json</code> created in the template.</p>
</div>
<div class="listingblock">
<div class="title">Determination of editorial content</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(blocks, [])$
$CMS_VALUE(#global.page.body("content_top"))$
$CMS_SET(contentTopBlocks, [])$
$CMS_SET(void, contentTopBlocks.addAll(blocks))$

$CMS_SET(blocks, [])$
$CMS_VALUE(#global.page.body("content_body"))$
$CMS_SET(contentBodyBlocks, [])$
$CMS_SET(void, contentBodyBlocks.addAll(blocks))$

$CMS_SET(resultingBlocks, [])$
$CMS_SET(void, resultingBlocks.addAll(contentTopBlocks))$
$CMS_SET(void, resultingBlocks.addAll(contentBodyBlocks))$
$CMS_SET(void, json.put("blocks", resultingBlocks))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, dynamic content pages have so-called placeholders.
These correspond to the content areas of the FirstSpirit page template and contain only references to the CMS blocks assigned to them.
After the editorial content has been entered, these references are created for each content area.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The placeholders must also be created in the case of empty content pages.
This is especially necessary for the initial creation of the pages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Creation of the block references</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(placeholder, {:})$
$CMS_SET(contentTopPlaceholder, "")$

$CMS_IF(!contentTopBlocks.isEmpty())$
   $CMS_FOR(contentTopBlock, contentTopBlocks)$
      $CMS_SET(contentTopPlaceholder, contentTopPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentTopBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$CMS_SET(contentBodyPlaceholder, "")$
$CMS_IF(!contentBodyBlocks.isEmpty())$
   $CMS_FOR(contentBodyBlock, contentBodyBlocks)$
      $CMS_SET(contentBodyPlaceholder, contentBodyPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentBodyBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$-- Placeholders values have to exist in Spryker for synchronization purposes, therefore allowing even empty placeholder values for online CaaS --$
$CMS_IF(!contentTopPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_top", {localeAbbr: contentTopPlaceholder}))$
$CMS_END_IF$
$CMS_IF(!contentBodyPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_body", {localeAbbr: contentBodyPlaceholder}))$
$CMS_END_IF$

$CMS_SET(void, json.put("placeholder", placeholder))$
$CMS_VALUE(json.toJSON)$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_dcp_twigtemp"><a class="anchor" href="#rp_dcp_twigtemp"></a>1.4.2. Twig template</h4>
<div class="paragraph">
<p>In Spryker, the <a href="#sp_twigtemplates">Twig template <code>fs-content-page.twig</code></a> represents a dynamic content page.
Unlike <a href="#rp_staticsite">static pages</a> and <a href="#rp_categorypages">category pages</a>, dynamic content pages have placeholders.
To make the placeholders editable in ContentCreator, it is necessary to use the Twig function <code>fsSpyCms</code> to include them.</p>
</div>
<div class="paragraph">
<p>Each placeholder represents a content area of the corresponding <a href="#rp_dcp_pagetemp">FirstSpirit page template</a>.
For this reason, the name of the placeholder and the name of the content area must be identical.
Each of the content areas can contain any number of <a href="#rp_section">sections</a>, for which a Twig template must also exist in Spryker.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">FirstSpirit page template <code>contentpage</code></a> contained in the reference project is an example for dynamic content pages.
It has the content areas <code>content_top</code> and <code>content_body</code> and maps the Twig template <code>fs-content-page.twig</code>.</p>
</div>
<div class="paragraph">
<p>Within the Twig template, specific metadata and the page title are first defined.
Then the output of the two placeholders <code>content_top</code> and <code>content_body</code> is handled within the blocks <code>title</code> and <code>content</code>.
They reference the CMS blocks assigned to them, which in turn control the output of the editorial content.</p>
</div>
<div class="paragraph">
<p>The following code example shows the content of the template.</p>
</div>
<div class="listingblock">
<div class="title">Twig template fs-content-page.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends template('page-layout-main') %}

{% define data = {
   title: _view.pageTitle | default('global.spryker.shop' | trans),
   metaTitle: _view.pageTitle | default('global.spryker.shop' | trans),
   metaDescription: _view.pageDescription | default(''),
   metaKeywords: _view.pageKeywords | default('')
} %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
   &lt;!-- CMS_PLACEHOLDER : "content-top" --&gt;
   &lt;div class="cms-page__title"&gt;
      {{ fsSpyCms('content_top') | raw }}
   &lt;/div&gt;
{% endblock %}

{% block content %}
   &lt;!-- CMS_PLACEHOLDER : "content-body" --&gt;
   &lt;div class="cms-page__content"&gt;
      {{ fsSpyCms('content_body') | raw }}
   &lt;/div&gt;
{% endblock %}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_magazine"><a class="anchor" href="#rp_magazine"></a>1.5. Creation of a magazine</h3>
<div class="paragraph">
<p>Based on the previously described <a href="#rp_contentpage">dynamic content pages</a>, the <em>FirstSpirit Connect</em> module allows the creation of a magazine.
This consists of any number of magazine articles and an overview page.
Both the magazine articles and the overview page can be maintained in the ContentCreator just like the other pages.
In contrast to them, the magazine articles do not represent different pages, but individual data sets.
Within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a> the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/ContentStore/magazine_articles">data source <em>Magazine Articles</em></a> exists for their editorial creation and maintenance.
For the output of the magazine articles, the corresponding <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Schemes/magazine/magazine.magazine_articles/ChannelSource_CaaS_CaaS.json">table template</a> is referenced in a dynamic content page.
The data for the overview page is referenced via ContentSelects in a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/magazine_overview">section template</a>, which is also integrated in a dynamic content page.</p>
</div>
<div class="paragraph">
<p>The creation of a new magazine article in ContentCreator triggers an event of the <em>Omnichannel Manager</em>, which triggers the creation of the corresponding CMS page in Spryker.
This is necessary for displaying the CMS page in the preview.</p>
</div>
<div class="paragraph">
<p>For the creation of the magazine articles, it is necessary to fill the output channel of the corresponding page and table template.
The overview page requires the filling of the output channel of the corresponding section template.
Furthermore, the Twig templates <a href="#rp_m_twigtemplates"><code>fs-magazine-intro.twig</code>, <code>fs-magazine-overview.twig</code>, <code>fs-magazine-teaser.twig</code></a> and <a href="#rp_dcp_twigtemp"><code>fs-content-page.twig</code></a> are required in Spryker.
The templates are part of the <a href="#sp_twigtemplates">Spryker module <code>firstspirit-reference-components</code></a> included in the delivery.</p>
</div>
<div class="paragraph">
<p>The other section templates contained in the reference project for maintaining editorial content are permitted for all pages.
For this reason, they do not require any additional extensions that go beyond the requirements already described for the <a href="#rp_section">Shoppable Video section</a>.</p>
</div>
<div class="sect3">
<h4 id="rp_m_pagetemplate"><a class="anchor" href="#rp_m_pagetemplate"></a>1.5.1. Page template</h4>
<div class="paragraph">
<p>Both the magazine articles and the overview page are based on <a href="#rp_contentpage">dynamic content pages</a>.
Since they differ in their structure, the magazine articles need their own page template in contrast to the overview page.
In the reference project this corresponds to the page template <code>magazine_detail_page</code> and is a copy of a <a href="#rp_dcp_pagetemp"><code>contentpage</code></a>.
However, in comparison to the <code>contentpage</code>, the <code>magazine_detail_page</code> has only one content area, which only allows the integration of the <a href="#rp_m_tabletemplate">table template</a> of the magazine articles.</p>
</div>
<div class="paragraph">
<p>The following code fragment shows the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/magazine_detail_page/ChannelSource_CaaS_CaaS.json">output channel</a> of the page template <code>magazine_detail_page</code>:</p>
</div>
<div class="listingblock">
<div class="title">Output channel of the page template magazine_detail_page</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(json, {:})$
$CMS_IF(#global.pageParams.data.size &gt; 0)$
   $CMS_SET(previewId, previewId(element:#global.node))$
   $CMS_SET(void, json.put("previewId", "" + previewId))$
   $CMS_SET(void, json.put("template_name", pt_cmsPageTemplateName))$
   $CMS_SET(void, json.put("template_path", "@Cms/templates/fs-content-page/fs-content-page.twig"))$
   $CMS_SET(void, json.put("pagetype", "cmspage"))$
   $CMS_SET(void, json.put("is_active", "1"))$
   $CMS_SET(void, json.put("store_names", [ps_activeStore]))$
   $CMS_SET(void, json.put("is_searchable", "1"))$

   $CMS_IF(#global.dataset.formData.tt_page_identifier != null &amp;&amp; !#global.dataset.formData.tt_page_identifier.isEmpty())$
      $CMS_SET(void, json.put("identifier", #global.dataset.formData.tt_page_identifier))$
   $CMS_ELSE$
      $CMS_SET(void, #global.logError(
         "Missing page identifier for magazine detail page with entity id '" + #row.id + "'. Magazine detail pages without a page identifier can't be generated."))$
      $CMS_SET(#global.stopGenerate, true)$
   $CMS_END_IF$

   $CMS_SET(locale, #global.language.getLocale())$
   $CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$

   $CMS_SET(attributes, {:})$
   $CMS_SET(set_entityUrl, #global.dataset.formData.tt_url.convert2)$
   $CMS_IF(set_entityUrl != null &amp;&amp; !set_entityUrl.isEmpty())$
      $CMS_SET(url, "/" + locale.getLanguage() + if(!set_entityUrl.startsWith("/"), "/") + set_entityUrl)$
      $CMS_SET(void, attributes.put("url", {localeAbbr: url}))$
   $CMS_ELSE$
      $CMS_SET(void,#global.logError(
         "Missing url for contentpage " + #global.node.uid + "_" + global.dataset.entity.fs_id + ". Contentpages without url can't create and generate."))$
      $CMS_SET(#global.stopGenerate,true)$
   $CMS_END_IF$

   $CMS_SET(pageName, #global.dataset.formData.tt_title.convert2)$
   $CMS_SET(void, attributes.put("name", {localeAbbr: if(pageName.toString() != null, pageName, "")}))$
   $CMS_SET(void, attributes.put("meta_title", {localeAbbr: ""}))$
   $CMS_SET(void, attributes.put("meta_description", {localeAbbr: ""}))$
   $CMS_SET(void, attributes.put("meta_keywords", {localeAbbr: ""}))$
   $CMS_SET(void, json.put("localizedAttributes", attributes))$

   $CMS_VALUE(#global.page.body("container"))$
$CMS_END_IF$

$CMS_VALUE(json.toJSON)$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/magazine_detail_page/ChannelSource_CaaS_CaaS.json">output channel</a> of the magazine articles is almost identical to the output channel of <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">dynamic content pages</a>.
It differs only in the definitions of the identifier, some attributes and the number of content areas.</p>
</div>
<div class="paragraph">
<p>The identifier allows the referencing of the <em>CaaS</em> item on Spryker side and must therefore be unique.
However, if it were specified within the output channel, all magazine articles would have the same identifier.
Due to this it is stored in the form of the corresponding data set.</p>
</div>
<div class="paragraph">
<p>In contrast to <a href="#rp_dcp_pagetemp">dynamic content pages</a>, the URL is not specified in the page form, but, like the identifier, within the data set.
For this reason, it is determined at this point from the input component of the data set.
For the page name, the title defined for the magazine article is used.
This ensures that each magazine article has a unique page name.</p>
</div>
<div class="paragraph">
<p>The enclosing If query prevents generation errors in case of an empty data source.</p>
</div>
<div class="paragraph">
<p>In contrast to dynamic content pages, the editorial content and the block references for the magazine articles are not determined within the page template,
but in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Schemes/magazine/magazine.magazine_articles/ChannelSource_CaaS_CaaS.json">output channel</a> of the associated <a href="#rp_m_tabletemplate">table template</a>.
This represents the only permissible content for the <code>container</code> content area.</p>
</div>
<div class="paragraph">
<p>The overview page corresponds to a dynamic content page.
It includes the data required for it using a <a href="#rp_m_section">section template</a> and also allows the addition of further sections.
For this reason, it does not need its own page template.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_m_tabletemplate"><a class="anchor" href="#rp_m_tabletemplate"></a>1.5.2. Table template</h4>
<div class="paragraph">
<p>In contrast to the other pages, the magazine articles represent individual data sets, which are integrated into a <a href="#rp_m_pagetemplate">content page</a> via content projection.
Their maintenance and processing is therefore based on a table template that provides the corresponding form and forms the basis for the corresponding data source.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/Schemes/magazine/magazine.magazine_articles/ChannelSource_CaaS_CaaS.json">table template <code>magazine_articles</code></a> contained in the reference project consists of two thematic content blocks:<br>
The first block maps the Twig template <code>fs-magazine-intro.twig</code> in Spryker and consists of superordinate intro data, such as a title and various teaser information.
For their determination, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/magazine_intro_block_render_template">render template <code>magazine_intro_block_render_template</code></a> is referenced within the output channel of the table template, the result of which is stored in the array <code>contentTopBlocks</code>.
The output channel of this render template is almost identical to the output channel of the <a href="#rp_section">Shoppable Video section</a> and differs only in the evaluation of the available input components.<br>
The second block corresponds to the various sections of the magazine page, which respectively represent the Twig templates belonging to them in Spryker.
The sections are combined in a FS_CATALOG, which is stored in the output channel of the table template in the <code>contentBodyBlocks</code> array.</p>
</div>
<div class="paragraph">
<p>Both arrays are successively added to the JSON object <code>json</code> created in the <a href="#rp_m_pagetemplate">page template</a>.</p>
</div>
<div class="listingblock">
<div class="title">Determination of editorial content</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(blocks, [])$

$CMS_RENDER(template: "magazine_intro_block_render_template")$
$CMS_SET(contentTopBlocks, [])$
$CMS_SET(void, contentTopBlocks.addAll(blocks))$

$CMS_SET(blocks, [])$
$CMS_VALUE(tt_sections)$
$CMS_SET(contentBodyBlocks, [])$
$CMS_SET(void, contentBodyBlocks.addAll(blocks))$

$CMS_SET(resultingBlocks, [])$
$CMS_SET(void, resultingBlocks.addAll(contentTopBlocks))$
$CMS_SET(void, resultingBlocks.addAll(contentBodyBlocks))$
$CMS_SET(void, json.put("blocks", resultingBlocks))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the magazine articles are based on <a href="#rp_dcp_pagetemp">dynamic content pages</a>, they also have so-called placeholders.
The output channels of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/magazine_detail_page/ChannelSource_CaaS_CaaS.json">magazine articles</a> and the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/contentpage/ChannelSource_CaaS_CaaS.json">content pages</a> are therefore almost identical from this point on.
They differ only in the output of the placeholder for the body area and in the specification of the <code>previewId</code>.
In contrast to the content pages, the body area must also exist in the preview for the magazine articles in order to avoid the prohibited addition of further sections.
The <code>previewId</code> specified in this step overwrites the ID of the parent page, which references all magazine articles.
This is necessary because the <code>previewId</code> of the page is identical for all magazine articles, while the article IDs are unique.</p>
</div>
<div class="listingblock">
<div class="title">Creation of the block references</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(placeholder, {:})$
$CMS_SET(contentTopPlaceholder, "")$

$CMS_IF(!contentTopBlocks.isEmpty())$
   $CMS_FOR(contentTopBlock, contentTopBlocks)$
      $CMS_SET(contentTopPlaceholder, contentTopPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentTopBlock.get("block_name") + "'}) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$CMS_SET(contentBodyPlaceholder, "")$
$CMS_IF(!contentBodyBlocks.isEmpty())$
   $CMS_FOR(contentBodyBlock, contentBodyBlocks)$
      CMS_SET(contentBodyPlaceholder, contentBodyPlaceholder + "{{ fsSpyCmsBlock({name: '" + contentBodyBlock.get("block_name") + "'}, isContentEditable = false) }}\n")$
   $CMS_END_FOR$
$CMS_END_IF$

$-- Placeholders values have to exist in Spryker for synchronization purposes, therefore allowing even empty placeholder values for online CaaS --$
$CMS_IF(!contentTopPlaceholder.isEmpty() || #global.isRelease())$
   $CMS_SET(void, placeholder.put("content_top", {localeAbbr: contentTopPlaceholder}))$
$CMS_END_IF$
$CMS_SET(void, placeholder.put("content_body", {localeAbbr: contentBodyPlaceholder}))$

$CMS_SET(void, json.put("placeholder", placeholder))$
$CMS_SET(void, json.put("previewId", "" + previewId()))$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_m_section"><a class="anchor" href="#rp_m_section"></a>1.5.3. Section template</h4>
<div class="paragraph">
<p>In addition to the magazine articles, there is an overview page on which the articles are listed in the form of teasers sorted by date in ascending or descending order.
In contrast to magazine articles, the editorial content is not rendered via a content projection, but via two ContentSelects.
The reference project therefore contains the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/magazine_overview">section template <code>magazine_overview</code></a>, which can only be used in <a href="#rp_contentpage">dynamic content pages</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Editing, deleting or creating a magazine article does not update the overview page <strong>in the preview</strong> by default.
Within the reference project, the section template <code>magazine_overview</code> therefore contains the hidden FS_REFERENCE input component <code>st_dataSource</code>.
The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/ContentStore/magazine_articles">data source <code>magazine_articles</code></a>, which contains all magazine articles, is entered as the default value in this component.
With the help of this specification, a service running in the background recognizes the dependency between the corresponding magazine article and the overview page and triggers its update in the preview.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="IMPORTANT"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Publishing a magazine article always includes the publication of the overview page.
This ensures that the overview page is always up-to-date and contains all published magazine articles in the live status at any time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/magazine_overview/ChannelSource_CaaS_CaaS.json">output channel</a> of the section template contains the ContentSelects in the first place.
These query all data sets of the data source <code>magazine</code> and stores them in different order in the variables <code>fr_st_teasers_descending</code> or <code>fr_st_teasers_ascending</code>.</p>
</div>
<div class="listingblock">
<div class="title">ContentSelects in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">&lt;CMS_HEADER&gt;
   &lt;CMS_FUNCTION name="contentSelect" resultname="fr_st_teasers_descending"&gt;
      &lt;CMS_PARAM name="schema" value="magazine" /&gt;
      &lt;QUERY entityType="magazine_articles"&gt;
         &lt;ORDERCRITERIA attribute="date" descending="1" /&gt;
      &lt;/QUERY&gt;
   &lt;/CMS_FUNCTION&gt;

   &lt;CMS_FUNCTION name="contentSelect" resultname="fr_st_teasers_ascending"&gt;
      &lt;CMS_PARAM name="schema" value="magazine" /&gt;
      &lt;QUERY entityType="magazine_articles"&gt;
         &lt;ORDERCRITERIA attribute="date" descending="0" /&gt;
      &lt;/QUERY&gt;
   &lt;/CMS_FUNCTION&gt;
&lt;/CMS_HEADER&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to define various information, which is also contained in all other sections of the reference project.
At this point, the output channel is therefore identical to that of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/reference_components/shoppable_video/ChannelSource_CaaS_CaaS.json">Shoppable Video section</a>.</p>
</div>
<div class="listingblock">
<div class="title">Definition of various information in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(block,{:})$

$-- Defining general block data --$
$CMS_SET(void, block.put("previewId", "" + previewId()))$
$CMS_SET(void, block.put("active", "1"))$
$CMS_SET(void, block.put("store_names",[ps_activeStore]))$
$CMS_SET(void, block.put("template_name", "fs_molecule_block"))$
$CMS_SET(void, block.put("template_path", "@CmsBlock/template/fs_molecule_block.twig"))$

$CMS_SET(set_pageType, json.get("pagetype"))$

$-- Add block name attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_name_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add additional block attributes to block object (page type dependent) --$
$CMS_RENDER(template: "additional_block_attributes_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Add block key attribute to block object (page type dependent) --$
$CMS_RENDER(template: "block_key_render", rt_pageType: set_pageType, rt_blockObject: block)$

$-- Defining placeholder data of the block --$
$CMS_SET(placeholders,{:})$
$CMS_SET(void, block.put("placeholder",placeholders))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Subsequently, the teaser information is determined in two steps.
They consist of a title, an image, a text and a reference and are stored in the <code>teaser</code> array for each data set.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If for a teaser no title is specified or no image is selected, the title and image of the corresponding magazine article will be used for the display on the magazine overview page.
If the fields are maintained in both places, the overview page always shows the contents of the teaser.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first step only considers the information of the Featured Articles, which can be defined in the form of the overview page.
The second step is based on the result set of the corresponding ContentSelect and thus includes all magazine articles.
In both cases, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/FormatTemplates/rendertemplates/magazine_teaser_render">render template <code>magazine_teaser_render</code></a> is referenced, whose output channel only contains the evaluation of the input components available for the teasers.
The information determined in the two steps is stored in the arrays <code>featuredTeasers</code> and <code>teasers</code>.</p>
</div>
<div class="listingblock">
<div class="title">Determination of the teaser data in the output channel of the section</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(featuredTeasers, [])$
$CMS_FOR(for_featuredArticle, st_featuredArticles.values)$
   $CMS_SET(teaser,{:})$
   $CMS_RENDER(template: "magazine_teaser_render", rt_entity: for_featuredArticle.entity, rt_teaser: teaser)$
   $CMS_SET(void, featuredTeasers.add(teaser))$
$CMS_END_FOR$

$CMS_SET(teasers, [])$
$CMS_FOR(for_teaser, #global.context.getVariableValue("fr_st_teasers_"+st_sortingOrder.key))$
   $CMS_SET(teaser,{:})$
   $CMS_RENDER(template: "magazine_teaser_render", rt_entity: for_teaser, rt_teaser: teaser)$
   $CMS_SET(void, teasers.add(teaser))$
$CMS_END_FOR$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>data</code> array contains the editorial content.
The previously determined teaser data is added to it.
In Spryker, the section is represented by the molecule <code>fs-magazine-overview</code>, whose name is also contained in the <code>data</code> array.</p>
</div>
<div class="paragraph">
<p>The importer expects the information in the context of the current language.
For this reason, the corresponding language abbreviation to which the array <code>data</code> is assigned is determined.</p>
</div>
<div class="paragraph">
<p>In the preview, the contents of the section are output directly.
Otherwise, the last step adds the section to the <code>blocks</code> array defined in the page template, which contains all sections of a page and integrates them into the <em>CaaS</em> item to be generated.
Since the overview page is based on a <a href="#rp_contentpage">dynamic content page</a>, the corresponding page template is the <a href="#rp_dcp_pagetemp"><code>contentpage</code></a>.</p>
</div>
<div class="listingblock">
<div class="title">Processing of editorial content in the output channel of the sectionsection.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">$CMS_SET(data, {:})$
$CMS_SET(void, data.put("moleculename", "fs-magazine-overview"))$
$CMS_SET(void, data.put("featuredTeasers", featuredTeasers))$
$CMS_SET(void, data.put("teasers", teasers))$

$CMS_SET(locale, #global.language.getLocale())$
$CMS_SET(localeAbbr, locale.getLanguage() + "_" + locale.getCountry())$
$CMS_SET(localizedData, {:})$
$CMS_SET(void, localizedData.put(localeAbbr, data))$
$CMS_SET(void, block.put("data", localizedData))$

$CMS_IF(#global.is("WEBEDIT") &amp;&amp; !isSet(caas_preview_generation))$
   $CMS_VALUE(block.toJSON)$
$CMS_ELSE$
   $CMS_SET(void, blocks.add(block))$
$CMS_END_IF$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_m_twigtemplates"><a class="anchor" href="#rp_m_twigtemplates"></a>1.5.4. Twig Templates</h4>
<div class="paragraph">
<p>Both the magazine articles and the overview page are based on <a href="#rp_contentpage">dynamic content pages</a> and are therefore represented by the Twig template <a href="#rp_dcp_twigtemp"><code>fs-content-page.twig</code></a> on Spryker side.
This contains the placeholders <code>content_top</code> and <code>content_body</code>, which reference the CMS blocks assigned to them.
In this way, the molecule <code>fs-magazine-intro.twig</code> is called for the intro data of the magazine articles and the molecule <code>fs-magazine-overview.twig</code> for the teaser information of the overview page.
The molecule <code>fs-magazine-overview.twig</code> in turn references the molecule <code>fs-magazine-teaser.twig</code>, which provides the teaser information of a single magazine article.
All three molecules control the output of the editorial content.</p>
</div>
<div class="paragraph">
<p>The output of the remaining sections of the magazine articles takes place via the Twig Templates belonging to them.
Both the templates of these sections as well as the molecules for the magazine articles and the overview page are part of the <a href="#sp_twigtemplates">Spryker module <code>firstspirit-reference-components</code></a> included in the delivery.</p>
</div>
<div class="paragraph">
<p>As with the molecules of the <a href="#rp_twigtemplates">Shoppable Video section</a> and the <a href="#rp_cp_twigtemp">Banner</a>, the names of the molecules are defined within the three Twig Templates for the magazine articles and the overview page and then the fsBlockData object is created.
It provides access to the structured data defined in the output channel of the <a href="#rp_m_tabletemplate">FirstSpirit table template</a>.
The fsBlockData object and the JSON object created in FirstSpirit thus each have the same structure.</p>
</div>
<div class="paragraph">
<p>The block <code>body</code> describes the output of the editorial contents in the molecules.
In the template for the magazine articles, these correspond to their intro data, which consist of a title, a sub-title, and a banner.
The template for the overview page contains the teaser data of the magazine articles, which consist of an image, a title, a text and a reference.
The teaser data is provided using the molecule for the teasers.</p>
</div>
<div class="paragraph">
<p>The following code examples show the contents of the molecules.</p>
</div>
<div class="listingblock">
<div class="title">Twig template fs-magazine-intro.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
    name: 'fs-magazine-intro'
} %}

{% define data = {
    fsBlockData: [],
} %}

{% block body %}
   &lt;article class="magazine"&gt;
      &lt;header&gt;
         &lt;h1&gt;{{ data.fsBlockData.title }}&lt;/h1&gt;
         {% if data.fsBlockData.subtitle is defined %}
            &lt;h2&gt;{{ data.fsBlockData.subtitle }}&lt;/h2&gt;
         {% endif %}
         {% if data.fsBlockData.banner.imageUrl is defined %}
            &lt;figure class="picture picture-responsive"&gt;
               &lt;img class="img-fluid" src="{{ data.fsBlockData.banner.imageUrl | raw }}"
                  {% if  data.fsBlockData.banner.previewId is defined %}
                     data-preview-id="{{ data.fsBlockData.banner.previewId }}"
                  {% endif %}
                  data-tpp-context-image-resolution="MAGAZINE_ARTICLE_BANNER"&gt;
            &lt;/figure&gt;
         {% endif %}
      &lt;/header&gt;
   &lt;/article&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Twig template fs-magazine-overview.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
    name: 'fs-magazine-overview'
} %}

{% define data = {
    fsBlockData: [],
} %}

{% block body %}
   {% if isFsPreview() %}
      &lt;div style="padding-top: 24px;"&gt;&lt;/div&gt;
   {% endif %}
   {% if data.fsBlockData.featuredTeasers is not empty %}
      &lt;h2 style="text-align: left;"&gt;Featured&lt;/h2&gt;
   {% endif %}

   &lt;div class="featured-magazine-teasers"&gt;
      {% for teaser in data.fsBlockData.featuredTeasers %}
         {% include molecule('fs-magazine-teaser', 'FirstSpiritReferenceComponents') with {
            data: {
               fsBlockData: teaser
            }
         } only %}
      {% endfor %}
   &lt;/div&gt;

   {% if data.fsBlockData.featuredTeasers is not empty %}
      &lt;hr class="magazine-featured-divider"&gt;
   {% endif %}

   &lt;div class="magazine-teasers"&gt;
      {% for teaser in data.fsBlockData.teasers %}
         {% include molecule('fs-magazine-teaser', 'FirstSpiritReferenceComponents') with {
            data: {
               fsBlockData: teaser
            }
         } only %}
      {% endfor %}
   &lt;/div&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Twig template fs-magazine-teaser.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% extends model('component') %}

{% define config = {
   name: 'fs-magazine-teaser'
} %}

{% define data = {
   fsBlockData: [],
} %}

{% block body %}
   &lt;article class="magazine-teaser"
      {% if data.fsBlockData.previewId is defined %}
         data-preview-id="{{ data.fsBlockData.previewId }}"
      {% endif %}&gt;
      {% set cmsPageUrl = getCmsPageUrl(data.fsBlockData.page_identifier) %}

      {% if cmsPageUrl is not null %}
         &lt;a href="{{ cmsPageUrl }}"&gt;
      {% endif %}

         {% if data.fsBlockData.picture.imageUrl is defined %}
            &lt;figure class="picture picture-responsive"&gt;
               &lt;img src="{{ data.fsBlockData.picture.imageUrl }}"
                  {% if  data.fsBlockData.picture.previewId is defined %}
                     data-preview-id="{{ data.fsBlockData.picture.previewId }}"
                  {% endif %}
                  data-tpp-context-image-resolution="CONTENT_IMAGE"&gt;
            &lt;/figure&gt;
         {% endif %}
         &lt;h3&gt;{{ data.fsBlockData.title | raw }}&lt;/h3&gt;
         &lt;p&gt;{{ data.fsBlockData.text | raw }}&lt;/p&gt;

      {% if cmsPageUrl is not null %}
         &lt;/a&gt;
      {% endif %}
   &lt;/article&gt;
{% endblock %}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_navigation"><a class="anchor" href="#rp_navigation"></a>1.6. Extension of the main navigation</h3>
<div class="paragraph">
<p>In addition to the different page types, the main navigation of the Spryker B2C Demo Shop can be edited in the ContentCreator.
In FirstSpirit the navigation is represented by a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/GlobalStore/GlobalContentArea/navigation_extensions">global page</a>, a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/navigation_node_reference">section template</a> and a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigations">technical page reference</a>.
These enable the creation of further menu items in the first level of the navigation and their transfer to the <em>Preview CaaS</em> and to the <em>Online CaaS</em>.</p>
</div>
<div class="paragraph">
<p>In order to enable the main navigation to be extended, the following Twig templates must also be adapted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>navigation-header.twig</p>
</li>
<li>
<p>navigation-multilevel-node.twig</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="rp_navigation_globalpage"><a class="anchor" href="#rp_navigation_globalpage"></a>1.6.1. Global page</h4>
<div class="paragraph">
<p>The navigations of the Spryker B2C Demo Shop are represented in FirstSpirit via the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigation_extension">page template <code>navigation_extension</code></a>,
which is used to automatically create a <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/GlobalStore/GlobalContentArea/navigation_extensions">global page</a> for each navigation.
It includes an <code>FS_CATALOG</code> input component, which uses the section template <a href="#rp_navigation_section"><code>navigation_node_reference</code></a>
to refer all start nodes of the menu items <strong>maintained in FirstSpirit</strong>.
Each of these start nodes corresponds to a structure folder, which is to be selected within an editing dialog in the ContentCreator.
Therefore the main navigation in the ContentCreator has a button which allows the addition of new menu items in the first level of the navigation.
If a referenced structure folder contains further subfolders, these are automatically interpreted as sub-items of the new menu item.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The button for adding further menu items is only visible for those roles that have the right to edit and delete.
Otherwise the button is hidden.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/img_navigation.png" alt="img navigation">
</div>
<div class="title">Figure 4. Button to extend the navigation</div>
</div>
</div>
<div class="sect3">
<h4 id="rp_navigation_section"><a class="anchor" href="#rp_navigation_section"></a>1.6.2. Section template</h4>
<div class="paragraph">
<p>The global page <a href="#rp_navigation_globalpage"><code>navigation_extension</code></a> contained in the reference project enables the extension of the main navigation in the ContentCreator.
The navigation can be enhanced by adding menu items on the first level, each of which corresponds to a structure folder and serves as a start node.
Subfolders contained in such a structure folder are automatically interpreted as sub-items of the new menu item.</p>
</div>
<div class="paragraph">
<p>For all new start nodes, the <code>FS_CATALOG</code> input component of the global page is enhanced with an entry based on the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/navigation_node_reference"><code>navigation_node_reference</code> section template</a>.
This section template in turn contains an <code>FS_REFERENCE</code> input component, which is used to reference the respective menu item.</p>
</div>
<div class="paragraph">
<p>In its <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/navigation_node_reference/ChannelSource_CaaS_CaaS.json">output channel</a>, the section template additionally contains the navigation function <code>fr_mainNav</code>.
Starting from the selected structure folder, this function generates the sub-navigation of the new menu item for this folder and the subfolders contained in it.
All these sub-navigations of the individual menu items are combined using the technical page template <a href="#rp_navigation_page"><code>navigations</code></a> and transferred to the <em>CaaS</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_navigation_page"><a class="anchor" href="#rp_navigation_page"></a>1.6.3. Page template</h4>
<div class="paragraph">
<p>In addition to the <a href="#rp_navigation_globalpage">global page</a> the reference project contains the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigations">technical page reference <code>navigations</code></a>.
This is used to transfer all navigation changes made <strong>in FirstSpirit</strong> to the <em>CaaS</em>.</p>
</div>
<div class="paragraph">
<p>Using the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/Scripts/get_navigation_gca_pages">script <code>get_navigation_gca_pages</code></a>, the page reference determines all global pages,
which are based on the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/technical/navigation_extension">page template <code>navigation_extension</code></a>.
The global pages represent the navigations in FirstSpirit that can be extended using the ContentCreator.
Within the reference project, this is the main navigation of the Spryker B2C Demo Shop.</p>
</div>
<div class="paragraph">
<p>Each of these global pages contains an <code>FS_CATALOG</code> input component,
which uses the section template <a href="#rp_navigation_section"><code>navigation_node_reference</code></a> to reference the start nodes of all menu items <strong>maintained in FirstSpirit</strong>.
The section template in turn generates a sub-navigation for each of these start nodes.
The technical page reference combines all these sub-navigations and creates a JSON document containing all navigations that are <strong>extendable in FirstSpirit</strong>.</p>
</div>
<div class="paragraph">
<p>For the release of the navigation changes made, the reference project provides the workflow <a href="#fs-nav-wf"><em>Release Navigation</em></a>, which requires the release right for its execution.
This workflow only performs the release, but not the publication of the corresponding global page.
At the same time, it triggers a script that ensures that the technical page reference is transferred to the <em>Preview CaaS</em>.
The publication of the adaptations and their transfer to the <em>Online CaaS</em> only takes place in the context of a <a href="#fs-deployment">full generation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="rp_navigation_twigtemplates"><a class="anchor" href="#rp_navigation_twigtemplates"></a>1.6.4. Twig templates</h4>
<div class="paragraph">
<p>In addition to the described FirstSpirit templates, the adaptation of the following Twig templates is required in Spryker,
to enable the extension of the main navigation of the Spryker B2C Demo Shop in the ContentCreator.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>navigation-header.twig</p>
</li>
<li>
<p>navigation-multilevel-node.twig</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The necessary adjustments are part of the <a href="#sp_navigation">installation</a> and are therefore not described here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Spryker, the Twig templates represent the main navigation.
They reference the menu items and control their display in the preview and in the live state.
The adaptations provide the main navigation with a button in the ContentCreator, which allows the addition of further menu items.</p>
</div>
<div class="paragraph">
<p>If other navigations should be editable in the ContentCreator, only an adjustment of the corresponding Twig templates is necessary.
The chapter <a href="#uc_navigation">navigation maintenance</a> explains the required steps for this.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rp_links"><a class="anchor" href="#rp_links"></a>1.7. Links</h3>
<div class="paragraph">
<p>The editorial contents maintained in FirstSpirit can contain the following references, which link them with other contents.
They are based on various link templates that are already included in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.</p>
</div>
<div class="paragraph">
<p>All link templates exist twice because they differ in the way they are integrated:
In contrast to the general references, the DOM references can only be used within DOM Editors - according to their name.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Category and product link</dt>
<dd>
<p>The <em>FirstSpirit Connect</em> module provides a report for products and categories in ContentCreator.
They serve to display the category and product information coming from Spryker, which can be used for links to category or product detail pages.</p>
<div class="paragraph">
<p>Therefore, the reference project contains the link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/category_link"><code>category_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/product_link"><code>product_link</code></a> as well as <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_category_link"><code>dom_category_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_product_link"><code>dom_product_link</code></a>, which correspond to a category or product link.
They enable category or product detail pages to be referenced and are equivalent to each other.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In contrast to a category, a referenced product is identified by its sku and not by the node ID.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Content page link</dt>
<dd>
<p>The link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/content_link"><code>content_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_content_link"><code>dom_content_link</code></a> contained in the reference project correspond to a content page link.
This allows referencing <a href="#rp_staticsite">static pages</a> and <a href="#rp_contentpage">dynamic content pages</a> maintained within the FirstSpirit project.
Within the reference project, the selection of the link target is therefore restricted to page references in the structure folder <code>content_pages</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For editors it is not obvious whether a link target is a dynamic content page or a static page.
However, since static pages do not have a URL by default, links to them would generally not be possible.
The <a href="#fs-projectsettings">project settings</a> therefore provide a way of assigning a URL to them.
The technical adjustments made in the reference project are described in the following <a href="#rp_staticcontentlinks">subchapter</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Magazine article link</dt>
<dd>
<p>The reference project contains the link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/magazine_article_link"><code>magazine_article_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_magazine_article_link"><code>dom_magazine_article_link</code></a>, which correspond to a magazine article link.
Like the content page link, it enables the referencing of editorial content maintained within the FirstSpirit project.
In contrast to this, the magazine article link refers to <a href="#rp_magazine">magazine articles</a> according to its name.</p>
</dd>
<dt class="hdlist1">External link</dt>
<dd>
<p>Just like the content page link and the magazine article link described above, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/external_link">external link</a> enables the referencing of editorial content.
However, in contrast to them it refers exclusively to external content.</p>
</dd>
<dt class="hdlist1">Search link</dt>
<dd>
<p>The reference project contains the link templates <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links/search_link"><code>search_link</code></a> and <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links/dom_search_link"><code>dom_search_link</code></a>, which correspond to a search link.
It enables the linking of a search result page to a defined search term.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All of the link templates for the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/dom_links">DOM references</a> contain in their output channel a call to the corresponding <a href="#sp_widgets">widget</a> which controls the Spryker-side output of the reference.
This way, the HTML for the reference is generated automatically.
A project-specific adaptation of the HTML is not possible.</p>
</div>
<div class="listingblock">
<div class="title">Widget call within the DOM category reference</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">{% widget 'FirstSpiritCategoryLinkWidget' args [$CMS_VALUE(lt_category.values[0].getNodeId)$, "$CMS_VALUE(lt_linkText.convert2)$"] only %}{% endwidget %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In contrast, the link templates for <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/LinkTemplates/links">general references</a> only contain the definition of two parameters.
They thus follow the same concept as the page and section templates.
In this way, only the URL of the reference is generated and the HTML is freely definable on the Spryker side.</p>
</div>
<div class="listingblock">
<div class="title">Parameter definition within the category reference</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">$CMS_SET(set_id)$
   $CMS_VALUE(lt_category.values[0].getNodeId)$
$CMS_END_SET$
$CMS_SET(void, set_link.put("id", set_id.toString()))$
$CMS_SET(void, set_link.put("type","category"))$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Processing the general references is controlled by the <code>link.twig</code> Twig template, which is part of the <a href="#sp_modules">FirstSpiritPreview module</a> and determines the corresponding URL based on the reference type.</p>
</div>
<div class="listingblock">
<div class="title">Twig template link.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-XML hljs" data-lang="XML">{% define data = {link: link} %}
{%- if data.link.type is defined -%}
   {%- set type = data.link.type -%}
   {%- if data.link.id is defined and data.link.id is not empty -%}
      {%- set id = data.link.id -%}
      {%- if  type == "cmspage" -%}
         {%- set url = getCmsPageUrl(id) -%}
      {%- elseif type == "category" -%}
         {%- set url = getCategoryPageUrl(id) -%}
      {%- elseif type == "product" -%}
         {%- set url = getProductPageUrl(id) -%}
      {%- endif -%}
   {%- else -%}
      {%- if type == "search" -%}
         {%- set url = path('search') ~ '?q=' ~ data.link.query -%}
      {%- elseif type == "external" -%}
         {%- set url = data.link.url -%}
      {%- elseif type == "static" -%}
         {%- set url = data.link.url -%}
      {%- endif -%}
   {%- endif -%}
{%- endif -%}

{%- if url is defined and url is not null -%}
   {{- url -}
}{%- endif -%}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Twig template is called in the individual components that represent the FirstSpirit sections in Spryker:</p>
</div>
<div class="listingblock">
<div class="title">Example call for the Twig template link.twig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP"> &lt;a href="{% include template('link', 'FirstSpiritPreview') with { link: data.fsBlockData.link } %}"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the Twig functions for determining the general references can also be called directly:</p>
</div>
<div class="listingblock">
<div class="title">calls of the Twig functions to determine the general references</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% set url = getCmsPageUrl(cms_page_id) %}
{% set url = getProductPageUrl(productId) %}
{% set url = getCategoryPageUrl(categoryId) %}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="rp_staticcontentlinks"><a class="anchor" href="#rp_staticcontentlinks"></a>1.7.1. Content page links to static pages</h4>
<div class="paragraph">
<p>When creating content page links, editors are not able to see any difference between static and dynamic pages.
However, since static pages do not have a URL by default, links to them would generally not be possible.
The <a href="#fs-projectsettings">project settings</a> therefore provide a way of assigning a URL to them.
For this purpose, the project settings contain the FS_CATALOG <code>ps_staticLinks</code>, which is filled via the <b class="button">Static Page Templates Import</b> button.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A future modification of the URLs defined in the project settings requires the execution of both the <a href="#fs-deployment">full generation</a> and the <a href="#fs-previewdeployment">preview generation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The button <b class="button">Static Page Templates Import</b> calls the executable <code>ProjectPropertiesStaticPageUrlListExecutable</code> which determines the content of the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/PageTemplates/static_pages">template folder <code>static_pages</code></a>.
For each template contained in this folder it adds an entry to the FS_CATALOG based on the technical <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/tree/master/reference-project-export/TemplateStore/SectionTemplates/technical_sections/static_page_url">section template <code>static_page_url</code></a>.
Every entry contains a reference to the respective template and a language-dependent field for the relative URL to be defined.</p>
</div>
<div class="paragraph">
<p>For creating the entries and referencing the templates automatically within these entries, the button has the following parameters,
which are predefined within the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>staticPageCatalog</strong>: This parameter defines the FS_CATALOG component in the project settings.</p>
</li>
<li>
<p><strong>staticPageUrlTemplateUid</strong>: This parameter specifies the reference name of the technical section template on which the entries in the FS_CATALOG are created.</p>
</li>
<li>
<p><strong>staticPageTemplateFolder</strong>: This parameter defines the reference name of the template folder that contains all templates for static pages.</p>
</li>
<li>
<p><strong>pageTemplateFsReference</strong>: The name of the FS_REFERENCE component from the technical section template is assigned to this parameter for referencing the static page templates automatically.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable content page links to static pages, the URLs defined in the project settings must be available in the link templates.
Therefore, the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/PageTemplates/technical/project_settings/ChannelSource_CaaS_CaaS.json">output channel</a> of the project settings contains the following code that stores the URL of a static page template in the variable <code>set_ps_staticLinks</code>.</p>
</div>
<div class="listingblock">
<div class="title">output channel of the project settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JAVA hljs" data-lang="JAVA">$CMS_SET(set_ps_staticLinks,{:})$
$CMS_FOR(for_staticLink,ps_staticLinks.filter(x-&gt;!x.item.st_pageTemplate.isEmpty))$
   $CMS_SET(void, set_ps_staticLinks
      .put(
         for_staticLink.item.st_pageTemplate.get.uid,
         for_staticLink.item.st_url.convert2
      )
   )$
$CMS_END_FOR$
$CMS_SET(set_ps_contentPageList,["contentpage"])$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the reference project the variable is queried in the <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/blob/master/reference-project-export/TemplateStore/LinkTemplates/links/content_link/ChannelSource_CaaS_CaaS.json">output channel</a> of the content page link.
This way editors do not have to distinguish between static and dynamic content pages when selecting a link target.</p>
</div>
<div class="listingblock">
<div class="title">Code snippet of the content page link</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JAVA hljs" data-lang="JAVA">$CMS_SET(set_pageUid,lt_pageRef.get().page.template.uid)$
$CMS_IF(set_pageUid == "contentpage")$
[...]
$CMS_ELSIF(!set_ps_staticLinks.isEmpty)$
   $CMS_IF(set_ps_staticLinks.containsKey(set_pageUid) &amp;&amp; !set_ps_staticLinks.get(set_pageUid).isEmpty)$
      $CMS_SET(void, set_link.put("url", set_ps_staticLinks.get(set_pageUid)))$
      $CMS_SET(void, set_link.put("type","static"))$
      [...]
   $CMS_END_IF$
   [...]
$CMS_END_IF$</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../../../../_/js/site.js"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
