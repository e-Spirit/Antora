<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spryker - Installation and configuration :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/EN/spryker-installation/spryker-installation.html">
    <meta name="description" content="Dieses Dokument enthält die Dokumentation für das {modulname}-Modul von {fs}.">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://e-spirit.github.io/Antora/cloud/1.0/index.html">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS/CaaS_FSM_Documentation_EN.html">CaaS</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Connect/CaaS_Connect_FSM_Documentation_EN.html">CaaS Connect</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Platform/CaaS_Platform_Documentation_EN.html">CaaS Platform</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_FSM/index.html">Navigation Service (FSM)</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_Platform/documentation.html">Navigation Service (Platform)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/FS_Connect_SAP_hl_Documentation_EN.html">Spartacus</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Salesforce/index.html">Salesforce</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/SAP_Classic/firstspiritconnect-sap-documentation_EN.html">SAP Classic</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Crownpeak</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/dxm/1.0/index.html">DXM</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ecom" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">E-Commerce</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Spryker</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="spryker-installation.html">Spryker - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fs-installation/fs-installation.html">FirstSpirit - Installation and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../use-cases/use-cases.html">Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../legal-notice.html">Legal Notice</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spartacus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../Spartacus/chapters/introduction.html">Main Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/sapcc-installation/sapcc-installation.html">Spartacus - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/fs-installation/fs-installation.html">FirstSpirit - Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/referenceproject/referenceproject.html">Reference Project</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../Spartacus/chapters/use-cases/use-cases.html">Use Cases</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../Spartacus/FS_Connect_SAP_hl_ServeradminManual_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../Salesforce/index.html">Salesforce</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SAP Classic</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../SAP_Classic/firstspiritconnect-sap-documentation_EN.html">Main Documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../SAP_Classic/firstspiritconnect-sap-admindoc_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">E-Commerce</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../dxm/1.0/index.html">DXM</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../dxm/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../cloud/1.0/index.html">FirstSpirit Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../cloud/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../../headless/1.0/index.html">Headless</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../../headless/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">E-Commerce</a></li>
    <li><a href="../../index.html">Spryker</a></li>
    <li><a href="spryker-installation.html">Spryker - Installation and Configuration</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/ecom/edit/main/modules/Spryker/pages/EN/spryker-installation/spryker-installation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Spryker - Installation and configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This is provided by the Spryker modules <code>firstspirit-preview</code> and <code>firstspirit-caas</code>, which require an installation and configuration in Spryker.
The <code>firstspirit-preview</code> module enables the storefront to be displayed in ContentCreator.
The contents are retrieved from the <em>CaaS</em> using the <code>firstspirit-caas</code> module.</p>
</div>
<div class="paragraph">
<p>The following chapters describe all steps required for installation and configuration as well as additional extensions in Spryker.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sp_modules"><a class="anchor" href="#sp_modules"></a>1. Spryker-Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both the retrieval of the <em>CaaS</em> contents by Spryker and their display and editing in ContentCreator is done using various Spryker modules.
These modules require an installation in Spryker and an extension of the configuration.
They also require various JavaScript and CSS files to be included in Spryker.</p>
</div>
<div class="paragraph">
<p>The following chapters describe how to perform the necessary steps.</p>
</div>
<div class="sect2">
<h3 id="sp_install_module"><a class="anchor" href="#sp_install_module"></a>1.1. Installation of the Spryker modules</h3>
<div class="paragraph">
<p>The maintenance of shop contents in ContentCreator requires the installation of several Spryker modules, which are included in the delivery in the form of zip files.
They have to be stored in any directory below the Spryker project directory, which must be announced to Composer as another repository.
This is done via the following command to be executed in the project directory, which extends the <code>composer.json</code> file of the Spryker server accordingly.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the composer.json file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">composer config repo.espirit artifact ./PATH-TO-DIRECTORY</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spryker modules to be installed use the namespace <code>ESpirit</code>, which must be announced to Spryker.
This requires an extension of the <code>KernelConstants</code> in the environment-independent file <code>config_default.php</code> in the directory <code><strong>config/Shared</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the KernelConstants</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">$config[KernelConstants::CORE_NAMESPACES] = [
   'SprykerShop',
   'SprykerEco',
   'Spryker',
   'Generated',
   'ESpirit'
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spryker modules are then installed using the following commands, which must also be executed in the Spryker project directory in the specified order.</p>
</div>
<div class="listingblock">
<div class="title">Installation commands</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">composer require e-spirit/firstspirit-caas
composer require e-spirit/firstspirit-preview
composer require e-spirit/firstspirit-preview-navigation
composer require e-spirit/firstspirit-data-state-writer
composer require e-spirit/firstspirit-data-cleanup
composer require e-spirit/firstspirit-data-import
composer require e-spirit/firstspirit-data-inconsistency-check
composer require e-spirit/firstspirit-data-rest-api
composer require e-spirit/firstspirit-cms-data-connector
composer require e-spirit/firstspirit-cms-data-storage</code></pre>
</div>
</div>
<div class="paragraph">
<p>The commands load the modules from the created repository and install them automatically.</p>
</div>
<div class="paragraph">
<p>The last step of the installation corresponds to the generation of the transfer objects of the Data Import module and the creation of the database schema contained in the CMS Block Data Connector module:</p>
</div>
<div class="listingblock">
<div class="title">Generation of the transfer objects and creation of the database schema</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">vendor/bin/console transfer:generate
vendor/bin/console propel:install</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sp_twigtemplates"><a class="anchor" href="#sp_twigtemplates"></a>1.2. Twig Templates</h3>
<div class="paragraph">
<p>The <em>FirstSpirit Connect</em> module provides different ways to access shop content from Spryker and use it in FirstSpirit.
These possibilities are described in the following of this documentation on the basis of the supplied reference project in the form of <a href="#usecases">use cases</a>.</p>
</div>
<div class="paragraph">
<p>If the <a href="#ref-project">sections and page templates</a> contained in the reference project should be used, this requires different Twig templates in Spryker.</p>
</div>
<div class="paragraph">
<p>The sections correspond to different Spryker molecules, atoms and organisms, which are summarized in the folder <code><strong>FirstSpiritReferenceComponents</strong></code>.
This is part of the delivery and is provided in the form of another Spryker module, which is to be installed using the following command:</p>
</div>
<div class="listingblock">
<div class="title">Installation command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">composer require e-spirit/firstspirit-reference-components</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to make the components provided with the module usable in Spryker, the corresponding path must be specified in Spryker.
This is done by adapting the files <code>settings.js</code> and <code>tsconfig.json</code>.</p>
</div>
<div class="paragraph">
<p>Within the <code>settings.js</code> file in the directory <code><strong>Spryker-directory/frontend</strong></code> an extension of the context is necessary:</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the settings.js file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">[...]

dirs: [
   join(globalSettings.context, paths.core),
   join(globalSettings.context, './vendor/e-spirit'),
   join(globalSettings.context, paths.eco),
   join(globalSettings.context, paths.project)
],</code></pre>
</div>
</div>
<div class="paragraph">
<p>An additional include must be added to the <code>tsconfig.json</code> file in the <code><strong>Spryker directory</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the tsconfig.json file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">[...]

"include": [
   "./vendor/spryker-shop/**/*",
   "./vendor/spryker-eco/**/*",
   "./src/Pyz/Yves/**/*",
   "./vendor/e-spirit/**/*"
],</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic Twig template <code>fs_molecule_block.twig</code> controls the output of the supplied molecules.
It is a part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery and must be stored under the path <code><strong>src/Pyz/Shared/CmsBlock/Theme/default/template</strong></code> in Spryker.</p>
</div>
<div class="paragraph">
<p>The integration of the Twig templates in Spryker takes place via the following command, which finally is to be executed in the Spryker project directory.</p>
</div>
<div class="listingblock">
<div class="title">Integration of the Twig templates</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">npm run yves</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FirstSpirit templates allow the extension of existing <a href="#rp_staticsite">static pages</a>, <a href="#rp_productpages">product</a>, and <a href="#rp_categorypages">category pages</a> and the creation of <a href="#rp_contentpage">dynamic content pages</a> or a <a href="#rp_magazine">magazine</a>.
Therefore, the reference project contains the page templates <code>homepage</code>, <code>productpage</code>, <code>categorypage</code>, <code>contentpage</code>, and <code>magazine_detail_page</code>.
In addition, the following Twig templates are required in Spryker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#rp_twigtemplates"><code>home.twig</code></a></p>
</li>
<li>
<p><a href="#rp_pdp_twigtemp"><code>pdp.twig</code></a></p>
</li>
<li>
<p><a href="#rp_pdp_twigtemp"><code>product-cms-block.twig</code></a></p>
</li>
<li>
<p><a href="#rp_cp_twigtemp"><code>page-layout-catalog.twig</code></a></p>
</li>
<li>
<p><a href="#rp_cp_twigtemp"><code>catalog-with-cms-slot.twig</code></a></p>
</li>
<li>
<p><a href="#rp_dcp_twigtemp"><code>fs-content-page.twig</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code>, which can be found under the path <code><strong>src/Pyz/Yves/HomePage/Theme/default/views/home</strong></code>, needs some changes.
These are explained in the description of the <a href="#rp_twigtemplates">static pages</a>.
The same applies to the Twig templates <code>pdp.twig</code>, <code>page-layout-catalog.twig</code> and <code>catalog-with-cms-slot.twig</code> which are necessary to edit <a href="#rp_pdp_twigtemp">product</a> and <a href="#rp_cp_twigtemp">category pages</a>.</p>
</div>
<div class="paragraph">
<p>They are available in Spryker under the following paths:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>src/Pyz/Yves/ProductDetailPage/Theme/default/views/pdp</strong></code></p>
</li>
<li>
<p><code><strong>src/Pyz/Yves/CatalogPage/Theme/default/templates/page-layout-catalog</strong></code></p>
</li>
<li>
<p><code><strong>src/Pyz/Yves/CatalogPage/Theme/default/views/catalog-with-cms-slot</strong></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remaining Twig templates are part of the zip file included in the delivery and have to be stored under the following paths:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Product pages: <code><strong>src/Pyz/Yves/CmsBlockWidget/Theme/default/components/molecules/product-cms-block</strong></code></p>
</li>
<li>
<p>Dynamic Content Pages: <code><strong>src/Pyz/Shared/Cms/Theme/default/templates/fs-content-page</strong></code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sp_slotimport"><a class="anchor" href="#sp_slotimport"></a>1.3. Slots import</h3>
<div class="paragraph">
<p>In both Spryker and FirstSpirit, pages are based on a structure of different components.
In Spryker, these include the CMS slots, which are represented in FirstSpirit by the content areas of a page template.
The slots bind CMS blocks, each of which corresponds to a FirstSpirit section.</p>
</div>
<div class="paragraph">
<p>The Twig template <code>home.twig</code> represents a <a href="#rp_staticsite">static page</a> on the Spryker side and is mapped by the page template <code>homepage</code> in the provided <a href="https://github.com/e-Spirit/ecom-spryker-reference-project/">reference project</a>.
It contains the content areas <code>fs_slt_2</code> and <code>fs_slt_3</code>, for which the corresponding slots must exist in Spryker.</p>
</div>
<div class="paragraph">
<p>The slots are imported using the file <code>cms_slot.csv</code>, which is stored in Spryker in the directory <code><strong>/data/import/common/common</strong></code>.
It must be replaced by the file of the same name from the delivery, which additionally contains the following two lines:</p>
</div>
<div class="listingblock">
<div class="title">Import file cms_slot.csv</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-SPRYKER hljs" data-lang="SPRYKER">template_path,slot_key,content_provider,name,description,is_active
[...]
@HomePage/views/home/home.twig,fs-slt-2,FirstSpiritCmsSlotBlock,Banner,Banner content section for the homepage.,1
@HomePage/views/home/home.twig,fs-slt-3,FirstSpiritCmsSlotBlock,Homepage Content,Homepage main content section.,1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, the new slots are taken over via the following command, which has to be executed in the Spryker project directory.</p>
</div>
<div class="listingblock">
<div class="title">Import command</div>
<div class="content">
<pre>vendor/bin/console data:import cms-slot</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sp_configuration"><a class="anchor" href="#sp_configuration"></a>1.4. Extension of the configuration</h3>
<div class="paragraph">
<p>In FirstSpirit, the creation and editing of editorial content takes place in ContentCreator.
The storefront is embedded in it using the <em>Omnichannel Manager</em>.</p>
</div>
<div class="paragraph">
<p>To enable the display of the shop contents from Spryker in ContentCreator, an extension of the environment-specific configuration is necessary.
To do this, a token must be defined in the <a href="https://documentation.spryker.com/docs/configuration-management">file <code>config_default-[environment].php</code></a> in the directory <code><strong>config/Shared</strong></code> as well as the host and port of the FirstSpirit start page.
Furthermore, the operation of <em>CaaS</em> requires the specification of some parameters.
These parameters are necessary both for production operation and for the use of the <em>CaaS</em> in the preview.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">// ----------- FirstSpirit Preview Configurations
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_AUTHENTICATION_INIT_TOKEN] = '&lt;ADD TOKEN&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_WEB_HOST] = '&lt;ADD FS PREVIEW HOST&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_CAAS_CONTENT_PAGE_COLLECTION] = '&lt;CAAS COLLECTION&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_CAAS_CATEGORY_PAGE_COLLECTION] = '&lt;CAAS COLLECTION&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_CAAS_PRODUCT_PAGE_COLLECTION] = '&lt;CAAS COLLECTION&gt;';
$config[FirstSpiritPreviewConstants::FIRSTSPIRIT_PREVIEW_DISPLAY_BLOCK_RENDER_ERRORS] = true;

// ----------- FirstSpirit Data Import Configurations
$config[FirstSpiritDataImportConstants::FIRSTSPIRIT_DATA_IMPORT_BLOCK_DATA_CAAS_PATH] = '/_aggrs/blocks';
$config[FirstSpiritDataImportConstants::FIRSTSPIRIT_CAAS_REQUEST_PAGESIZE] = &lt;VALUE&gt;;

// ----------- FirstSpirit CaaS Configurations
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_HOSTNAME_PREVIEW] = '&lt;ADD CAAS HOST&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_PORT_PREVIEW] = '&lt;ADD CAAS PORT&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_SCHEME_PREVIEW] = '&lt;ADD CAAS SCHEME&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_APIKEY_PREVIEW] = '&lt;ADD APIKEY&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_DATABASE_PREVIEW] = '&lt;ADD CAAS DATABASE&gt;';

$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_HOSTNAME_ONLINE] = '&lt;ADD CAAS HOST&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_PORT_ONLINE] = '&lt;ADD CAAS PORT&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_SCHEME_ONLINE] = '&lt;ADD CAAS SCHEME&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_APIKEY_ONLINE] = '&lt;ADD APIKEY&gt;';
$config[FirstSpiritCaaSConstants::FIRSTSPIRIT_CAAS_DATABASE_ONLINE] = '&lt;ADD CAAS DATABASE&gt;';</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">FirstSpirit Preview Configurations</dt>
<dd>
<p>The token is used for authentication and must be specified in the ContentCreator settings as a query parameter of the <a href="#fs_previewurl">external preview URL</a> during the configuration in FirstSpirit.
It can be defined arbitrarily.</p>
<div class="paragraph">
<p>Specifying the fully qualified host of the FirstSpirit home page (e.g. <code>http://localhost:8000</code>) is a requirement of the <a href="#sp_plugin">HeadersSecurityExtensionPlugins</a> to be installed.
It uses the information to enable previewing in ContentCreator.</p>
</div>
<div class="paragraph">
<p>The mentions of the <em>CaaS</em> collections for content, category and product pages enable access to the editorial content stored in the <em>Preview CaaS</em> and its display in the ContentCreator.</p>
</div>
<div class="paragraph">
<p>The error parameter enables the display of error outputs in the page.
Using the value <code>true</code> therefore only makes sense for Dev and QA instances.</p>
</div>
</dd>
<dt class="hdlist1">FirstSpirit Data Import Configurations</dt>
<dd>
<p>The path is used to query and persist the block data stored in the <em>Online CaaS</em>.
It is required by the <a href="#sp-importcommand"><code>FsDataImportConsole</code> command</a>, which triggers the importer in the context of a <a href="#fs-deployment">FirstSpirit deployment</a>.</p>
<div class="paragraph">
<p>With the help of the pagesize the number of documents that the <em>CaaS</em> returns on a request can be defined.
The parameter is optional and may have a value from <code>1</code> to <code>100</code>.
By default, the maximum value of <code>100</code> is defined for it.</p>
</div>
</dd>
<dt class="hdlist1">FirstSpirit CaaS Configurations</dt>
<dd>
<p>The <em>CaaS</em> host, port, and scheme to use (<code>http</code> or <code>https</code>) allow Spryker to connect to the <em>CaaS</em>.
Access to the data stored in it requires a valid API Key that needs read access to the corresponding project.
The name of the project stored in <em>CaaS</em> must be specified in the configuration file as the value of the database parameter.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on using the <em>CaaS</em>, see the <em><a href="https://docs.e-spirit.com/module/caas/CaaS_FSM_Documentation_EN.html">Content as a Service Documentation</a></em>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To ensure that the used classes <code>FirstSpiritPreviewConstants</code>, <code>FirstSpiritDataImportConstants</code> and <code>FirstSpiritCaaSConstants</code> can be found, they have to be included in the configuration file via use statements:</p>
</div>
<div class="listingblock">
<div class="title">Integration of the classes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Shared\FirstSpiritPreview\FirstSpiritPreviewConstants;
use ESpirit\Shared\FirstSpiritDataImport\FirstSpiritDataImportConstants;
use ESpirit\Shared\FirstSpiritCaaS\FirstSpiritCaaSConstants;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sp_basetemp"><a class="anchor" href="#sp_basetemp"></a>1.5. Extension of the basic template</h3>
<div class="paragraph">
<p>The <em>Omnichannel Manager</em> enables the display and editing of external content in ContentCreator, for which it requires some preview-specific data attributes.
In Spryker, it also requires a preview-specific JavaScript file, which is included by the FirstSpiritPreview module.</p>
</div>
<div class="paragraph">
<p>The JavaScript file must be added to the Twig template, which is responsible for the basic layout of all shop pages.
By default this is the <code>page-blank.twig</code> template, which is stored under the path <code><strong>src/Pyz/Yves/ShopUi/Theme/default/templates/page-blank</strong></code>.
In the same template, the data attributes must also be determined by the Twig function <code>fsIncludeDataAttributes</code>.</p>
</div>
<div class="paragraph">
<p>The Twig template is adapted by calling the Twig functions <code>fsIncludeDataAttributes</code> and <code>fsIncludeOcmScript</code> and by extending the template data.
The Twig function <code>fsIncludeOcmScript</code> can be passed the URL to a local copy of the JavaScript file as an optional parameter.
By default, it retrieves the file from the <a href="https://unpkg.com/fs-spryker-content-editing">CDN</a>.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the Twig template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% block template %}
   {% set isNewFrontendBuildSupported = true %}
   &lt;body [...] {{ fsIncludeDataAttributes() }}&gt;
   {{ parent() }}
{% endblock %}

{% block footerScripts %}
   {% include molecule('check-touch') only %}
   {{ fsIncludeOcmScript() }}
   {{ parent() }}
{% endblock %}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sp_plugin"><a class="anchor" href="#sp_plugin"></a>2. Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the installation of the <a href="#sp_modules">Spryker modules</a>, the following plugins must be included:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HeadersSecurityExtensionPlugin</code></p>
</li>
<li>
<p><code>FsTwigExtensionPlugin</code></p>
</li>
<li>
<p><code>FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</code></p>
</li>
<li>
<p><code>FirstSpiritDataImportsResourceRoutePlugin</code></p>
</li>
<li>
<p><code>FirstSpiritDataCleanupsResourceRoutePlugin</code></p>
</li>
<li>
<p><code>FirstSpiritCmsPagesResourceRoutePlugin</code></p>
</li>
</ul>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">HeadersSecurityExtensionPlugin and FsTwigExtensionPlugin</dt>
<dd>
<p>The <code>HeadersSecurityExtensionPlugin</code> uses the <a href="#sp_configuration">hosts of the FirstSpirit home page</a> defined in the <a href="https://documentation.spryker.com/docs/configuration-management">configuration file <code>config_default-[environment].php</code></a> to enable the storefront to be displayed in ContentCreator.
Therefore, it checks if storefront queries contain the <a href="#sp_configuration">Token</a> also defined in the configuration file or if a logged in user exists.
If one of the two options applies, the plugin sets the Content Security Policy Header and extends the Cookie header.</p>
<div class="paragraph">
<p>The <code>FsTwigExtensionPlugin</code> enables the maintenance of CMS placeholders and CMS blocks in FirstSpirit.
Therefore, it accesses information provided by the <a href="#sp_controller">CmsController</a> to be installed.
The information is needed for mapping between the data stored in FirstSpirit and in Spryker.</p>
</div>
<div class="paragraph">
<p>The integration of both plugins is done with the following code, which has to be added to the <code>ShopApplicationDependencyProvider</code> in the directory
<code><strong>src/Pyz/Yves/ShopApplication</strong></code>.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the ShopApplicationDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Yves\FirstSpiritPreview\Plugin\HeadersSecurityExtensionPlugin;
use ESpirit\Yves\FirstSpiritPreview\Plugin\FsTwigExtensionPlugin;

[...]

protected function getApplicationPlugins(): array
{
   return [
      new HeadersSecurityExtensionPlugin(),
      new FsTwigExtensionPlugin()
   ];
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</dt>
<dd>
<p>The <code>FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin</code> enables the output of all blocks contained in a slot.
In contrast to the <code>CmsSlotBlockWidget</code> included in Spryker, which is limited to the output of the Spryker data, the plugin only considers the information from the <em>CaaS</em>.
The inclusion of the plugin requires an extension of the <code>ShopCmsSlotDependencyProvider</code> in the <code><strong>src/Pyz/Yves/ShopCmsSlot</strong></code> directory.</p>
<div class="listingblock">
<div class="title">Extension of the ShopCmsSlotDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php

namespace Pyz\Yves\ShopCmsSlot;

use ESpirit\Yves\FirstSpiritPreviewSlotBlockWidget\FirstSpiritPreviewSlotBlockWidgetConfig;
use ESpirit\Yves\FirstSpiritPreviewSlotBlockWidget\Plugin\FirstSpiritPreviewSlotBlockWidget\
   FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin;
[...]

class ShopCmsSlotDependencyProvider extends SprykerShopShopCmsSlotDependencyProvider
{
   protected function getCmsSlotContentPlugins(): array
   {
      return [
         CmsSlotBlockConfig::CMS_SLOT_CONTENT_PROVIDER_TYPE
            =&gt; new CmsSlotBlockWidgetCmsSlotContentPlugin(),
         FirstSpiritPreviewSlotBlockWidgetConfig::FS_CMS_SLOT_CONTENT_PROVIDER_TYPE
            =&gt; new FirstSpiritPreviewSlotBlockWidgetCmsSlotContentPlugin(),
      ];
   }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">FirstSpiritDataImportsResourceRoutePlugin and FirstSpiritDataCleanupsResourceRoutePlugin</dt>
<dd>
<p>The <code>FirstSpiritDataImportsResourceRoutePlugin</code> and <code>FirstSpiritDataCleanupsResourceRoutePlugin</code> each provide an API endpoint.
This endpoint allows the <a href="#fs-deployment">FirstSpirit deployment</a> to address the importer.</p>
<div class="paragraph">
<p>The <code>FirstSpiritDataImportsResourceRoutePlugin</code> controls the transfer of editorial content from the <em>Online CaaS</em> to Spryker and its persistence there.
In contrast, the <code>FirstSpiritDataCleanupsResourceRoutePlugin</code> is used to find and delete obsolete data in Spryker.</p>
</div>
<div class="paragraph">
<p>Both plugins and the following <code>FirstSpiritCmsPagesResourceRoutePlugin</code> must be added to the <code>GlueApplicationDependencyProvider</code>.</p>
</div>
</dd>
<dt class="hdlist1">FirstSpiritCmsPagesResourceRoutePlugin</dt>
<dd>
<p>If a new page is created within the ContentCreator, the creation of a CMS page in Spryker is required in parallel.
Because the ContentCreator displays the storefront, the newly created page would otherwise not be visible in the preview.
Instead, it would already be available in the live state if it were created in Spryker with a deployment.</p>
<div class="paragraph">
<p>The <code>FirstSpiritCmsPagesResourceRoutePlugin</code> is used to create the new page.
This plugin and the other two ResourceRoutePlugins described above must be added to the <code>GlueApplicationDependencyProvider</code> in the <code><strong>src/Pyz/Glue/GlueApplication</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the GlueApplicationDependencyProviders</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Glue\FirstSpiritDataRestApi\Plugin\FirstSpiritDataImportsResourceRoutePlugin;
use ESpirit\Glue\FirstSpiritDataRestApi\Plugin\FirstSpiritDataCleanupsResourceRoutePlugin;
use ESpirit\Glue\FirstSpiritDataRestApi\Plugin\FirstSpiritCmsPagesResourceRoutePlugin;

[...]

protected function getResourceRoutePlugins(): array
{
   return [
      new FirstSpiritDataImportsResourceRoutePlugin(),
      new FirstSpiritDataCleanupsResourceRoutePlugin(),
      new FirstSpiritCmsPagesResourceRoutePlugin()
      [...]
   ];
}</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sp_widgets"><a class="anchor" href="#sp_widgets"></a>3. Widgets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the <a href="#sp_modules">Spryker modules</a> and the <a href="#sp_plugin">plugins</a> the delivery contains the following widgets.
They enable the expandability of the <a href="#rp_navigation">navigations</a> contained in the shop, as well as the usage of the <a href="#rp_links">DOM references</a> and the <a href="#sp_twigtemplates">Shoppable Image</a> contained in the reference project.
Only if these elements are used a registration of the widgets is required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FirstSpiritPreviewContentNavigationWidget</code></p>
</li>
<li>
<p><code>FirstSpiritCategoryLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritProductLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritContentLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritExternalLinkWidget</code></p>
</li>
<li>
<p><code>FirstSpiritProductFlyoutWidget</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritPreviewContentNavigationWidget</strong></span><br>
The <code>FirstSpiritPreviewContentNavigationWidget</code> creates the possibility to maintain the navigations contained in the store with FirstSpirit and to add further menu items.
It replaces the existing <code>ContentNavigationWidget</code> in Spryker and provides various attributes required for displaying the corresponding navigation in the preview.
Therefore the existing <code><strong>ContentNavigationWidget</strong></code>, which is stored under the path <code><strong>/src/Pyz/Yves</strong></code> in Spryker, has to be replaced by the <code><strong>FirstSpiritPreviewContentNavigationWidget</strong></code> included in the delivery.
Finally, the use of the <code>FirstSpiritPreviewContentNavigationWidget</code> requires a registration.
This is done by modifying the <code>TwigDependencyProvider</code> in the directory <code><strong>/src/Pyz/Yves/Twig/</strong></code>,
in which the <code>ContentNavigationTwigPlugin</code> has to be replaced by the <code>FirstSpiritPreviewNavigationWidgetTwigPlugin</code>.</p>
</div>
<div class="listingblock">
<div class="title">Adaptation of the TwigDependencyProviders</div>
<div class="content">
<pre>&lt;?php

namespace Pyz\Yves\Twig;

use ESpirit\Yves\FirstSpiritPreviewNavigationWidget\Plugin\Twig\FirstSpiritPreviewNavigationWidgetTwigPlugin;
[...]

class TwigDependencyProvider extends SprykerTwigDependencyProvider
{
   [...]

   protected function getTwigPlugins(): array
   {
      return [
         [...]
         new FirstSpiritPreviewNavigationWidgetTwigPlugin(),
      ];
   }

   [...]
}</pre>
</div>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritCategoryLinkWidget und FirstSpiritProductLinkWidget</strong></span><br>
The <code>FirstSpiritCategoryLinkWidget</code> and the <code>FirstSpiritProductLinkWidget</code> are used to display editorial DOM links to category or product detail pages.
In both cases, the widget determines the corresponding category or product using a unique identifier and passes the result to the Twig template that controls the display of the respective link in Spryker.
Each of the two widgets references its corresponding Twig template.
The Twig templates are provided by the previously installed FirstSpiritPreview module.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritContentLinkWidget und FirstSpiritExternalLinkWidget</strong></span><br>
The <code>FirstSpiritContentLinkWidget</code> and the <code>FirstSpiritExternalLinkWidget</code> enable DOM links to editorial content, whereby the type of content differs in each case.
The <code>FirstSpiritExternalLinkWidget</code> only allows the referencing of external content.
In contrast, the <code>FirstSpiritContentLinkWidget</code> is used to display internal DOM links to <a href="#rp_contentpage">dynamic content pages</a> or <a href="#rp_magazine">magazine articles</a> maintained within the FirstSpirit project.
An important aspect is that the target URL of the internal links to dynamic content pages depends on the output:
While the link in the live state refers to the published CMS page, the corresponding preview URL must be used in the preview.
In both cases, the widget controls the determination of the required URL.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>FirstSpiritProductFlyoutWidgets</strong></span><br>
The registration of the <code>FirstSpiritProductFlyoutWidget</code> is only required if the Shoppable Image provided with the delivery is used in the project.
The widget controls the display of flyouts for the products linked to the Shoppable Image.</p>
</div>
<div class="paragraph">
<p><span class="underline"><strong>Registration</strong></span><br>
The four link widgets and the flyout widget are registered using the following code, which must be added to the <code>ShopApplicationDependencyProvider</code> in the folder <code><strong>src/Pyz/Yves/ShopApplication</strong></code>.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the ShopApplicationDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritCategoryLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritProductLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritContentLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritExternalLinkWidget;
use ESpirit\Yves\FirstSpiritPreview\Widget\FirstSpiritProductFlyoutWidget;

[...]

protected function getGlobalWidgets(): array
{
   return [
      [...]
      FirstSpiritCategoryLinkWidget::class,
      FirstSpiritProductLinkWidget::class,
      FirstSpiritContentLinkWidget::class,
      FirstSpiritExternalLinkWidget::class,
      FirstSpiritProductFlyoutWidget::class
   ];
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sp_controller"><a class="anchor" href="#sp_controller"></a>4. Controllers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previously installed <a href="#sp_plugin"><code>CmsBlockTwigFunctionPlugin</code></a> allows mapping between the content stored in FirstSpirit and in Spryker.
For this, it assumes that the view data of a page contains its ID and type.
The controllers of Spryker do not provide this information by default.
For this reason, the following controllers must be overwritten both for <a href="#rp_contentpage">content</a> and <a href="#rp_categorypages">category pages</a> and in the case of the homepage, which corresponds to a <a href="#rp_staticsite">static page</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IndexController</p>
</li>
<li>
<p>CatalogController</p>
</li>
<li>
<p>CmsController</p>
</li>
<li>
<p>PreviewController</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The overwriting is done by creating the corresponding classes, which are all part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery.
They must be copied into the directory <code><strong>Controller</strong></code> to be created below <code><strong>src/Pyz/Yves/HomePage|CatalogPage|CmsPage</strong></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the classes already exist under the path specified for them, the controllers are already overwritten project-specifically.
In this case, it need to be ensured that the view parameters are extended accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In contrast to the other pages, the <a href="#rp_productpages">product pages</a> require the adaptation of the ProductController which already exists in Spryker.
It is contained in the directory <code><strong>src/Pyz/Yves/ProductDetailPage/Controller/ProductController</strong></code> and must be extended by the definition of the page type and the Product SKU.
The following code snippet shows the changes to be made:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the ProductController</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php
namespace Pyz\Yves\ProductDetailPage\Controller;

[...]
use ESpirit\Shared\FirstSpiritPreview\FirstSpiritPreviewConstants;

class ProductController extends SprykerShopProductController
{
   protected function executeDetailAction(array $productData, Request $request): array
   {
      [...]

       $viewData['cart'] = $quoteTransfer;
       $viewData[FirstSpiritPreviewConstants::VIEW_DATA_PAGE_TYPE_KEY] = FirstSpiritPreviewConstants::PRODUCT_PAGE_TYPE;
       $viewData[FirstSpiritPreviewConstants::VIEW_DATA_PAGE_ID_KEY] = $productData['sku'];

       return $viewData;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the controllers mentioned above, the delivery includes further render controllers which enable individual CMS elements to be updated in the preview.
They are addressed by the <code>FirstSpiritPreviewRoutePlugin</code> which initially does not exist in Spryker and therefore requires registration in the <code>RouterDependencyProvider</code> file in the <code><strong>Pyz/Yves/Router</strong></code> directory.
Within the file, the method <code>getRouteProvider</code> has to be extended as follows.</p>
</div>
<div class="listingblock">
<div class="title">Extension of the method getRouteProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Yves\FirstSpiritPreview\Plugin\Route\FirstSpiritPreviewRoutePlugin;

[...]
protected function getRouteProvider(): array
{
   return [
      [...]
      new FirstSpiritPreviewRoutePlugin()
   ];
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sp_navigation"><a class="anchor" href="#sp_navigation"></a>5. Main navigation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the Spryker B2C Demo Shop contains different navigations, which can be created and edited in Spryker.
The integration realised with the <em>FirstSpirit Connect</em> module offers the possibility to maintain these navigations with FirstSpirit and to add further menu items.</p>
</div>
<div class="paragraph">
<p>Within the reference project the functionality is implemented exemplarily for the main navigation.
Its usage requires the already described <a href="#sp_widgets">referencing of the <code>FirstSpiritPreviewContentNavigationWidgets</code></a>, the creation of a placeholder, and the addition of a preview ID.</p>
</div>
<div class="paragraph">
<p>The placeholder to be created corresponds to another menu item.
This is required to display the navigation in the preview and must be added to the <code>navigation-header.twig</code> file
in the <code><strong>src/Pyz/Yves/ShopUi/Theme/default/components/molecules/navigation-header</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Adjustment of the navigation-header.twig file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">[..]
&lt;ul class="menu {{ menuClass }} grid grid--center grid--no-wrap"&gt;
   {% for node in data.nodes %}
      [..]
   {% endfor %}

   {% if isFsPreview() %}
      &lt;li class="fs-navigation-extension"
         style="padding-left: 1rem; transform: translate(0,15% );"&gt;
      &lt;/li&gt;
   {% endif %}
&lt;/ul&gt;
[..]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, a preview ID is required to display the main navigation in the preview.
This preview ID is to be defined in the <code>navigation-multilevel-node.twig</code> file in the directory <code><strong>src/Pyz/Yves/ShopUi/Theme/default/components/molecules/navigation-multilevel-node</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">Adjustment of the navigation-multilevel-node.twig file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">{% block attributes %}
   {% if isFsPreview() and data.node.previewId is defined and data.node.previewId is not empty %}
      data-preview-id="{{ data.node.previewId }}" style="min-height: unset;"
   {% endif %}
{% endblock %}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After the changes have been made, it may be necessary to empty the cache for the twig templates and to rebuild the frontend.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_container"><a class="anchor" href="#_query_container"></a>6. Query Container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previously installed &lt;sp_install_module,Cms Block Data Connector module&gt;&gt; creates a Zed table.
During the import, the editorial contents determined from the <em>Online CaaS</em> are stored in this table.
The CMS blocks are persisted in another table.</p>
</div>
<div class="paragraph">
<p>Since the CMS blocks do not contain placeholders, they are not published by Spryker by default.
For this reason, it is necessary to overwrite the <code>CmsBlockStorageQueryContainer</code> and thus adapt the standard behavior of Spryker for publishing CMS blocks.
The query container is overwritten by creating the class <code>CmsBlockStorageQueryContainer.php</code>.
It is part of the zip file <code>b2c-demo-shop-extensions-&lt;VERSION&gt;.zip</code> included in the delivery and must be copied into the directory <code><strong>src/Pyz/Zed/CmsBlockStorage/Persistence</strong></code> to be created.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sp_customer"><a class="anchor" href="#sp_customer"></a>7. Technical user</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The integration realized with the <em>FirstSpirit Connect</em> module only allows FirstSpirit to create and maintain editorial content and to publish it in the form of JSON objects.
The integration of these contents and the creation of the preview, however, still takes place in Spryker.</p>
</div>
<div class="paragraph">
<p>In the preview case, FirstSpirit determines the current view of a page in the storefront and displays it in ContentCreator using the <em>Omnichannel Manager</em>.
To integrate the editorial content into the shop, Spryker imports it from the <em>Online CaaS</em> and persists it in its internal data system.</p>
</div>
<div class="paragraph">
<p>As both the preview and the import process are protected by authentication, a technical user must be specified in the <a href="#fs_pcomp">project component of the <em>FirstSpirit Connect</em> module</a>.
This corresponds to a customer, who in turn is assigned to a Zed user.
The assignment can be done in the menu <code><strong><span class="menuseq"><b class="menu">Users Control</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">User</b></span></strong></code> via the button <b class="button">Assign Customers</b>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a more detailed description of the steps required for the assignment, see the chapters
<a href="https://documentation.spryker.com/docs/managing-users#assigning-customers-to-users">Assigning Customers</a> and
<a href="https://documentation.spryker.com/v2/docs/managing-cms-pages#previewing-cms-pages">Previewing a Page</a> of the <em>Spryker documentation</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sp-importcommand"><a class="anchor" href="#sp-importcommand"></a>8. Import command</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The integration of the contents created or maintained in FirstSpirit into the Shop takes place through Spryker.
Therefore, Spryker imports the data from the <em>Online CaaS</em> and persists them in its data system.
The transfer of the information must take place with each <a href="#fs-deployment">FirstSpirit deployment</a>, which for this reason each time triggers a Spryker sided import command.</p>
</div>
<div class="paragraph">
<p>The command instructs the importer to import the block data stored in the <em>Online CaaS</em>.
To do this, it uses the <a href="#sp_configuration"><code>FirstSpirit Data Import Block CaaS Path</code></a> stored in the <a href="https://documentation.spryker.com/docs/configuration-management">configuration file <code>config_default-[environment].php</code></a>.
Using this path, the importer accesses the <em>CaaS</em> aggregation that is created by the <a href="#fs-deployment">FirstSpirit deployment</a>.</p>
</div>
<div class="paragraph">
<p>The import command must be registered in Spryker in the <code>getConsoleCommands</code>.
This requires the following extension to the <code>ConsoleDependencyProvider.php</code> file in the <code><strong>src/Pyz/Zed/Console</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">Extension of the getConsoleCommands</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Spryker hljs" data-lang="Spryker">use ESpirit\Zed\FirstSpiritDataImport\Communication\Console\FsDataImportConsole;

[...]

$commands = [
   // Default commands
   [...]

   // FirstSpirit Data importers
   new FsDataImportConsole(FsDataImportConsole::DEFAULT_NAME)
];</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_synchronization"><a class="anchor" href="#_synchronization"></a>9. Synchronization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During deployment, the content maintained in FirstSpirit is retrieved from the <em>Online CaaS</em> using the importer.
It transfers the data to Spryker and persists them in the backend in its data system.
The display of the data in the live state additionally requires its transmission to Yves.
The transmission of the data requires the registration of an event subscriber, several queues and a message processor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="NOTE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See the <a href="https://documentation.spryker.com/docs/publish-and-synchronization">Publish and Synchronization</a> chapter of the <em>Spryker documentation</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The registration of the EventSubscriber is done with the following code to be added to the <code>EventDependencyProvider</code> in the directory <code><strong>Pyz/Zed/Event</strong></code>.</p>
</div>
<div class="listingblock">
<div class="title">EventDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">use ESpirit\Zed\FirstSpiritCmsDataStorage\Communication\Plugin\Event\Subscriber\FirstSpiritCmsDataStorageEventSubscriber;

[...]

class EventDependencyProvider extends SprykerEventDependencyProvider
{
   [...]

   public function getEventSubscriberCollection()
   {
      $eventSubscriberCollection = parent::getEventSubscriberCollection();

      /**
      * Storage Events
      */
      [...]
      $eventSubscriberCollection-&gt;add(new FirstSpiritCmsDataStorageEventSubscriber());

      /**
      * Search Events
      */
      [...]

      return $eventSubscriberCollection;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Registration of the queues requires the following adaption of the <code>RabbitMqConfig</code> file in the <code><strong>Pyz/Client/RabbitMq</strong></code> directory:</p>
</div>
<div class="listingblock">
<div class="title">RabbitMqConfig</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php
namespace Pyz\Client\RabbitMq;

use ESpirit\Shared\FirstSpiritCmsDataStorage\FirstSpiritCmsDataStorageConfig;
[...]

class RabbitMqConfig extends SprykerRabbitMqConfig
{
   [...]

   protected function getPublishQueueConfiguration(): array
   {
      return [
         PublisherConfig::PUBLISH_QUEUE =&gt; [
            [...]
         ],
         GlossaryStorageConfig::PUBLISH_TRANSLATION,
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_BLOCK_DATA_CONNECTOR,
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_PAGE_DATA_CONNECTOR,
      ];
   }

   protected function getSynchronizationQueueConfiguration(): array
   {
      return [
         [...]
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_BLOCK_DATA,
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_PAGE_DATA
      ];
   }

   [...]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The registration of the event subscriber necessary for the queues requires an adjustment of the <code>QueueDependencyProvider</code> in the directory <code><strong>Pyz/Zed/Queue</strong></code>:</p>
</div>
<div class="listingblock">
<div class="title">QueueDependencyProvider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-PHP hljs" data-lang="PHP">&lt;?php
namespace Pyz\Zed\Queue;

use ESpirit\Shared\FirstSpiritCmsDataStorage\FirstSpiritCmsDataStorageConfig;
[...]

class QueueDependencyProvider extends SprykerDependencyProvider
{
   protected function getProcessorMessagePlugins(Container $container)
   {
      return [
         [...]
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_BLOCK_DATA_CONNECTOR =&gt; new EventQueueMessageProcessorPlugin(),
         FirstSpiritCmsDataStorageConfig::PUBLISH_FS_CMS_PAGE_DATA_CONNECTOR =&gt; new EventQueueMessageProcessorPlugin(),
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_BLOCK_DATA =&gt; new SynchronizationStorageQueueMessageProcessorPlugin(),
         FirstSpiritCmsDataStorageConfig::SYNC_FS_CMS_PAGE_DATA =&gt; new SynchronizationStorageQueueMessageProcessorPlugin(),
      ];
   }
}</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../_/js/site.js"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
