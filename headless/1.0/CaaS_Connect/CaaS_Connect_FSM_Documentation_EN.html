<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Module documentation :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Connect/CaaS_Connect_FSM_Documentation_EN.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/shortcut-icon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://e-spirit.github.io/Antora/cloud/1.0/index.html">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS/CaaS_FSM_Documentation_EN.html">CaaS</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Connect/CaaS_Connect_FSM_Documentation_EN.html">CaaS Connect</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/CaaS_Platform/CaaS_Platform_Documentation_EN.html">CaaS Platform</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_FSM/index.html">Navigation Service (FSM)</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_Platform/documentation.html">Navigation Service (Platform)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/chapters/introduction.html">Spartacus</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Salesforce/index.html">Salesforce</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/SAP_Classic/firstspiritconnect-sap-documentation_EN.html">SAP Classic</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <a class="navbar-item" href="https://e-spirit.github.io/Antora/dxm/1.0/index.html">DXM</a>
        <a class="navbar-item" href="https://community.crownpeak.com/t5/DQM/ct-p/dqm">DQM</a>
        <a class="navbar-item" href="https://community.crownpeak.com/t5/DG/ct-p/dg">DG</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="headless" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Headless</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../CaaS/CaaS_FSM_Documentation_EN.html">Content as a Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">CaaS Connect</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="CaaS_Connect_FSM_Documentation_EN.html">Module documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="CaaS_Connect_ServerAdministrator_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../CaaS_Platform/CaaS_Platform_Documentation_EN.html">CaaS Platform</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Navigation Service (FSM)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../Nav_Service_FSM/index.html">Main Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Nav_Service_FSM/chapters/architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Nav_Service_FSM/chapters/components.html">Components</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Nav_Service_FSM/chapters/config.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../Nav_Service_FSM/chapters/auth.html">Authentification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Nav_Service_FSM/Navigation_Service_Serveradmin_Documentation_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Nav_Service_Platform/documentation.html">Navigation Service (Platform)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Headless</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dxm/1.0/index.html">DXM</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dxm/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ecom/1.0/index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ecom/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../cloud/1.0/index.html">FirstSpirit Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../cloud/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Headless</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Headless</a></li>
    <li>CaaS Connect</li>
    <li><a href="CaaS_Connect_FSM_Documentation_EN.html">Module documentation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/headless/edit/main/modules/CaaS_Connect/pages/CaaS_Connect_FSM_Documentation_EN.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Module documentation</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Content as a Service provides the editorial data of FirstSpirit via a uniform JSON-based data format that can be consumed by any endpoint.
The data is updated transparently when it is changed or released in the FirstSpirit editorial system.
With a cloud installation of the Content as a Service platform the data can be efficiently accessed worldwide.
In FirstSpirit, only the form configurations and the data maintained by the editorial system are accessed.
Templating in FirstSpirit is completely eliminated and is shifted to the front end or front end services (for more information, see <a href="https://docs.e-spirit.com/module/fsxa/">FSXA documentation</a>).</p>
</div>
<div class="paragraph">
<p>The FirstSpirit developer can thus concentrate completely on modeling the domain-oriented objects and creating the corresponding input components.
The following section describes the conventions for data format and URLs, as well as the optimal delivery of content for different consumers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the remainder of this document the abbreviation <em>CaaS</em> will be used instead of <em>Content as a Service</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-general"><a class="anchor" href="#module-general"></a>2. Introduction FirstSpirit module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CaaS Connect module is the link between FirstSpirit editorial environment and the CaaS platform that acts as the content delivery.
This connection is largely invisible to the editorial team and only requires attention in the event of a technical problem.
The editors can always view the current state of data directly via the CaaS platform.
As soon as a change has been made in FirstSpirit, the synchronization is triggered in the background, and the database immediately reflects the change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are traditional and fragment projects in FirstSpirit.
Technical <em>pages</em> - and thus also the elements that are transferred to the CaaS platform - correspond to the page
references in traditional projects and to the fragments in fragment projects.
For the sake of simplicity we speak of <em>pages</em> in both cases.
The CaaS Connect module automatically distinguishes between traditional and fragment projects.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="caas-urls"><a class="anchor" href="#caas-urls"></a>2.1. CaaS URLs</h3>
<div class="paragraph">
<p>The smallest addressable element in a CaaS project is a page.
The module creates a document in the CaaS platform for each page and language for both the preview and release state.
In addition to pages, media are also synchronized.
Pictures are multiplied with all project languages and resolutions, while other media are transferred for all languages.
Each of these elements can be identified and referenced with a unique URL.</p>
</div>
<div class="sect3">
<h4 id="urlschema"><a class="anchor" href="#urlschema"></a>2.1.1. URL schema</h4>
<div class="paragraph">
<p>The CaaS URL for an element consists of four parts: tenant id, project identifier, collection identifier, and document identifier.
The tenant id is the maintained name or abbreviation of the tenant.
It is set in the <a href="https://docs.e-spirit.com/module/caas-connect/CaaS_Connect_ServerAdministrator_EN.html#automated-configuration-of-the-module">CaaS Connect Service</a> by the server administrator.
The project identifier is the GID of the FirstSpirit project.
The collection identifier allows you to differentiate between release and preview state.
For page documents and metadata documents of media it is either 'release.content' or 'preview.content'.
The document identifier consists of the FirstSpirit GID of the page as well as language and resolution.
Together with the base URL of the CaaS endpoint, this results in the fully qualified URL of an item.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The URL scheme for binary data of media differs slightly from the listed URL scheme and is therefore described separately in <a href="#mediaurls">chapter Media URLs</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CaaS URLs for project settings do not use their FirstSpirit GID as document identifier but instead use the identifier <em>projectsettings</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="paragraph">
<p>The tenant id is <strong>defaultTenant</strong>.</p>
</div>
<div class="paragraph">
<p>The FirstSpirit project GID is <strong>e54cb80e-1f9c-4e8d-84b8-022f473202eb</strong>.</p>
</div>
<div class="paragraph">
<p>The fully qualified CaaS URL of a sample page with the GID <strong>f6910b22-6ae8-4ce1-af45-c7b364b3117a</strong> in preview and for the English language looks like this</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/defaultTenant/e54cb80e-1f9c-4e8d-84b8-022f473202eb.preview.files/f6910b22-6ae8-4ce1-af45-c7b364b3117a.en_GB" class="bare">http://localhost:8080/defaultTenant/e54cb80e-1f9c-4e8d-84b8-022f473202eb.preview.files/f6910b22-6ae8-4ce1-af45-c7b364b3117a.en_GB</a></p>
</div>
<div class="paragraph">
<p><strong>CaaS endpoint:</strong> <a href="http://localhost:8080" class="bare">http://localhost:8080</a></p>
</div>
<div class="paragraph">
<p><strong>CaaS URL:</strong> defaultTenant/e54cb80e-1f9c-4e8d-84b8-022f473202eb.preview.files/f6910b22-6ae8-4ce1-af45-c7b364b3117a.en_GB</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For easier access the collection URLs of the project are shown in the <a href="https://docs.e-spirit.com/module/caas-connect/CaaS_Connect_ServerAdministrator_EN.html#projectapp">configuration dialog of the project component</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="mediaurls"><a class="anchor" href="#mediaurls"></a>2.1.2. Media URLs</h4>
<div class="paragraph">
<p>For each medium, two types of documents are generated, which can be queried in the CaaS platform:
Metadata and binary data.</p>
</div>
<div class="paragraph">
<p><strong>Metadata document</strong><br>
For a given medium, exactly one metadata document is created for each project language (regardless of whether the medium is language-dependent or not).
The metadata document will <strong>always</strong> be stored in the CaaS platform with a generated CaaS URL.
It contains the FirstSpirit metadata of the medium, as well as a list of resolutions and associated resolution-specific URLs.
The URL for the binary data of a specific medium for a specific language - and possibly a specific resolution - must be taken from this metadata document.</p>
</div>
<div class="paragraph">
<p>In case the CaaS platform is used to provide the media binary data, the same <a href="#url schema">URL schema of pages or metadata documents</a> is used.
The only difference is the collection identifier where either 'release.files' or 'preview.files' is used for the release or preview state.</p>
</div>
<div class="listingblock">
<div class="title">Example metadata document, content of <a href="http://localhost:8080/be8a58cd-c0c1-4b77-8220-b4515379010d/preview.content/1ee22c21-b646-4b13-873a-e62c612b0768.en_US" class="bare">http://localhost:8080/be8a58cd-c0c1-4b77-8220-b4515379010d/preview.content/1ee22c21-b646-4b13-873a-e62c612b0768.en_US</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
    "_id": "f6910b22-6ae8-4ce1-af45-c7b364b3117a.en_GB",
    "fsType": "Media",
    "name": "audio_video_connector",
    "displayName": "Connecting cable for audio and video",
    "identifier": "f6910b22-6ae8-4ce1-af45-c7b364b3117a",
    "uid": "audio_video_connector",
    "uidType": "MEDIASTORE_LEAF",
    "fileName": "audio-video-connector",
    "languageDependent": false,
    "mediaType": "PICTURE",
    "description": "Within this demo project \"Mithras Energy\"...",
    "resolutionsMetaData": {
        "110x73": {
            "fileSize": 3885,
            "extension": "jpg",
            "mimeType": "image/jpeg",
            "width": 110,
            "height": 73,
            "url": "http://localhost:8080/defaultTenant/e54cb80e-1f9c-4e8d-84b8-022f473202eb.preview.files/f6910b22-6ae8-4ce1-af45-c7b364b3117a.110x73/binary"
        },
        "ORIGINAL": {
            "fileSize": 69597,
            "extension": "jpg",
            "mimeType": "image/jpeg",
            "width": 693,
            "height": 462,
            "url": "http://localhost:8080/defaultTenant/e54cb80e-1f9c-4e8d-84b8-022f473202eb.preview.files/f6910b22-6ae8-4ce1-af45-c7b364b3117a.ORIGINAL/binary"
        }
    },
    "metaFormData": {},
    "locale": {
        "identifier": "EN",
        "country": "GB",
        "language": "en"
    },
    "_etag": {
        "$oid": "5f23f63dc9977b5e90c25dc2"
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The administrator can customize the media deployment configuration so that binary data from media URLs cannot be retrieved using CaaS URLs.
Therefore it&#8217;s very important that binary data URLs for media are always queried via the metadata document and are never generated by string concatenation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="data-format"><a class="anchor" href="#data-format"></a>2.2. Data format</h3>
<div class="paragraph">
<p>Unlike traditional FirstSpirit projects and earlier module versions, CaaS version 3 or later does not support either output channels or FirstSpirit templating.
Instead, a JSON document is generated for each page of the project, based on the <code>toJson</code> standard of FirstSpirit.
An adaptation of the format is not possible.
This restriction allows to deliver a complete, standardized data format via CaaS platform,
so that all consuming endpoints can work with the same data format.
Since the standard data format is very comprehensive, the platform offers filtering and aggregation capabilities
to reduce data volumes for mobile end points, for example.
For more information about CaaS platform, see <a href="https://docs.e-spirit.com/module/caas-platform/CaaS_Platform_Documentation_EN">platform documentation</a>.</p>
</div>
<div class="paragraph">
<p>Since the CaaS URLs derive the document identifier from a unique FirstSpirit ID (among other things),
it is necessary to use a filter when querying a document using its name.
To query a CaaS page (a FirstSpirit page reference) with the name <em>services</em> a GET request is executed with the following URL:</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/defaultTenant/e54cb80e-1f9c-4e8d-84b8-022f473202eb/preview.content?filter={'name'" class="bare">http://localhost:8080/defaultTenant/e54cb80e-1f9c-4e8d-84b8-022f473202eb/preview.content?filter={'name'</a>: "services"}</p>
</div>
<div class="paragraph">
<p>For more information on queries for the CaaS platform, see <a href="https://docs.e-spirit.com/module/caas-platform/CaaS_Platform_Documentation_EN">platform documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="_caas_json_format"><a class="anchor" href="#_caas_json_format"></a>2.2.1. CaaS JSON format</h4>
<div class="paragraph">
<p>The standard JSON format of FirstSpirit serves as the basis for the CaaS JSON format and is extended by the CaaS Connect module both with CaaS specific <a href="https://docs.e-spirit.com/odfs/enhanced-json-s/configuration/index.html">JSON format configuration</a>, as well as with some attributes that simplify its usage.
The CaaS specific format configurations include reducing the output of datasets to references, the <a href="#dynamiccontentresolution">indirect referencing of records of a content projection</a>, and enabling the output of the FirstSpirit metadata.</p>
</div>
<div class="paragraph">
<p><strong>Dataset URLs:</strong> FirstSpirit does not address individual datasets and instead works with content projections or selects and embeds datasets in pages.
In CaaS projects, individual datasets are identified by a unique URL and can be queried with it.
Therefore, pages do not embed datasets, but contain references to the stored datasets in the CaaS platform.</p>
</div>
<div class="listingblock">
<div class="title">JSON snippet example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "fsType" : "FS_DATASET",
   "name" : "st_button_link",
   "value" : {
      "fsType" : "DatasetReference",
      "target" : {
         "entityType" : "product",
         "fsType" : "Dataset",
         "identifier" : "fae0687b-c365-4851-919e-566f4d587201",
         "schema" : "products"
      }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Dataset routes:</strong> The <em>route</em> attribute contains the relative route of a dataset.
This route is only calculated if a preview page has been selected for the underlying table template.
The preview page should contain a content-projection for the rendered table, and the setting "number of entries per page" should be set to "1" (see <a href="https://docs.e-spirit.com/odfs/templates-basic/composition-tem/database-schema/dataset-output/index.html#content_projektion">Content Projection</a>).
This is the only way different datasets will have different routes.</p>
</div>
<div class="listingblock">
<div class="title">JSON snippet example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "route" : "/Company/Locations/Locations.html"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Fragment metadata:</strong> The attribute <em>fragmentMetaData</em> contains the attributes <em>id</em> (fragment ID) and <em>type</em> (fragment type).</p>
</div>
<div class="listingblock">
<div class="title">JSON snippet example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "fragmentMetaData": {
        "id": "378d5ec9_58f1_4dec_83bc_724dc93de5c2",
        "type": "news"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Locale:</strong> The <em>locale</em> attribute contains the attributes <em>identifier</em> (abbreviation of the language), <em>country</em> (associated country) and <em>language</em> (associated language).</p>
</div>
<div class="listingblock">
<div class="title">JSON snippet example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "locale": {
        "identifier": "EN",
        "country": "GB",
        "language": "en"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Media URL attributes in media metadata:</strong> The media metadata provided by FirstSpirit (see <a href="#mediaurls">Media URLs</a>) usually only includes the URL to a medium that was generated by a URL factory.</p>
</div>
<div id="dynamiccontentresolution" class="paragraph">
<p><strong>Content2Section:</strong> The JSON data of content projections or its sections contain references to its records when using the standard JSON configuration of FirstSpirit.
However, the CaaS Connect module uses a specific configuration for the JSON format so that the records are not referenced directly, but indirectly via a query object.
For this purpose, the query object contains identifiable attributes of the content projection.</p>
</div>
<div class="listingblock">
<div class="title">JSON snippet example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "displayName" : "blog",
   "entityType" : "blog",
   "filterParams" : {},
   "fsType" : "Content2Section",
   "maxPageCount" : 0,
   "name" : "blog",
   "ordering" : [
      {
         "ascending" : false,
         "attribute" : "fs_id"
      }
   ],
   "query" : null,
   "recordCountPerPage" : 1,
   "schema" : "global",
   "template" : {
      "displayName" : "Blog entry",
      "fsType" : "TableTemplate",
      "identifier" : "e657e0f0-0fd3-456f-b5ab-560a879ca748",
      "name" : "Blog entry",
      "uid" : "global.blog",
      "uidType" : "TEMPLATESTORE_SCHEMA"
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="release-and-preview"><a class="anchor" href="#release-and-preview"></a>2.3. Preview and release state</h3>
<div class="paragraph">
<p>An essential distinction between release and preview data states is made by both FirstSpirit and the CaaS Connect module.
The platform manages both states of data, which are distinguishable by different CaaS URLs (see <a href="#urlschema">URL schema</a>).
A synchronization of both data states is always based on certain actions that the editors perform in FirstSpirit.
Release actions are the only actions that update the release state, all other changes only affect the preview state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_manual_data_reconciliation"><a class="anchor" href="#_manual_data_reconciliation"></a>2.4. Manual data reconciliation</h3>
<div class="paragraph">
<p>For certain scenarios, it may be necessary to perform a full reconciliation between FirstSpirit and CaaS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Populating the CaaS with existing project data to start a project.</p>
</li>
<li>
<p>Reconciling data in the event of an error to manually restore data consistency between systems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This manual full reconciliation of the data is enabled via schedules, which are automatically created with the installation of the CaaS Connect module.
After module installation, the project contains two schedules <code>Caas Connect Release Generation</code> and <code>Caas Connect Preview Generation</code>, which can perform a full synchronization for the release or preview state.
These schedules are automatically updated when the CaaS Connect module is updated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changes to the configuration of these schedules are not persistent, as the schedules are reset to their original state by the automatic update.
If the configuration of these schedules needs to be changed, these changes have to be applied to a copy of the respective schedule.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_overwrite_the_complete_data_set"><a class="anchor" href="#_overwrite_the_complete_data_set"></a>2.4.1. Overwrite the complete data set</h4>
<div class="paragraph">
<p>If changes in the FirstSpirit project are expected to be visible in the CaaS data but instead are not reflected in the CaaS, the schedules can be used to overwrite the full data set of the CaaS.
For this purpose it is necessary to create a copy of the respective schedule and to adjust its configuration so that the <code>replicationMode</code> parameter of the script task contains the value <code>FULL</code> (in contrast to the default <code>DELTA</code>).
Running this task will then overwrite the complete data set in CaaS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hidden_sections"><a class="anchor" href="#_hidden_sections"></a>2.4.2. Hidden sections</h4>
<div class="paragraph">
<p>In FirstSpirit it is possible to hide sections.
The data of these sections is treated differently depending on the preview or release state.</p>
</div>
<div class="paragraph">
<p>Sections hidden in FirstSpirit are always part of the preview data, but never included in the release data.
The preview data also contains an additional JSON attribute named <code>displayed</code> per section.
This indicates whether the section is displayed or hidden and thus whether it is transferred to the CaaS as part of the release data.</p>
</div>
<div class="paragraph">
<p>Accordingly, the following possibilities for sections arise:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Visibility</th>
<th class="tableblock halign-left valign-top">Part of preview state</th>
<th class="tableblock halign-left valign-top">Value of <code>displayed</code> in preview state</th>
<th class="tableblock halign-left valign-top">Part of release state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displayed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hidden</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please note that the <code>displayed</code> attribute is only present in the preview state.
In the release state, only visible sections are present and therefore this attribute is not used there.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_push_notifications_change_streams"><a class="anchor" href="#_push_notifications_change_streams"></a>2.5. Push notifications (change streams)</h3>
<div class="paragraph">
<p>It is often convenient to be notified about changes in the CaaS platform.
For this purpose the CaaS platform offers change streams.
This feature allows a websocket connection to be established to the CaaS platform, through which events about the various changes are published.</p>
</div>
<div class="paragraph">
<p>By default, a <code>crud</code> change stream is provided for each collection created by CaaS Connect.
It publishes all <code>insert</code>, <code>replace</code>, <code>update</code> and <code>delete</code> events.
It is accessible at <code>&lt;collectionUrl&gt;/_streams/crud</code>.
The exact definition of the change streams can be accessed at any time in the collection metadata.</p>
</div>
<div class="paragraph">
<p>More information on using change streams is available in the <a href="https://docs.e-spirit.com/module/caas-platform/CaaS_Platform_Documentation_EN.html#push-notifications-change-streams">CaaS platform documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_indexes"><a class="anchor" href="#_indexes"></a>2.6. Indexes</h3>
<div class="paragraph">
<p>To query documents from CaaS platform, filters can be used that specify criteria for the documents to be returned.
To speed up filter queries on frequently used document attributes, various indexes are set up on some collections created by CaaS Connect.
Information on existing indices can be retrieved under <code>&lt;collectionUrl&gt;/_indexes/</code>.</p>
</div>
<div class="paragraph">
<p>The following indexes are set up in the collections <code>preview.content</code> and <code>release.content</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>idx_identifier_lang_country</code> with the attribute combination <code>identifier</code>, <code>locale.language</code> and <code>locale.country</code></p>
</li>
<li>
<p><code>idx_entity_lang_country</code> with the attribute combination <code>entityType</code>, <code>locale.language</code> and <code>locale.country</code></p>
</li>
<li>
<p><code>idx_fstype_lang_country</code> with attribute combination <code>fsType</code>, <code>locale.language</code> and <code>locale.country</code></p>
</li>
<li>
<p><code>idx_route</code> with the document attribute <code>route</code></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The order of the index fields is relevant.
Please use the <a href="https://docs.mongodb.com/manual/applications/indexes/">database documentation</a> to ensure that your filter queries are designed in such a way that the indexes are used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More information on indices is available in the <a href="https://docs.e-spirit.com/module/caas-platform/CaaS_Platform_Documentation_EN.html#indexes">CaaS platform documentation</a>.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
