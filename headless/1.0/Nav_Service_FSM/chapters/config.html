<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: CrownSpirit Documentation</title>
    <link rel="canonical" href="https://e-spirit.github.io/Antora/headless/1.0/Nav_Service_FSM/chapters/config.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <link rel="icon" href="../../../../_/img/shortcut-icon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://e-spirit.github.io/Antora">CrownSpirit Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Cloud</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">E-Commerce</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spryker/index.html">Spryker</a>
            <a class="navbar-item" href="https://e-spirit.github.io/Antora/ecom/1.0/Spartacus/index.html">Spartacus</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">FirstSpirit</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=editors">Editors</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=developers">Developers</a>
            <a class="navbar-item" href="https://docs.e-spirit.com/lp/?locale=en&main=firstspirit&sub=administrators">Administrators</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Crownpeak</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="headless" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Headless</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">CaaS Connect</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../CaaS_Connect/CaaS_Connect_FSM_Documentation_EN.html">Module documentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../CaaS_Connect/CaaS_Connect_ServerAdministrator_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../CaaS/CaaS_FSM_Documentation_EN.html">Content as a Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../CaaS_Platform/CaaS_Platform_Documentation_EN.html">CaaS Platform</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Navigation Service (FSM)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Main Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="components.html">Components</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="config.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="auth.html">Authentification</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Navigation_Service_Serveradmin_Documentation_EN.html">Admin Manual</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../Nav_Service_Platform/documentation.html">Navigation Service (Platform)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Headless</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../component-b/1.0/index.html">CrownSpirit Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../component-b/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../dxm/1.0/index.html">DXM</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../dxm/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../ecom/1.0/index.html">E-Commerce</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../ecom/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../cloud/1.0/index.html">FirstSpirit Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../cloud/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../fsxa-pwa/1.3.0/index.html">FSXA-PWA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../fsxa-pwa/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../fsxa-ui/4.1.0/index.html">FSXA-UI</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../fsxa-ui/4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../../../fsxa-ui/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../index.html">Headless</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../component-b/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Headless</a></li>
    <li>Navigation Service (FSM)</li>
    <li><a href="../index.html">Main Documentation</a></li>
    <li><a href="config.html">Configuration</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/pahl-espirit/headless/edit/main/modules/Nav_Service_FSM/pages/chapters/config.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The setup of the {nav} for operation on a server is done by configuring the {pak}: <code><em>{componentname}</em></code>.</p>
</div>
<div class="paragraph">
<p>The following subchapters describe the required configuration steps.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/Nav_Service_FSM/pages/chapters/config.adoc - include::chapters/projectappconfig.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The {navm} makes it possible to query the structure of the {fs} site store of a {fs} project via the {navs}.</p>
</div>
<div class="paragraph">
<p>The following sections describe how such a navigation is created and how to optionally enrich it with additional information.</p>
</div>
<div class="sect2">
<h3 id="generation"><a class="anchor" href="#generation"></a>Creation of the navigation</h3>
<div class="paragraph">
<p>The navigations for the preview and release state are updated each time a page reference, structure folder or root node of the site structure has been changed or released.
Additionally, an update of the navigation is triggered by changes to pages, if the page is referenced by at least a single page reference.</p>
</div>
<div class="paragraph">
<p>When changes are made to the global URL settings of the project, both the preview and the release state are updated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Navigations are created for each language of the project as well as for each release status.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Navigations that correspond to a language that is not part of the project are deleted daily as part of a change-triggered update.</p>
</div>
<div class="sect3">
<h4 id="_resilience"><a class="anchor" href="#_resilience"></a>Resilience</h4>
<div class="paragraph">
<p>Occasionally, an update of the navigation may fail for a variety of reasons.
Therefore, the process is reattempted several times over more than a day.</p>
</div>
</div>
<div class="sect3">
<h4 id="_scheduled_tasks"><a class="anchor" href="#_scheduled_tasks"></a>Scheduled Tasks</h4>
<div class="paragraph">
<p>It is also possible to trigger the generation of the navigation by a {fs} scheduled task.
When installing the project app, two jobs are added to the project for this purpose: <em>Navigation Live Generation</em> and <em>Navigation Preview Generation</em>.
These consist of two tasks each, which transmit the current navigations in all languages to the {nav} and delete existing navigations for which there is no corresponding language in the project.</p>
</div>
<div class="sect4">
<h5 id="_navigation_at_generation_time"><a class="anchor" href="#_navigation_at_generation_time"></a>Navigation at generation time</h5>
<div class="paragraph">
<p>The <em>NavigationInspectionExecutable</em> can be used to calculate the navigation tree for a specified element at generation time.
It expects the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">en.espirit.firstspirit.access.store.IDprovider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The {fs} element (page reference, structure folder or root node of the structure store element) for which the navigation should be calculated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">en.espirit.firstspirit.access.Language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The {fs} language object for which the navigation should be calculated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The attribute to be returned as a result object.
If not set, the entire navigation element is returned.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The return value is a JSON object. The method <code>.toString()</code> provides the serialized JSON of the object.
If the <em>key</em> parameter is set and the specified attribute has a primitive type, a String is always returned directly.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custmdata"><a class="anchor" href="#custmdata"></a>Custom Data</h3>
<div class="paragraph">
<p>If the navigation data in the generated standard format is not sufficient, it is possible to add further information to the navigation.
The Navigation Service Module provides the so-called <em>Custom Data Script</em> for this purpose.
It allows users to transfer self-defined content to the {navs}.</p>
</div>
<div class="paragraph">
<p>One use case for this is, for example, a page description, which is required in addition to the navigation information for the presentation.</p>
</div>
<div class="paragraph">
<p>The following chapter describes the setup of exactly this particular use case.</p>
</div>
<div class="sect3">
<h4 id="_setting_up_a_custom_data_script"><a class="anchor" href="#_setting_up_a_custom_data_script"></a>Setting up a Custom Data Script</h4>
<div class="paragraph">
<p>Open the {sa} and add a script to your project with the following reference name: <code>navigation_service_custom_data</code>.</p>
</div>
<div class="paragraph">
<p>Within the script it is necessary to write the code into the first output channel.</p>
</div>
<div class="listingblock">
<div class="title">Example implementation of a Custom Data Script</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JAVA hljs" data-lang="JAVA">import de.espirit.firstspirit.access.store.pagestore.Page;
import de.espirit.firstspirit.access.store.sitestore.PageRef;

if (e instanceof PageRef) {
    page = e.getPage();
    formData = page.getFormData();
    pageDescription = formData.get(language, "pt_pageDescription").get();
    customData.put("pageDescription", pageDescription);
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The CustomData Script is evaluated directly after the creation with each following change at the {fs} project as well the release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">The resulting JSON of an exemplary {fs} page reference</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
    "id": "815c307c-2ca6-4f02-9653-fa3454988fc2",
    "label": "Products",
    "seoRoute": "/Products/Products.html",
    "seoRouteRegex": null,
    "contentReference": "/examplePrefix/Products/Products.html",
    "customData": {
        "pageDescription": "Our Offers"
    },
    "_links": {
        "self": {
            "href": "https://navigation-example.e-spirit.live/navigation/preview.7c5c1555-c706-45a7-8371-ccddbb4ba8be/node/815c307c-2ca6-4f02-9653-fa3454988fc2?depth=10&amp;language=de_DE"
        },
        "path": {
            "href": "https://navigation-example.e-spirit.live/navigation/preview.7c5c1555-c706-45a7-8371-ccddbb4ba8be/node/815c307c-2ca6-4f02-9653-fa3454988fc2/path?depth=10&amp;language=de_DE"
        },
        "seoRoute": {
            "href": "https://navigation-example.e-spirit.live/navigation/preview.7c5c1555-c706-45a7-8371-ccddbb4ba8be/by-seo-route/Products/Products.html?depth=10&amp;language=de_DE"
        }
    },
    "visible": false,
    "permissions": {
        "allowed": ["customer", "admin"],
        "forbidden": ["anonym"]
    },
    "children": null,
    "hasChildren": false
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can find all information on the use and format of the generated navigation structure in the corresponding <a href="https://navigationservice.e-spirit.cloud/docs/user/en/documentation.html">{navs} documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to the already mentioned IDProvider, other fields are available to the script within the execution context:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">de.espirit.firstspirit.access.store.IDProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current {fs} element (page reference, structure folder or root node of the structure store element).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">de.espirit.firstspirit.access.BaseContext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of an <a href="https://docs.e-spirit.com/odfs/dev/en/espirit/firstspirit/access/BaseContext.html">{fs}-SpecialistBroker</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">de.espirit.firstspirit.access.Language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The {fs} language object at runtime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">customData</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, Object&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entries in this map are written to the custom data and then provided by the {navs}.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that the maximum size of the customData map is limited to five entries.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The values must be equivalent to JSON primitives (e.g. String, Number or Boolean).</p>
</div>
<div class="paragraph">
<p>If you have a use case that cannot be covered by the above-mentioned fields, please contact <a href="https://help.e-spirit.com/">e-Spirit Support</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_content_projections"><a class="anchor" href="#_content_projections"></a>Content projections</h3>
<div class="paragraph">
<p>In the case of a content projection for detailed views the related navigation nodes contain an attribute that can be used to resolve dynamic routes.
A content projection is regarded as a projection for detail views if the following attributes are configured in the <strong>Content</strong> tab of a page reference:</p>
</div>
<div class="paragraph">
<p><strong>The *Number of entries per page</strong> value is greater than 0 (e.g. 1)
<strong>The *Maximum number of pages</strong> value is not 1 (e.g. 0)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/images/contentprojection-detail.png" alt="contentprojection detail">
</div>
<div class="title">Figure 1. Content projection of a detail page view for products</div>
</div>
<div class="paragraph">
<p>If such a content projection exists in the project, the associated navigation node contains the attribute <code>seoRouteRegex</code>.
The value of the attribute is a regular expression describing the dynamic route of the content projection.
For the above example of a detail page view for products the value <code>^[\/]?products\/[^\s\/]+$</code> would be generated for the <code>seoRouteRegex</code> attribute.</p>
</div>
<div class="paragraph">
<p>The {nav} also supports resolving a dynamic route to the corresponding navigation node.
Further information is available in the {nav} documentation in the chapter <a href="https://navigationservice.e-spirit.cloud/docs/user/en/documentation.html#api-endpoints">API endpoints</a>.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
